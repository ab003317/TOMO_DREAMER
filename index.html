<head><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,interactive-widget=overlays-content"/><script>if(window.opener&&window.location.search.includes("code=")){const o=new URLSearchParams(window.location.search).get("code");o&&(window.opener.postMessage({type:"discord-auth-code",code:o},"*"),window.close(),document.write("Authentication successful. Closing window..."),window.stop())}</script><script type="module">import{default as e}from'https://testingcf.jsdelivr.net/npm/html2canvas/+esm';import{default as t}from'https://testingcf.jsdelivr.net/npm/axios/+esm';import{compile as a}from'https://testingcf.jsdelivr.net/npm/@vue/compiler-dom/+esm';var n={374:(e,t,a)=>{a.d(t,{An:()=>v,RV:()=>f,WC:()=>N,getAllBackgroundImages:()=>h,getAllCharacterImages:()=>k,w7:()=>c,wO:()=>E,xg:()=>y,zP:()=>i});var n=a(894);a(514);function o(e){return'string'==typeof e?e:''}function l(e){return{eventPackId:o(e?.eventPackId),eventPackName:o(e?.eventPackName),backgroundImages:Array.isArray(e?.backgroundImages)?e.backgroundImages.map((e,t)=>({id:o(e?.id)||`bg_${t}`,name:o(e?.name),imageUrl:o(e?.imageUrl)})).filter(e=>!!e.imageUrl):[],characterImages:Array.isArray(e?.characterImages)?e.characterImages.map((e,t)=>({id:o(e?.id)||`char_${t}`,characterName:o(e?.characterName),imageUrl:o(e?.imageUrl),expression:o(e?.expression),outfit:o(e?.outfit),isFallback:!!e?.isFallback})).filter(e=>!!e.imageUrl&&!!e.characterName):[],userWidgets:Array.isArray(e?.userWidgets)?e.userWidgets.map((e,t)=>({id:o(e?.id)||`widget_${t}`,name:o(e?.name),code:o(e?.code)||void 0,vueCode:o(e?.vueCode)||void 0,cssCode:o(e?.cssCode)||void 0,css:o(e?.css)||void 0,description:o(e?.description)||void 0})).filter(e=>!!e.id):[]}}function r(e){if(!e||'object'!=typeof e)return null;const t=l({eventPackId:o(e.eventPackId??e.id),eventPackName:o(e.eventPackName??e.name),backgroundImages:Array.isArray(e.backgroundImages)?e.backgroundImages:[],characterImages:Array.isArray(e.characterImages)?e.characterImages:[],userWidgets:Array.isArray(e.userWidgets)?e.userWidgets:[]});return t.eventPackId||t.eventPackName?t:null}function i(e){const t=e??{},a=Array.isArray(t.backgroundImages)?t.backgroundImages:[],n=Array.isArray(t.sceneBackgrounds)?t.sceneBackgrounds:[],l=a.length>0?a:n;return{backgroundImages:Array.isArray(l)?l.map((e,t)=>'string'==typeof e?{id:`bg_${t}`,name:'',imageUrl:e}:{id:e?.id||`bg_${t}`,name:e?.name||e?.title||e?.linkedVariable||e?.condition||e?.trigger||'',imageUrl:e?.imageUrl||e?.url||e?.src||''}).filter(e=>!!e?.imageUrl):[],characterImages:Array.isArray(t.characterImages)?t.characterImages.map(e=>({id:e?.id,characterName:e?.characterName,imageUrl:e?.imageUrl,expression:e?.expression||e?.diffName||'',outfit:e?.outfit||'',isFallback:!!e?.isFallback})):[],userWidgets:Array.isArray(t.userWidgets)?t.userWidgets.map((e,t)=>({id:o(e?.id)||`widget_${t}`,name:o(e?.name),code:o(e?.code)||void 0,vueCode:o(e?.vueCode)||void 0,cssCode:o(e?.cssCode)||void 0,css:o(e?.css)||void 0,description:o(e?.description)||void 0})):[],eventPackName:'string'==typeof t.name?t.name:'',eventPackId:'string'==typeof t.id?t.id:''}}function c(e){const t=g(),a=i(e);a.eventPackId&&(t?.eventPackId===a.eventPackId&&Array.isArray(t?.userWidgets)||f(a))}const s='current_game_assets',d='current_game_assets_v1';let u=null;function m(e){return e&&'object'==typeof e&&'idb_runtime_asset'===e.__ref&&'string'==typeof e.runtimeId}function p(e){u=e;try{window.__CURRENT_GAME_ASSETS__=e}catch{}}async function v(){if(u)return u;try{const e=sessionStorage.getItem(s);if(!e)return null;const t=JSON.parse(e);if(!t)return null;if(m(t)){const e=r(await n.idbService.getRuntimeAsset(t.runtimeId));return e?(p(e),e):null}const a=r(t);return a?(p(a),a):null}catch(e){return console.error('[GameAssets] Failed to hydrate game assets:',e),null}}function g(){if(u)return u;try{const e=window.__CURRENT_GAME_ASSETS__;if(e)return u=e,e}catch{}try{const e=sessionStorage.getItem(s);if(!e)return null;const t=JSON.parse(e);return m(t)?null:(u=t,t)}catch(e){return console.error('[GameAssets] Failed to parse game assets:',e),null}}function f(e){p(e);try{sessionStorage.setItem(s,JSON.stringify(e)),console.log('[GameAssets] Saved game assets:',e.eventPackName)}catch(t){if(function(e){const t=e;return!!t&&('QuotaExceededError'===t?.name||'NS_ERROR_DOM_QUOTA_REACHED'===t?.name||'string'==typeof t?.message&&/quota/i.test(t.message))}(t)){console.warn('[GameAssets] sessionStorage quota exceeded; falling back to IndexedDB runtime asset');const t=l(e);n.idbService.setRuntimeAsset(d,t).catch(e=>{console.warn('[GameAssets] Failed to persist assets to IndexedDB:',e)});const a={__ref:'idb_runtime_asset',runtimeId:d,eventPackId:e.eventPackId,eventPackName:e.eventPackName};try{sessionStorage.setItem(s,JSON.stringify(a))}catch(e){console.error('[GameAssets] Failed to save even the reference:',e)}return}console.error('[GameAssets] Failed to save game assets:',t)}}function y(){p(null);try{const e=sessionStorage.getItem(s);if(e){const t=JSON.parse(e);m(t)&&n.idbService.deleteRuntimeAsset(t.runtimeId).catch(()=>{})}}catch{}sessionStorage.removeItem(s),console.log('[GameAssets] Cleared game assets')}function h(){const e=g();return e?.backgroundImages||[]}function k(){const e=g();return e?.characterImages||[]}function N(e){const t=g();return t?.userWidgets.find(t=>t.id===e)}function E(){const e=g();return e?.userWidgets||[]}},514:(e,t,a)=>{a.d(t,{Ao:()=>r,V_:()=>o,uF:()=>l});const n=e=>(e??'').trim().toLowerCase();function o(e){return e?e.split(/[，,、;；|\n\r\t]/g).map(e=>e.trim()).filter(Boolean):[]}function l(e,t,a='equals'){const l=n(t);if(!l)return!1;const r=o(e).map(n).filter(Boolean);return 0!==r.length&&('includes'===a?r.some(e=>l.includes(e)||e.includes(l)):r.includes(l))}function r(e,t,a='equals'){const l=n(t);if(!l)return 0;const r=o(e).map(n).filter(Boolean);if(0===r.length)return 0;if('includes'===a){let e=0;for(const t of r)t&&(l.includes(t)||t.includes(l))&&(e=Math.max(e,Math.min(t.length,l.length)));return e}return r.includes(l)?1:0}},772:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a}},823:()=>{$(()=>{console.log('Ethereal Echoes: 界面已加载')}),$(window).on('pagehide',()=>{console.log('Ethereal Echoes: 界面已卸载')})},894:(e,t,a)=>{a.d(t,{idbService:()=>i});const n='works',o='saves',l='runtime_assets',r='kv';const i=new class{db=null;async open(){return this.db?this.db:new Promise((e,t)=>{const a=indexedDB.open('WorkshopDB',5);a.onerror=e=>{console.error('IDB open error:',e),t('Failed to open database')},a.onsuccess=t=>{this.db=t.target.result,e(this.db)},a.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(n)||t.createObjectStore(n,{keyPath:'id'}),t.objectStoreNames.contains(o)||t.createObjectStore(o,{keyPath:'id'}),t.objectStoreNames.contains(l)||t.createObjectStore(l,{keyPath:'id'}),t.objectStoreNames.contains(r)||t.createObjectStore(r,{keyPath:'key'})}})}async getAllWorks(){const e=await this.open();return new Promise((t,a)=>{const o=e.transaction(n,'readonly').objectStore(n).getAll();o.onsuccess=()=>{t(o.result)},o.onerror=()=>{a('Failed to fetch works')}})}async saveWork(e){const t=await this.open();return new Promise((a,o)=>{const l=t.transaction(n,'readwrite').objectStore(n).put(e);l.onsuccess=()=>{a()},l.onerror=()=>{o('Failed to save work')}})}async deleteWork(e){const t=await this.open();return new Promise((a,o)=>{const l=t.transaction(n,'readwrite').objectStore(n).delete(e.toString());l.onsuccess=()=>{a()},l.onerror=()=>{o('Failed to delete work')}})}async getAllSaves(){const e=await this.open();return new Promise((t,a)=>{const n=e.transaction(o,'readonly').objectStore(o).getAll();n.onsuccess=()=>{t(n.result)},n.onerror=()=>{a('Failed to fetch saves')}})}async getSave(e){const t=await this.open();return new Promise((a,n)=>{const l=t.transaction(o,'readonly').objectStore(o).get(e);l.onsuccess=()=>{a(l.result)},l.onerror=()=>{n('Failed to get save')}})}async saveSave(e){const t=await this.open();return new Promise((a,n)=>{const l=t.transaction(o,'readwrite').objectStore(o).put(e);l.onsuccess=()=>{a()},l.onerror=()=>{n('Failed to save game')}})}async deleteSave(e){const t=await this.open();return new Promise((a,n)=>{const l=t.transaction(o,'readwrite').objectStore(o).delete(e);l.onsuccess=()=>{a()},l.onerror=()=>{n('Failed to delete save')}})}async setRuntimeAsset(e,t){const a=await this.open();return new Promise((n,o)=>{const r=a.transaction(l,'readwrite').objectStore(l),i={id:e,value:t,updatedAt:Date.now()};try{const e=r.put(i);e.onsuccess=()=>n(),e.onerror=()=>o(e.error??new Error('Failed to save runtime asset'))}catch(e){o(e)}})}async getRuntimeAsset(e){const t=await this.open();return new Promise((a,n)=>{const o=t.transaction(l,'readonly').objectStore(l).get(e);o.onsuccess=()=>{const e=o.result;a(e?.value)},o.onerror=()=>n('Failed to get runtime asset')})}async deleteRuntimeAsset(e){const t=await this.open();return new Promise((a,n)=>{const o=t.transaction(l,'readwrite').objectStore(l).delete(e);o.onsuccess=()=>a(),o.onerror=()=>n('Failed to delete runtime asset')})}async setKV(e,t){const a=await this.open();return new Promise((n,o)=>{const l=a.transaction(r,'readwrite').objectStore(r),i={key:e,value:t,updatedAt:Date.now()},c=l.put(i);c.onsuccess=()=>n(),c.onerror=()=>o('Failed to save kv')})}async getKV(e){const t=await this.open();return new Promise((a,n)=>{const o=t.transaction(r,'readonly').objectStore(r).get(e);o.onsuccess=()=>{const e=o.result;a(e?.value)},o.onerror=()=>n('Failed to get kv')})}async deleteKV(e){const t=await this.open();return new Promise((a,n)=>{const o=t.transaction(r,'readwrite').objectStore(r).delete(e);o.onsuccess=()=>a(),o.onerror=()=>n('Failed to delete kv')})}}}},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var a=o[e]={exports:{}};return n[e](a,a.exports,l),a.exports}l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);l(823);const r=Vue,i=VueRouter,c={class:'th-mobile-input-bar__row'},s={class:'th-mobile-input-bar__title'},d=['placeholder','value'],u=['placeholder','value'],m=(0,r.defineComponent)({__name:'MobileKeyboardInputBar',setup(e){function t(e){if(!e)return!1;if('1'===e.dataset?.noMobileProxy)return!1;if(e instanceof HTMLTextAreaElement)return!0;if(e instanceof HTMLInputElement){const t=(e.type||'').toLowerCase();return'text'===t||'search'===t||'url'===t||'email'===t||'tel'===t||'password'===t||''===t}return!1}const a=(0,r.ref)(!1),n=(0,r.ref)(0);function o(){try{return navigator?.virtualKeyboard||null}catch{return null}}function l(){const e=o();if(!e?.boundingRect)return null;const t=e.boundingRect;if(!t||!Number.isFinite(t.height)||t.height<=0)return null;return t.y+t.height<window.innerHeight-8?null:t.y}let i=null,m=0,p=null,v=null,g=!1;function f(){if(i=null,m=0,null!=p){try{window.clearTimeout(p)}catch{}p=null}}function y(){setTimeout(()=>{try{return void b.value?.focus?.({preventScroll:!0})}catch{}try{b.value?.focus()}catch{}},0)}function h(e){if(!e)return!1;const t=l();if(null!=t)try{const a=e.getBoundingClientRect(),n=18;return a.bottom>t-n}catch{return!1}const a=window.visualViewport;if(!a)return!1;try{const t=e.getBoundingClientRect(),n=a.offsetTop,o=a.height+a.offsetTop,l=18;return t.bottom>o-l||t.top<n+l}catch{return!1}}function k(){if(!i)return;const e=Date.now(),t=window.visualViewport,a=l();return t||null!=a?n.value>=120||h(i)?(C(i),y(),void f()):void(m&&e>=m?f():null==p&&(p=window.setTimeout(()=>{p=null,k()},120))):(C(i),y(),void f())}const N=(0,r.reactive)({active:!1,value:'',placeholder:'',isTextarea:!0,target:null}),E=(0,r.computed)(()=>a.value&&N.active),V=(0,r.computed)(()=>N.target&&N.target instanceof HTMLTextAreaElement?'输入（小键盘输入栏）':'输入'),b=(0,r.ref)(null),w=(0,r.ref)(null);function C(e){N.target=e,N.isTextarea=e instanceof HTMLTextAreaElement,N.placeholder=e.getAttribute('placeholder')||'',N.value=e.value??'',N.active=!0}function S(e){if(e)try{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation?.()}catch{}f(),N.active=!1,N.target=null;try{b.value?.blur()}catch{}}function B(){if(!a.value)return;if(!N.active&&!i)return;const e=l();let t=0;if(null!=e)t=Math.max(0,Math.floor(window.innerHeight-e));else{const e=window.visualViewport;if(!e)return void(n.value=0);t=Math.max(0,Math.floor(window.innerHeight-(e.height+e.offsetTop)))}if(n.value=t,k(),N.active&&t<120){h(N.target)||S()}}function x(){a.value&&(N.active||i)&&(g||(g=!0,v=requestAnimationFrame(()=>{v=null,g=!1,B()})))}function I(e){const t=e.target.value;N.value=t;const a=N.target;a&&(a.value=t,a.dispatchEvent(new Event('input',{bubbles:!0})))}function T(e){const t=N.target;if(t)try{t.dispatchEvent(new KeyboardEvent('keydown',{key:e.key,code:e.code,location:e.location,repeat:e.repeat,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,bubbles:!0,cancelable:!0}))}catch{}}const A=(0,r.computed)(()=>({'--th-kb-inset':`${n.value||0}px`}));let M=null,D=null,P=null,O=null,R=null,L=null,U=null;return(0,r.onMounted)(()=>{if(a.value=function(){if('undefined'==typeof window)return!1;const e=navigator.userAgent||'',t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),a=window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,n=window.innerWidth<=1024;return t||a&&n}(),!a.value)return;B();try{const e=o();e&&'boolean'==typeof e.overlaysContent&&(e.overlaysContent=!0)}catch{}L=()=>x(),window.addEventListener('resize',L,{passive:!0});try{const e=o();U=()=>x(),e?.addEventListener?.('geometrychange',U,{passive:!0})}catch{}const e=window.visualViewport;O=()=>x(),R=()=>x(),e&&(e.addEventListener('resize',O,{passive:!0}),e.addEventListener('scroll',R,{passive:!0})),M=e=>{if(!a.value)return;const n=e.target;w.value&&n&&w.value.contains(n)||t(n)&&(i=n,m=Date.now()+900,B())},D=e=>{if(!a.value)return;const n=e.target;N.target&&n===N.target&&setTimeout(()=>{const e=document.activeElement;t(e)||e&&e===b.value||S()},0)},P=e=>{if(!a.value)return;if(!N.active)return;const n=e.target;t(n)&&N.target&&n===N.target&&(N.value=n.value??'')},document.addEventListener('focusin',M,!0),document.addEventListener('focusout',D,!0),document.addEventListener('input',P,!0)}),(0,r.onUnmounted)(()=>{f(),function(){if(null!=v){try{cancelAnimationFrame(v)}catch{}v=null}g=!1}();try{M&&document.removeEventListener('focusin',M,!0),D&&document.removeEventListener('focusout',D,!0),P&&document.removeEventListener('input',P,!0)}catch{}try{const e=window.visualViewport;e&&O&&e.removeEventListener('resize',O),e&&R&&e.removeEventListener('scroll',R)}catch{}try{L&&window.removeEventListener('resize',L)}catch{}try{const e=o();e&&U&&e.removeEventListener?.('geometrychange',U)}catch{}}),(e,t)=>E.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,ref_key:'barRoot',ref:w,class:'th-mobile-input-bar',style:(0,r.normalizeStyle)(A.value),onPointerdown:t[3]||(t[3]=(0,r.withModifiers)(()=>{},['stop'])),onPointerup:t[4]||(t[4]=(0,r.withModifiers)(()=>{},['stop'])),onClick:t[5]||(t[5]=(0,r.withModifiers)(()=>{},['stop'])),onTouchstart:t[6]||(t[6]=(0,r.withModifiers)(()=>{},['stop'])),onTouchend:t[7]||(t[7]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.createElementVNode)('div',c,[(0,r.createElementVNode)('div',s,(0,r.toDisplayString)(V.value),1),(0,r.createElementVNode)('button',{class:'th-mobile-input-bar__close',type:'button',onPointerdown:(0,r.withModifiers)(S,['stop','prevent']),onPointerup:t[0]||(t[0]=(0,r.withModifiers)(()=>{},['stop','prevent'])),onClick:(0,r.withModifiers)(S,['stop','prevent']),onTouchstart:t[1]||(t[1]=(0,r.withModifiers)(()=>{},['stop','prevent'])),onTouchend:t[2]||(t[2]=(0,r.withModifiers)(()=>{},['stop','prevent']))},[...t[8]||(t[8]=[(0,r.createElementVNode)('span',{'aria-hidden':'true'},'×',-1)])],32)]),N.isTextarea?((0,r.openBlock)(),(0,r.createElementBlock)('textarea',{key:0,ref_key:'proxyField',ref:b,class:'th-mobile-input-bar__field','data-no-mobile-proxy':'1',placeholder:N.placeholder,value:N.value,rows:'2',onInput:I,onKeydown:T},null,40,d)):((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:1,ref_key:'proxyField',ref:b,class:'th-mobile-input-bar__field',type:'text','data-no-mobile-proxy':'1',placeholder:N.placeholder,value:N.value,onInput:I,onKeydown:T},null,40,u))],36)):(0,r.createCommentVNode)('v-if',!0)}});var p=l(772);const v=(0,p.A)(m,[['__scopeId','data-v-2113ddac']]),g=['title'],f={key:0,xmlns:'http://www.w3.org/2000/svg',width:'18',height:'18',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2','stroke-linecap':'round','stroke-linejoin':'round'},y={key:1,xmlns:'http://www.w3.org/2000/svg',width:'18',height:'18',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2','stroke-linecap':'round','stroke-linejoin':'round'},h='ethereal_fs_btn_pos',k=(0,r.defineComponent)({__name:'App',setup(e){const t=(0,r.ref)(null),a=(0,r.ref)(null),n=(0,r.ref)(!1),o=(0,r.ref)(!1),l=(0,r.computed)(()=>n.value||o.value),i=(0,r.reactive)({width:0,height:0,rotateDeg:0,scale:1}),c=(0,r.ref)(!1),s=(0,r.reactive)({w:0,h:0}),d=(0,r.computed)(()=>{if(!c.value)return;const e=s.h;return e?{height:`${e}px`}:void 0}),u=(0,r.computed)(()=>{if(!c.value)return;const e=s.h;return{height:e?`${e}px`:void 0}});function m(e=!1){try{if(c.value=p(),!c.value)return;const t=Math.max(0,Math.floor(window.innerWidth||0)),a=Math.max(0,Math.floor(window.innerHeight||0));if(!t||!a)return;const n=Math.abs(t-(s.w||t))>80;(e||0===s.w||0===s.h||n)&&(s.w=t,s.h=a)}catch{}}function p(){if('undefined'==typeof window)return!1;const e=navigator.userAgent||'',t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),a=window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,n=window.innerWidth<=1024;return t||a&&n}function k(){try{const e=document.documentElement;p()?(e.dataset.thMobile='1',e.dataset.thPerf='low'):(delete e.dataset.thMobile,delete e.dataset.thPerf)}catch{}}const N=(0,r.computed)(()=>{if(!l.value)return;const e=i.width||0,t=i.height||0;return{position:'absolute',left:'50%',top:'50%',width:e?`${e}px`:'100%',height:t?`${t}px`:'100%',transform:`translate(-50%, -50%) rotate(${i.rotateDeg||0}deg) scale(${i.scale||1}) translateZ(0)`,transformOrigin:'center center',backfaceVisibility:'hidden',perspective:'1000px'}}),E=(0,r.reactive)({x:20,y:20});let V=!1,b=!1,w=0,C=0,S=0,B=0,x=null,I=null;function T(){const e=t.value,n=a.value;if(!e||!n)return;const o=e.getBoundingClientRect(),l=n.offsetWidth||40,r=n.offsetHeight||40;E.x=Math.max(0,Math.min(o.width-l,E.x)),E.y=Math.max(0,Math.min(o.height-r,E.y))}function A(e){if('mouse'===e.pointerType&&0!==e.button)return;const t=a.value;if(t){x=e.pointerId,I=e.pointerType,V=!0,b=!1,w=e.clientX,C=e.clientY,S=E.x,B=E.y;try{t.setPointerCapture(e.pointerId)}catch{}document.addEventListener('pointermove',M,{passive:!1}),document.addEventListener('pointerup',D),document.addEventListener('pointercancel',D)}}function M(e){if(!V)return;if(null!=x&&e.pointerId!==x)return;const t=e.clientX-w,a=e.clientY-C;(Math.abs(t)>3||Math.abs(a)>3)&&(b=!0),E.x=S+t,E.y=B+a,T(),'touch'===I&&e.preventDefault()}async function D(e){null!=x&&e.pointerId!==x||(V=!1,x=null,I=null,document.removeEventListener('pointermove',M),document.removeEventListener('pointerup',D),document.removeEventListener('pointercancel',D),function(){try{localStorage.setItem(h,JSON.stringify({x:E.x,y:E.y}))}catch{}}(),b||await async function(){const e=t.value;if(!e)return;if(o.value)return o.value=!1,void P();if('function'==typeof e.requestFullscreen&&'function'==typeof document.exitFullscreen)try{return void(document.fullscreenElement?await document.exitFullscreen():await e.requestFullscreen())}catch(e){console.warn('[Fullscreen] native failed, fallback to pseudo:',e)}o.value=!0,P(),await async function(){try{const e=screen;e.orientation?.lock&&await e.orientation.lock('landscape')}catch{}}()}())}function P(){if(k(),m(!1),!l.value)return i.width=0,i.height=0,i.rotateDeg=0,i.scale=1,void requestAnimationFrame(()=>T());const e=Math.max(1,c.value&&s.w?s.w:window.innerWidth),t=Math.max(1,c.value&&s.h?s.h:window.innerHeight);if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){const a=1920,n=1080,o=t>e,l=Math.max(e,t),r=Math.min(e,t),c=Math.min(l/a,r/n);i.width=a,i.height=n,i.rotateDeg=o?90:0,i.scale=c}else{const a=t>e,n=a?t:e,o=a?e:t,l=4,r=Math.max(1,n-l),c=Math.max(1,o-l),s=Math.min(r,16*c/9),d=Math.min(c,9*r/16);i.width=Math.round(s),i.height=Math.round(d),i.rotateDeg=a?90:0,i.scale=1}requestAnimationFrame(()=>T())}function O(){n.value=!!document.fullscreenElement,P()}return(0,r.onMounted)(()=>{!function(){try{const e=localStorage.getItem(h);if(e){const t=JSON.parse(e);'number'==typeof t.x&&'number'==typeof t.y&&(E.x=t.x,E.y=t.y)}}catch{}}(),document.addEventListener('fullscreenchange',O),window.addEventListener('resize',P),window.addEventListener('orientationchange',P),k(),m(!0),P()}),(0,r.onUnmounted)(()=>{document.removeEventListener('fullscreenchange',O),window.removeEventListener('resize',P),window.removeEventListener('orientationchange',P)}),(0,r.watch)(l,()=>{P()}),(e,n)=>{const o=(0,r.resolveComponent)('RouterView');return(0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['ethereal-app-wrapper',{'is-fullscreen':l.value}]),style:(0,r.normalizeStyle)(d.value)},[(0,r.createElementVNode)('div',{ref_key:'gameContainer',ref:t,class:'ethereal-app',style:(0,r.normalizeStyle)([u.value,N.value])},[(0,r.createCommentVNode)(' Background Layer - Deep Space Gradients '),n[2]||(n[2]=(0,r.createElementVNode)('div',{class:'background-layer'},[(0,r.createElementVNode)('div',{class:'bg-orb bg-orb-violet'}),(0,r.createElementVNode)('div',{class:'bg-orb bg-orb-blue'}),(0,r.createElementVNode)('div',{class:'bg-orb bg-orb-fuchsia'})],-1)),(0,r.createCommentVNode)(' Main Content Render '),(0,r.createVNode)(r.Transition,{name:'fade-scale',mode:'out-in'},{default:(0,r.withCtx)(()=>[(0,r.createVNode)(o,{class:'main-content'})]),_:1}),(0,r.createCommentVNode)(' Global mobile keyboard input proxy bar (keeps typing visible above keyboard) '),(0,r.createVNode)(v),(0,r.createCommentVNode)(' Overlay root (must be inside fullscreen element) '),n[3]||(n[3]=(0,r.createElementVNode)('div',{id:'ethereal-overlay-root',class:'ethereal-overlay-root'},null,-1)),n[4]||(n[4]=(0,r.createElementVNode)('div',{id:'ethereal-toast-root',class:'ethereal-toast-root'},null,-1)),(0,r.createCommentVNode)(' Global UI overlay (Version info etc) '),n[5]||(n[5]=(0,r.createElementVNode)('div',{class:'version-info'},'VER v1.2.2 BETA // TOMO / DREAMER',-1)),(0,r.createCommentVNode)(' Noise texture overlay '),n[6]||(n[6]=(0,r.createElementVNode)('div',{class:'bg-noise'},null,-1)),(0,r.createCommentVNode)(' Draggable Fullscreen Button '),(0,r.createElementVNode)('div',{ref_key:'fsBtn',ref:a,class:'fullscreen-btn',style:(0,r.normalizeStyle)({left:E.x+'px',top:E.y+'px'}),onPointerdown:A,title:l.value?'退出全屏':'进入全屏 (16:9)'},[l.value?((0,r.openBlock)(),(0,r.createElementBlock)('svg',y,[...n[1]||(n[1]=[(0,r.createElementVNode)('polyline',{points:'4 14 10 14 10 20'},null,-1),(0,r.createElementVNode)('polyline',{points:'20 10 14 10 14 4'},null,-1),(0,r.createElementVNode)('line',{x1:'14',y1:'10',x2:'21',y2:'3'},null,-1),(0,r.createElementVNode)('line',{x1:'3',y1:'21',x2:'10',y2:'14'},null,-1)])])):((0,r.openBlock)(),(0,r.createElementBlock)('svg',f,[...n[0]||(n[0]=[(0,r.createElementVNode)('polyline',{points:'15 3 21 3 21 9'},null,-1),(0,r.createElementVNode)('polyline',{points:'9 21 3 21 3 15'},null,-1),(0,r.createElementVNode)('line',{x1:'21',y1:'3',x2:'14',y2:'10'},null,-1),(0,r.createElementVNode)('line',{x1:'3',y1:'21',x2:'10',y2:'14'},null,-1)])]))],44,g)],4)],6)}}}),N=['width','height','stroke'],E=(0,r.defineComponent)({__name:'Icons',props:{name:{},size:{default:24},stroke:{default:'currentColor'}},setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('svg',{xmlns:'http://www.w3.org/2000/svg',width:e.size,height:e.size,viewBox:'0 0 24 24',fill:'none',stroke:e.stroke,'stroke-width':'2','stroke-linecap':'round','stroke-linejoin':'round'},[(0,r.createCommentVNode)(' Menu '),'menu'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[t[0]||(t[0]=(0,r.createElementVNode)('line',{x1:'3',y1:'12',x2:'21',y2:'12'},null,-1)),t[1]||(t[1]=(0,r.createElementVNode)('line',{x1:'3',y1:'6',x2:'21',y2:'6'},null,-1)),t[2]||(t[2]=(0,r.createElementVNode)('line',{x1:'3',y1:'18',x2:'21',y2:'18'},null,-1))],64)):'play'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Play '),t[3]||(t[3]=(0,r.createElementVNode)('polygon',{points:'5 3 19 12 5 21 5 3'},null,-1))],64)):'save'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(' Save '),t[4]||(t[4]=(0,r.createElementVNode)('path',{d:'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z'},null,-1)),t[5]||(t[5]=(0,r.createElementVNode)('polyline',{points:'17 21 17 13 7 13 7 21'},null,-1)),t[6]||(t[6]=(0,r.createElementVNode)('polyline',{points:'7 3 7 8 15 8'},null,-1))],64)):'hammer'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:3},[(0,r.createCommentVNode)(' Hammer '),t[7]||(t[7]=(0,r.createElementVNode)('path',{d:'m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9'},null,-1)),t[8]||(t[8]=(0,r.createElementVNode)('path',{d:'M17.64 15 22 10.64'},null,-1)),t[9]||(t[9]=(0,r.createElementVNode)('path',{d:'m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91'},null,-1))],64)):'arrow-left'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:4},[(0,r.createCommentVNode)(' ArrowLeft (Back alias) '),t[10]||(t[10]=(0,r.createElementVNode)('line',{x1:'19',y1:'12',x2:'5',y2:'12'},null,-1)),t[11]||(t[11]=(0,r.createElementVNode)('polyline',{points:'12 19 5 12 12 5'},null,-1))],64)):'map-pin'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:5},[(0,r.createCommentVNode)(' MapPin '),t[12]||(t[12]=(0,r.createElementVNode)('path',{d:'M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z'},null,-1)),t[13]||(t[13]=(0,r.createElementVNode)('circle',{cx:'12',cy:'10',r:'3'},null,-1))],64)):'back'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:6},[(0,r.createCommentVNode)(' ArrowLeft (Back) '),t[14]||(t[14]=(0,r.createElementVNode)('line',{x1:'19',y1:'12',x2:'5',y2:'12'},null,-1)),t[15]||(t[15]=(0,r.createElementVNode)('polyline',{points:'12 19 5 12 12 5'},null,-1))],64)):'next'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:7},[(0,r.createCommentVNode)(' ArrowRight (Next) '),t[16]||(t[16]=(0,r.createElementVNode)('line',{x1:'5',y1:'12',x2:'19',y2:'12'},null,-1)),t[17]||(t[17]=(0,r.createElementVNode)('polyline',{points:'12 5 19 12 12 19'},null,-1))],64)):'search'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:8},[(0,r.createCommentVNode)(' Search '),t[18]||(t[18]=(0,r.createElementVNode)('circle',{cx:'11',cy:'11',r:'8'},null,-1)),t[19]||(t[19]=(0,r.createElementVNode)('line',{x1:'21',y1:'21',x2:'16.65',y2:'16.65'},null,-1))],64)):'zoom'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:9},[(0,r.createCommentVNode)(' Zoom (Maximize2) '),t[20]||(t[20]=(0,r.createElementVNode)('polyline',{points:'15 3 21 3 21 9'},null,-1)),t[21]||(t[21]=(0,r.createElementVNode)('polyline',{points:'9 21 3 21 3 15'},null,-1)),t[22]||(t[22]=(0,r.createElementVNode)('line',{x1:'21',y1:'3',x2:'14',y2:'10'},null,-1)),t[23]||(t[23]=(0,r.createElementVNode)('line',{x1:'3',y1:'21',x2:'10',y2:'14'},null,-1))],64)):'import'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:10},[(0,r.createCommentVNode)(' Download (Import) '),t[24]||(t[24]=(0,r.createElementVNode)('path',{d:'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'},null,-1)),t[25]||(t[25]=(0,r.createElementVNode)('polyline',{points:'7 10 12 15 17 10'},null,-1)),t[26]||(t[26]=(0,r.createElementVNode)('line',{x1:'12',y1:'15',x2:'12',y2:'3'},null,-1))],64)):'export'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:11},[(0,r.createCommentVNode)(' Upload (Export) '),t[27]||(t[27]=(0,r.createElementVNode)('path',{d:'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'},null,-1)),t[28]||(t[28]=(0,r.createElementVNode)('polyline',{points:'17 8 12 3 7 8'},null,-1)),t[29]||(t[29]=(0,r.createElementVNode)('line',{x1:'12',y1:'3',x2:'12',y2:'15'},null,-1))],64)):'user'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:12},[(0,r.createCommentVNode)(' User '),t[30]||(t[30]=(0,r.createElementVNode)('path',{d:'M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'},null,-1)),t[31]||(t[31]=(0,r.createElementVNode)('circle',{cx:'12',cy:'7',r:'4'},null,-1))],64)):'location'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:13},[(0,r.createCommentVNode)(' MapPin (Location) '),t[32]||(t[32]=(0,r.createElementVNode)('path',{d:'M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z'},null,-1)),t[33]||(t[33]=(0,r.createElementVNode)('circle',{cx:'12',cy:'10',r:'3'},null,-1))],64)):'time'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:14},[(0,r.createCommentVNode)(' Clock (Time) '),t[34]||(t[34]=(0,r.createElementVNode)('circle',{cx:'12',cy:'12',r:'10'},null,-1)),t[35]||(t[35]=(0,r.createElementVNode)('polyline',{points:'12 6 12 12 16 14'},null,-1))],64)):'event'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:15},[(0,r.createCommentVNode)(' Sparkles (Event) '),t[36]||(t[36]=(0,r.createStaticVNode)('<path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path>',5))],64)):'close'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:16},[(0,r.createCommentVNode)(' X (Close) '),t[37]||(t[37]=(0,r.createElementVNode)('line',{x1:'18',y1:'6',x2:'6',y2:'18'},null,-1)),t[38]||(t[38]=(0,r.createElementVNode)('line',{x1:'6',y1:'6',x2:'18',y2:'18'},null,-1))],64)):'star'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:17},[(0,r.createCommentVNode)(' Star '),t[39]||(t[39]=(0,r.createElementVNode)('polygon',{points:'12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2'},null,-1))],64)):'verified'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:18},[(0,r.createCommentVNode)(' Verified (BadgeCheck) '),t[40]||(t[40]=(0,r.createElementVNode)('path',{d:'M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z'},null,-1)),t[41]||(t[41]=(0,r.createElementVNode)('path',{d:'m9 12 2 2 4-4'},null,-1))],64)):'upload-cloud'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:19},[(0,r.createCommentVNode)(' UploadCloud '),t[42]||(t[42]=(0,r.createElementVNode)('path',{d:'M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242'},null,-1)),t[43]||(t[43]=(0,r.createElementVNode)('path',{d:'M12 12v9'},null,-1)),t[44]||(t[44]=(0,r.createElementVNode)('path',{d:'m16 16-4-4-4 4'},null,-1))],64)):'cloud-delete'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:20},[(0,r.createCommentVNode)(' CloudDelete (cloud with X) '),t[45]||(t[45]=(0,r.createElementVNode)('path',{d:'M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242'},null,-1)),t[46]||(t[46]=(0,r.createElementVNode)('line',{x1:'9',y1:'14',x2:'15',y2:'20'},null,-1)),t[47]||(t[47]=(0,r.createElementVNode)('line',{x1:'15',y1:'14',x2:'9',y2:'20'},null,-1))],64)):'sparkles'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:21},[(0,r.createCommentVNode)(' Sparkles '),t[48]||(t[48]=(0,r.createElementVNode)('path',{d:'m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z'},null,-1))],64)):'palette'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:22},[(0,r.createCommentVNode)(' Palette '),t[49]||(t[49]=(0,r.createStaticVNode)('<circle cx="13.5" cy="6.5" r=".5" fill="currentColor"></circle><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"></circle><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"></circle><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"></circle><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"></path>',5))],64)):'text'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:23},[(0,r.createCommentVNode)(' Text '),t[50]||(t[50]=(0,r.createElementVNode)('path',{d:'M17 6.1H3'},null,-1)),t[51]||(t[51]=(0,r.createElementVNode)('path',{d:'M21 12.1H3'},null,-1)),t[52]||(t[52]=(0,r.createElementVNode)('path',{d:'M15.1 18H3'},null,-1))],64)):'link'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:24},[(0,r.createCommentVNode)(' Link '),t[53]||(t[53]=(0,r.createElementVNode)('path',{d:'M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'},null,-1)),t[54]||(t[54]=(0,r.createElementVNode)('path',{d:'M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'},null,-1))],64)):'settings'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:25},[(0,r.createCommentVNode)(' Settings '),t[55]||(t[55]=(0,r.createElementVNode)('path',{d:'M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z'},null,-1)),t[56]||(t[56]=(0,r.createElementVNode)('circle',{cx:'12',cy:'12',r:'3'},null,-1))],64)):'delete'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:26},[(0,r.createCommentVNode)(' Delete (Trash2) '),t[57]||(t[57]=(0,r.createStaticVNode)('<path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line>',5))],64)):'plus'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:27},[(0,r.createCommentVNode)(' Plus '),t[58]||(t[58]=(0,r.createElementVNode)('line',{x1:'12',y1:'5',x2:'12',y2:'19'},null,-1)),t[59]||(t[59]=(0,r.createElementVNode)('line',{x1:'5',y1:'12',x2:'19',y2:'12'},null,-1))],64)):'brain'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:28},[(0,r.createCommentVNode)(' Brain '),t[60]||(t[60]=(0,r.createElementVNode)('path',{d:'M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-1.54'},null,-1)),t[61]||(t[61]=(0,r.createElementVNode)('path',{d:'M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-1.54'},null,-1))],64)):'compress'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:29},[(0,r.createCommentVNode)(' Compress (Minimize2) '),t[62]||(t[62]=(0,r.createElementVNode)('polyline',{points:'4 14 10 14 10 20'},null,-1)),t[63]||(t[63]=(0,r.createElementVNode)('polyline',{points:'20 10 14 10 14 4'},null,-1)),t[64]||(t[64]=(0,r.createElementVNode)('line',{x1:'14',y1:'10',x2:'21',y2:'3'},null,-1)),t[65]||(t[65]=(0,r.createElementVNode)('line',{x1:'3',y1:'21',x2:'10',y2:'14'},null,-1))],64)):'file'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:30},[(0,r.createCommentVNode)(' File '),t[66]||(t[66]=(0,r.createElementVNode)('path',{d:'M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z'},null,-1)),t[67]||(t[67]=(0,r.createElementVNode)('polyline',{points:'14 2 14 8 20 8'},null,-1))],64)):'edit'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:31},[(0,r.createCommentVNode)(' Edit (PenTool) '),t[68]||(t[68]=(0,r.createElementVNode)('path',{d:'M12 19l7-7 3 3-7 7-3-3z'},null,-1)),t[69]||(t[69]=(0,r.createElementVNode)('path',{d:'M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z'},null,-1)),t[70]||(t[70]=(0,r.createElementVNode)('path',{d:'M2 2l7.586 7.586'},null,-1)),t[71]||(t[71]=(0,r.createElementVNode)('circle',{cx:'11',cy:'11',r:'2'},null,-1))],64)):'download'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:32},[(0,r.createCommentVNode)(' Download '),t[72]||(t[72]=(0,r.createElementVNode)('path',{d:'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'},null,-1)),t[73]||(t[73]=(0,r.createElementVNode)('polyline',{points:'7 10 12 15 17 10'},null,-1)),t[74]||(t[74]=(0,r.createElementVNode)('line',{x1:'12',y1:'15',x2:'12',y2:'3'},null,-1))],64)):'external-link'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:33},[(0,r.createCommentVNode)(' External Link '),t[75]||(t[75]=(0,r.createElementVNode)('path',{d:'M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6'},null,-1)),t[76]||(t[76]=(0,r.createElementVNode)('polyline',{points:'15 3 21 3 21 9'},null,-1)),t[77]||(t[77]=(0,r.createElementVNode)('line',{x1:'10',y1:'14',x2:'21',y2:'3'},null,-1))],64)):'code'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:34},[(0,r.createCommentVNode)(' Code '),t[78]||(t[78]=(0,r.createElementVNode)('polyline',{points:'16 18 22 12 16 6'},null,-1)),t[79]||(t[79]=(0,r.createElementVNode)('polyline',{points:'8 6 2 12 8 18'},null,-1))],64)):'trash'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:35},[(0,r.createCommentVNode)(' Trash '),t[80]||(t[80]=(0,r.createElementVNode)('path',{d:'M3 6h18'},null,-1)),t[81]||(t[81]=(0,r.createElementVNode)('path',{d:'M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6'},null,-1)),t[82]||(t[82]=(0,r.createElementVNode)('path',{d:'M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2'},null,-1))],64)):'x'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:36},[(0,r.createCommentVNode)(' X (Close alternative) '),t[83]||(t[83]=(0,r.createElementVNode)('line',{x1:'18',y1:'6',x2:'6',y2:'18'},null,-1)),t[84]||(t[84]=(0,r.createElementVNode)('line',{x1:'6',y1:'6',x2:'18',y2:'18'},null,-1))],64)):'message'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:37},[(0,r.createCommentVNode)(' Message '),t[85]||(t[85]=(0,r.createElementVNode)('path',{d:'M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z'},null,-1))],64)):'chat'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:38},[(0,r.createCommentVNode)(' Chat '),t[86]||(t[86]=(0,r.createElementVNode)('path',{d:'M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z'},null,-1))],64)):'home'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:39},[(0,r.createCommentVNode)(' Home '),t[87]||(t[87]=(0,r.createElementVNode)('path',{d:'M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z'},null,-1)),t[88]||(t[88]=(0,r.createElementVNode)('polyline',{points:'9 22 9 12 15 12 15 22'},null,-1))],64)):'eye'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:40},[(0,r.createCommentVNode)(' Eye '),t[89]||(t[89]=(0,r.createElementVNode)('path',{d:'M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z'},null,-1)),t[90]||(t[90]=(0,r.createElementVNode)('circle',{cx:'12',cy:'12',r:'3'},null,-1))],64)):'image'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:41},[(0,r.createCommentVNode)(' Image '),t[91]||(t[91]=(0,r.createElementVNode)('rect',{width:'18',height:'18',x:'3',y:'3',rx:'2',ry:'2'},null,-1)),t[92]||(t[92]=(0,r.createElementVNode)('circle',{cx:'9',cy:'9',r:'2'},null,-1)),t[93]||(t[93]=(0,r.createElementVNode)('path',{d:'m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21'},null,-1))],64)):'book'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:42},[(0,r.createCommentVNode)(' Book '),t[94]||(t[94]=(0,r.createElementVNode)('path',{d:'M4 19.5A2.5 2.5 0 0 1 6.5 17H20'},null,-1)),t[95]||(t[95]=(0,r.createElementVNode)('path',{d:'M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z'},null,-1))],64)):'folder'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:43},[(0,r.createCommentVNode)(' Folder '),t[96]||(t[96]=(0,r.createElementVNode)('path',{d:'M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z'},null,-1))],64)):'world'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:44},[(0,r.createCommentVNode)(' World '),t[97]||(t[97]=(0,r.createElementVNode)('circle',{cx:'12',cy:'12',r:'10'},null,-1)),t[98]||(t[98]=(0,r.createElementVNode)('line',{x1:'2',y1:'12',x2:'22',y2:'12'},null,-1)),t[99]||(t[99]=(0,r.createElementVNode)('path',{d:'M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z'},null,-1))],64)):'lightning'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:45},[(0,r.createCommentVNode)(' Lightning '),t[100]||(t[100]=(0,r.createElementVNode)('polygon',{points:'13 2 3 14 12 14 11 22 21 10 12 10 13 2'},null,-1))],64)):'info'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:46},[(0,r.createCommentVNode)(' Info '),t[101]||(t[101]=(0,r.createElementVNode)('circle',{cx:'12',cy:'12',r:'10'},null,-1)),t[102]||(t[102]=(0,r.createElementVNode)('line',{x1:'12',y1:'16',x2:'12',y2:'12'},null,-1)),t[103]||(t[103]=(0,r.createElementVNode)('line',{x1:'12',y1:'8',x2:'12.01',y2:'8'},null,-1))],64)):'check'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:47},[(0,r.createCommentVNode)(' Check '),t[104]||(t[104]=(0,r.createElementVNode)('polyline',{points:'20 6 9 17 4 12'},null,-1))],64)):'alert'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:48},[(0,r.createCommentVNode)(' Alert '),t[105]||(t[105]=(0,r.createElementVNode)('path',{d:'M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z'},null,-1)),t[106]||(t[106]=(0,r.createElementVNode)('line',{x1:'12',y1:'9',x2:'12',y2:'13'},null,-1)),t[107]||(t[107]=(0,r.createElementVNode)('line',{x1:'12',y1:'17',x2:'12.01',y2:'17'},null,-1))],64)):'copy'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:49},[(0,r.createCommentVNode)(' Copy '),t[108]||(t[108]=(0,r.createElementVNode)('rect',{x:'9',y:'9',width:'13',height:'13',rx:'2',ry:'2'},null,-1)),t[109]||(t[109]=(0,r.createElementVNode)('path',{d:'M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1'},null,-1))],64)):(0,r.createCommentVNode)('v-if',!0)],8,N))}),V={class:'sphere-label'},b=(0,r.defineComponent)({__name:'MistySphere',props:{label:{},size:{},color:{},delay:{}},emits:['click'],setup(e){const t=e,a=(0,r.computed)(()=>`size-${t.size}`),n=(0,r.computed)(()=>t.color||'bg-violet');return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['misty-sphere',[a.value]]),style:(0,r.normalizeStyle)({animationDelay:`${e.delay}s`}),onClick:t[0]||(t[0]=t=>e.$emit('click'))},[(0,r.createCommentVNode)(' Core Sphere - The "Gas" Effect '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['sphere-glow',n.value])},null,2),(0,r.createCommentVNode)(' Secondary Layer - Texture/Mist '),t[2]||(t[2]=(0,r.createElementVNode)('div',{class:'sphere-mist'},null,-1)),(0,r.createCommentVNode)(' Container for content '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['sphere-content',[a.value]])},[(0,r.createCommentVNode)(' Inner swirling mist animation '),t[1]||(t[1]=(0,r.createElementVNode)('div',{class:'sphere-swirl'},null,-1)),(0,r.createElementVNode)('span',V,(0,r.toDisplayString)(e.label),1)],2)],6))}}),w=(0,p.A)(b,[['__scopeId','data-v-7e21fa7d']]),C=(0,r.defineComponent)({__name:'GlassPanel',props:{fullHeight:{type:Boolean}},setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['glass-panel',{'full-height':e.fullHeight}])},[(0,r.createCommentVNode)(' Shiny edge effect '),t[0]||(t[0]=(0,r.createElementVNode)('div',{class:'shiny-edge-top'},null,-1)),t[1]||(t[1]=(0,r.createElementVNode)('div',{class:'shiny-edge-left'},null,-1)),(0,r.renderSlot)(e.$slots,'default')],2))}),S=(0,p.A)(C,[['__scopeId','data-v-f8670f2c']]),B={class:'message-body'},x={key:0,class:'loading-spinner'},I={class:'message-text'},T={key:0,class:'message-actions'},A=(0,r.defineComponent)({__name:'TempMessage',props:{visible:{type:Boolean},message:{},type:{default:'info'},blocking:{type:Boolean,default:!1}},emits:['update:visible','close'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.computed)(()=>({'is-loading':'loading'===a.type,'is-blocking':a.blocking||'loading'===a.type}));function l(){n('update:visible',!1),n('close')}function i(){'loading'===a.type||a.blocking||l()}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createCommentVNode)(' No Teleport: render in-place so it stays inside fullscreen container '),(0,r.createVNode)(r.Transition,{name:'msg-fade'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:(0,r.normalizeClass)(['temp-message-overlay',o.value]),onClick:(0,r.withModifiers)(i,['self'])},[(0,r.createVNode)(S,{class:(0,r.normalizeClass)(['message-box',e.type])},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',B,[(0,r.createCommentVNode)(' Loading Spinner '),'loading'===e.type?((0,r.openBlock)(),(0,r.createElementBlock)('div',x)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Standard Icons '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['icon-wrapper',e.type])},['error'===e.type?((0,r.openBlock)(),(0,r.createBlock)(E,{key:0,name:'alert',size:'2em'})):'success'===e.type?((0,r.openBlock)(),(0,r.createBlock)(E,{key:1,name:'check',size:'2em'})):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(' Assuming check exists or fallback '),(0,r.createVNode)(E,{name:'info',size:'2em'})],2112)),(0,r.createCommentVNode)(' Assuming info exists or fallback ')],2)],2112)),(0,r.createElementVNode)('div',I,(0,r.toDisplayString)(e.message),1)]),'loading'!==e.type?((0,r.openBlock)(),(0,r.createElementBlock)('div',T,[(0,r.createElementVNode)('button',{class:'btn-primary',onClick:l},'OK')])):(0,r.createCommentVNode)('v-if',!0)]),_:1},8,['class'])],2)):(0,r.createCommentVNode)('v-if',!0)]),_:1})],2112))}}),M=(0,p.A)(A,[['__scopeId','data-v-747be383']]),D={accessToken:null},P={setAccessToken(e){D.accessToken=e||null},getAccessToken:()=>D.accessToken,isAuthenticated:()=>!!D.accessToken,clear(){D.accessToken=null}},O='workshop_user',R='workshop_local_login_expires_at';function L(e,t=6048e5){const a=Date.now()+t;localStorage.setItem(O,JSON.stringify(e)),localStorage.setItem(R,String(a))}function U(){localStorage.removeItem(O),localStorage.removeItem(R)}function F(){const e=function(e){if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null}(localStorage.getItem(R)),t=localStorage.getItem(O);let a=null;if(t)try{const e=JSON.parse(t);e&&'object'==typeof e&&(a={username:'string'==typeof e.username?e.username:'点击登录',avatar:'string'==typeof e.avatar?e.avatar:'',id:'string'==typeof e.id?e.id:''})}catch{a=null}const n=!!a&&'number'==typeof e&&Date.now()<e;return{user:n?a:null,expiresAt:e,isValid:n}}function W(){return F().isValid}const G='同梦',j='游戏持久化数据',J='persistence_main_game_payload_v1',Y='persistence_main_game_event_pack_override_v1',H={currentPage:'Home',lastSaveTime:0};async function X(){try{const e=(await getWorldbook(G)).find(e=>e.name===j);if(!e?.content)return H;try{return{...H,...JSON.parse(e.content)}}catch{return console.warn('[Persistence] Failed to parse data, using default'),H}}catch(e){return console.error('[Persistence] Failed to get data:',e),H}}async function K(e){try{const t=await getWorldbook(G),a=t.findIndex(e=>e.name===j);let n=H;if(-1!==a&&t[a].content)try{n={...H,...JSON.parse(t[a].content)}}catch{}const o={...n,...e,lastSaveTime:Date.now()};e.mainGame&&(o.mainGame={...n.mainGame,...e.mainGame}),e.workshop&&(o.workshop={...n.workshop,...e.workshop}),e.newGame&&(o.newGame={...n.newGame,...e.newGame});const l=JSON.stringify(o,null,2);return-1===a?t.push({uid:Date.now(),name:j,enabled:!1,content:l,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:0,order:900},probability:0,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}}):(t[a].content=l,t[a].enabled=!1,t[a].probability=0),await replaceWorldbook(G,t),!0}catch(e){return console.error('[Persistence] Failed to save:',e),!1}}async function q(){return K({currentPage:'Home',mainGame:void 0,workshop:void 0,newGame:void 0})}async function Q(){const e=await X();if('Home'===e.currentPage)return null;if('MainGame'===e.currentPage){const t=e.mainGame;if(!t?.hasActiveGame)return null;const a='string'==typeof t.payloadRuntimeId&&t.payloadRuntimeId.trim().length>0,n=Array.isArray(t.dialogueQueue)&&t.dialogueQueue.length>0,o=Array.isArray(t.historyLog)&&t.historyLog.length>0;return a||n||o?'/MainGame':'/load-game'}return{Workshop:'/workshop',NewGame:'/new-game',LoadGame:'/load-game'}[e.currentPage]||null}async function Z(e){return K({currentPage:'MainGame',mainGame:e})}async function ee(e){return K({currentPage:'NewGame',newGame:e})}const te={class:'home-view'},ae=['src'],ne={class:'tutorial-links-fixed'},oe={class:'sphere-position sphere-start'},le={class:'sphere-position sphere-workshop'},re={class:'sphere-position sphere-load'},ie=(0,r.defineComponent)({__name:'Home',setup(e){const t=(0,i.useRouter)(),a=(0,r.ref)(!1),n=(0,r.ref)({username:'点击登录',avatar:'',id:''}),o=(0,r.ref)('idle'),l=(0,r.ref)(!1),c=(0,r.ref)(''),s=(0,r.ref)('info');function d(e,t='info'){c.value=e,s.value=t,l.value=!0}const u=(0,r.ref)(!1);let m=null;let p=null;const v=()=>{a.value=!1,o.value='idle',n.value={username:'点击登录',avatar:'',id:''},U(),P.clear()},g=()=>{if(a.value)return u.value?void f():(u.value=!0,d('再点一次即可退出登录','warning'),m&&window.clearTimeout(m),void(m=window.setTimeout(()=>{u.value=!1,m=null},2500)));const e=(()=>{const e=new Uint32Array(4);return window.crypto.getRandomValues(e),Array.from(e,e=>e.toString(36)).join('')})();console.log('【调试】生成的信箱 ID (state):',e),o.value='pending';const t=(window.screen.width-500)/2,l=(window.screen.height-800)/2,r=`https://discord.com/api/oauth2/authorize?client_id=1456699602181820426&redirect_uri=${encodeURIComponent('https://workshop.ab003317.dpdns.org/api/auth/discord/callback')}&response_type=code&scope=identify&state=${e}`;console.log('【调试】即将打开弹窗 URL:',r);const i=window.open(r,'DiscordLogin',`width=500,height=800,top=${l},left=${t}`);console.log('【调试】开始轮询后端...');const c=setInterval(async()=>{try{const t=`https://workshop.ab003317.dpdns.org/api/auth/check?socketId=${e}`,l=await fetch(t,{credentials:'include'});if(!l.ok)return void console.error('【调试】网络请求失败，状态码:',l.status);const r=await l.json();if('success'===r.status){console.log('🎉【调试】拿到数据了！！！',r.data),clearInterval(c),o.value='idle';const e=r.data.user||r.data,t=r.data&&r.data.accessToken||e&&e.accessToken;P.setAccessToken('string'==typeof t&&t?t:null);const l=e.avatar&&!e.avatar.startsWith('http')?`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.png`:e.avatar||'',s={username:e.username,avatar:l,id:e.id};console.log('【调试】更新用户信息:',s),n.value=s,a.value=!0,L(s),p&&window.clearTimeout(p);const{expiresAt:d}=F();if('number'==typeof d){const e=Math.max(0,d-Date.now());p=window.setTimeout(()=>{v()},e)}i&&!i.closed&&i.close()}i&&i.closed}catch(e){console.error('❌【调试】轮询发生严重错误:',e),o.value='error'}},1e3);setTimeout(()=>{clearInterval(c),'pending'===o.value&&(o.value='timeout',d('登录超时，请重试','warning'))},12e4)},f=()=>{a.value=!1,o.value='idle',n.value={username:'点击登录',avatar:'',id:''},p&&window.clearTimeout(p),p=null,U(),P.clear(),fetch('https://workshop.ab003317.dpdns.org/api/auth/logout',{method:'POST',credentials:'include',headers:{'X-Requested-With':'XMLHttpRequest'}}).catch(()=>{}),u.value=!1,m&&window.clearTimeout(m),m=null,d('已退出登录','success')};(0,r.onMounted)(async()=>{try{const e=await Q();if(e)return console.log(`[Home] Restoring to ${e}`),void t.replace(e)}catch(e){console.warn('[Home] Failed to check persistence:',e)}const e=F();if(e.isValid&&e.user){if(n.value=e.user,a.value=!0,p&&window.clearTimeout(p),'number'==typeof e.expiresAt){const t=Math.max(0,e.expiresAt-Date.now());p=window.setTimeout(()=>{v()},t)}}else v()});const y=t.afterEach(e=>{'/'===e.path&&sessionStorage.removeItem('home_checked_restore')});return(0,r.onBeforeUnmount)(()=>{y(),p&&window.clearTimeout(p),p=null,m&&window.clearTimeout(m),m=null}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',te,[(0,r.createCommentVNode)(' User Info '),(0,r.createElementVNode)('div',{class:'user-info',onClick:g,style:{cursor:'pointer'}},[a.value&&n.value.avatar?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:n.value.avatar,class:'user-avatar',alt:'User Avatar'},null,8,ae)):((0,r.openBlock)(),(0,r.createBlock)(E,{key:1,name:'user',size:18})),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(n.value.username),1)]),(0,r.createCommentVNode)(' Title Section '),t[6]||(t[6]=(0,r.createElementVNode)('div',{class:'title-section'},[(0,r.createElementVNode)('h1',{class:'main-title'},[(0,r.createTextVNode)(' 同梦 '),(0,r.createElementVNode)('br'),(0,r.createElementVNode)('span',{class:'sub-title'},'TOMO / DREAMER')]),(0,r.createElementVNode)('p',{class:'description'},[(0,r.createTextVNode)(' 打破次元，在此同梦, 无尽维度的AI同人宇宙。 '),(0,r.createElementVNode)('br'),(0,r.createTextVNode)(' Immerse in the dreams we weave together. ')])],-1)),(0,r.createElementVNode)('div',ne,[(0,r.createElementVNode)('a',{class:'tutorial-btn',href:'https://www.canva.com/design/DAG84TlRbY0/NvWFdU5JUuly4uDSvxqH8w/view?utm_content=DAG84TlRbY0&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h4176bae348#2',target:'_blank',rel:'noopener noreferrer'},[(0,r.createVNode)(E,{name:'external-link',size:'1em'}),t[4]||(t[4]=(0,r.createTextVNode)(' 游玩教学 ',-1))]),(0,r.createElementVNode)('a',{class:'tutorial-btn',href:'https://www.canva.com/design/DAG_IvmgntY/WZt4eczPs16plNKeJgh8Sg/view?utm_content=DAG_IvmgntY&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h3824398191',target:'_blank',rel:'noopener noreferrer'},[(0,r.createVNode)(E,{name:'external-link',size:'1em'}),t[5]||(t[5]=(0,r.createTextVNode)(' 创作教学 ',-1))])]),(0,r.createCommentVNode)(' Floating Spheres Layout '),(0,r.createCommentVNode)(' 1. Start Game - Center Left-ish '),(0,r.createElementVNode)('div',oe,[(0,r.createVNode)(w,{label:'开局',size:'md',color:'bg-cyan',delay:0,onClick:t[0]||(t[0]=t=>e.$router.push('/new-game'))})]),(0,r.createCommentVNode)(' 2. Workshop - Center Right, Large '),(0,r.createElementVNode)('div',le,[(0,r.createVNode)(w,{label:'创意工坊',size:'lg',color:'bg-violet',delay:1,onClick:t[1]||(t[1]=t=>e.$router.push('/workshop'))})]),(0,r.createCommentVNode)(' 3. Load Game - Bottom Center-Left, Small '),(0,r.createElementVNode)('div',re,[(0,r.createVNode)(w,{label:'读档',size:'sm',color:'bg-fuchsia',delay:2,onClick:t[2]||(t[2]=t=>e.$router.push('/load-game'))})]),(0,r.createVNode)(M,{visible:l.value,'onUpdate:visible':t[3]||(t[3]=e=>l.value=e),message:c.value,type:s.value},null,8,['visible','message','type'])]))}}),ce=(0,p.A)(ie,[['__scopeId','data-v-e3e25d1c']]),se={class:'confirm-header'},de={class:'confirm-message'},ue=(0,r.defineComponent)({__name:'ConfirmModal',props:{visible:{type:Boolean},title:{},message:{}},emits:['update:visible','confirm','cancel'],setup(e,{emit:t}){const a=t;function n(){a('update:visible',!1),a('cancel')}function o(){a('update:visible',!1),a('confirm')}return(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'#ethereal-overlay-root'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'confirm-overlay',onClick:(0,r.withModifiers)(n,['self'])},[(0,r.createVNode)(S,{class:'confirm-box'},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',se,[(0,r.createVNode)(E,{name:'alert',size:'1.5em',class:'warn-icon'}),(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(e.title||'确认操作'),1)]),(0,r.createElementVNode)('p',de,(0,r.toDisplayString)(e.message),1),(0,r.createElementVNode)('div',{class:'confirm-actions'},[(0,r.createElementVNode)('button',{class:'btn-cancel',onClick:n},'取消'),(0,r.createElementVNode)('button',{class:'btn-confirm',onClick:o},'确定')])]),_:1})])):(0,r.createCommentVNode)('v-if',!0)]),_:1})]))}}),me=(0,p.A)(ue,[['__scopeId','data-v-f79ac350']]);var pe=l(894);const ve=new Map;function ge(e){try{if('function'==typeof globalThis.structuredClone)return globalThis.structuredClone(e)}catch{}return JSON.parse(JSON.stringify(e))}async function fe(e){return await pe.idbService.getKV(e)}async function ye(e,t){await pe.idbService.setKV(e,ge(t))}function he(e,t,a=250){const n=ve.get(e);'number'==typeof n&&window.clearTimeout(n);const o=window.setTimeout(()=>{ve.delete(e),pe.idbService.setKV(e,ge(t))},Math.max(0,a));ve.set(e,o)}const ke='gameSettings',Ne='gameSettings_v1';let Ee=null,Ve=null;function be(e){return e&&'object'==typeof e?e:{}}async function we(){return Ee?be(Ee):Ve||(Ve=(async()=>{const e=await fe(Ne);if(e&&'object'==typeof e)return Ee=e,be(Ee);try{const e=localStorage.getItem(ke);if(e){const t=JSON.parse(e);return Ee=be(t),await ye(Ne,Ee),localStorage.removeItem(ke),be(Ee)}}catch{}return Ee={},be(Ee)})().finally(()=>{Ve=null}),Ve)}async function Ce(e){Ee=be(e),await ye(Ne,Ee)}function Se(e,t=250){Ee=be(e),he(Ne,Ee,t)}const Be=e=>(e??'').toLowerCase(),xe=e=>{if(!e)return'';if(!e.includes('&'))return e;let t=e.replace(/&lt;/gi,'<').replace(/&gt;/gi,'>').replace(/&amp;/gi,'&').replace(/&quot;/gi,'"').replace(/&#39;/gi,'\'');return t=t.replace(/&#60;/g,'<').replace(/&#62;/g,'>').replace(/&#x3c;/gi,'<').replace(/&#x3e;/gi,'>'),t},_e=(e,t,a)=>{const n=`<${t}`;return e.lastIndexOf(n,Math.max(0,a))},Ie=(e,t,a)=>{const n=`</${t}>`;return e.indexOf(n,Math.max(0,a))},Te=(e,t='content')=>{const a=new RegExp(`<${t}\\b`,'gi');let n,o=-1;for(;null!==(n=a.exec(e));)o=n.index;return o};function Ae(e,t='content',a=['think','analysis']){let n=String(e??'');if(!n)return'';const o=Be(n);if(Te(o,t)<0)return n;for(const e of a){const a=Be(n),o=Ie(a,e,0),l=a.includes(`<${e}`);o>=0&&!l&&(n=n.slice(0,o)+`<${e}>`+n.slice(o));const r=Be(n),i=Te(r,t);if(i<0)continue;const c=_e(r,e,i);if(c<0)continue;const s=Ie(r,e,c+1);(s<0||s>i)&&(n=n.slice(0,i)+`</${e}>`+n.slice(i))}return n}function Me(e){return function(e,t=['think','analysis']){let a=Ae(xe(String(e??'')),'content',t);if(!a)return'';for(const e of t){const t=new RegExp(`<${e}\\b[^>]*>[\\s\\S]*?<\\/${e}>`,'gi');for(a=a.replace(t,'');;){const t=Be(a),n=t.indexOf(`<${e}`);if(n<0)break;const o=t.indexOf(`</${e}>`,n+1);if(o<0){a=a.slice(0,n);break}a=a.slice(0,n)+a.slice(o+`</${e}>`.length)}}return a}(e,['think','analysis'])}function De(e,t,a={}){const{stripThink:n=!0}=a,o=xe(String(e??''));if(!o)return null;const l=n?Me(o):o,r=new RegExp(`<${t}\\b[^>]*>([\\s\\S]*?)<\\/${t}>`,'gi');let i,c=null;for(;null!==(i=r.exec(l));)c='string'==typeof i[1]?i[1]:'';return null===c?null:c}const Pe=e=>(e??'').toLowerCase(),Oe=(e,t)=>{let a=-1;for(const n of t){const t=e.indexOf(n);t>=0&&(a<0||t<a)&&(a=t)}return a},Re=(e,t,a)=>{const n=Math.max(0,Math.min(t,e.length));return e.slice(0,n)+a+e.slice(n)},Le=e=>(e??'').replace(/\r\n/g,'\n'),$e=(e,t)=>{const a=Le(String(e??''));if(!a)return null;const n=new RegExp(`<${t}\\b[^>]*>([\\s\\S]*?)<\\/${t}>`,'gi');let o,l=null;for(;null!==(o=n.exec(a));)l='string'==typeof o[1]?o[1]:'';return l};function Ue(e){let t=(e=>{if(!e)return'';if(!e.includes('&'))return e;let t=e.replace(/&lt;/gi,'<').replace(/&gt;/gi,'>').replace(/&amp;/gi,'&').replace(/&quot;/gi,'"').replace(/&#39;/gi,'\'');return t=t.replace(/&#60;/g,'<').replace(/&#62;/g,'>').replace(/&#x3c;/gi,'<').replace(/&#x3e;/gi,'>'),t})(String(e??''));if(!t)return'';if(!(/<(think|analysis|content|小总结|大总结|small_summary|big_summary|big-summary)\b/i.test(t)||/<\/think>/i.test(t))){const e=String(t).trim();return e?`<think></think><content>\n${e}\n</content><小总结></小总结>`:''}t=t.replace(/<analysis\b[^>]*>/gi,'<think>').replace(/<\/analysis>/gi,'</think>'),t=t.replace(/<\s*state_bar\b[^>]*>/gi,'<小总结>').replace(/<\s*\/\s*state_bar\s*>/gi,'</小总结>').replace(/<\s*small_summary\b[^>]*>/gi,'<小总结>').replace(/<\s*\/\s*small_summary\s*>/gi,'</小总结>').replace(/<\s*big_summary\b[^>]*>/gi,'<大总结>').replace(/<\s*\/\s*big_summary\s*>/gi,'</大总结>').replace(/<\s*big-summary\b[^>]*>/gi,'<大总结>').replace(/<\s*\/\s*big-summary\s*>/gi,'</大总结>'),t=t.replace(/<think\b[^>]*>/gi,'<think>').replace(/<content\b[^>]*>/gi,'<content>').replace(/<小总结\b[^>]*>/gi,'<小总结>').replace(/<大总结\b[^>]*>/gi,'<大总结>');const a=t.replace(/^\s+/,'');Pe(a).startsWith('<think')||(t='<think>\n'+t),t=Ae(t,'content',['think']);const n=['<小总结>','<大总结>'],o=Pe(t);if(o.includes('<think')&&!o.includes('</think>')){const e=[o.indexOf('<content'),Oe(o,n.map(e=>e.toLowerCase()))].filter(e=>'number'==typeof e&&e>=0),a=e.length>0?Math.min(...e):t.length;t=Re(t,a,'</think>')}t=function(e){const t=String(e??'');return t?t.replace(/<think\b[^>]*>([\s\S]*?)<\/think>/gi,(e,t)=>{const a=(e=>e?e.replace(/<\/?\s*(content|state_bar|小总结|大总结|small_summary|big_summary|big-summary)\b[^>]*>/gi,''):'')(String(t??''));return e.replace(t,a)}):''}(t);const l=Pe(t).indexOf('</think>');if(l>=0){const e=l+8;t=t.replace(/<\/think>\s*<content\b/gi,'</think><content');Pe(t).includes('<content')||(t=Re(t,e,'<content>'))}else t='<think>\n</think>'+t;const r=Pe(t),i=r.indexOf('<content'),c=r.indexOf('</content>'),s=Pe(t),d=Oe(s,n.map(e=>e.toLowerCase()));i>=0&&(c<0?d>=0?t=Re(t,d,'</content>'):t+='</content>':t=t.replace(/<\/content>\s*<小总结>/g,'</content><小总结>'));if(!Pe(t).includes('<小总结>')){const e=d>=0?d:t.length;t=Re(t,e,'<小总结>\n</小总结>'),t=t.replace(/<\/content>\s*<小总结>/g,'</content><小总结>')}t=t.replace(/<\/think>\s*<content\b/gi,'</think><content');const u=$e(t,'think')??'';let m=$e(t,'content')??'';const p=$e(t,'小总结')??'',v=$e(t,'大总结')??'';if(!m.trim()){const e=(e=>{const t=Le(String(e??''));return t?t.replace(/<think\b[^>]*>[\s\S]*?<\/think>/gi,'').replace(/<content\b[^>]*>[\s\S]*?<\/content>/gi,'').replace(/<小总结\b[^>]*>[\s\S]*?<\/小总结>/gi,'').replace(/<大总结\b[^>]*>[\s\S]*?<\/大总结>/gi,'').trim():''})(t);e&&(m=e)}return((e,t,a,n)=>{const o=(e??'').trim(),l=(t??'').trim(),r=(a??'').trim(),i=(n??'').trim();let c=`<think>\n${o}\n</think><content>\n${l}\n</content><小总结>\n${r}\n</小总结>`;return i&&(c+=`<大总结>\n${i}\n</大总结>`),c})(u,m,p,v)}const ze=e=>{const t=(e=>{if(!e||'object'!=typeof e)return'';if('performance'===e.kind)return'';const t=[e.text,e.content,e.message,e.rawText,e.raw];for(const e of t){const t='string'==typeof e?e.trim():'';if(t)return t}return''})(e);if(!t)return'';const a='string'==typeof e?.name?e.name.trim():'',n='string'==typeof e?.emotion?e.emotion.trim():'',o='string'==typeof e?.outfit?e.outfit.trim():'';if(!(Boolean(a)&&(Boolean(n)||Boolean(o))))return t;return`[${[a,n||'null',o||'null'].join(' | ')}]\n${t}`};function Fe(e,t=2e4){try{const a=Array.isArray(e?.dialogueQueue)?e.dialogueQueue:[],n=Array.isArray(e?.historyLog)?e.historyLog:[],o=a.length>0?a:n;if(0===o.length)return'';const l=[],r=24;for(let e=o.length-1;e>=0&&l.length<r;e--){const t=ze(o[e]);t&&l.push(t)}const i=l.reverse().join('\n\n').trim();if(!i)return'';const c=Ue(`<think></think><content>\n${i}\n</content><小总结></小总结>`);return c.length>t?c.slice(c.length-t):c}catch{return''}}const We='同梦',Ge='云存档',je=e=>'string'==typeof e&&e.trim().length>0;async function Je(){try{const e=await async function(){try{const e=window;if('function'!=typeof e.getWorldbook)return null;const t=await e.getWorldbook(We);if(!Array.isArray(t))return null;const a=t.find(e=>e?.name===Ge),n='string'==typeof a?.content?a.content:'';if(!n.trim())return null;const o=JSON.parse(n);return o&&'object'==typeof o?{id:'cloud',slotType:'cloud',autoIndex:void 0,isCloud:!0,timestamp:'number'==typeof o.timestamp?o.timestamp:Date.now(),title:'string'==typeof o.title&&o.title.trim()?o.title:'云存档',thumbnail:'string'==typeof o.thumbnail?o.thumbnail:void 0,screenshot:'string'==typeof o.screenshot?o.screenshot:void 0,eventPackId:'string'==typeof o.eventPackId?o.eventPackId:'',eventPackName:'string'==typeof o.eventPackName?o.eventPackName:'',charIds:Array.isArray(o.charIds)?o.charIds.map(String):[],firstLine:'string'==typeof o.firstLine?o.firstLine:void 0,worldbookEntries:Array.isArray(o.worldbookEntries)?o.worldbookEntries:[],sessionData:o.sessionData&&'object'==typeof o.sessionData?o.sessionData:{dialogueQueue:[],currentLineIndex:0,historyLog:[],gameSettings:{}}}:null}catch(e){return console.warn('[saveSystem] readCloudSaveFromWorldbook failed:',e),null}}();return e?(await pe.idbService.saveSave(e),e):null}catch(e){return console.warn('[saveSystem] syncCloudSaveFromWorldbook failed:',e),null}}async function Ye(t){const a=t.screenshotDataUrl||(t.screenshotSelector?await async function(t){const a=e=>new Promise(t=>setTimeout(t,e)),n=()=>new Promise(e=>requestAnimationFrame(()=>e())),o=document.querySelector(t);if(o){await(async(e,t=6)=>{for(let o=0;o<t;o++){const t=e.getBoundingClientRect();if(t.width>0&&t.height>0)return!0;await n(),await a(16)}return!1})(o);for(let t=0;t<3;t++)try{await n(),await n();const t=await e(o,{logging:!1,useCORS:!0,scale:1.2,ignoreElements:e=>{if(e instanceof HTMLCanvasElement){const t=e.width||e.clientWidth||0,a=e.height||e.clientHeight||0;if(t<=0||a<=0)return!0}return!1}});if(!t||t.width<=0||t.height<=0){await a(30);continue}return t.toDataURL('image/jpeg',.8)}catch(e){if(t<2){await a(50);continue}return void console.warn('[saveSystem] captureScreenshot failed:',e)}}}(t.screenshotSelector):void 0),n=await async function(){try{const e=await window.getWorldbook(We);if(!Array.isArray(e))return[];const t=e.filter(e=>{const t=e?.name||'';return'变量库结构定义 - 正文'===t||'当前游戏数据'===t||!!/^【[^】]*】【[^】]*】【[^】]*】【[^】]*】/.test(t)||!!(t.includes('大总结')||t.includes('小总结')||t.includes('小总结备份'))||'玩家档案'===t});return JSON.parse(JSON.stringify(t))}catch(e){return console.warn('[saveSystem] collectWorldbookSnapshot failed:',e),[]}}(),o=t.firstLine||(t.dialogueQueue?.[0]?.text?String(t.dialogueQueue[0].text).slice(0,120):''),l=t.protagonist&&(je(t.protagonist.name)||je(t.protagonist.imageUrl))?{name:je(t.protagonist.name)?t.protagonist.name:'',imageUrl:je(t.protagonist.imageUrl)?t.protagonist.imageUrl:''}:void 0;return{id:je(t.idOverride)?t.idOverride:'auto'===t.slotType?`auto_${t.autoIndex||1}_${Date.now()}`:'cloud'===t.slotType?`cloud_${Date.now()}`:`manual_${Date.now()}`,slotType:t.slotType,autoIndex:'auto'===t.slotType?t.autoIndex||1:void 0,isCloud:'cloud'===t.slotType,timestamp:Date.now(),title:t.title||('auto'===t.slotType?'自动存档':'手动存档'),thumbnail:t.thumbnail,screenshot:a,eventPackId:t.eventPackId,eventPackName:t.eventPackName,charIds:t.charIds||[],firstLine:o,worldbookEntries:n,sessionData:{dialogueQueue:t.dialogueQueue||[],currentLineIndex:t.currentLineIndex||0,historyLog:t.historyLog||[],gameSettings:t.gameSettings||{},protagonist:l,eventPackData:t.eventPackData,lastFinalText:'string'==typeof t.lastFinalText?t.lastFinalText.length>2e4?t.lastFinalText.slice(t.lastFinalText.length-2e4):t.lastFinalText:void 0}}}async function He(e){const t=e.filter(e=>'auto'===e.slotType).sort((e,t)=>t.timestamp-e.timestamp),a=e.filter(e=>'manual'===e.slotType).sort((e,t)=>t.timestamp-e.timestamp),n=e.filter(e=>'cloud'===e.slotType).sort((e,t)=>t.timestamp-e.timestamp),o=t.slice(2),l=a.slice(7),r=n.slice(0,1),i=n.slice(1);for(const e of[...o,...l,...i])await pe.idbService.deleteSave(e.id).catch(()=>{});if(r.length>0&&n.length>1)for(const e of i)await pe.idbService.deleteSave(e.id).catch(()=>{})}function Xe(e,t){return e.filter(t).sort((e,t)=>t.timestamp-e.timestamp)[0]}async function Ke(e){const t=await pe.idbService.getAllSaves(),a=Xe(t,e=>'cloud'===e.slotType||!0===e.isCloud),n=Xe(t,e=>'auto'===e.slotType&&1===e.autoIndex),o=await Ye({...e,slotType:'cloud',autoIndex:void 0,title:'云存档',idOverride:'cloud'});if(o.isCloud=!0,await pe.idbService.saveSave(o),await async function(e){try{const t=JSON.stringify(e,null,2),a=await window.getWorldbook(We),n=a.findIndex(e=>e.name===Ge),o={uid:Date.now(),name:Ge,enabled:!1,content:t,probability:0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:0,order:901},recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}};-1===n?a.push(o):a[n]={...a[n],...o,uid:a[n].uid||o.uid},await window.replaceWorldbook(We,a)}catch(e){console.warn('[saveSystem] writeCloudEntry failed:',e)}}(o),a){const e={...a,id:'auto_1',slotType:'auto',autoIndex:1,isCloud:!1,title:'自动存档 1'};await pe.idbService.saveSave(e)}if(n){const e={...n,id:'auto_2',slotType:'auto',autoIndex:2,isCloud:!1,title:'自动存档 2'};await pe.idbService.saveSave(e)}const l=await pe.idbService.getAllSaves();for(const e of l)'auto'===e.slotType&&'auto_1'!==e.id&&'auto_2'!==e.id&&await pe.idbService.deleteSave(e.id).catch(()=>{}),'cloud'===e.slotType&&'cloud'!==e.id&&await pe.idbService.deleteSave(e.id).catch(()=>{});await He(await pe.idbService.getAllSaves())}const qe={class:'load-game-view'},Qe={class:'header'},Ze={class:'header-left'},et={class:'back-icon-wrapper'},tt={class:'saves-container'},at={key:0,class:'loading-state'},nt={class:'save-thumbnail'},ot=['src'],lt={key:1,class:'placeholder-thumb'},rt={class:'save-info'},it={class:'save-header'},ct={class:'save-chapter'},st={key:0,class:'save-date'},dt={class:'save-summary'},ut={key:0,class:'save-firstline'},mt={class:'save-actions'},pt=['onClick'],vt=['onClick'],gt={key:0,class:'no-saves compact'},ft={class:'save-thumbnail'},yt=['src'],ht={key:1,class:'placeholder-thumb'},kt={class:'save-info'},Nt={class:'save-header'},Et={class:'save-chapter'},Vt={class:'save-date'},bt={class:'save-summary'},wt={key:0,class:'save-firstline'},Ct={class:'save-actions'},St=['onClick'],Bt=['onClick'],xt=['onClick'],_t={class:'no-saves'},It=(0,r.defineComponent)({__name:'LoadGame',setup(e){const t=(0,i.useRouter)(),a=(0,r.ref)([]),n=(0,r.ref)(!0),o=(0,r.ref)(!1),l=(0,r.ref)([{key:'cloud',slotType:'cloud',fallbackTitle:'云存档',save:null},{key:'auto1',slotType:'auto',autoIndex:1,fallbackTitle:'自动存档 1',save:null},{key:'auto2',slotType:'auto',autoIndex:2,fallbackTitle:'自动存档 2',save:null}]),c=(0,r.ref)([]),s=(0,r.ref)(!1),d=(0,r.ref)(null),u=(0,r.ref)(!1),m=(0,r.ref)(''),p=(0,r.ref)('info');function v(e,t='info'){m.value=e,p.value=t,u.value=!0}async function g(){await q(),t.push('/')}async function f(){n.value=!0;try{await Je(),a.value=await pe.idbService.getAllSaves(),a.value.sort((e,t)=>t.timestamp-e.timestamp),o.value=a.value.length>0;const e=a.value.find(e=>'cloud'===e.slotType||'cloud'===e.id)||null,t=a.value.find(e=>'auto'===e.slotType&&(1===e.autoIndex||'auto_1'===e.id))||null,n=a.value.find(e=>'auto'===e.slotType&&(2===e.autoIndex||'auto_2'===e.id))||null;l.value=[{key:'cloud',slotType:'cloud',fallbackTitle:'云存档',save:e},{key:'auto1',slotType:'auto',autoIndex:1,fallbackTitle:'自动存档 1',save:t},{key:'auto2',slotType:'auto',autoIndex:2,fallbackTitle:'自动存档 2',save:n}],c.value=a.value.filter(e=>'manual'===e.slotType).sort((e,t)=>t.timestamp-e.timestamp)}catch(e){console.error('[LoadGame] Failed to load saves:',e),a.value=[],o.value=!1,l.value=[{key:'cloud',slotType:'cloud',fallbackTitle:'云存档',save:null},{key:'auto1',slotType:'auto',autoIndex:1,fallbackTitle:'自动存档 1',save:null},{key:'auto2',slotType:'auto',autoIndex:2,fallbackTitle:'自动存档 2',save:null}],c.value=[]}finally{n.value=!1}}(0,r.onMounted)(async()=>{await async function(){return K({currentPage:'LoadGame'})}(),await f()});const y=(e,t)=>'auto'===e?`AUTO${t||''}`:'cloud'===e?'CLOUD':'MANUAL',h=e=>'auto'===e?'badge-auto':'cloud'===e?'badge-cloud':'badge-manual',k=e=>{if(!e)return'';const t='string'==typeof e.firstLine?e.firstLine.trim():'';if(t)return t;const a=e=>{if(!e||'object'!=typeof e)return'';if('performance'===e.kind)return'';const t=[e.text,e.content,e.message,e.rawText,e.raw];for(const e of t){const t='string'==typeof e?e.trim():'';if(t)return t.slice(0,120)}return''},n=e=>{if(!Array.isArray(e))return'';for(const t of e){const e=a(t);if(e)return e}return''},o=e?.sessionData;return n(o?.dialogueQueue)||n(o?.historyLog)||n(e?.historyLog)||''};function N(e){return new Date(e).toLocaleString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})}async function V(e){try{v('正在加载存档...','loading');const a='同梦',n=window.TavernHelper;n.getWorldbookNames().includes(a)||await n.createWorldbook(a),await n.rebindChatWorldbook('current',a);try{const t=window,n=(Array.isArray(e.worldbookEntries)?e.worldbookEntries:[]).filter(e=>{const t='string'==typeof e?.name?e.name:'';return'剧情事件 - 开始'!==t&&'剧情事件 - 结束'!==t});if('function'==typeof t.getWorldbook&&'function'==typeof t.replaceWorldbook){const e=await t.getWorldbook(a),o=Array.isArray(e)?[...e]:[],l=new Set;for(const e of o)'number'==typeof e?.uid&&l.add(e.uid);const r=e=>o.findIndex(t=>t?.name===e);for(let e=0;e<n.length;e++){const t=n[e],a='string'==typeof t?.name?t.name:'';if(!a)continue;const i=r(a);if(-1!==i){const e=o[i]?.uid;o[i]={...o[i],...t,uid:'number'==typeof e?e:o[i]?.uid}}else{let a='number'==typeof t?.uid?t.uid:Date.now()+e;for(;l.has(a);)a++;l.add(a),o.push({...t,uid:a})}}await t.replaceWorldbook(a,o)}else n.length>0&&'function'==typeof t.createWorldbookEntries&&await t.createWorldbookEntries(a,n)}catch(e){console.warn('[LoadGame] Failed to restore worldbook entries:',e)}sessionStorage.setItem('current_game_event_id',e.eventPackId),sessionStorage.setItem('current_game_char_ids',JSON.stringify(e.charIds));try{const t=e.sessionData?.lastFinalText,a='string'==typeof t&&t.trim()?t:Fe(e.sessionData);if(a&&'string'==typeof a){const e=Ue(a),t=2e4;sessionStorage.setItem('last_final_text',e.length>t?e.slice(e.length-t):e)}else sessionStorage.removeItem('last_final_text')}catch{}if(sessionStorage.setItem('restore_save_id',e.id),sessionStorage.removeItem('restore_save_ref'),sessionStorage.removeItem('restore_save_data'),e.sessionData?.protagonist){const t=e.sessionData.protagonist,a=`save_${e.id}_protagonist`;await pe.idbService.setRuntimeAsset(a,{imageUrl:t.imageUrl||''}),sessionStorage.setItem('current_game_protagonist_ref',JSON.stringify({name:t.name||'',runtimeId:a}))}e.sessionData?.gameSettings&&await Ce(e.sessionData.gameSettings),await Z({hasActiveGame:!0,variablesProcessed:!1,eventPackId:e.eventPackId,characterIds:e.charIds||[]}),t.push('/MainGame')}catch(e){console.error('[LoadGame] Failed to load:',e),v('读档失败: '+(e.message||e),'error')}}async function b(){const e=d.value;if(d.value=null,e)try{await pe.idbService.deleteSave(e),await f(),v('存档已删除','success')}catch(e){console.error('[LoadGame] Failed to delete:',e),v('删除失败: '+(e.message||e),'error')}}function w(e){try{const t=JSON.stringify(e,null,2),a=new Blob([t],{type:'application/json'}),n=URL.createObjectURL(a),o=document.createElement('a');o.href=n,o.download=`save_${e.id}_${Date.now()}.json`,o.click(),URL.revokeObjectURL(n),v('导出成功','success')}catch(e){console.error('[LoadGame] Failed to export:',e),v('导出失败: '+(e.message||e),'error')}}function C(){const e=document.createElement('input');e.type='file',e.accept='.json',e.onchange=async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.text(),a=JSON.parse(e);a.id=`imported_${Date.now()}`,a.timestamp=Date.now(),await pe.idbService.saveSave(a),await f(),v('导入成功','success')}catch(e){console.error('[LoadGame] Failed to import:',e),v('导入失败: '+(e.message||e),'error')}},e.click()}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',qe,[(0,r.createCommentVNode)(' Header '),(0,r.createElementVNode)('div',Qe,[(0,r.createElementVNode)('div',Ze,[(0,r.createElementVNode)('button',{class:'back-btn',onClick:g},[(0,r.createElementVNode)('div',et,[(0,r.createVNode)(E,{name:'back',size:20})])]),t[3]||(t[3]=(0,r.createElementVNode)('h1',{class:'page-title'},'记忆回溯',-1))]),(0,r.createElementVNode)('button',{class:'import-btn',onClick:C},[(0,r.createVNode)(E,{name:'import',size:16}),t[4]||(t[4]=(0,r.createElementVNode)('span',null,'导入存档 (Import)',-1))])]),(0,r.createCommentVNode)(' Save Slots Panel '),(0,r.createVNode)(S,{class:'saves-panel',fullHeight:!0},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',tt,[(0,r.createCommentVNode)(' Loading State '),n.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',at,[...t[5]||(t[5]=[(0,r.createElementVNode)('div',{class:'loading-spinner'},null,-1),(0,r.createElementVNode)('p',null,'加载中...',-1)])])):o.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Existing Saves '),t[9]||(t[9]=(0,r.createElementVNode)('div',{class:'section-title'},'自动 / 云存档',-1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.key,class:'save-item system-save',onClick:t[0]||(t[0]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.createElementVNode)('div',nt,[e.save&&(e.save.screenshot||e.save.thumbnail)?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.save.screenshot||e.save.thumbnail,alt:'Save'},null,8,ot)):((0,r.openBlock)(),(0,r.createElementBlock)('div',lt,[(0,r.createVNode)(E,{name:'image',size:32})])),t[6]||(t[6]=(0,r.createElementVNode)('div',{class:'thumbnail-overlay'},null,-1)),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['slot-badge',h(e.slotType)])},(0,r.toDisplayString)(y(e.slotType,e.autoIndex)),3)]),(0,r.createElementVNode)('div',rt,[(0,r.createElementVNode)('div',it,[(0,r.createElementVNode)('h3',ct,(0,r.toDisplayString)(e.save?.title||e.fallbackTitle),1),e.save?((0,r.openBlock)(),(0,r.createElementBlock)('span',st,(0,r.toDisplayString)(N(e.save.timestamp)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('p',dt,(0,r.toDisplayString)(e.save?.eventPackName||'暂无存档'),1),k(e.save)?((0,r.openBlock)(),(0,r.createElementBlock)('p',ut,(0,r.toDisplayString)(k(e.save)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',mt,[e.save?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn load-btn',title:'Load',onClick:(0,r.withModifiers)(t=>V(e.save),['stop'])},[(0,r.createVNode)(E,{name:'play',size:20})],8,pt)):(0,r.createCommentVNode)('v-if',!0),e.save?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'action-btn export-btn',title:'Export',onClick:(0,r.withModifiers)(t=>w(e.save),['stop'])},[(0,r.createVNode)(E,{name:'export',size:18})],8,vt)):(0,r.createCommentVNode)('v-if',!0)])]))),128)),t[10]||(t[10]=(0,r.createElementVNode)('div',{class:'section-title'},'手动存档',-1)),0===c.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',gt,[...t[7]||(t[7]=[(0,r.createElementVNode)('p',null,'暂无手动存档',-1),(0,r.createElementVNode)('span',null,'你仍可读取上方自动/云存档（如果有）',-1)])])):(0,r.createCommentVNode)('v-if',!0),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(c.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'save-item'},[(0,r.createElementVNode)('div',ft,[e.screenshot||e.thumbnail?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.screenshot||e.thumbnail,alt:'Save'},null,8,yt)):((0,r.openBlock)(),(0,r.createElementBlock)('div',ht,[(0,r.createVNode)(E,{name:'image',size:32})])),t[8]||(t[8]=(0,r.createElementVNode)('div',{class:'thumbnail-overlay'},null,-1)),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['slot-badge',h(e.slotType)])},(0,r.toDisplayString)(y(e.slotType,e.autoIndex)),3)]),(0,r.createElementVNode)('div',kt,[(0,r.createElementVNode)('div',Nt,[(0,r.createElementVNode)('h3',Et,(0,r.toDisplayString)(e.title||'未命名存档'),1),(0,r.createElementVNode)('span',Vt,(0,r.toDisplayString)(N(e.timestamp)),1)]),(0,r.createElementVNode)('p',bt,(0,r.toDisplayString)(e.eventPackName||'未知事件包'),1),k(e)?((0,r.openBlock)(),(0,r.createElementBlock)('p',wt,(0,r.toDisplayString)(k(e)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',Ct,[(0,r.createElementVNode)('button',{class:'action-btn load-btn',title:'Load',onClick:t=>V(e)},[(0,r.createVNode)(E,{name:'play',size:20})],8,St),(0,r.createElementVNode)('button',{class:'action-btn export-btn',title:'Export',onClick:t=>w(e)},[(0,r.createVNode)(E,{name:'export',size:18})],8,Bt),(0,r.createElementVNode)('button',{class:'action-btn delete-btn',title:'Delete',onClick:t=>{return a=e.id,d.value=a,void(s.value=!0);var a}},[(0,r.createVNode)(E,{name:'trash',size:18})],8,xt)])]))),128))],64)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(' No Saves '),(0,r.createElementVNode)('div',_t,[(0,r.createVNode)(E,{name:'info',size:48}),t[11]||(t[11]=(0,r.createElementVNode)('p',null,'暂无存档',-1)),t[12]||(t[12]=(0,r.createElementVNode)('span',null,'开始新游戏后可在此读取存档',-1))])],2112))])]),_:1}),(0,r.createCommentVNode)(' Temp Message '),(0,r.createVNode)(M,{visible:u.value,'onUpdate:visible':t[1]||(t[1]=e=>u.value=e),message:m.value,type:p.value},null,8,['visible','message','type']),(0,r.createCommentVNode)(' Delete Confirm '),(0,r.createVNode)(me,{visible:s.value,'onUpdate:visible':t[2]||(t[2]=e=>s.value=e),title:'删除存档',message:'确定要删除这个存档吗？该操作无法撤销。',onConfirm:b},null,8,['visible'])]))}}),Tt=(0,p.A)(It,[['__scopeId','data-v-ddadd5c2']]),At='同梦',Mt='当前游戏数据',Dt={time:'时间',location:'地点',deviation:'偏移度',personality:'性格',background:'背景',trust:'好感度',states:'表情',outfits:'服装'};function Pt(e){const t=(e||'').trim();if(!t)return t;const a=t.split('.').filter(Boolean);if(0===a.length)return t;'system'===a[0]&&(a[0]='系统'),'characters'===a[0]&&(a[0]='角色');for(let e=0;e<a.length;e++){const t=Dt[a[e]];t&&(a[e]=t)}return a.join('.')}function Ot(){const e=(e,t)=>{if(!e||'object'!=typeof e||!t||'object'!=typeof t)return 0;const a=Object.keys(t).filter(e=>!e.startsWith('<'));if(0===a.length)return 0;let n=0;for(const t of a)t in e&&n++;return n/a.length},t=async e=>{try{const t=(await window.getWorldbook(At)).find(e=>e.name===Mt);if(!t||!t.content)return console.warn('[VariableReader] Data entry not found'),null;let a;try{a=JSON.parse(t.content)}catch{return console.warn('[VariableReader] Failed to parse data entry as JSON'),null}const n=e=>{const t=e.split('.').filter(Boolean);let n=a;for(const e of t){if(null==n)return null;n=n[e]}return n},o=n(Pt(e));return null!=o?o:n(e)}catch(t){return console.error('[VariableReader] Failed to read variable:',e,t),null}};return{readVariable:t,readAllData:async()=>{try{const e=(await window.getWorldbook(At)).find(e=>e.name===Mt);if(!e||!e.content)return console.warn('[VariableReader] Data entry not found'),null;try{return JSON.parse(e.content)}catch{return console.warn('[VariableReader] Failed to parse data entry as JSON'),null}}catch(e){return console.error('[VariableReader] Failed to read all data:',e),null}},getCurrentTime:async()=>await t('系统.时间')||'',getCurrentLocation:async()=>await t('系统.地点')||'',getCharacterData:async e=>await t(`角色.${e}`),variableExists:async e=>{const a=await t(e);return null!=a},getDynamicKeys:async a=>{try{const n=Pt(a),o=await t(n);if(!o||'object'!=typeof o)return console.warn(`[VariableReader] Container not found or invalid: ${n}`),[];const l=await(async()=>{try{const e=(await window.getWorldbook(At)).find(e=>'变量库结构定义 - 正文'===e.name);if(!e||!e.content)return console.warn('[VariableReader] Template definition entry not found'),null;try{const t=e.content.replace(/\/\/.*$/gm,'');return JSON.parse(t)}catch{return console.warn('[VariableReader] Failed to parse template definition as JSON'),null}}catch(e){return console.error('[VariableReader] Failed to read template definition:',e),null}})();if(!l)return console.warn('[VariableReader] Cannot read template definition'),[];const r=n.split('.');let i=l;for(const e of r){if(!i||'object'!=typeof i)return console.warn(`[VariableReader] Cannot find template path: ${n}`),[];i=i[e]}if(!i||'object'!=typeof i)return console.warn(`[VariableReader] Template not found at path: ${n}`),[];const c=Object.keys(i).find(e=>e.startsWith('<')&&e.endsWith('>'));if(!c)return console.warn(`[VariableReader] No dynamic template found in container: ${n}`),[];const s=i[c],d=.7,u=[];for(const t of Object.keys(o)){if(t.startsWith('//'))continue;const a=o[t];if('object'==typeof a&&null!==a&&!Array.isArray(a)){e(a,s)>=d&&u.push(t)}}return u}catch(e){return console.error('[VariableReader] Failed to get dynamic keys:',a,e),[]}},getDynamicInstance:async(e,a,n)=>{const o=Pt(e),l=n?Pt(n):void 0,r=l?`${o}.${a}.${l}`:`${o}.${a}`;return await t(r)}}}const Rt='同梦',Lt='当前游戏数据';function $t(e){if(!e)return-1;const t=new Date(e);if(!isNaN(t.getTime()))return t.getTime();const a=e.match(/\d+/g);if(a&&a.length>0){if(1===a.length&&4===a[0].length)return new Date(`${a[0]}/01/01`).getTime();if(a.length>=3)return new Date(`${a[0]}/${a[1]}/${a[2]}`).getTime()}return-1}function Ut(e){const t=e.split('\n'),a=[];let n=[],o=-1;for(const e of t){const t=e.match(/(?:触发时间|Trigger Time)[：:]\s*(\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}\s+\d{1,2}:\d{1,2})/i);t?(n.length>0&&a.push({time:o,text:n.join('\n').trim()}),o=$t(t[1]),n=[e]):n.push(e)}return n.length>0&&a.push({time:o,text:n.join('\n').trim()}),a.filter(e=>-1!==e.time&&e.text)}function zt(){return{updateStoryWorldbook:async(e,t)=>{if(!e.plotEvents||0===e.plotEvents.length)return;const a=$t(t);-1===a&&console.warn('[StoryManager] Invalid reference time:',t);const n=[];for(const t of e.plotEvents){const e=Ut(t.content);n.push(...e)}if(console.log(`[StoryManager] Total sub-events extracted: ${n.length}`),0===n.length)return void console.warn('[StoryManager] No valid sub-events found');const o=n.filter(e=>e.time<=a),l=n.filter(e=>e.time>a);o.sort((e,t)=>t.time-e.time),l.sort((e,t)=>e.time-t.time);const r=[...o.slice(0,5),...l.slice(0,5)];r.sort((e,t)=>e.time-t.time);const i=[...o.slice(5),...l.slice(5)];i.sort((e,t)=>e.time-t.time);const c=[],s='Local',d=(t,a,n,o)=>({name:`【${s}】【${e.name}】【剧情事件】【${t}】`,content:a,position:{type:'after_character_definition',order:n},enabled:o,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}});if(r.length>0){const e=r.map(e=>e.text).join('\n\n');c.push(d('current',e,302,!0))}for(let e=0;e<i.length;e+=10){const t=i.slice(e,e+10).map(e=>e.text).join('\n\n'),a=String(Math.floor(e/10)+1).padStart(3,'0');c.push(d(a,t,303+Math.floor(e/10),!1))}const u=new RegExp(`^【${s}】【${e.name}】【剧情事件】【.*?】$`);window.deleteWorldbookEntries&&await window.deleteWorldbookEntries(Rt,e=>u.test(e.name)),c.length>0&&window.createWorldbookEntries&&await window.createWorldbookEntries(Rt,c),console.log(`[StoryManager] Updated plot events. Active: ${r.length}, Inactive: ${i.length}`)},cleanGameDataEntry:async()=>{try{window.deleteWorldbookEntries&&(await window.deleteWorldbookEntries(Rt,e=>e.name===Lt||e.name.includes(Lt)),console.log('[StoryManager] Cleaned up game data entry:',Lt))}catch(e){console.warn('[StoryManager] Failed to clean game data:',e)}},getCurrentGameTime:async()=>{const{getCurrentTime:e}=Ot();return await e()}}}const Ft='🟢针对【低偏离度】的指令',Wt='🟡针对【中偏离度】的指令',Gt='🔴针对【高偏离度】的指令';async function jt(e){try{const t=window.updateWorldbookWith;if('function'!=typeof t)return void console.warn('[DeviationPrompt] updateWorldbookWith not available');await t('同梦',t=>t.map(t=>t.name===Ft?{...t,strategy:{...t.strategy,type:'low'===e?'constant':'selective'}}:t.name===Wt?{...t,strategy:{...t.strategy,type:'mid'===e?'constant':'selective'}}:t.name===Gt?{...t,strategy:{...t.strategy,type:'high'===e?'constant':'selective'}}:t)),console.log(`[DeviationPrompt] Set active level to: ${e}`)}catch(e){console.error('[DeviationPrompt] Failed to update deviation entries:',e)}}async function Jt(e){const t=function(e){try{const t=e?.系统?.偏移度;if('string'==typeof t){const e=t.toLowerCase();return e.includes('高')||'high'===e?'high':e.includes('中')||'mid'===e||'medium'===e?'mid':'low'}return'number'==typeof t?t>=67?'high':t>=34?'mid':'low':'low'}catch(e){return console.warn('[DeviationPrompt] Failed to parse deviation from game data:',e),'low'}}(e);await jt(t)}const Yt=t.create({baseURL:'https://workshop.ab003317.dpdns.org',withCredentials:!0,timeout:15e3}),Ht=12e4;Yt.interceptors.request.use(e=>{const t=(e.method||'get').toLowerCase(),a='get'!==t&&'head'!==t&&'options'!==t;try{e.headers=e.headers||{},e.headers['X-Client-Request-Id']||(e.headers['X-Client-Request-Id']=crypto.randomUUID())}catch{}const n=P.getAccessToken();return n&&(e.headers=e.headers||{},e.headers.Authorization=`Bearer ${n}`),a&&(e.headers=e.headers||{},e.headers['X-Requested-With']='XMLHttpRequest'),e});const Xt={listPublicItems:async(e,t)=>(await Yt.get('/api/workshop/items',{params:e,...'number'==typeof t?.timeoutMs?{timeout:t.timeoutMs}:null})).data,getItem:async(e,t)=>(await Yt.get(`/api/workshop/items/${encodeURIComponent(e)}`,'number'==typeof t?.timeoutMs?{timeout:t.timeoutMs}:void 0)).data,listMyItems:async(e,t)=>(await Yt.get('/api/workshop/my-items',{params:e,...'number'==typeof t?.timeoutMs?{timeout:t.timeoutMs}:null})).data,getMyItemByClientId:async(e,t)=>(await Yt.get(`/api/workshop/my-items/by-client-id/${encodeURIComponent(e)}`,{...'number'==typeof t?.timeoutMs?{timeout:t.timeoutMs}:null,...t?.signal?{signal:t.signal}:null})).data,getUserUsage:async()=>(await Yt.get('/api/workshop/user/usage')).data,createItem:async(e,t)=>(await Yt.post('/api/workshop/items',e,{timeout:'number'==typeof t?.timeoutMs?t.timeoutMs:Ht,headers:{...t?.requestId?{'X-Client-Request-Id':t.requestId}:null,...t?.clientContentSha256?{'X-Client-Content-Sha256':t.clientContentSha256}:null},...t?.onUploadProgress?{onUploadProgress:t.onUploadProgress}:null,...t?.signal?{signal:t.signal}:null})).data,upsertItemByClientId:async(e,t,a)=>(await Yt.put(`/api/workshop/items/by-client-id/${encodeURIComponent(e)}`,t,{timeout:'number'==typeof a?.timeoutMs?a.timeoutMs:Ht,params:a?.async?{async:1}:void 0,headers:{...a?.requestId?{'X-Client-Request-Id':a.requestId}:null,...a?.clientContentSha256?{'X-Client-Content-Sha256':a.clientContentSha256}:null,...a?.preferRespondAsync?{Prefer:'respond-async'}:null},...a?.onUploadProgress?{onUploadProgress:a.onUploadProgress}:null,...a?.signal?{signal:a.signal}:null})).data,getOperation:async(e,t)=>(await Yt.get(`/api/workshop/operations/${encodeURIComponent(e)}`,{...'number'==typeof t?.timeoutMs?{timeout:t.timeoutMs}:null,...t?.signal?{signal:t.signal}:null})).data,updateItem:async(e,t,a)=>(await Yt.put(`/api/workshop/items/${encodeURIComponent(e)}`,t,{timeout:'number'==typeof a?.timeoutMs?a.timeoutMs:Ht,...a?.signal?{signal:a.signal}:null})).data,deleteItem:async(e,t)=>(await Yt.delete(`/api/workshop/items/${encodeURIComponent(e)}`,{timeout:'number'==typeof t?.timeoutMs?t.timeoutMs:Ht,...t?.signal?{signal:t.signal}:null})).data,recordDownload:async e=>(await Yt.post(`/api/workshop/items/${encodeURIComponent(e)}/download`)).data},Kt='同梦',qt='当前游戏数据',Qt=JSON.parse('{"系统":{"时间":"String","//时间":"Format: YYYY/MM/DD HH:MM","地点":"String","//地点":"详细地点","偏移度":"String","//偏移度":"Format: 低/中/高"},"角色":{"<名字>":{"外貌":"String","//外貌":"50字外貌描述","性格":"String","//性格":"50字性格","背景":"String","//背景":"100字背景","好感度":"Int","//好感度":"好感度0-100","表情":["String"],"//表情":"立绘表情差分,例如: 开心,悲伤。readOnly,由玩家自行管理","服装":["String"],"//服装":"立绘服装差分,例如: 校服,便服。readOnly,由玩家自行管理"},"//<名字>":"这里的 <名字> 代表人物的名字，如 \\"田中\\"、\\"佐藤\\" 等"}}');let Zt=null;function ea(e,t=''){Zt||(Zt={containerPaths:[],dynamicContainers:new Map});for(const a of Object.keys(e)){if(a.startsWith('//'))continue;const n=t?`${t}.${a}`:a,o=e[a];if('object'==typeof o&&!Array.isArray(o)&&null!==o){const e=Object.keys(o).find(e=>e.startsWith('<')&&e.endsWith('>'));if(e){Zt.containerPaths.push(n);const t=o[e];if('object'==typeof t&&!Array.isArray(t)){const e=Object.keys(t).filter(e=>!e.startsWith('//'));Zt.dynamicContainers.set(n,e)}}else ea(o,n)}}}function ta(){return Object.keys(Qt).filter(e=>!(e.startsWith('//')||e.startsWith('<')&&e.endsWith('>')))}ea(Qt);const aa={time:'时间',location:'地点',deviation:'偏移度',personality:'性格',background:'背景',trust:'好感度',states:'表情',outfits:'服装'};function na(e){const t=(e||'').trim();if(!t)return t;const a=t.split('.').filter(Boolean);if(0===a.length)return t;const n=Object.prototype.hasOwnProperty.call(Qt,'系统'),o=Object.prototype.hasOwnProperty.call(Qt,'角色');n&&'system'===a[0]&&(a[0]='系统'),o&&'characters'===a[0]&&(a[0]='角色');for(let e=0;e<a.length;e++){const t=aa[a[e]];t&&(a[e]=t)}return a.join('.')}function oa(e){const t=(e||'').trim();if(!t)return t;const a=na(t);if(ma(a))return a;Zt||ea(Qt);const n=new Set(ta()),o=a.split('.').filter(Boolean);if(o.length<2)return a;if(n.has(o[0]))return a;const l=[];for(const[e,t]of Zt.dynamicContainers.entries()){const n=o[o.length-1];if(!t.includes(n))continue;const r=e.split('.').pop()||'';let i=a;o[0]===r&&(i=o.slice(1).join('.')),i.startsWith(e+'.')||l.push({containerPath:e,normalized:`${e}.${i}`})}return 0===l.length?a:(l.sort((e,t)=>t.containerPath.length-e.containerPath.length),l[0].normalized)}function la(e){if(!e||'object'!=typeof e)return;Zt||ea(Qt);const t=new Set(ta()),a=t.has('角色')?'角色':'characters',n=Zt?.dynamicContainers.get(a)||[];if(0!==n.length){e[a]&&'object'==typeof e[a]||(e[a]={});for(const o of Object.keys(e)){if(o.startsWith('//'))continue;if(t.has(o))continue;const l=e[o];if(!l||'object'!=typeof l||Array.isArray(l))continue;if(n.reduce((e,t)=>e+(t in l?1:0),0)<2)continue;const r=e[a][o];if(r){if(r&&'object'==typeof r&&!Array.isArray(r))for(const e of Object.keys(l))e.startsWith('//')||void 0===r[e]&&(r[e]=l[e])}else e[a][o]=l;delete e[o]}}}function ra(e){if(!e||'object'!=typeof e)return;const t=new Set(ta()),a=t.has('系统'),n=t.has('角色');if(a&&e.system&&'object'==typeof e.system&&!e.系统){const t=e.system;e.系统={时间:'string'==typeof t.time?t.time:'',地点:'string'==typeof t.location?t.location:'',偏移度:'string'==typeof t.deviation?t.deviation:'低'};for(const a of Object.keys(t))'time'!==a&&'location'!==a&&'deviation'!==a&&(e.系统[a]=t[a]);delete e.system}if(n&&e.characters&&'object'==typeof e.characters&&!e.角色){const t=e.characters;e.角色={};for(const a of Object.keys(t)){const n=t[a];if(n&&'object'==typeof n){e.角色[a]={性格:'string'==typeof n.personality?n.personality:'',背景:'string'==typeof n.background?n.background:'',好感度:'number'==typeof n.trust?n.trust:50,表情:Array.isArray(n.states)?n.states:[],服装:Array.isArray(n.outfits)?n.outfits:[]};for(const t of Object.keys(n))'personality'!==t&&'background'!==t&&'trust'!==t&&'states'!==t&&'outfits'!==t&&(e.角色[a][t]=n[t])}}delete e.characters}}function ia(e){let t=0;function a(){for(;t<e.length&&/\s/.test(e[t]);)t++}function n(a){t++;let n='';for(;t<e.length;){const o=e[t];if('\\'===o&&t+1<e.length){t++;const a=e[t];n+='n'===a?'\n':'t'===a?'\t':'r'===a?'\r':a,t++}else{if(o===a)return t++,n;n+=o,t++}}return n}const o=e=>/[A-Za-z0-9_$\p{L}\p{N}]/u.test(e);function l(){const a=t,n=e[t]??'';if(!n||!/[A-Za-z_$\p{L}]/u.test(n))return'';for(t++;t<e.length&&o(e[t]);)t++;return e.substring(a,t)}function r(){const a=t;for(;t<e.length;){const a=e[t];if(':'===a)break;if('}'===a||','===a||'\n'===a||'\r'===a)break;t++}return e.substring(a,t).trim()}function i(){if(a(),t>=e.length)return;const o=e[t];if('"'===o||'\''===o)return n(o);if('['===o)return function(){t++;const n=[];for(a();t<e.length&&']'!==e[t];)n.push(i()),a(),','===e[t]&&(t++,a());return t<e.length&&t++,n}();if('{'===o)return function(){t++;const o={};for(a();t<e.length&&'}'!==e[t];){let c;if('"'===e[t]||'\''===e[t]?c=n(e[t]):(c=l(),c||(c=r())),a(),':'!==e[t])throw new Error('Invalid object literal: missing ":" after key');t++,a(),o[c]=i(),a(),','===e[t]&&(t++,a())}return t<e.length&&t++,o}();if('-'===o||/\d/.test(o))return function(){const a=t;for('-'===e[t]&&t++;t<e.length&&/\d/.test(e[t]);)t++;if(t<e.length&&'.'===e[t])for(t++;t<e.length&&/\d/.test(e[t]);)t++;return parseFloat(e.substring(a,t))}();const c=l();return'true'===c||'false'!==c&&('null'===c?null:c)}return i()}function ca(e){const t=[],a=(e,a,n)=>{let o;for(;null!==(o=a.exec(e));){const a=o[1].toUpperCase();let l=o.index+o[0].length;for(;l<e.length&&'\''!==e[l];)l++;if(l>=e.length)continue;const r=l+1;for(l++;l<e.length&&'\''!==e[l];)l++;if(l>=e.length)continue;const i=e.substring(r,l);for(l++;l<e.length&&/[\s,]/.test(e[l]);)l++;let c;if(l<e.length&&')'!==e[l]){const t=l;let a=0,n=!1,o='';for(;l<e.length;){const t=e[l];if(n)t===o&&'\\'!==e[l-1]&&(n=!1);else if('\''===t||'"'===t)n=!0,o=t;else if('('===t||'['===t||'{'===t)a++;else if(')'===t||']'===t||'}'===t){if(')'===t&&0===a)break;a--}l++}const r=e.substring(t,l).trim();try{c=ia(r),console.log('[VariableProcessor] Parsed value:',c)}catch(e){console.error('[VariableProcessor] Failed to parse value:',r,e),c=r}}const s=l,d=e.substring(o.index,Math.min(e.length,s+1)).trim(),u=n?`[$$ ${d} $$]`:d;t.push({type:a,path:i,value:c,rawCommand:u})}},n='[$$';let o=0,l=!1;for(;o<e.length;){const t=e.indexOf(n,o);if(-1===t)break;const r=e.indexOf('$$]',t+3);if(-1===r)break;a(e.substring(t+3,r),/\b(UPDATE|MOD|CREATE|REMOVE)\s*\(/gi,!0),l=!0,o=r+3}if(l)return t;return a(e,/\[\$\$\s*(UPDATE|MOD|CREATE|REMOVE)\s*\(/gi,!1),t}function sa(e,t){const a=t.split('.');let n=e;for(const e of a){if(null==n)return;n=n[e]}return n}function da(e,t,a){const n=t.split('.');let o=e;for(let e=0;e<n.length-1;e++){const t=n[e];void 0!==o[t]&&null!==o[t]||(o[t]={}),o=o[t]}o[n[n.length-1]]=a}function ua(e,t){const a=t.split('.').filter(Boolean);if(0===a.length)return!1;let n=e;for(const e of a){if(null==n)return!1;if('object'!=typeof n)return!1;if(!Object.prototype.hasOwnProperty.call(n,e))return!1;n=n[e]}return!0}function ma(e){Zt||ea(Qt);const t=na(e).split('.');return function e(t,a,n){if(n>=a.length)return!1;const o=a[n],l=n===a.length-1;if(Object.prototype.hasOwnProperty.call(t,o)){if(l)return!0;const r=t[o];return!('object'==typeof r&&!Array.isArray(r)&&null!==r)||e(r,a,n+1)}const r=Object.keys(t).find(e=>e.startsWith('<')&&e.endsWith('>'));if(r){const o=t[r];if('object'==typeof o&&!Array.isArray(o)&&!l)return e(o,a,n+1)}return!1}(Qt,t,0)}function pa(e,t){const{type:a,value:n}=t;let o=oa(t.path);const l=(e,n,l)=>({code:e,commandType:a,path:t.path,normalizedPath:o,message:n,rawCommand:t.rawCommand,details:l}),r=e=>Array.isArray(e)?'array':null===e?'null':typeof e;switch(a){case'UPDATE':{if(!ua(e,o))return{success:!1,error:l('path_not_found',`UPDATE failed: path not found (UPDATE does not create new nodes): ${o}`)};const t=sa(e,o);if(null!=t){const e=r(t),a=r(n);if(e!==a)return{success:!1,error:l('type_mismatch',`UPDATE failed: type mismatch at ${o} (${e} -> ${a})`,{currentType:e,nextType:a})};if('number'===e){const e=n;if('number'!=typeof e||!Number.isFinite(e))return{success:!1,error:l('invalid_value',`UPDATE failed: value must be a finite number: ${o}`)}}}return da(e,o,n),console.log(`[VariableProcessor] UPDATE '${o}' = `,n),{success:!0}}case'MOD':{if(!ua(e,o))return{success:!1,error:l('path_not_found',`MOD failed: path not found (MOD does not create new nodes): ${o}`)};const t=n,a='number'==typeof t?t:'string'==typeof t?Number(t):Number.NaN;if(!Number.isFinite(a))return{success:!1,error:l('invalid_value',`MOD failed: delta must be a number (got ${typeof t}): ${o}`)};const r=sa(e,o);if('number'!=typeof r||!Number.isFinite(r))return{success:!1,error:l('type_mismatch',`MOD failed: target is not a number: ${o}`)};const i=r+a;return da(e,o,i),console.log(`[VariableProcessor] MOD '${o}': ${r} + ${a} = ${i}`),{success:!0}}case'CREATE':try{if(!o.includes('.')&&n&&'object'==typeof n&&!Array.isArray(n)){const e=new Set(ta()).has('角色')?'角色':'characters',t=Zt?.dynamicContainers.get(e)||[];if(t.length>0){t.reduce((e,t)=>e+(t in n?1:0),0)>=2&&(o=`${e}.${o}`)}}}catch{}if(ma(o)){Zt||ea(Qt);if(!!Zt?.dynamicContainers.get(o)&&n&&'object'==typeof n&&!Array.isArray(n))try{for(const t of Object.keys(n))t&&!t.startsWith('//')&&da(e,`${o}.${t}`,n[t]);return console.log(`[VariableProcessor] CREATE '${o}' bulk instances = `,n),{success:!0}}catch(e){return console.error(`[VariableProcessor] CREATE '${o}' bulk failed:`,e),{success:!1,error:l('unknown',`CREATE failed: ${e.message||e}`)}}if(n&&'object'==typeof n&&!Array.isArray(n))try{for(const t of Object.keys(n))t&&!t.startsWith('//')&&da(e,`${o}.${t}`,n[t]);return console.log(`[VariableProcessor] CREATE '${o}' treated as UPDATE children = `,n),{success:!0}}catch(e){return console.error(`[VariableProcessor] CREATE '${o}' merge-as-update failed:`,e),{success:!1,error:l('unknown',`CREATE failed: ${e.message||e}`)}}return console.warn(`[VariableProcessor] CREATE failed: '${o}' is a fixed path`),{success:!1,error:l('fixed_path',`Cannot CREATE on fixed path: ${o}`)}}try{return da(e,o,n),console.log(`[VariableProcessor] CREATE '${o}' = `,n),{success:!0}}catch(e){return console.error(`[VariableProcessor] CREATE '${o}' failed:`,e),{success:!1,error:l('unknown',`CREATE failed: ${e.message||e}`)}}case'REMOVE':{if(ma(o))return console.warn(`[VariableProcessor] REMOVE failed: '${o}' is a fixed path`),{success:!1,error:l('fixed_path',`Cannot REMOVE fixed path: ${o}`)};const t=function(e,t){const a=t.split('.');let n=e;for(let e=0;e<a.length-1;e++){const t=a[e];if(void 0===n[t]||null===n[t])return!1;n=n[t]}const o=a[a.length-1];return!!Object.prototype.hasOwnProperty.call(n,o)&&(delete n[o],!0)}(e,o);return t?console.log(`[VariableProcessor] REMOVE '${o}' success`):console.log(`[VariableProcessor] REMOVE '${o}' - path not found`),{success:!0}}default:return{success:!1,error:l('unknown',`Unknown command type: ${a}`)}}}function va(e){if('object'==typeof e&&null!==e&&!Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,'__type')){if(Object.prototype.hasOwnProperty.call(e,'__default'))try{return structuredClone(e.__default)}catch{return JSON.parse(JSON.stringify(e.__default))}const t=e.__type;if(Array.isArray(t))return[];if('string'==typeof t)return'Int'===t||t.includes('Int')?0:'Boolean'!==t&&!t.includes('Boolean')&&''}if(Array.isArray(e)){if(!(1===e.length&&'String'===e[0])&&e.every(e=>'string'==typeof e))try{return structuredClone(e)}catch{return JSON.parse(JSON.stringify(e))}return[]}if('number'==typeof e&&Number.isFinite(e))return Math.trunc(e);if('boolean'==typeof e)return e;if('string'==typeof e)return'Int'===e||e.includes('Int')?0:'Boolean'!==e&&!e.includes('Boolean')&&('String'===e?'':e);if('object'!=typeof e||null===e)return e;const t={};for(const a of Object.keys(e))a.startsWith('//')||'__type'!==a&&'__default'!==a&&(a.startsWith('<')&&a.endsWith('>')||(t[a]=va(e[a])));return t}async function ga(e=Kt){try{const t=await getWorldbook(e),a=t.findIndex(e=>e.name===qt),n=a>=0?t[a]:null;if(n&&(!0!==n.enabled||100!==n.probability))try{n.enabled=!0,n.probability=100,await replaceWorldbook(e,t)}catch{}if(n&&n.content)try{const e=n.content.replace(/\/\/[^\n]*/g,''),t=JSON.parse(e);return ra(t),la(t),t}catch{console.warn('[VariableProcessor] Failed to parse game data JSON')}const o=await async function(e=Kt){try{const t=(await getWorldbook(e)).find(e=>'变量库结构定义 - 正文'===e.name);if(t&&t.content)try{const e=t.content.replace(/\/\/[^\n]*/g,'');return JSON.parse(e)}catch{return console.warn('[VariableProcessor] Failed to parse schema JSON, using default from structure.json'),Qt}return Qt}catch(e){return console.error('[VariableProcessor] Failed to get schema, using default from structure.json:',e),Qt}}(e);return va(o)}catch(e){return console.error('[VariableProcessor] Failed to get worldbook:',e),va(Qt)}}async function fa(e,t=Kt){try{const a=await getWorldbook(t),n=a.findIndex(e=>e.name===qt),o=JSON.stringify(e,null,2);if(-1===n){const e={uid:Date.now(),name:qt,enabled:!0,content:o,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:0,order:800},probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}};a.push(e)}else{const e=a[n];e.content=o,e.enabled=!0,e.probability=100,e.strategy={...e.strategy??{},type:'constant',keys:Array.isArray(e.strategy?.keys)?e.strategy.keys:[],keys_secondary:e.strategy?.keys_secondary&&'object'==typeof e.strategy.keys_secondary?e.strategy.keys_secondary:{logic:'and_any',keys:[]},scan_depth:e.strategy?.scan_depth??'same_as_global'},e.position={...e.position??{},type:e.position?.type??'at_depth',role:e.position?.role??'system',depth:'number'==typeof e.position?.depth?e.position.depth:0,order:'number'==typeof e.position?.order?e.position.order:800}}return await replaceWorldbook(t,a),console.log('[VariableProcessor] Game data saved successfully'),!0}catch(e){return console.error('[VariableProcessor] Failed to save game data:',e),!1}}async function ya(e,t=Kt){const a=ca(e);if(0===a.length)return{success:!0,commandsExecuted:0,errors:[],errorDetails:[],updatedData:null};console.log(`[VariableProcessor] Found ${a.length} commands to process`);const n=await ga(t);ra(n);const o=[],l=[];let r=0;for(const e of a)try{const t=pa(n,e);if(t.success)r++;else if(t.error){l.push(t.error);const e=t.error.rawCommand?`${t.error.message} | 指令: ${t.error.rawCommand}`:t.error.message;o.push(e),console.error('[VariableProcessor] Command failed:',t.error)}}catch(t){const a=`Unexpected error: ${t.message||t} | 指令: ${e.rawCommand||'unknown'}`;o.push(a),l.push({code:'unknown',commandType:e.type,path:e.path,normalizedPath:oa(e.path),message:`Unexpected error: ${t.message||t}`,rawCommand:e.rawCommand}),console.error('[VariableProcessor] Unexpected error executing command:',t)}if(la(n),r>0){console.log(`[VariableProcessor] Saving data with ${r} successful changes...`);await fa(n,t)?console.log('[VariableProcessor] Data saved successfully'):o.push('Failed to save game data to worldbook')}else console.warn('[VariableProcessor] No commands executed successfully, skipping save');return console.log(`[VariableProcessor] Executed ${r}/${a.length} commands`),{success:0===o.length,commandsExecuted:r,errors:o,errorDetails:l,updatedData:n}}function ha(e){const t={};for(const a of e){const e=a.isDynamic?`<${a.key}>`:a.key;if(a.children&&a.children.length>0)t[e]=ha(a.children);else{const n='StringList'===a.valueType?['String']:a.valueType;void 0!==a.defaultValue?'StringList'===a.valueType&&Array.isArray(a.defaultValue)?t[e]=a.defaultValue:'Int'===a.valueType&&'number'==typeof a.defaultValue&&Number.isFinite(a.defaultValue)?t[e]=Math.trunc(a.defaultValue):'Boolean'===a.valueType&&'boolean'==typeof a.defaultValue?t[e]=a.defaultValue:'String'===a.valueType&&'string'==typeof a.defaultValue?'Int'===a.defaultValue||'Boolean'===a.defaultValue||'String'===a.defaultValue?t[e]={__type:n,__default:a.defaultValue}:t[e]=a.defaultValue:t[e]={__type:n,__default:a.defaultValue}:t[e]=n}a.comment&&(t[`//${e}`]=a.comment)}return t}function ka(e){const t=ha(e);return Ea(JSON.parse(JSON.stringify(Qt)),t)}function Na(e,t){return function(e,t){const a=(t?.dynamicKeySample||'Example').trim()||'Example',n=e=>{try{return structuredClone(e)}catch{return JSON.parse(JSON.stringify(e))}},o=(e,t)=>void 0!==t?n(t):Array.isArray(e)?[]:'Int'===e?0:'Boolean'!==e&&('String'===e?'':null),l=e=>{if(null==e)return null;if('object'==typeof e&&!Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,'__type')){const t=e.__type,a=Object.prototype.hasOwnProperty.call(e,'__default')?e.__default:void 0;return o(t,a)}if('string'==typeof e)return'Int'===e||'Boolean'===e||'String'===e?o(e):e;if('number'==typeof e||'boolean'==typeof e)return e;if(Array.isArray(e))return 1===e.length&&'String'===e[0]?[]:n(e);if('object'==typeof e){const t={};for(const n of Object.keys(e))n.startsWith('//')||(n.startsWith('<')&&n.endsWith('>')?t[a]=l(e[n]):t[n]=l(e[n]));return t}return null};return l(e)||{}}(ka(Array.isArray(e)?e:[]),t)}function Ea(e,t){for(const a of Object.keys(t))t[a]&&'object'==typeof t[a]&&!Array.isArray(t[a])?(('object'!=typeof e[a]||null===e[a]||Array.isArray(e[a]))&&(e[a]={}),Ea(e[a],t[a])):e[a]=t[a];return e}function Va(e,t=''){const a=[],n={};for(const t of Object.keys(e))t.startsWith('//')&&(n[t.substring(2)]=e[t]);for(const o of Object.keys(e)){if(o.startsWith('//'))continue;const l=e[o],r=o.startsWith('<')&&o.endsWith('>'),i=r?o.slice(1,-1):o,c={id:t?`${t}.${i}`:i,key:i,isDynamic:r,valueType:'String',comment:n[o]};if('object'==typeof l&&null!==l&&!Array.isArray(l)&&Object.prototype.hasOwnProperty.call(l,'__type')){const e=l.__type;Object.prototype.hasOwnProperty.call(l,'__default')&&(c.defaultValue=l.__default),Array.isArray(e)?c.valueType='StringList':'string'==typeof e&&('Int'===e||e.includes('Int')?c.valueType='Int':'Boolean'===e||e.includes('Boolean')?c.valueType='Boolean':c.valueType='String')}else if(Array.isArray(l)){const e=1===l.length&&'String'===l[0];c.valueType='StringList',!e&&l.every(e=>'string'==typeof e)&&(c.defaultValue=l)}else if('object'==typeof l&&null!==l){const e={};for(const t of Object.keys(l))'__type'!==t&&'__default'!==t&&(e[t]=l[t]);c.children=Va(e,c.id),c.valueType='String'}else'number'==typeof l&&Number.isFinite(l)?(c.valueType='Int',c.defaultValue=Math.trunc(l)):'boolean'==typeof l?(c.valueType='Boolean',c.defaultValue=l):'string'==typeof l&&('Int'===l||l.includes('Int')?c.valueType='Int':'Boolean'===l||l.includes('Boolean')?c.valueType='Boolean':'String'===l?c.valueType='String':(c.valueType='String',c.defaultValue=l));a.push(c)}return a}function ba(e,t=0){if('object'!=typeof e||null===e)return JSON.stringify(e);if(Array.isArray(e))return JSON.stringify(e);const a='  '.repeat(t),n='  '.repeat(t+1),o=Object.keys(e).filter(e=>!e.startsWith('//'));if(0===o.length)return'{}';let l='{\n';return o.forEach((a,r)=>{const i=e[a],c=e['//'+a],s=ba(i,t+1);if('object'==typeof i&&null!==i&&!Array.isArray(i)&&s.includes('\n')){const e=s.indexOf('\n'),t=s.substring(0,e),i=s.substring(e);l+=`${n}"${a}": ${t}`,c&&(l+=` // ${c}`),l+=i,r<o.length-1&&(l+=',')}else l+=`${n}"${a}": ${s}`,r<o.length-1&&(l+=','),c&&(l+=` // ${c}`);l+='\n'}),l+=`${a}}`,l}var wa=l(374),Ca=l(514);const Sa=new Set(['default','normal','stand','idle']);function Ba(e){return(e??'').trim()}function xa(e){let t=5381;for(let a=0;a<e.length;a++)t=33*t^e.charCodeAt(a);return t>>>0}function _a(e){return Ba(e.expression||e.diffName||'')}function Ia(e,t,a,n){const o=Ba(t);if(!e||!o)return'';const l=Ba(a??''),r=Ba(n??''),i=(Array.isArray(e?.characterImages)&&e.characterImages||[]).map(e=>{if(!e)return null;if('string'==typeof e)return{id:e,characterName:'',expression:'',outfit:'',isFallback:!1,imageUrl:Ba(e)};const t=e,a=Ba(t.imageUrl||t.url||t.src||'');return{id:String(t.id||a||crypto.randomUUID()),characterName:String(t.characterName||t.character||t.name||''),expression:String(t.expression||t.expressionName||t.emotion||t.diffName||''),outfit:String(t.outfit||t.outfitName||''),diffName:t.diffName,isFallback:Boolean(t.isFallback||t.fallback||t.isResident),imageUrl:a}}).filter(e=>!!e&&!!e.imageUrl).filter(e=>e.characterName&&(0,Ca.uF)(e.characterName,o,'equals'));if(0===i.length)return'';const c=e=>l?(0,Ca.Ao)(_a(e),l,'includes'):0,s=e=>r?(0,Ca.Ao)(e.outfit||'',r,'includes'):0,d=e=>String(e.id||e.imageUrl||''),u=(e,t)=>{let a,n=-1,o=0;for(const l of e){const e=1e3*c(l)+(t?s(l):0),r=xa(d(l));e>n?(n=e,o=r,a=l):e===n&&r<o&&(o=r,a=l)}return a};if(l&&r){const e=u(i.filter(e=>{const t=_a(e),a=Ba(e.outfit||'');return(0,Ca.uF)(t,l,'includes')&&a&&(0,Ca.uF)(a,r,'includes')}),!0);if(e)return e.imageUrl;const t=u(i.filter(e=>{const t=_a(e),a=Ba(e.outfit||'');return(0,Ca.uF)(t,l,'includes')&&!a}),!1);if(t)return t.imageUrl}if(l){const e=i.filter(e=>{const t=_a(e);return(0,Ca.uF)(t,l,'includes')});if(e.length>0){if(r){const t=u(e.filter(e=>{const t=Ba(e.outfit||'');return t&&(0,Ca.uF)(t,r,'includes')}),!0);if(t)return t.imageUrl;const a=u(e.filter(e=>!Ba(e.outfit||'')),!1);if(a)return a.imageUrl}const t=u(e,!1);if(t)return t.imageUrl}}if(r){const e=u(i.filter(e=>{const t=Ba(e.outfit||'');return t&&(0,Ca.uF)(t,r,'includes')}),!0);if(e)return e.imageUrl}const m=i.find(e=>!!e.isFallback);if(m)return m.imageUrl;const p=i.find(e=>function(e){return Sa.has(e.trim().toLowerCase())}(_a(e)));return p?p.imageUrl:i[0].imageUrl}function Ta(e){return Ba(e.naturalCondition||e.linkedVariable||'')}function Aa(e){return e?Ba('string'==typeof e?e:e.imageUrl||e.url||e.src||''):''}function Ma(e){if(!e)return'';if('string'==typeof e)return'';const t=e;return Ba(t.naturalCondition||t.linkedVariable||t.condition||t.trigger||t.keywords||t.aliases||t.name||t.title||'')}function Da(e){const t=Array.isArray(e?.backgroundImages)?e.backgroundImages:[];if(t.length>0){const a=t.filter(e=>{if(!Ba(e?.imageUrl||''))return!1;const t=e;if(Boolean(t?.isResident||t?.isFallback||t?.fallback))return!0;return!Ba(e?.naturalCondition||e?.linkedVariable||'')});if(1===a.length)return Ba(a[0].imageUrl||'');if(a.length>1){const t=a.map(e=>Ba(e.imageUrl||'')).filter(Boolean);if(0===t.length)return'';const n=`${e?.id||''}|resident|${t.join('|')}`;return t[xa(n)%t.length]}const n=t.find(e=>!!Ba(e?.imageUrl||''));if(n)return Ba(n.imageUrl||'')}const a=Array.isArray(e?.sceneBackgrounds)&&e.sceneBackgrounds||[];if(a.length>0){const e=Aa(a[0]);if(e)return e}return''}const Pa={class:'step-container'},Oa={class:'selection-grid'},Ra={class:'selection-column'},La={class:'column-header event-header'},$a={class:'scrollable-list'},Ua=['onClick'],za={key:0,class:'placeholder'},Fa={class:'card-info'},Wa={class:'pack-meta'},Ga={key:0,class:'link-badge'},ja={key:0,class:'checked-icon'},Ja={key:0,class:'empty-list'},Ya={class:'selection-column'},Ha={class:'column-header char-header'},Xa={class:'scrollable-grid'},Ka=['onClick'],qa={class:'char-info'},Qa={class:'preset-count'},Za={key:0,class:'empty-list'},en=(0,r.defineComponent)({__name:'Step1_Selection',props:{eventPacks:{},characterPacks:{},selectedEventId:{},selectedCharIds:{}},emits:['update:selectedEventId','update:selectedCharIds'],setup(e,{emit:t}){const a=e,n=t;return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Pa,[(0,r.createElementVNode)('div',Oa,[(0,r.createCommentVNode)(' Event Packs (Single Select) '),(0,r.createElementVNode)('div',Ra,[(0,r.createElementVNode)('div',La,[(0,r.createVNode)(E,{name:'book',size:'1.2em'}),t[0]||(t[0]=(0,r.createElementVNode)('h2',null,'选择剧本 / Scenario',-1))]),(0,r.createElementVNode)('div',$a,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPacks,t=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t.id,class:(0,r.normalizeClass)(['event-card',{selected:e.selectedEventId===t.id}]),onClick:e=>function(e){n('update:selectedEventId',e);const t=a.eventPacks.find(t=>t.id===e);if(t&&t.linkedCharacterPackIds&&t.linkedCharacterPackIds.length>0){const e=new Set([...a.selectedCharIds,...t.linkedCharacterPackIds]),o=new Set(a.characterPacks.map(e=>e.id)),l=[...e].filter(e=>o.has(e));n('update:selectedCharIds',l)}}(t.id)},[(0,r.createElementVNode)('div',{class:'card-cover',style:(0,r.normalizeStyle)({backgroundImage:`url(${t.coverImage||''})`})},[t.coverImage?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',za,'NO IMAGE'))],4),(0,r.createElementVNode)('div',Fa,[(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(t.name),1),(0,r.createElementVNode)('p',null,(0,r.toDisplayString)(t.description),1),(0,r.createElementVNode)('div',Wa,[t.linkedCharacterPackIds?.length?((0,r.openBlock)(),(0,r.createElementBlock)('span',Ga,' 🔗 '+(0,r.toDisplayString)(t.linkedCharacterPackIds.length)+' Linked ',1)):(0,r.createCommentVNode)('v-if',!0)])]),e.selectedEventId===t.id?((0,r.openBlock)(),(0,r.createElementBlock)('div',ja,[(0,r.createVNode)(E,{name:'check',size:'1.5em'})])):(0,r.createCommentVNode)('v-if',!0)],10,Ua))),128)),0===e.eventPacks.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ja,'没有已下载的事件包 (No Event Packs Found)')):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createCommentVNode)(' Character Packs (Multi Select) '),(0,r.createElementVNode)('div',Ya,[(0,r.createElementVNode)('div',Ha,[(0,r.createVNode)(E,{name:'star',size:'1.2em'}),t[1]||(t[1]=(0,r.createElementVNode)('h2',null,'登场人物 / Characters',-1))]),(0,r.createElementVNode)('div',Xa,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.characterPacks,o=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:o.id,class:(0,r.normalizeClass)(['char-card',{selected:e.selectedCharIds.includes(o.id)}]),onClick:e=>function(e){const t=[...a.selectedCharIds],o=t.indexOf(e);o>=0?t.splice(o,1):t.push(e),n('update:selectedCharIds',t)}(o.id)},[(0,r.createElementVNode)('div',{class:'char-cover',style:(0,r.normalizeStyle)({backgroundImage:`url(${o.coverImage||''})`})},[t[2]||(t[2]=(0,r.createElementVNode)('div',{class:'overlay'},null,-1)),e.selectedCharIds.includes(o.id)?((0,r.openBlock)(),(0,r.createBlock)(E,{key:0,name:'check',class:'check-mark',size:'2em'})):(0,r.createCommentVNode)('v-if',!0)],4),(0,r.createElementVNode)('div',qa,[(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(o.name),1),(0,r.createElementVNode)('span',Qa,(0,r.toDisplayString)(o.presets?.length||0)+' Presets',1)])],10,Ka))),128)),0===e.characterPacks.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Za,'没有已下载的角色包 (No Character Packs Found)')):(0,r.createCommentVNode)('v-if',!0)])])])]))}}),tn=(0,p.A)(en,[['__scopeId','data-v-429894f2']]),an={class:'step-container'},nn={class:'split-layout'},on={class:'info-column'},ln={class:'header'},rn={key:0,class:'scenario-details'},cn={class:'detail-row'},sn={class:'detail-row'},dn={key:1,class:'empty-state'},un={class:'selection-column'},mn={class:'header'},pn={key:0,class:'anchor-list'},vn=['onClick'],gn={class:'anchor-header'},fn={class:'badge'},yn={class:'anchor-meta'},hn={class:'anchor-desc'},kn={key:0,class:'custom-form'},Nn={key:1,class:'anchor-desc'},En=(0,r.defineComponent)({__name:'Step2_Scenario',props:{eventPack:{},selectedAnchorId:{},useCustom:{type:Boolean},customData:{}},emits:['update:selectedAnchorId','update:useCustom','update:customData'],setup(e,{emit:t}){const a=t;function n(){a('update:useCustom',!0)}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',an,[(0,r.createElementVNode)('div',nn,[(0,r.createCommentVNode)(' Scenario Info (Left) '),(0,r.createElementVNode)('div',on,[(0,r.createElementVNode)('div',ln,[(0,r.createVNode)(E,{name:'map-pin',size:'1.2em'}),t[6]||(t[6]=(0,r.createElementVNode)('h2',null,'选中剧本信息',-1))]),e.eventPack?((0,r.openBlock)(),(0,r.createElementBlock)('div',rn,[(0,r.createElementVNode)('div',cn,[t[7]||(t[7]=(0,r.createElementVNode)('label',null,'剧本名称:',-1)),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(e.eventPack.name),1)]),(0,r.createElementVNode)('div',sn,[t[8]||(t[8]=(0,r.createElementVNode)('label',null,'描述:',-1)),(0,r.createElementVNode)('p',null,(0,r.toDisplayString)(e.eventPack.description),1)])])):((0,r.openBlock)(),(0,r.createElementBlock)('div',dn,'未选择剧本'))]),(0,r.createCommentVNode)(' Anchor Selection (Right) '),(0,r.createElementVNode)('div',un,[(0,r.createElementVNode)('div',mn,[(0,r.createVNode)(E,{name:'map-pin',size:'1.2em'}),t[9]||(t[9]=(0,r.createElementVNode)('h2',null,'选择开局锚点 / Start Point',-1))]),e.eventPack?((0,r.openBlock)(),(0,r.createElementBlock)('div',pn,[(0,r.createCommentVNode)(' Presets '),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.startPoints,(t,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t.id,class:(0,r.normalizeClass)(['anchor-card',{selected:!e.useCustom&&e.selectedAnchorId===t.id}]),onClick:e=>{return n=t.id,a('update:useCustom',!1),void a('update:selectedAnchorId',n);var n}},[(0,r.createElementVNode)('div',gn,[(0,r.createElementVNode)('span',fn,'Preset #'+(0,r.toDisplayString)(n+1),1),(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(t.title||t.location||'未命名锚点'),1)]),(0,r.createElementVNode)('div',yn,[(0,r.createElementVNode)('span',null,[(0,r.createVNode)(E,{name:'time',size:'0.8em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(t.time),1)]),(0,r.createElementVNode)('span',null,[(0,r.createVNode)(E,{name:'map-pin',size:'0.8em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(t.location),1)])]),(0,r.createElementVNode)('p',hn,(0,r.toDisplayString)(t.initialEvent),1)],10,vn))),128)),(0,r.createCommentVNode)(' Custom Option '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['anchor-card custom-card',{selected:e.useCustom}]),onClick:n},[t[10]||(t[10]=(0,r.createElementVNode)('div',{class:'anchor-header'},[(0,r.createElementVNode)('span',{class:'badge custom'},'Custom'),(0,r.createElementVNode)('h3',null,'自定义开局 (Custom Start)')],-1)),e.useCustom?((0,r.openBlock)(),(0,r.createElementBlock)('div',kn,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=t=>e.customData.time=t),placeholder:'时间 (Time)...',onClick:t[1]||(t[1]=(0,r.withModifiers)(()=>{},['stop']))},null,512),[[r.vModelText,e.customData.time]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[2]||(t[2]=t=>e.customData.location=t),placeholder:'地点 (Location)...',onClick:t[3]||(t[3]=(0,r.withModifiers)(()=>{},['stop']))},null,512),[[r.vModelText,e.customData.location]]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[4]||(t[4]=t=>e.customData.initialEvent=t),placeholder:'初始剧情/状况描述...',rows:'3',onClick:t[5]||(t[5]=(0,r.withModifiers)(()=>{},['stop']))},null,512),[[r.vModelText,e.customData.initialEvent]])])):((0,r.openBlock)(),(0,r.createElementBlock)('p',Nn,'编写你自己的时间、地点和初始剧情。'))],2)])):(0,r.createCommentVNode)('v-if',!0)])])]))}}),Vn=(0,p.A)(En,[['__scopeId','data-v-0b0de7a9']]),bn={class:'step-container'},wn={class:'presets-column'},Cn={class:'header'},Sn={class:'presets-list'},Bn={class:'preset-header'},xn={class:'preset-info'},_n={class:'pn'},In={key:0,class:'origin'},Tn={class:'category-buttons'},An=['onClick','title'],Mn=['onClick','title'],Dn=['onClick','title'],Pn=['onClick','title'],On=['onClick','title'],Rn={class:'preset-preview'},Ln={key:0,class:'preview-item'},$n={key:1,class:'preview-item'},Un={key:2,class:'preview-item'},zn={key:3,class:'preview-item'},Fn={key:0,class:'empty-list'},Wn={class:'editor-column'},Gn={class:'header'},jn={class:'form-scroll'},Jn={class:'form-section'},Yn={class:'input-grid'},Hn={key:0},Xn={class:'identity-fields'},Kn={class:'field'},qn={class:'field'},Qn={class:'section-header'},Zn={key:0,class:'selection-count'},eo=['onUpdate:modelValue','placeholder'],to=(0,r.defineComponent)({__name:'Step3_Protagonist',props:{modelValue:{},characterPacks:{},selectedCharIds:{}},emits:['update:modelValue'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.reactive)({...a.modelValue}),l=(0,r.reactive)({appearance:[],personality:[],background:[],ability:[]}),i=(0,r.ref)(null),c=(0,r.ref)(null),s=(0,r.computed)(()=>{const e=[];return a.characterPacks.forEach(t=>{a.selectedCharIds.includes(t.id)&&t.presets&&t.presets.forEach(a=>{e.push({...a,_packId:t.id})})}),e}),d=[{key:'appearance',label:'外貌 (Appearance)',placeholder:'黑发红瞳，身穿...',icon:'eye'},{key:'personality',label:'性格 (Personality)',placeholder:'冷酷，多疑...',icon:'chat'},{key:'background',label:'身世 (Background)',placeholder:'来自...',icon:'book'},{key:'ability',label:'能力 (Ability)',placeholder:'5倍力量，常人的5倍力量',icon:'lightning'}],u=(0,r.computed)(()=>o.name&&o.appearance&&o.personality&&o.background&&o.ability);function m(e,t){return e?e.length>t?e.slice(0,t)+'...':e:''}function p(e,t){return l[e].some(e=>e.presetId===t.id)}function v(e){return i.value===e.id}function g(e){return l[e].length}function f(e,t){const a=t[e];if(!a)return;const n=l[e].findIndex(e=>e.presetId===t.id);n>=0?l[e].splice(n,1):l[e].push({presetId:t.id,content:a}),function(e){const t=l[e].map(e=>e.content);o[e]=t.join('\n\n')}(e)}return(0,r.watch)(o,e=>{n('update:modelValue',{...e})},{deep:!0}),(0,r.watch)(()=>a.modelValue,e=>{Object.assign(o,e)},{deep:!0}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',bn,[(0,r.createCommentVNode)(' Presets Sidebar (grouped by category) '),(0,r.createElementVNode)('div',wn,[(0,r.createElementVNode)('div',Cn,[(0,r.createVNode)(E,{name:'user',size:'1.2em'}),t[2]||(t[2]=(0,r.createElementVNode)('h2',null,'参考预设 / PRESETS',-1))]),(0,r.createElementVNode)('div',Sn,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.value,e=>{return(0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'preset-card'},[(0,r.createElementVNode)('div',Bn,[(0,r.createElementVNode)('div',{class:'preset-cover',style:(0,r.normalizeStyle)({backgroundImage:`url(${e.coverImage||''})`})},null,4),(0,r.createElementVNode)('div',xn,[(0,r.createElementVNode)('span',_n,(0,r.toDisplayString)((n=e._packId,a.characterPacks.find(e=>e.id===n)?.name||'Unknown')),1),e.name&&'Untitled Module'!==e.name?((0,r.openBlock)(),(0,r.createElementBlock)('span',In,(0,r.toDisplayString)(e.name),1)):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createCommentVNode)(' Category buttons for this preset '),(0,r.createElementVNode)('div',Tn,[e.name||e.description||e.coverImage?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:(0,r.normalizeClass)(['cat-btn',{selected:v(e)}]),onClick:t=>function(e){if(i.value===e.id)return c.value&&(o.name=c.value.name,o.description=c.value.description,o.coverImage=c.value.coverImage),c.value=null,void(i.value=null);i.value||(c.value={name:o.name,description:o.description,coverImage:o.coverImage}),i.value=e.id,o.name=e.name||'',o.description=e.description||'',o.coverImage=e.coverImage||''}(e),title:e.description||e.name||''},[(0,r.createVNode)(E,{name:'image',size:'0.9em'}),t[3]||(t[3]=(0,r.createTextVNode)(' 立绘 ',-1))],10,An)):(0,r.createCommentVNode)('v-if',!0),e.appearance?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:(0,r.normalizeClass)(['cat-btn',{selected:p('appearance',e)}]),onClick:t=>f('appearance',e),title:e.appearance},[(0,r.createVNode)(E,{name:'eye',size:'0.9em'}),t[4]||(t[4]=(0,r.createTextVNode)(' 外貌 ',-1))],10,Mn)):(0,r.createCommentVNode)('v-if',!0),e.personality?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:2,class:(0,r.normalizeClass)(['cat-btn',{selected:p('personality',e)}]),onClick:t=>f('personality',e),title:e.personality},[(0,r.createVNode)(E,{name:'chat',size:'0.9em'}),t[5]||(t[5]=(0,r.createTextVNode)(' 性格 ',-1))],10,Dn)):(0,r.createCommentVNode)('v-if',!0),e.background?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:3,class:(0,r.normalizeClass)(['cat-btn',{selected:p('background',e)}]),onClick:t=>f('background',e),title:e.background},[(0,r.createVNode)(E,{name:'book',size:'0.9em'}),t[6]||(t[6]=(0,r.createTextVNode)(' 身世 ',-1))],10,Pn)):(0,r.createCommentVNode)('v-if',!0),e.ability?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:4,class:(0,r.normalizeClass)(['cat-btn',{selected:p('ability',e)}]),onClick:t=>f('ability',e),title:e.ability},[(0,r.createVNode)(E,{name:'lightning',size:'0.9em'}),t[7]||(t[7]=(0,r.createTextVNode)(' 能力 ',-1))],10,On)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createCommentVNode)(' Preview of content '),(0,r.createElementVNode)('div',Rn,[e.appearance?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ln,[t[8]||(t[8]=(0,r.createElementVNode)('span',{class:'preview-label'},'外貌:',-1)),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(m(e.appearance,40)),1)])):(0,r.createCommentVNode)('v-if',!0),e.personality?((0,r.openBlock)(),(0,r.createElementBlock)('div',$n,[t[9]||(t[9]=(0,r.createElementVNode)('span',{class:'preview-label'},'性格:',-1)),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(m(e.personality,40)),1)])):(0,r.createCommentVNode)('v-if',!0),e.background?((0,r.openBlock)(),(0,r.createElementBlock)('div',Un,[t[10]||(t[10]=(0,r.createElementVNode)('span',{class:'preview-label'},'身世:',-1)),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(m(e.background,40)),1)])):(0,r.createCommentVNode)('v-if',!0),e.ability?((0,r.openBlock)(),(0,r.createElementBlock)('div',zn,[t[11]||(t[11]=(0,r.createElementVNode)('span',{class:'preview-label'},'能力:',-1)),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(m(e.ability,40)),1)])):(0,r.createCommentVNode)('v-if',!0)])]);var n}),128)),0===s.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Fn,'No presets available')):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createCommentVNode)(' Main Editor '),(0,r.createElementVNode)('div',Wn,[(0,r.createElementVNode)('div',Gn,[(0,r.createVNode)(E,{name:'edit',size:'1.2em'}),t[12]||(t[12]=(0,r.createElementVNode)('h2',null,'主角设定 / PROTAGONIST',-1)),(0,r.createElementVNode)('span',{class:(0,r.normalizeClass)(['status-badge',{valid:u.value}])},(0,r.toDisplayString)(u.value?'Ready':'Incomplete'),3)]),(0,r.createElementVNode)('div',jn,[(0,r.createCommentVNode)(' Identity '),(0,r.createElementVNode)('div',Jn,[(0,r.createElementVNode)('div',Yn,[(0,r.createElementVNode)('div',{class:'avatar-uploader',style:(0,r.normalizeStyle)({backgroundImage:`url(${o.coverImage})`})},[o.coverImage?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',Hn,'Avatar'))],4),(0,r.createElementVNode)('div',Xn,[(0,r.createElementVNode)('div',Kn,[t[13]||(t[13]=(0,r.createElementVNode)('label',null,'姓名 Name',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>o.name=e),type:'text',placeholder:'输入姓名...'},null,512),[[r.vModelText,o.name]])]),(0,r.createElementVNode)('div',qn,[t[14]||(t[14]=(0,r.createElementVNode)('label',null,'描述 Description',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>o.description=e),type:'text',placeholder:'一句话描述...'},null,512),[[r.vModelText,o.description]])])])])]),(0,r.createCommentVNode)(' Trait Sections with combined content '),((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(d,e=>(0,r.createElementVNode)('div',{class:'form-section',key:e.key},[(0,r.createElementVNode)('div',Qn,[(0,r.createElementVNode)('h3',null,[(0,r.createVNode)(E,{name:e.icon,size:'1em'},null,8,['name']),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(e.label),1)]),g(e.key)>0?((0,r.openBlock)(),(0,r.createElementBlock)('span',Zn,' 已选 '+(0,r.toDisplayString)(g(e.key))+' 项 ',1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>o[e.key]=t,placeholder:e.placeholder,rows:'3'},null,8,eo),[[r.vModelText,o[e.key]]])])),64))])])]))}}),ao=(0,p.A)(to,[['__scopeId','data-v-41af27aa']]),no={class:'new-game-root'},oo={class:'visual-container'},lo={class:'new-game-header'},ro={class:'steps-progress'},io={class:'step-content-wrapper'},co=(0,r.defineComponent)({__name:'NewGame',setup(e){const t=(0,r.ref)([]),a=(0,r.ref)([]);(0,r.onMounted)(async()=>{try{const e=await pe.idbService.getAllWorks();t.value=e.filter(e=>'EVENT'===e.type).map(e=>e.data),a.value=e.filter(e=>'CHARACTER'===e.type).map(e=>e.data)}catch(e){console.error('Failed to load works from IDB:',e)}const e=await X();if(e&&'NewGame'===e.currentPage&&e.newGame){const t=e.newGame;t.step&&(n.value=t.step),t.selectedEventId&&(l.value=t.selectedEventId),t.selectedCharIds&&(c.value=t.selectedCharIds),t.selectedAnchorId&&(s.value=t.selectedAnchorId),t.protagonistData&&Object.assign(m,t.protagonistData),console.log(`[NewGame] 恢复到Step ${n.value}`)}await ee({step:n.value,selectedEventId:l.value||void 0,selectedCharIds:c.value,selectedAnchorId:s.value||void 0,protagonistData:{...m}})});const n=(0,r.ref)(1),o=(0,i.useRouter)(),l=(0,r.ref)(null),c=(0,r.ref)([]),s=(0,r.ref)(null),d=(0,r.ref)(!1),u=(0,r.reactive)({id:'custom',time:'',location:'',initialEvent:''}),m=(0,r.reactive)({name:'',description:'',coverImage:'',appearance:'',personality:'',background:'',ability:''}),p=(0,r.ref)(!1),v=(0,r.ref)(''),g=(0,r.ref)('info');function f(e,t='info'){v.value=e,g.value=t,p.value=!0}function y(e){if(!e)return{};try{const t=JSON.parse(e);if(t&&'object'==typeof t&&('EVENT'===t.type||'CHARACTER'===t.type)&&t.data)return{type:t.type,data:t.data}}catch{}return{}}let h=0;async function k(e){const t=++h,n=function(e){if(!e)return[];const t=[];if(Array.isArray(e.linkedCharacterPackIds))for(const a of e.linkedCharacterPackIds)'string'==typeof a&&a.trim()&&t.push(a.trim());else'string'==typeof e.linkedCharacterPackId&&e.linkedCharacterPackId.trim()&&t.push(e.linkedCharacterPackId.trim());return Array.from(new Set(t))}(e);if(!n.length)return;const o=new Set(a.value.map(e=>e.id)),l=n.filter(e=>!o.has(e));if(!l.length)return;f(`检测到缺少关联人设包：${l.length} 个，正在自动下载...`,'loading');let r=[];const i=[];try{const e=await async function(e,t){const a=new Set(e.filter(Boolean)),n=new Map;if(!a.size)return n;const o='number'==typeof t?.maxPages?t.maxPages:8,l='number'==typeof t?.pageSize?t.pageSize:50;for(let e=1;e<=o;e++){const t=await Xt.listPublicItems({page:e,limit:l},{timeoutMs:15e3}),o=Array.isArray(t?.data)?t.data:[];for(const e of o){const t='string'==typeof e?.clientWorkId?e.clientWorkId:'';t&&a.has(t)&&!n.has(t)&&'CHARACTER'===e.packType&&n.set(t,e)}if(n.size>=a.size)break;if(!t?.hasMore)break}return n}(l);for(const n of l){if(t!==h)return;const o=e.get(n);if(o?._id)try{const e=await Xt.getItem(String(o._id),{timeoutMs:2e4}),t=y(e?.data?.code);if('CHARACTER'!==t.type||!t.data){i.push(n);continue}const l=t.data,s=(new Date).toISOString(),d={id:String(l.id||n||crypto.randomUUID()),type:'CHARACTER',data:l,downloadedAt:s};await pe.idbService.saveWork(d),a.value.find(e=>e.id===d.id)||a.value.push(l),c.value.includes(d.id)||(c.value=[...c.value,d.id]),r.push(l)}catch{i.push(n)}else i.push(n)}}catch{i.push(...l)}t===h&&(r.length&&i.length?f(`已自动下载关联人设包：${r.map(e=>e.name||e.id).join('、')}\n云端缺少/不可下载：${i.join('、')}`,'warning'):r.length?f(`已自动下载关联人设包：${r.map(e=>e.name||e.id).join('、')}`,'success'):i.length&&f(`云端缺少关联人设包，无法自动下载：${i.join('、')}`,'warning'))}let N=null;(0,r.watch)([n,l,c,s,()=>({...m})],async()=>{N&&clearTimeout(N),N=setTimeout(async()=>{await ee({step:n.value,selectedEventId:l.value||void 0,selectedCharIds:c.value,selectedAnchorId:s.value||void 0,protagonistData:{...m}})},300)}),(0,r.watch)(l,async e=>{if(!e)return;const a=t.value.find(t=>t.id===e);a&&await k(a)},{flush:'post'});const V=(0,r.computed)(()=>{switch(n.value){case 1:default:return tn;case 2:return Vn;case 3:return ao}}),b=(0,r.computed)(()=>{if(1===n.value){if(!l.value)return!1;const e=t.value.find(e=>e.id===l.value);if(e&&e.linkedCharacterPackIds&&e.linkedCharacterPackIds.length>0){if(!e.linkedCharacterPackIds.every(e=>c.value.includes(e)))return!1}return!0}return 2===n.value?d.value?!!(u.time&&u.location&&u.initialEvent):!!s.value:3===n.value&&(m.name&&m.appearance&&m.personality&&m.background&&m.ability)}),{updateStoryWorldbook:w,cleanGameDataEntry:C}=zt();async function S(){if(b.value)if(n.value<3)n.value++;else{f('正在启动游戏，请稍候...\nStarting Game...','loading');try{const e=t.value.find(e=>e.id===l.value);if(!e)throw new Error('Event Pack not found');const a=d.value?u:e.startPoints.find(e=>e.id===s.value),n='同梦',r=window.TavernHelper;r.getWorldbookNames().includes(n)||await r.createWorldbook(n),await r.rebindChatWorldbook('current',n);const i=n;await C();const p=/^【.*?】【.*?】【.*?】【.*?】$/;await window.deleteWorldbookEntries(i,e=>p.test(e.name));const v=[],g='Local',y=(t,a,n,o=!1,l=null)=>{t&&v.push({name:`【${g}】【${e.name}】【${a}】【${String(n).padStart(3,'0')}】`,content:t,position:{type:'after_character_definition',order:n},enabled:o,probability:l,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}})};e.randomEvents&&e.randomEvents.forEach((e,t)=>{const a='number'==typeof e.config?.probability?e.config.probability:0;y(e.content,'随机事件',202+t,!0,a)}),await w(e,a?.time||''),e.conditionalEvents&&e.conditionalEvents.forEach((e,t)=>y(e.content,'条件事件',402+t,!0));let h=502;e.worldviews&&e.worldviews.forEach(e=>y(e.content,'世界观',h++,!0)),e.powerSystems&&e.powerSystems.forEach(e=>y(e.content,'世界观',h++,!0)),e.specialRules&&e.specialRules.forEach((e,t)=>y(e.content,'特殊规则',602+t,!0)),Array.isArray(e.extraWorldBooks)&&e.extraWorldBooks.length>0&&e.extraWorldBooks.forEach((t,a)=>{const n='string'==typeof t?.content?t.content:'';if(!n.trim())return;const o='number'==typeof t?.uid?String(t.uid).padStart(3,'0'):String(800+a).padStart(3,'0'),l='string'==typeof t?.name&&t.name.trim()?t.name.trim():'额外世界书';v.push({name:`【${g}】【${e.name}】【额外世界书】【${o}】${l}`,content:n,position:t?.position||{type:'after_character_definition',order:800+a},enabled:!1!==t?.enabled,probability:'number'==typeof t?.probability?t.probability:null,strategy:t?.strategy||{type:'selective',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},recursion:t?.recursion,effect:t?.effect})}),'string'==typeof e.extraWorldBook&&e.extraWorldBook.trim()&&v.push({name:`【${g}】【${e.name}】【额外世界书】【LEGACY】`,content:e.extraWorldBook.trim(),position:{type:'after_character_definition',order:799},enabled:!0,probability:null,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}});{const t=Da(e);if(t)try{const e=await we();e.bgImage=t,Se(e,0),console.log('[NewGame] Set start background:',t)}catch(e){console.error('Failed to set background',e)}}const k=`\n姓名: ${m.name}\n描述: ${m.description}\n外貌: ${m.appearance}\n性格: ${m.personality}\n身世: ${m.background}\n能力: ${m.ability}\n      `.trim();let N;v.push({name:`【${g}】【${e.name}】【玩家档案】【001】`,content:k,position:{type:'after_character_definition',order:702},enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}}),v.length>0&&await window.createWorldbookEntries(i,v),N=e.variableTree&&e.variableTree.length>0?ka(e.variableTree):JSON.parse(JSON.stringify(Qt));const E={name:'变量库结构定义 - 正文',content:ba(N),position:{type:'before_character_definition',order:3},enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}};try{await window.deleteWorldbookEntries(i,e=>'变量库结构定义 - 正文'===e.name)}catch(e){console.warn('[NewGame] Failed to delete existing schema entry:',e)}await window.createWorldbookEntries(i,[E]),console.log('[NewGame] Variable schema entry created'),await jt('low'),console.log('[NewGame] Deviation prompt set to low');const V=`\n**<玩家档案 (Protagonist)>**\n${k}\n\n**<开局锚点 (Scenario Anchor)>**\n时间: ${a?.time||''}\n地点: ${a?.location||''}\n初始事件: ${a?.initialEvent||''}\n`,b={injects:[{role:'user',content:`\n<开局指令>\n**[1. 数据加载]**\n请读取以下核心数据：\n${V}\n\n**[2. 执行指令 (Execution)]**\n你现在是 **Game Master (GM)**。请根据以上数据，为你面前的玩家生成**开局场景**。\n**写作要求：**\n1.  **视角转换**：无论前置剧情使用什么视角，都要按指定视角重写。\n2.  **能力融入**：结合玩家的【特殊能力】，在描述中加入独特的感官细节。\n3.  **人设匹配**：描述玩家的心理活动时，必须符合【性格】\n4.  **环境渲染**：利用【世界观】设定，描写周围的光影、景色。\n5.  **行动诱导**：**不要**帮玩家执行之后的一系列动作。请把剧情停在玩家决定行动的那一刻，等待玩家的具体指令。\n6， **语言风格**：遵从<正文生成规范>的要求生成文本。\n</开局指令>`,position:'in_chat',depth:0,should_scan:!0}],should_stream:!1};console.log('[NewGame] 准备发送 Prompt (No Stream):',b);const S=new Promise(e=>{const t=window.iframe_events||window.tavern_events,a=window.eventOnce;if(t&&t.GENERATION_ENDED&&a){const n=t=>{console.log('[NewGame] 收到 GENERATION_ENDED 事件'),t&&e(t)};console.log('[NewGame] 注册一次性 GENERATION_ENDED 监听器'),a(t.GENERATION_ENDED,n),setTimeout(()=>{e('')},45e3)}else console.warn('[NewGame] 无法注册监听器，事件系统不可用'),e('')});let B=await window.TavernHelper.generate(b);console.log('[NewGame] TavernHelper.generate 返回:',B);let x='string'==typeof B?B:'';if(x||(console.log('[NewGame] 等待事件捕获文本...'),x=await S),!x)throw new Error('No text received from generation');const I=Ue(x);console.log('[NewGame] 生成成功! finalText length:',I.length);const T=De(I,'content',{stripThink:!0});if(!('string'==typeof T?T.trim():''))return void f('启动失败：无法从模型回应中解析出有效 <content>。\n请让模型重新发送，或检查提示词模板是否输出 <think>/<content>/<小总结> 标签。','error');sessionStorage.setItem('new_game_start_text',I),sessionStorage.setItem('last_final_text',I),sessionStorage.setItem('current_game_event_id',l.value||''),sessionStorage.setItem('current_game_char_ids',JSON.stringify(c.value));const A=`protagonist_${Date.now()}`;await pe.idbService.setRuntimeAsset(A,{imageUrl:m.coverImage||''}),sessionStorage.setItem('current_game_protagonist_ref',JSON.stringify({name:m.name||'',runtimeId:A}));const M=(0,wa.zP)(e);(0,wa.RV)(M),console.log('[NewGame] Saved event pack assets:',M),await K({currentPage:'NewGame',mainGame:void 0}),o.push('/MainGame')}catch(e){console.error('Failed to start game:',e),f('启动失败，请再次尝试。\nFailed to start game: '+(e.message||e),'error')}}}async function B(){n.value>1?n.value--:(await q(),o.push('/'))}const x=(0,r.computed)(()=>{if(1===n.value)return{eventPacks:t.value,characterPacks:a.value,selectedEventId:l.value,selectedCharIds:c.value};if(2===n.value){return{eventPack:t.value.find(e=>e.id===l.value),selectedAnchorId:s.value,useCustom:d.value,customData:u}}return{modelValue:m,characterPacks:a.value,selectedCharIds:c.value}}),I=(0,r.computed)(()=>1===n.value?{'update:selectedEventId':e=>l.value=e,'update:selectedCharIds':e=>c.value=e}:2===n.value?{'update:selectedAnchorId':e=>s.value=e,'update:useCustom':e=>d.value=e,'update:customData':e=>Object.assign(u,e)}:{'update:modelValue':e=>Object.assign(m,e)});return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',no,[(0,r.createElementVNode)('div',oo,[(0,r.createCommentVNode)(' Top Navigation '),(0,r.createElementVNode)('div',lo,[(0,r.createElementVNode)('button',{class:'nav-btn',onClick:B},[(0,r.createVNode)(E,{name:'back'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(1===n.value?'Back to Home':'Previous Step'),1)]),(0,r.createElementVNode)('div',ro,[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['step-dot',{active:n.value>=1,current:1===n.value}])},'1',2),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['line',{active:n.value>=2}])},null,2),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['step-dot',{active:n.value>=2,current:2===n.value}])},'2',2),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['line',{active:n.value>=3}])},null,2),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['step-dot',{active:n.value>=3,current:3===n.value}])},'3',2)]),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['nav-btn next',{disabled:!b.value}]),onClick:S},[(0,r.createTextVNode)((0,r.toDisplayString)(3===n.value?'START GAME':'NEXT STEP')+' ',1),(0,r.createVNode)(E,{name:'next'})],2)]),(0,r.createCommentVNode)(' Content Area '),(0,r.createElementVNode)('div',io,[((0,r.openBlock)(),(0,r.createBlock)(r.KeepAlive,null,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(V.value),(0,r.mergeProps)(x.value,(0,r.toHandlers)(I.value)),null,16))],1024))])]),(0,r.createVNode)(M,{visible:p.value,'onUpdate:visible':t[0]||(t[0]=e=>p.value=e),message:v.value,type:g.value},null,8,['visible','message','type'])]))}}),so=(0,p.A)(co,[['__scopeId','data-v-5b862732']]);const uo=['eval','Function','setTimeout','setInterval','document.cookie','localStorage','sessionStorage','indexedDB','window.opener','window.parent','window.top','postMessage','XMLHttpRequest','WebSocket','Worker','SharedWorker','ServiceWorker','importScripts','__proto__','prototype','constructor','atob','btoa','fetch','navigator.sendBeacon','location.href','location.assign','location.replace','history.pushState','history.replaceState'],mo=[/\b_0x[a-f0-9]+\b/gi,/\[['"][a-z]{1,2}['"]\]/gi,/\\x[0-9a-f]{2}/gi,/\\u[0-9a-f]{4}/gi,/String\.fromCharCode\(/gi,/unescape\(/gi,/decodeURIComponent\(/gi],po=['Math','Date','console','String','Number','Boolean','Array','Object','JSON','parseInt','parseFloat','isNaN','isFinite','encodeURIComponent','decodeURIComponent','Promise','Map','Set','WeakMap','WeakSet','Symbol','Proxy','Reflect','RegExp','Error','TypeError','RangeError'];function vo(e){const t=[],a=[];for(const a of uo){new RegExp(`\\b${a.replace(/\./g,'\\.')}\\b`,'gi').test(e)&&t.push(`禁止使用危险关键词: ${a}`)}for(const t of mo)if(t.test(e)){a.push('检测到可能的代码混淆，请使用清晰可读的代码');break}const n=e.match(/\[['"]\w+['"]\]/g);n&&n.length>10&&a.push('检测到大量括号属性访问，可能是混淆代码');const o=e.replace(/\bxmlns(?::[a-zA-Z_][\w.-]*)?\s*=\s*(['"])\s*(?:https?|ftp):\/\/[^'"\s]+\s*\1/gi,'').match(/\b(?:https?|ftp|ws|wss):\/\/[^\s'"\)\]]+/gi)||[],l=['webp','png','jpg','jpeg','gif','avif'];o.filter(e=>{return!(/^https:\/\//i.test(t=e)&&l.some(e=>new RegExp(`\\.${e}(?:[?#].*)?$`,'i').test(t)));var t}).length>0&&t.push(`禁止在代码中包含外部 URL（仅允许 https 图片直链: ${l.join(', ')}）`);const r=[/document\.(getElementById|querySelector|getElementsBy)/gi,/document\.(write|writeln|open|close)/gi,/\.innerHTML\s*=/gi,/\.outerHTML\s*=/gi,/\.insertAdjacentHTML/gi];for(const a of r)if(a.test(e)){t.push('禁止直接操作 DOM，请使用 GameSDK 提供的方法');break}return{isValid:0===t.length,errors:t,warnings:a}}function go(e,t={}){const{extraGlobals:n={}}=t,o=vo(e);if(!o.isValid)return{component:null,error:`代码安全检查失败:\n${o.errors.join('\n')}`};const l=function(e={}){const t={};for(const e of po)e in window&&(t[e]=window[e]);return Object.assign(t,e),new Proxy(t,{get(e,t){if(t in e)return e[t];if('string'==typeof t){const e=t.toLowerCase();if(e.includes('cookie')||e.includes('storage')||e.includes('location')||'window'===e||'document'===e||'global'===e||'self'===e||'top'===e||'parent'===e||'frames'===e)return void console.warn(`[SecuritySandbox] 阻止访问危险属性: ${t}`)}},set:(e,t,a)=>(e[t]=a,!0),has:(e,t)=>t in e,deleteProperty:()=>!1})}(n);try{const t=new Function('sandbox',`\n      const { Math, Date, console, JSON, String, Number, Boolean, Array, Object, \n              parseInt, parseFloat, isNaN, isFinite, Promise, Map, Set, RegExp,\n              Error, TypeError, RangeError, Symbol } = sandbox;\n      \n      // 屏蔽危险全局变量（设为 undefined）\n      const window = undefined;\n      const document = undefined;\n      const globalThis = undefined;\n      const self = undefined;\n      const top = undefined;\n      const parent = undefined;\n      const frames = undefined;\n      const localStorage = undefined;\n      const sessionStorage = undefined;\n      const indexedDB = undefined;\n      const fetch = undefined;\n      const XMLHttpRequest = undefined;\n      const WebSocket = undefined;\n      \n      return (${e});\n      `)(l);if(!t||'object'!=typeof t)return{component:null,error:'用户代码必须返回一个有效的 Vue 组件配置对象'};const n=t;if(!n.template&&!n.render)return{component:null,error:'组件必须包含 template 或 render 属性'};if('string'==typeof n.template&&!n.render)try{const{code:e}=a(n.template,{mode:'function'});n.render=new Function('Vue',e)(r),delete n.template}catch(e){return{component:null,error:`template 编译失败: ${e?.message||String(e)}`}}return{component:t,error:null}}catch(e){return{component:null,error:`代码执行错误: ${e.message}`}}}const fo=['id'],yo={key:0,class:'widget-loading'},ho={class:'widget-error'},ko={class:'error-message'},No={key:2,class:'widget-warnings'},Eo=(0,r.defineComponent)({__name:'DynamicLoader',props:{userCode:{},userCSS:{default:''},componentId:{default:''},gameState:{},previewVariables:{default:null}},emits:['loaded','error','notification'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(!0),l=(0,r.ref)(null),i=(0,r.ref)([]),c=(0,r.ref)(null),s=(0,r.ref)(0),d=(0,r.ref)('user-widget-'+Math.random().toString(36).substring(2,10)),u=(0,r.ref)(null),m=(0,r.ref)(null),p=(0,r.ref)(null),v=(0,r.ref)(!1),g=(0,r.ref)(1),f=(0,r.ref)(null),y=(0,r.computed)(()=>g.value<.999),h=(0,r.computed)(()=>{const e={'--th-widget-scale':String(g.value)};return null!=f.value&&(e.height=`${f.value}px`),e}),k=(0,r.ref)(a.gameState||{playerName:'玩家',gold:0,level:1,customVars:{}}),N=(0,r.computed)(()=>function(e){const{gameState:t,maxLogEntries:a=100,componentId:n,previewVariables:o}=e,l=Ot(),r=e=>{try{return structuredClone(e)}catch{try{return JSON.parse(JSON.stringify(e))}catch{return null}}},i=e=>{const t=o?.value;if(!t||'object'!=typeof t)return{found:!1,value:null};const a=String(e).split('.').map(e=>e.trim()).filter(Boolean);if(0===a.length)return{found:!1,value:null};let n=t;for(let e=0;e<a.length;e++){const t=a[e];if(null==n)return{found:!1,value:null};if(Array.isArray(n)){const e=Number(t);if(!Number.isInteger(e)||e<0||e>=n.length)return{found:!1,value:null};n=n[e];continue}if('object'!=typeof n)return{found:!1,value:null};if(!Object.prototype.hasOwnProperty.call(n,t))return{found:!1,value:null};n=n[t]}return{found:!0,value:n}},c=[],s=[],d=new Map;return{version:'1.0.0',componentId:n,getPlayerName:()=>t.value.playerName,getGold:()=>t.value.gold,getLevel:()=>t.value.level,getCustomVar:e=>JSON.parse(JSON.stringify(t.value.customVars[e]??null)),getAllCustomVars:()=>JSON.parse(JSON.stringify(t.value.customVars)),getVariable(e,t){if('string'!=typeof e||!e.trim())return console.warn(`[GameSDK:${n}] 无效的变量路径`),void t(null);const a=i(e);a.found?t(r(a.value)):l.readVariable(e).then(e=>t(e)).catch(a=>{console.warn(`[GameSDK:${n}] 获取变量失败:`,e,a),t(null)})},getDynamicKeys(e,t){if('string'!=typeof e||!e.trim())return console.warn(`[GameSDK:${n}] 无效的容器路径`),void t([]);const a=i(e);if(a.found){const e=a.value;return void(e&&'object'==typeof e&&!Array.isArray(e)?t(Object.keys(e)):t([]))}l.getDynamicKeys(e).then(e=>t(e)).catch(a=>{console.warn(`[GameSDK:${n}] 获取动态 keys 失败:`,e,a),t([])})},getDynamicInstance(e,t,a,o){if(!e||!t)return console.warn(`[GameSDK:${n}] 无效的容器路径或实例 key`),void o(null);const c=i(a?`${e}.${t}.${a}`:`${e}.${t}`);c.found?o(r(c.value)):l.getDynamicInstance(e,t,a||void 0).then(e=>o(e)).catch(l=>{console.warn(`[GameSDK:${n}] 获取动态实例失败:`,e,t,a,l),o(null)})},modifyGold(e){if('number'!=typeof e||isNaN(e))return console.warn(`[GameSDK:${n}] 无效的金币变化值`),!1;const a=Math.max(-1e3,Math.min(1e3,e));return t.value.gold=Math.max(0,t.value.gold+a),!0},setCustomVar(e,a){if('string'!=typeof e||e.length>50)return console.warn(`[GameSDK:${n}] 无效的变量名`),!1;const o=JSON.stringify(a);return o.length>1e4?(console.warn(`[GameSDK:${n}] 变量值过大`),!1):(t.value.customVars[e]=JSON.parse(o),!0)},showNotification(e,t={}){if('string'!=typeof e)return;const a=e.substring(0,200);s.length>=10&&s.shift(),s.push({id:`${n}-${Date.now()}`,message:a,options:{type:t.type||'info',duration:Math.min(t.duration||3e3,1e4)}})},_consumeNotifications(){const e=[...s];return s.length=0,e},async confirm(e){if('string'!=typeof e)return!1;const t=e.substring(0,500);return new Promise(e=>{const a=d.get('_confirmRequest');a&&a.size>0?a.forEach(a=>a({message:t,resolve:e})):(console.log(`[GameSDK:${n}] 确认请求: ${t}`),e(!0))})},log(...e){this._addLog('info',e)},warn(...e){this._addLog('warn',e)},error(...e){this._addLog('error',e)},_addLog(e,t){const o=t.map(e=>{if('object'==typeof e)try{return JSON.stringify(e)}catch{return String(e)}return String(e)}).join(' ');c.length>=a&&c.shift(),c.push({time:new Date,level:e,message:o.substring(0,1e3)});const l=`[UserWidget:${n}]`;switch(e){case'warn':console.warn(l,...t);break;case'error':console.error(l,...t);break;default:console.log(l,...t)}},_getLogs:()=>[...c],on:(e,t)=>['gameStateChange','turnStart','turnEnd','battleStart','battleEnd'].includes(e)||e.startsWith('_')?(d.has(e)||d.set(e,new Set),d.get(e).add(t),()=>{d.get(e)?.delete(t)}):(console.warn(`[GameSDK:${n}] 不允许监听事件: ${e}`),()=>{}),_emit(e,...t){const a=d.get(e);a&&a.forEach(e=>{try{e(...t)}catch(e){console.error(`[GameSDK:${n}] 事件处理器错误:`,e)}})},formatNumber:e=>'number'!=typeof e?'0':e.toLocaleString(),formatTime(e){const t='number'==typeof e?new Date(e):e;return t instanceof Date&&!isNaN(t.getTime())?t.toLocaleTimeString():'--:--:--'},randomInt:(e,t)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e),delay(e){const t=Math.max(0,Math.min(e,1e4));return new Promise(e=>setTimeout(e,t))},_cleanup(){d.clear(),c.length=0,s.length=0}}}({gameState:k,componentId:a.componentId||d.value,previewVariables:(0,r.computed)(()=>a.previewVariables||null)}));function E(){o.value=!0,l.value=null,i.value=[];try{if('string'!=typeof a.userCode||!a.userCode.trim())return l.value='组件代码为空或不是字符串',void n('error',l.value);const e=vo(a.userCode);if(!e.isValid)return l.value=`代码安全检查失败:\n${e.errors.join('\n')}`,void n('error',l.value);i.value=e.warnings;const t=go(a.userCode,{extraGlobals:{GameSDK:N.value}});if(t.error)return l.value=t.error,void n('error',t.error);c.value=(0,r.markRaw)(t.component),s.value++,w(),n('loaded')}catch(e){l.value=`组件加载异常: ${e.message}`,n('error',l.value)}finally{o.value=!1}}let V=null,b=null;function w(){null==V&&(V=window.requestAnimationFrame(()=>{V=null,async function(){if(!v.value)return g.value=1,void(f.value=null);if(o.value||l.value||!c.value)return g.value=1,void(f.value=null);if(function(){const e=p.value,t=e?.firstElementChild;return!(!t||!t.hasAttribute('data-th-no-autoscale')&&'true'!==t.getAttribute('data-th-no-autoscale'))}())return g.value=1,void(f.value=null);await(0,r.nextTick)();const e=m.value,t=p.value;if(!e||!t)return;const a=e.clientWidth,n=t.scrollWidth;if(a<=0||n<=0)return;let i=Math.min(1,a/n);i>.98&&(i=1);if(g.value=i,i<1){const e=t.scrollHeight;f.value=Math.ceil(e*i)}else f.value=null}()}))}function C(e){console.error(`[DynamicLoader:${d.value}] 组件运行时错误:`,e),N.value.error('组件运行时错误:',e.message)}let S=null;return(0,r.watch)(()=>a.userCode,()=>{E()}),(0,r.watch)(()=>a.gameState,e=>{e&&(k.value=e)},{deep:!0}),(0,r.onMounted)(()=>{E(),S=window.setInterval(()=>{const e=N.value._consumeNotifications();for(const t of e)n('notification',{message:t.message,type:t.options.type||'info'})},100),v.value=!!u.value?.closest?.('.right-sidebar, .widgets-panel, .widget-host'),'undefined'!=typeof ResizeObserver&&(b=new ResizeObserver(()=>{w()}),m.value&&b.observe(m.value),p.value&&b.observe(p.value))}),(0,r.onUnmounted)(()=>{N.value._cleanup(),S&&clearInterval(S),b&&(b.disconnect(),b=null),null!=V&&(cancelAnimationFrame(V),V=null)}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{ref_key:'containerRef',ref:u,class:'user-widget-container',id:d.value},[(0,r.createCommentVNode)(' 加载状态 '),o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',yo,[...t[0]||(t[0]=[(0,r.createElementVNode)('div',{class:'loading-spinner'},null,-1),(0,r.createElementVNode)('span',null,'加载组件中...',-1)])])):l.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' 错误状态 '),(0,r.createElementVNode)('div',ho,[t[1]||(t[1]=(0,r.createElementVNode)('div',{class:'error-icon'},'⚠️',-1)),t[2]||(t[2]=(0,r.createElementVNode)('div',{class:'error-title'},'组件加载失败',-1)),(0,r.createElementVNode)('div',ko,(0,r.toDisplayString)(l.value),1),(0,r.createElementVNode)('button',{class:'retry-btn',onClick:E},'重试')])],2112)):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 警告信息 '),i.value.length>0?((0,r.openBlock)(),(0,r.createElementBlock)('div',No,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:'warning-item'},'⚠️ '+(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 动态组件 '),c.value&&!l.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:3,ref_key:'contentOuterRef',ref:m,class:(0,r.normalizeClass)(['user-widget-content-outer',{'is-autoscaled':y.value}]),style:(0,r.normalizeStyle)(h.value)},[(0,r.createElementVNode)('div',{ref_key:'contentInnerRef',ref:p,class:'user-widget-content-inner'},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(c.value),(0,r.mergeProps)({key:s.value},e.$attrs,{sdk:N.value,api:N.value,onError:C}),null,16,['sdk','api']))],512)],6)):(0,r.createCommentVNode)('v-if',!0)],8,fo))}}),Vo=(0,p.A)(Eo,[['__scopeId','data-v-79a103d6']]),bo={class:'card-image'},wo=['src','alt'],Co={class:'card-type-badge'},So={class:'card-content'},Bo={class:'card-header'},xo={class:'card-metrics'},_o={key:0,class:'downloads',title:'下载/使用次数'},Io={class:'card-author'},To=['src'],Ao={key:1,class:'author-avatar'},Mo={class:'card-tags'},Do={class:'card-actions'},Po=['title'],Oo=['title'],Ro=['title'],Lo=(0,r.defineComponent)({__name:'WorkshopCard',props:{item:{},isDownloaded:{type:Boolean},canMoveToMine:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canDeleteRemote:{type:Boolean},canUpload:{type:Boolean},canDownload:{type:Boolean},canFileDownload:{type:Boolean},fileDownloadTitle:{},moveToMineTitle:{},uploadTitle:{},uploadIcon:{},statusLabel:{},authorAvatarUrl:{}},emits:['edit','delete','delete-remote','upload','download','file-download','move-to-mine','info'],setup(e){const t=e,a=(0,r.computed)(()=>{const e=t.item?.description;return'string'==typeof e&&e.trim().length>0}),n=(0,r.ref)(t.item.img);function o(){n.value&&n.value.startsWith('https://picsum.photos/')||(n.value='https://picsum.photos/400/250?random='+encodeURIComponent(String(t.item.id||'fallback')))}(0,r.watch)(()=>t.item.img,e=>{n.value=e});const l=(0,r.computed)(()=>'本地'===t.statusLabel?'local':'云端'===t.statusLabel?'cloud':'我的作品'===t.statusLabel?'mine':'both');return(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(S,{class:'gallery-card'},{default:(0,r.withCtx)(()=>{return[(0,r.createElementVNode)('div',bo,[(0,r.createElementVNode)('img',{src:n.value,alt:e.item.title,onError:o},null,40,wo),(0,r.createElementVNode)('div',Co,(0,r.toDisplayString)('EVENT'===e.item.type?'EVENT PACK':'CHAR PACK'),1),e.statusLabel?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:(0,r.normalizeClass)(['card-status-badge',l.value])},(0,r.toDisplayString)(e.statusLabel),3)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',So,[(0,r.createElementVNode)('div',Bo,[(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(e.item.title),1),(0,r.createElementVNode)('div',xo,['number'==typeof e.item.downloadCount?((0,r.openBlock)(),(0,r.createElementBlock)('div',_o,[(0,r.createVNode)(E,{name:'download',size:'0.8em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)((i=e.item.downloadCount,i>=1e6?(i/1e6).toFixed(1)+'m':i>=1e3?(i/1e3).toFixed(1)+'k':i.toString())),1)])):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createElementVNode)('div',Io,[e.authorAvatarUrl?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,class:'author-avatar author-avatar-img',src:e.authorAvatarUrl,alt:'Author Avatar'},null,8,To)):((0,r.openBlock)(),(0,r.createElementBlock)('div',Ao)),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(e.item.author),1),(0,r.createVNode)(E,{name:'verified',size:'0.75em',class:'verified-icon'})]),(0,r.createElementVNode)('div',Mo,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.item.tags,e=>((0,r.openBlock)(),(0,r.createElementBlock)('span',{key:e},'#'+(0,r.toDisplayString)(e),1))),128))])]),(0,r.createCommentVNode)(' Actions Overlay '),(0,r.createElementVNode)('div',Do,[a.value?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'btn-info',onClick:t[0]||(t[0]=(0,r.withModifiers)(t=>e.$emit('info',e.item),['stop'])),title:'查看简介'},[(0,r.createVNode)(E,{name:'info',size:'1em'})])):(0,r.createCommentVNode)('v-if',!0),e.canFileDownload?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'btn-file-download',onClick:t[1]||(t[1]=(0,r.withModifiers)(t=>e.$emit('file-download',e.item),['stop'])),title:e.fileDownloadTitle||'导出为JSON文件'},[(0,r.createVNode)(E,{name:'export',size:'1em'})],8,Po)):(0,r.createCommentVNode)('v-if',!0),e.canMoveToMine?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:2,class:'btn-move-mine',onClick:t[2]||(t[2]=(0,r.withModifiers)(t=>e.$emit('move-to-mine',e.item),['stop'])),title:e.moveToMineTitle||'移到我的作品'},[(0,r.createVNode)(E,{name:'folder',size:'1em'})],8,Oo)):(0,r.createCommentVNode)('v-if',!0),e.canUpload?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:3,class:'btn-upload',onClick:t[3]||(t[3]=(0,r.withModifiers)(t=>e.$emit('upload',e.item),['stop'])),title:e.uploadTitle||'上传到云端'},[(0,r.createVNode)(E,{name:e.uploadIcon||'upload-cloud',size:'1em'},null,8,['name'])],8,Ro)):(0,r.createCommentVNode)('v-if',!0),e.canDownload?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:4,class:'btn-download',onClick:t[4]||(t[4]=(0,r.withModifiers)(t=>e.$emit('download',e.item),['stop'])),title:'下载到本地'},[(0,r.createVNode)(E,{name:'download',size:'1em'})])):(0,r.createCommentVNode)('v-if',!0),e.canDeleteRemote?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:5,class:'btn-delete-remote',onClick:t[5]||(t[5]=(0,r.withModifiers)(t=>e.$emit('delete-remote',e.item),['stop'])),title:'删除云端源文件（危险）'},[(0,r.createVNode)(E,{name:'cloud-delete',size:'1em'})])):(0,r.createCommentVNode)('v-if',!0),e.isDownloaded||e.canDelete?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:6,class:'btn-delete',onClick:t[6]||(t[6]=(0,r.withModifiers)(t=>e.$emit('delete',e.item),['stop'])),title:'删除'},[(0,r.createVNode)(E,{name:'delete',size:'1em'})])):(0,r.createCommentVNode)('v-if',!0),e.canEdit?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:7,class:'btn-edit',onClick:t[7]||(t[7]=(0,r.withModifiers)(t=>e.$emit('edit',e.item),['stop'])),title:'编辑/查看'},[(0,r.createVNode)(E,{name:'edit',size:'1em'})])):(0,r.createCommentVNode)('v-if',!0)])];var i}),_:1}))}}),$o=(0,p.A)(Lo,[['__scopeId','data-v-d4b94892']]),Uo={class:'image-cropper-overlay'},zo={class:'cropper-modal'},Fo={class:'cropper-header'},Wo={class:'controls'},Go=['src'],jo={class:'cropper-footer'},Jo=(0,r.defineComponent)({__name:'ImageCropper',props:{imageUrl:{},aspectRatio:{}},emits:['confirm','cancel'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(1),l=(0,r.ref)(0),i=(0,r.ref)(0),c=(0,r.ref)(!1),s=(0,r.ref)(0),d=(0,r.ref)(0),u=(0,r.ref)(0),m=(0,r.ref)(0),p=(0,r.ref)(null),v=(0,r.ref)(null),g=(0,r.ref)(null),f=(0,r.computed)(()=>({transform:`translate(${l.value}px, ${i.value}px) scale(${o.value})`,cursor:c.value?'grabbing':'grab',transformOrigin:'top left'}));function y(){if(!p.value||!v.value)return;const e=p.value,t=v.value.getBoundingClientRect(),a=(e.getBoundingClientRect(),e.offsetWidth),n=e.offsetHeight;l.value=(t.width-a)/2,i.value=(t.height-n)/2,o.value=1}function h(e){c.value=!0,e instanceof MouseEvent?(s.value=e.clientX,d.value=e.clientY):(s.value=e.touches[0].clientX,d.value=e.touches[0].clientY),u.value=l.value,m.value=i.value,window.addEventListener('mousemove',k),window.addEventListener('mouseup',N),window.addEventListener('touchmove',k),window.addEventListener('touchend',N)}function k(e){if(!c.value)return;let t,a;e instanceof MouseEvent?(t=e.clientX,a=e.clientY):(t=e.touches[0].clientX,a=e.touches[0].clientY);const n=t-s.value,o=a-d.value;l.value=u.value+n,i.value=m.value+o}function N(){c.value=!1,window.removeEventListener('mousemove',k),window.removeEventListener('mouseup',N),window.removeEventListener('touchmove',k),window.removeEventListener('touchend',N)}function E(){if(!p.value||!v.value)return;const e=document.createElement('canvas'),t=1280,r=Math.round(t/a.aspectRatio);e.width=t,e.height=r;const c=e.getContext('2d');if(!c)return;c.fillStyle='#000',c.fillRect(0,0,e.width,e.height),c.imageSmoothingEnabled=!0,c.imageSmoothingQuality='high';const s=p.value,d=v.value.getBoundingClientRect(),u=(s.getBoundingClientRect(),o.value),m=l.value,g=i.value,f=s.offsetWidth,y=s.offsetHeight,h=s.naturalWidth/f/u,k=s.naturalHeight/y/u,N=-m*h,E=-g*k,V=d.width*h,b=d.height*k;c.drawImage(s,N,E,V,b,0,0,t,r),n('confirm',e.toDataURL('image/jpeg',.9))}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Uo,[(0,r.createElementVNode)('div',zo,[(0,r.createElementVNode)('div',Fo,[t[2]||(t[2]=(0,r.createElementVNode)('h3',null,'调整封面 Image Adjustment',-1)),(0,r.createElementVNode)('div',Wo,[(0,r.createElementVNode)('label',null,'缩放 Zoom: '+(0,r.toDisplayString)(o.value.toFixed(1))+'x',1),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range','onUpdate:modelValue':t[0]||(t[0]=e=>o.value=e),min:'1',max:'5',step:'0.1'},null,512),[[r.vModelText,o.value,void 0,{number:!0}]])])]),(0,r.createElementVNode)('div',{class:'cropper-viewport-container',ref_key:'containerRef',ref:g},[(0,r.createCommentVNode)(' The viewport defines the output Frame '),(0,r.createElementVNode)('div',{class:'cropper-viewport',ref_key:'viewportRef',ref:v,style:(0,r.normalizeStyle)({aspectRatio:e.aspectRatio+''}),onMousedown:h,onTouchstart:(0,r.withModifiers)(h,['prevent'])},[(0,r.createElementVNode)('img',{ref_key:'imageRef',ref:p,src:e.imageUrl,style:(0,r.normalizeStyle)(f.value),draggable:'false',onLoad:y},null,44,Go)],36)],512),(0,r.createElementVNode)('div',jo,[(0,r.createElementVNode)('button',{class:'btn cancel',onClick:t[1]||(t[1]=t=>e.$emit('cancel'))},'取消 Cancel'),(0,r.createElementVNode)('button',{class:'btn confirm',onClick:E},'确认使用 Confirm')])])]))}}),Yo=(0,p.A)(Jo,[['__scopeId','data-v-085c99f0']]),Ho=['data-block-id'],Xo={class:'block-label'},Ko={class:'block-content'},qo={key:0,class:'identity-form'},Qo={key:0},Zo={class:'inputs'},el={class:'text-content'},tl=['placeholder'],al=(0,r.defineComponent)({__name:'CharacterBlock',props:{block:{},isDragging:{type:Boolean},snapTargetId:{}},emits:['remove','trigger-upload','drag-start'],setup(e,{emit:t}){const a=e,n=t;function o(e){n('drag-start',{id:a.block.id,event:e})}function l(e){switch(e){case'IDENTITY':return'star';case'APPEARANCE':return'eye';case'PERSONALITY':return'brain';case'BACKGROUND':return'book';case'ABILITY':return'lightning';default:return'file'}}function i(e){switch(e){case'IDENTITY':return'身份 (IDENTITY)';case'APPEARANCE':return'外貌 (APPEARANCE)';case'PERSONALITY':return'性格 (PERSONALITY)';case'BACKGROUND':return'身世 (BACKGROUND)';case'ABILITY':return'能力 (ABILITY)';default:return e}}function c(e){switch(e){case'APPEARANCE':return'描述角色的外貌特征...';case'PERSONALITY':return'描述角色的性格特征...';case'BACKGROUND':return'角色的身世背景...';case'ABILITY':return'角色的特殊能力...';default:return'...'}}return(e,t)=>{const a=(0,r.resolveComponent)('CharacterBlock',!0);return(0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['character-block',[`type-${e.block.type.toLowerCase()}`,{'is-dragging':e.isDragging}]]),'data-block-id':e.block.id},[(0,r.createCommentVNode)(' Block Header/Grip '),(0,r.createElementVNode)('div',{class:'block-header',onPointerdown:(0,r.withModifiers)(o,['stop'])},[(0,r.createVNode)(E,{name:l(e.block.type),size:'1em'},null,8,['name']),(0,r.createElementVNode)('span',Xo,(0,r.toDisplayString)(i(e.block.type)),1),(0,r.createCommentVNode)(' Remove Button (Only on hover) '),(0,r.createElementVNode)('button',{class:'remove-btn',onClick:t[0]||(t[0]=(0,r.withModifiers)(t=>e.$emit('remove',e.block.id),['stop'])),onMousedown:t[1]||(t[1]=(0,r.withModifiers)(()=>{},['stop'])),onPointerdown:t[2]||(t[2]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.createVNode)(E,{name:'x',size:'0.95em'})],32)],32),(0,r.createCommentVNode)(' Block Content Form '),(0,r.createElementVNode)('div',Ko,[(0,r.createCommentVNode)(' Identity: Special Fields '),'IDENTITY'===e.block.type?((0,r.openBlock)(),(0,r.createElementBlock)('div',qo,[(0,r.createElementVNode)('div',{class:'avatar-upload',onClick:t[3]||(t[3]=(0,r.withModifiers)(t=>e.$emit('trigger-upload',e.block),['stop'])),onMousedown:t[4]||(t[4]=(0,r.withModifiers)(()=>{},['stop'])),onPointerdown:t[5]||(t[5]=(0,r.withModifiers)(()=>{},['stop'])),style:(0,r.normalizeStyle)({backgroundImage:e.block.data.cover?`url(${e.block.data.cover})`:'none'})},[e.block.data.cover?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',Qo,'立绘'))],36),(0,r.createElementVNode)('div',Zo,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[6]||(t[6]=t=>e.block.data.name=t),placeholder:'Name...',onMousedown:t[7]||(t[7]=(0,r.withModifiers)(()=>{},['stop'])),onPointerdown:t[8]||(t[8]=(0,r.withModifiers)(()=>{},['stop']))},null,544),[[r.vModelText,e.block.data.name]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[9]||(t[9]=t=>e.block.data.description=t),placeholder:'描述...',class:'tiny',onMousedown:t[10]||(t[10]=(0,r.withModifiers)(()=>{},['stop'])),onPointerdown:t[11]||(t[11]=(0,r.withModifiers)(()=>{},['stop']))},null,544),[[r.vModelText,e.block.data.description]])])])):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Generic Text Area for others '),(0,r.createElementVNode)('div',el,[(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[12]||(t[12]=t=>e.block.data.text=t),placeholder:c(e.block.type),rows:'2',onMousedown:t[13]||(t[13]=(0,r.withModifiers)(()=>{},['stop'])),onPointerdown:t[14]||(t[14]=(0,r.withModifiers)(()=>{},['stop']))},null,40,tl),[[r.vModelText,e.block.data.text]])])],2112))]),(0,r.createCommentVNode)(' Snap Socket (Bottom) '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['block-socket-bottom',{'is-snap-target':e.snapTargetId===e.block.id}])},[(0,r.createCommentVNode)(' Recursive Child Rendering '),e.block.next?((0,r.openBlock)(),(0,r.createBlock)(a,{key:0,block:e.block.next,'snap-target-id':e.snapTargetId,onRemove:t[15]||(t[15]=t=>e.$emit('remove',t)),onTriggerUpload:t[16]||(t[16]=t=>e.$emit('trigger-upload',t)),onDragStart:t[17]||(t[17]=t=>e.$emit('drag-start',t))},null,8,['block','snap-target-id'])):(0,r.createCommentVNode)('v-if',!0)],2),(0,r.createCommentVNode)(' Visual Notch (Removed for Tech Style) '),(0,r.createCommentVNode)(' <div v-if="!block.next" class="notch-bottom"></div> '),(0,r.createCommentVNode)(' <div class="notch-top"></div> ')],10,Ho)}}}),nl=(0,p.A)(al,[['__scopeId','data-v-4735476a']]),ol={class:'character-palette'},ll={class:'sidebar-group'},rl={class:'metadata-form'},il={key:0,class:'upload-placeholder'},cl={class:'upload-hover'},sl={class:'inputs'},dl=['value'],ul=['value'],ml={class:'input-hint'},pl=['value'],vl={class:'sidebar-group'},gl={class:'palette-buttons'},fl=(0,r.defineComponent)({__name:'CharacterPalette',props:{name:{},description:{},coverImage:{}},emits:['spawn','update:name','update:description','update:coverImage','trigger-cover-upload'],setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',ol,[(0,r.createCommentVNode)(' Metadata Section '),(0,r.createElementVNode)('div',ll,[t[11]||(t[11]=(0,r.createElementVNode)('h3',null,'角色包信息 DETAILS',-1)),(0,r.createElementVNode)('div',rl,[(0,r.createElementVNode)('div',{class:'cover-upload',onClick:t[0]||(t[0]=t=>e.$emit('trigger-cover-upload')),style:(0,r.normalizeStyle)({backgroundImage:e.coverImage?`url(${e.coverImage})`:'none'})},[e.coverImage?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',il,[(0,r.createVNode)(E,{name:'image',size:'1.2em'}),t[9]||(t[9]=(0,r.createElementVNode)('span',null,'封面',-1))])),(0,r.createElementVNode)('div',cl,[(0,r.createVNode)(E,{name:'edit',size:'1em'})])],4),(0,r.createElementVNode)('div',sl,[(0,r.createElementVNode)('input',{type:'text',value:e.name,onInput:t[1]||(t[1]=t=>e.$emit('update:name',t.target.value)),placeholder:'角色包名称...',class:'title-input'},null,40,dl),(0,r.createElementVNode)('input',{type:'text',value:e.coverImage,onInput:t[2]||(t[2]=t=>e.$emit('update:coverImage',t.target.value)),placeholder:'或输入封面图片 URL...',class:'url-input'},null,40,ul),(0,r.createElementVNode)('div',ml,[(0,r.createVNode)(E,{name:'info',size:'0.75em'}),t[10]||(t[10]=(0,r.createTextVNode)(' 推荐 URL（避免 base64 过大） ',-1))]),(0,r.createElementVNode)('textarea',{value:e.description,onInput:t[3]||(t[3]=t=>e.$emit('update:description',t.target.value)),placeholder:'简要描述...',rows:'2',class:'desc-input'},null,40,pl)])])]),(0,r.createElementVNode)('div',vl,[t[17]||(t[17]=(0,r.createElementVNode)('h3',null,'组件库 MODULES',-1)),(0,r.createElementVNode)('div',gl,[(0,r.createElementVNode)('button',{class:'palette-btn',onPointerdown:t[4]||(t[4]=(0,r.withModifiers)(t=>e.$emit('spawn',t,'IDENTITY'),['prevent']))},[(0,r.createVNode)(E,{name:'image',size:'0.9em'}),t[12]||(t[12]=(0,r.createTextVNode)(' 立绘 (Portrait) ',-1))],32),(0,r.createElementVNode)('button',{class:'palette-btn',onPointerdown:t[5]||(t[5]=(0,r.withModifiers)(t=>e.$emit('spawn',t,'APPEARANCE'),['prevent']))},[(0,r.createVNode)(E,{name:'eye',size:'0.9em'}),t[13]||(t[13]=(0,r.createTextVNode)(' 外貌 (Appearance) ',-1))],32),(0,r.createElementVNode)('button',{class:'palette-btn',onPointerdown:t[6]||(t[6]=(0,r.withModifiers)(t=>e.$emit('spawn',t,'PERSONALITY'),['prevent']))},[(0,r.createVNode)(E,{name:'brain',size:'0.9em'}),t[14]||(t[14]=(0,r.createTextVNode)(' 性格 (Personality) ',-1))],32),(0,r.createElementVNode)('button',{class:'palette-btn',onPointerdown:t[7]||(t[7]=(0,r.withModifiers)(t=>e.$emit('spawn',t,'BACKGROUND'),['prevent']))},[(0,r.createVNode)(E,{name:'book',size:'0.9em'}),t[15]||(t[15]=(0,r.createTextVNode)(' 身世 (Background) ',-1))],32),(0,r.createElementVNode)('button',{class:'palette-btn',onPointerdown:t[8]||(t[8]=(0,r.withModifiers)(t=>e.$emit('spawn',t,'ABILITY'),['prevent']))},[(0,r.createVNode)(E,{name:'lightning',size:'0.9em'}),t[16]||(t[16]=(0,r.createTextVNode)(' 能力 (Ability) ',-1))],32)])]),t[18]||(t[18]=(0,r.createElementVNode)('div',{class:'sidebar-spacer'},null,-1)),t[19]||(t[19]=(0,r.createElementVNode)('div',{class:'sidebar-info'},[(0,r.createElementVNode)('div',{class:'info-group'},[(0,r.createElementVNode)('h3',null,'操作指南'),(0,r.createElementVNode)('p',null,'拖拽组件到画布'),(0,r.createElementVNode)('p',null,'将它们拼接到一起'),(0,r.createElementVNode)('p',null,'每一组为一个预设')]),(0,r.createElementVNode)('div',{class:'info-group'},[(0,r.createElementVNode)('h3',null,'快捷键'),(0,r.createElementVNode)('p',null,'中键拖拽画布'),(0,r.createElementVNode)('p',null,'滚轮缩放视图')])],-1))]))}),yl=(0,p.A)(fl,[['__scopeId','data-v-f260f970']]),hl=(0,r.defineComponent)({__name:'CharacterPackEditor',props:{initialData:{}},emits:['save','auto-save'],setup(e,{expose:t,emit:a}){const n=e,o=a,l=(0,r.ref)(null),i=(0,r.ref)(null),c=(0,r.ref)(1),s=(0,r.ref)(!1),d=(0,r.reactive)({w:0,h:0});const u=(0,r.computed)(()=>{if(!s.value)return;const e=d.h;return{height:e?`${e}px`:void 0}}),m=(e=!1)=>{const t=Math.max(0,Math.floor(window.innerWidth||0)),a=Math.max(0,Math.floor(window.innerHeight||0));if(!t||!a)return;const n=Math.abs(t-(d.w||t))>80;(e||0===d.w||0===d.h||n)&&(d.w=t,d.h=a)},p=()=>m(!1),v=(0,r.computed)(()=>{if(!i.value)return{};const e=i.value.clientWidth,t=s.value&&d.h?d.h:i.value.clientHeight;return{width:e/c.value+'px',height:t/c.value+'px',transform:`scale(${c.value})`,transformOrigin:'center center',flexShrink:0,position:'relative'}});function g(){if(!i.value)return;const e=i.value.getBoundingClientRect(),t=e.width,a=s.value&&d.h?d.h:e.height;0!==t&&0!==a&&(c.value=a/1080)}const f=(0,r.ref)([]),y=(0,r.ref)(null),h=(0,r.reactive)({name:'New Character Pack',description:'',coverImage:''}),k=(0,r.reactive)({active:!1,block:null,isNew:!1,originalRootId:null,x:0,y:0,offsetX:0,offsetY:0}),N=(0,r.reactive)({active:!1,pointerId:null,lastX:0,lastY:0}),E=(0,r.reactive)({active:!1,startDist:0,startZoom:1,worldX:0,worldY:0}),V=new Map,b=(0,r.reactive)({x:0,y:0,zoom:1}),w=(0,r.computed)(()=>({transform:`translate(${b.x}px, ${b.y}px) scale(${b.zoom})`,transformOrigin:'0 0'})),C=(0,r.ref)(null),S=()=>Math.random().toString(36).substr(2,9);let B=null;function x(e){if(!l.value)return{x:e.clientX,y:e.clientY};const t=l.value.getBoundingClientRect(),a=e.clientX-t.left,n=e.clientY-t.top;return{x:a/c.value,y:n/c.value}}function I(e){if(e.target.closest('.character-block'))return;if(k.active)return;if('mouse'===e.pointerType&&0!==e.button&&1!==e.button)return;try{l.value?.setPointerCapture(e.pointerId)}catch{}const t=x(e);if(V.set(e.pointerId,t),V.size>=2){N.active=!1,N.pointerId=null;const t=Array.from(V.values()),a=t[0],n=t[1],o=(a.x+n.x)/2,l=(a.y+n.y)/2,r=a.x-n.x,i=a.y-n.y,c=Math.hypot(r,i);return E.active=!0,E.startDist=c||1,E.startZoom=b.zoom,E.worldX=(o-b.x)/b.zoom,E.worldY=(l-b.y)/b.zoom,void e.preventDefault()}N.active=!0,N.pointerId=e.pointerId,N.lastX=t.x,N.lastY=t.y,e.preventDefault()}function T(e){const t=b.zoom-.05*Math.sign(e.deltaY);b.zoom=Math.min(Math.max(t,.2),3)}(0,r.onMounted)(()=>{s.value=function(){if('undefined'==typeof window)return!1;const e=navigator.userAgent||'',t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),a=window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,n=window.innerWidth<=1024;return t||a&&n}(),s.value&&(m(!0),window.addEventListener('resize',p,{passive:!0}),window.addEventListener('orientationchange',()=>m(!0),{passive:!0})),B=new ResizeObserver(()=>{g()}),i.value&&B.observe(i.value),g(),n.initialData&&n.initialData.presets&&(h.name=n.initialData.name||'New Character Pack',h.description=n.initialData.description||'',h.coverImage=n.initialData.coverImage||'',n.initialData.presets.forEach((e,t)=>{const a=50+350*t,n={id:S(),type:'IDENTITY',x:a,y:50,data:{name:e.name,cover:e.coverImage,description:e.description}};let o=n;[{type:'APPEARANCE',text:e.appearance},{type:'PERSONALITY',text:e.personality},{type:'BACKGROUND',text:e.background},{type:'ABILITY',text:e.ability}].forEach(e=>{if(e.text){const t={id:S(),type:e.type,data:{text:e.text}};o.next=t,o=t}}),f.value.push(n)}))}),(0,r.onUnmounted)(()=>{M(),B&&B.disconnect(),s.value&&window.removeEventListener('resize',p)});let A=!1;function M(){A&&(document.removeEventListener('pointermove',O,!0),document.removeEventListener('pointerup',R,!0),document.removeEventListener('pointercancel',R,!0),A=!1)}function D(e,t){if(e.preventDefault(),void 0!==e.pointerId)try{l.value?.setPointerCapture(e.pointerId)}catch{}const a={id:S(),type:t,data:{}},n=x(e);k.block=a,k.isNew=!0,k.active=!0,k.pointerId=e.pointerId??null,void 0!==e.pointerId&&(A||(document.addEventListener('pointermove',O,{passive:!1,capture:!0}),document.addEventListener('pointerup',R,{capture:!0}),document.addEventListener('pointercancel',R,{capture:!0}),A=!0)),k.offsetX=150,k.offsetY=30,k.x=n.x-k.offsetX,k.y=n.y-k.offsetY}function P({id:e,event:t}){if(t.stopPropagation(),t.preventDefault(),void 0!==t.pointerId)try{l.value?.setPointerCapture(t.pointerId)}catch{}const{block:a,parent:n,rootIndex:o}=L(e);if(!a)return;const r=document.querySelector(`[data-block-id="${e}"]`),i=x(t);if(k.block=a,k.active=!0,k.isNew=!1,k.pointerId=t.pointerId??null,r&&l.value){const e=r.getBoundingClientRect(),t=l.value.getBoundingClientRect(),a=(e.left-t.left)/c.value,n=(e.top-t.top)/c.value;k.offsetX=i.x-a,k.offsetY=i.y-n}else k.offsetX=150,k.offsetY=30;k.x=i.x-k.offsetX,k.y=i.y-k.offsetY,n?n.next=void 0:'number'==typeof o&&f.value.splice(o,1)}function O(e){const t=x(e);if(V.has(e.pointerId)&&V.set(e.pointerId,t),E.active){if(V.size<2)E.active=!1;else{const e=Array.from(V.values()),t=e[0],a=e[1],n=(t.x+a.x)/2,o=(t.y+a.y)/2,l=t.x-a.x,r=t.y-a.y,i=Math.hypot(l,r)/(E.startDist||1),c=Math.min(Math.max(E.startZoom*i,.2),3);b.zoom=c,b.x=n-E.worldX*c,b.y=o-E.worldY*c}return void e.preventDefault()}if(N.active&&N.pointerId===e.pointerId){const e=t.x-N.lastX,a=t.y-N.lastY;return b.x+=e,b.y+=a,N.lastX=t.x,void(N.lastY=t.y)}if(!k.active)return;const a=k.pointerId;'number'==typeof a&&e.pointerId!==a||(k.x=t.x-k.offsetX,k.y=t.y-k.offsetY,e.cancelable&&e.preventDefault(),function(){if(!y.value||!l.value)return;const e=k.x,t=k.y,a=50;let n=null,o=a;const r=document.querySelectorAll('.character-block[data-block-id]'),i=l.value.getBoundingClientRect();r.forEach(l=>{const r=l.getAttribute('data-block-id');if(!r||r===k.block?.id)return;if(!L(r).block)return;const s=l.getBoundingClientRect(),d=(s.left-i.left)/c.value,u=(s.top-i.top)/c.value,m=(s.bottom-i.top)/c.value,p=s.height/c.value,v=Math.abs(t-m),g=Math.abs(e-d);if(v<a&&g<a){const e=Math.sqrt(g*g+v*v);e<o&&(o=e,n={id:r,x:d,y:u,height:p})}}),C.value=n}())}function R(e){if(V.has(e.pointerId)&&V.delete(e.pointerId),E.active&&V.size<2&&(E.active=!1),N.active&&N.pointerId===e.pointerId){N.active=!1,N.pointerId=null;try{l.value?.releasePointerCapture(e.pointerId)}catch{}return}if(!k.active){try{l.value?.releasePointerCapture(e.pointerId)}catch{}return}const t=k.pointerId;if('number'==typeof t&&e.pointerId!==t){try{l.value?.releasePointerCapture(e.pointerId)}catch{}return}try{l.value?.releasePointerCapture(e.pointerId)}catch{}const a=k.block;if(C.value){const e=L(C.value.id).block;if(e)if(e.next){const t=e.next;e.next=a;let n=a;for(;n.next;)n=n.next;n.next=t}else e.next=a}else{if(y.value){const e=y.value.getBoundingClientRect(),t=l.value.getBoundingClientRect(),n=(e.left-t.left)/c.value,o=(e.top-t.top)/c.value,r=k.x-n,i=k.y-o;a.x=(r-b.x)/b.zoom,a.y=(i-b.y)/b.zoom}f.value.push(a)}k.active=!1,k.block=null,k.pointerId=null,C.value=null,M()}function L(e,t=f.value){for(let a=0;a<t.length;a++){if(t[a].id===e)return{block:t[a],rootIndex:a};let n=t[a],o=n.next;for(;o;){if(o.id===e)return{block:o,parent:n};n=o,o=o.next}}return{}}const U=(0,r.ref)(null),F=(0,r.ref)(null),W=(0,r.ref)(!1),G=(0,r.ref)(!1),j=(0,r.ref)(''),J=(0,r.ref)(16/9);function Y(e){F.value=e,W.value=!1,U.value?.click()}function H(){F.value=null,W.value=!0,J.value=16/9,U.value?.click()}function X(e){const t=e.target,a=t.files?.[0];if(a){const e=new FileReader;e.onload=e=>{j.value=e.target?.result,W.value?G.value=!0:F.value&&(F.value.data.cover=j.value,G.value=!1),t.value=''},e.readAsDataURL(a)}}function K(e){W.value&&(h.coverImage=e),G.value=!1}function q(){const e=[];return f.value.forEach(t=>{let a=t;const n={id:t.id,name:'',appearance:'',personality:'',background:'',ability:'',description:'',coverImage:''};for(;a;)'IDENTITY'===a.type?(a.data.name&&(n.name=a.data.name),a.data.cover&&(n.coverImage=a.data.cover),a.data.description&&(n.description=a.data.description)):'APPEARANCE'===a.type?n.appearance=(n.appearance?n.appearance+'\n':'')+(a.data.text||''):'PERSONALITY'===a.type?n.personality=(n.personality?n.personality+'\n':'')+(a.data.text||''):'BACKGROUND'===a.type?n.background=(n.background?n.background+'\n':'')+(a.data.text||''):'ABILITY'===a.type&&(n.ability=(n.ability?n.ability+'\n':'')+(a.data.text||'')),a=a.next;e.push(n)}),{id:n.initialData?.id||S(),name:h.name,description:h.description,coverImage:h.coverImage,presets:e,createdAt:n.initialData?.createdAt||(new Date).toISOString(),updatedAt:(new Date).toISOString()}}return(0,r.watch)(f,()=>{o('auto-save','Saving...')},{deep:!0}),t({save:function(){o('save',q())},get charPack(){return q()}}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'character-pack-editor-root',ref_key:'rootRef',ref:i,style:(0,r.normalizeStyle)(u.value)},[(0,r.createCommentVNode)(' Scaled Container '),(0,r.createElementVNode)('div',{class:'visual-editor-container',ref_key:'containerRef',ref:l,style:(0,r.normalizeStyle)(v.value),onPointermove:O,onPointerup:R,onPointercancel:R,onWheel:(0,r.withModifiers)(T,['prevent'])},[(0,r.createCommentVNode)(' Palette Sidebar '),(0,r.createVNode)(yl,{onSpawn:D,name:h.name,'onUpdate:name':t[0]||(t[0]=e=>h.name=e),description:h.description,'onUpdate:description':t[1]||(t[1]=e=>h.description=e),'cover-image':h.coverImage,'onUpdate:coverImage':t[2]||(t[2]=e=>h.coverImage=e),onTriggerCoverUpload:H},null,8,['name','description','cover-image']),(0,r.createCommentVNode)(' Workspace '),(0,r.createElementVNode)('div',{class:'workspace',ref_key:'workspaceStore',ref:y,onPointerdown:I},[(0,r.createElementVNode)('div',{class:'pan-zoom-wrapper',style:(0,r.normalizeStyle)(w.value)},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(f.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'root-block-wrapper',style:(0,r.normalizeStyle)({left:e.x+'px',top:e.y+'px',position:'absolute'})},[(0,r.createVNode)(nl,{block:e,'snap-target-id':C.value?.id,onRemove:t=>function(e){const{rootIndex:t}=L(e);'number'==typeof t&&f.value.splice(t,1)}(e.id),onTriggerUpload:Y,onDragStart:P},null,8,['block','snap-target-id','onRemove'])],4))),128)),(0,r.createCommentVNode)(' Ghost removed, visualization handled inside CharacterBlock ')],4)],544),(0,r.createCommentVNode)(' Dragging Proxy (When spawning or moving) '),k.active&&k.block?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'drag-proxy',style:(0,r.normalizeStyle)({left:k.x+'px',top:k.y+'px',transform:`scale(${b.zoom})`})},[(0,r.createVNode)(nl,{block:k.block,'is-dragging':!0},null,8,['block'])],4)):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Hidden File Input '),(0,r.createElementVNode)('input',{type:'file',ref_key:'fileInput',ref:U,accept:'image/*',style:{display:'none'},onChange:X},null,544)],36),(0,r.createCommentVNode)(' Image Cropper Modal (Outside scaled container for proper display) '),G.value?((0,r.openBlock)(),(0,r.createBlock)(Yo,{key:0,'image-url':j.value,'aspect-ratio':J.value,onConfirm:K,onCancel:t[3]||(t[3]=e=>G.value=!1)},null,8,['image-url','aspect-ratio'])):(0,r.createCommentVNode)('v-if',!0)],4))}}),kl=(0,p.A)(hl,[['__scopeId','data-v-420e501e']]);function Nl(){const e=globalThis.crypto;if(e?.randomUUID)return e.randomUUID();if(e?.getRandomValues){const t=new Uint8Array(16);e.getRandomValues(t),t[6]=15&t[6]|64,t[8]=63&t[8]|128;const a=Array.from(t,e=>e.toString(16).padStart(2,'0')).join('');return`${a.slice(0,8)}-${a.slice(8,12)}-${a.slice(12,16)}-${a.slice(16,20)}-${a.slice(20)}`}return`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,10)}-${Math.random().toString(36).slice(2,10)}`}const El='autosave_event_pack_v1';let Vl=null,bl=null;async function wl(){Vl=null,null!=bl&&(clearTimeout(bl),bl=null),await pe.idbService.deleteRuntimeAsset(El).catch(()=>{})}function Cl(e,t=500){Vl=function(e){try{return structuredClone(e)}catch{return JSON.parse(JSON.stringify(e))}}(e),null==bl&&(bl=window.setTimeout(()=>{bl=null;const e=Vl;Vl=null,e&&pe.idbService.setRuntimeAsset(El,e).catch(e=>{console.warn('[EventPackAutosave] Failed to persist autosave to IndexedDB:',e)})},t))}const Sl={class:'editor-section'},Bl={class:'section-title'},xl={key:0,class:'items-list'},_l={class:'event-header'},Il=['onUpdate:modelValue'],Tl=['onClick'],Al={class:'natural-condition-panel'},Ml=['onUpdate:modelValue'],Dl={class:'event-content-wrapper'},Pl=['onUpdate:modelValue'],Ol={key:1,class:'empty-hint'},Rl=(0,r.defineComponent)({__name:'ConditionalEventsEditor',props:{eventPack:{},allVariables:{}},setup(e){const t=e;for(const e of t.eventPack.conditionalEvents||[])e.triggerType&&'natural'!==e.triggerType&&(e.triggerType='natural'),e.conditions&&delete e.conditions;function a(){const e={id:Nl(),name:'新条件事件',content:'',naturalCondition:''};t.eventPack.conditionalEvents.push(e)}return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Sl,[(0,r.createElementVNode)('div',Bl,[n[1]||(n[1]=(0,r.createElementVNode)('h4',null,'条件事件 (Conditional Events)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:a},[(0,r.createVNode)(E,{name:'plus',size:'0.75em'}),n[0]||(n[0]=(0,r.createTextVNode)(' 添加',-1))])]),e.eventPack.conditionalEvents.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',xl,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.conditionalEvents,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'event-item'},[(0,r.createElementVNode)('div',_l,[(0,r.createVNode)(E,{name:'book',size:'1.2em',style:{opacity:'0.5'}}),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'event-name',placeholder:'事件名称'},null,8,Il),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:e=>function(e){t.eventPack.conditionalEvents.splice(e,1)}(a)},[(0,r.createVNode)(E,{name:'delete',size:'0.9em'})],8,Tl)]),(0,r.createCommentVNode)(' Natural Language Trigger (only) '),(0,r.createElementVNode)('div',Al,[(0,r.createElementVNode)('label',null,[(0,r.createVNode)(E,{name:'chat',size:'0.9em'}),n[2]||(n[2]=(0,r.createTextVNode)(' 自然语言触发描述 (AI将根据剧情判断是否满足): ',-1))]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.naturalCondition=t,class:'natural-input',placeholder:'例如：当玩家进入废弃仓库，且随身携带了旧照片时触发...'},null,8,Ml),[[r.vModelText,e.naturalCondition]])]),(0,r.createElementVNode)('div',Dl,[n[3]||(n[3]=(0,r.createElementVNode)('label',null,'事件剧本:',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'event-content',placeholder:'事件发生时的剧情...'},null,8,Pl),[[r.vModelText,e.content]])])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Ol,'暂无条件事件'))]))}}),Ll=(0,p.A)(Rl,[['__scopeId','data-v-0d6a4e56']]),$l=Ll,Ul={class:'editor-section'},zl={class:'wb-grid'},Fl={class:'wb-panel list'},Wl={class:'panel-header'},Gl={class:'panel-content'},jl={key:0,class:'entry-list'},Jl=['onClick'],Yl={class:'entry-title-row'},Hl={class:'entry-title'},Xl={class:'entry-badges'},Kl={key:0,class:'badge disabled'},ql={key:1,class:'badge enabled'},Ql={class:'entry-sub'},Zl={key:0,class:'dim'},er={key:1,class:'dim'},tr={key:2,class:'dim'},ar={key:1,class:'empty-panel'},nr={class:'wb-panel editor'},or={class:'panel-header'},lr={class:'editor-actions'},rr=['disabled'],ir={key:0,class:'panel-content'},cr={class:'form-grid'},sr={class:'field span-2'},dr={class:'field'},ur={class:'pretty-check'},mr=['checked'],pr={class:'field'},vr=['value'],gr={class:'field'},fr=['value'],yr={class:'field'},hr={class:'field'},kr=['value'],Nr={class:'field span-2'},Er=['value'],Vr={class:'field'},br={class:'field span-1'},wr=['value'],Cr={class:'field span-2'},Sr={class:'field'},Br={class:'field'},xr=['value'],_r={key:0,class:'field'},Ir={key:1,class:'field'},Tr=['value'],Ar={class:'field'},Mr={class:'pretty-check'},Dr=['checked'],Pr={class:'field'},Or={class:'pretty-check'},Rr=['checked'],Lr={class:'field'},$r=['value'],Ur={class:'field'},zr=['value'],Fr={class:'field'},Wr=['value'],Gr={class:'field'},jr=['value'],Jr={class:'field span-2'},Yr=['value'],Hr={key:0,class:'hint warning'},Xr={key:1,class:'panel-content'},Kr=(0,r.defineComponent)({__name:'ExtraWorldbooksEditor',props:{eventPack:{}},setup(e){const t=e,a=(0,r.ref)(null);const n=(0,r.computed)(()=>{const e=a.value;if(!e)return null;const n=t.eventPack.extraWorldBooks.find(t=>t.id===e)||null;return n&&function(e){e.enabled??=!0,e.probability??=100,e.strategy??={},e.strategy.type??='selective',e.strategy.keys??=[],e.strategy.keys_secondary??={},e.strategy.keys_secondary.logic??='and_any',e.strategy.keys_secondary.keys??=[],e.strategy.scan_depth??='same_as_global',e.position??={},e.position.type??='after_character_definition',e.position.role??='system',e.position.depth??=0,e.position.order??=100,e.recursion??={},e.recursion.prevent_incoming??=!1,e.recursion.prevent_outgoing??=!1,e.recursion.delay_until??=null,e.effect??={},e.effect.sticky??=null,e.effect.cooldown??=null,e.effect.delay??=null,e.extra??={}}(n),n}),o=(0,r.computed)(()=>n.value||void 0);function l(){const e={id:Nl(),name:'',content:'',enabled:!0,uid:void 0,probability:100,strategy:{type:'selective',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:0,order:100},recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{}};t.eventPack.extraWorldBooks.push(e),a.value=e.id}function i(){if(!o.value)return;const e=t.eventPack.extraWorldBooks.findIndex(e=>e.id===o.value.id);if(e<0)return;t.eventPack.extraWorldBooks.splice(e,1);const n=t.eventPack.extraWorldBooks[e]||t.eventPack.extraWorldBooks[e-1]||null;a.value=n?.id||null}(0,r.onMounted)(()=>{t.eventPack.extraWorldBooks||(t.eventPack.extraWorldBooks=[]),t.eventPack.extraWorldBooks.length&&!a.value&&(a.value=t.eventPack.extraWorldBooks[0].id)}),(0,r.watch)(()=>t.eventPack.extraWorldBooks.length,()=>{!a.value&&t.eventPack.extraWorldBooks.length&&(a.value=t.eventPack.extraWorldBooks[0].id)});const c=(0,r.computed)(()=>'number'==typeof n.value?.probability?n.value.probability:100);function s(e){if(!o.value)return;const t=e.target.value,a=''===t?100:Number(t);o.value.probability=Number.isFinite(a)?Math.max(0,Math.min(100,Math.round(a))):100}const d=(0,r.computed)(()=>'number'==typeof n.value?.uid?String(n.value.uid):'');function u(e){if(!o.value)return;const t=e.target.value;if(!t.trim())return void(o.value.uid=void 0);const a=Number(t);o.value.uid=Number.isFinite(a)?Math.max(0,Math.floor(a)):o.value.uid}function m(e){o.value&&(o.value.enabled=e.target.checked)}const p=(0,r.computed)({get(){const e=n.value?.strategy?.scan_depth;return'same_as_global'===e||'number'!=typeof e?'same_as_global':'custom'},set(e){o.value&&(o.value.strategy.scan_depth='same_as_global'===e?'same_as_global':7)}}),v=(0,r.computed)(()=>{const e=n.value?.strategy?.scan_depth;return'number'==typeof e?String(e):'7'});function g(e){if(!o.value)return;const t=e.target.value,a=Number(t);Number.isFinite(a)&&(o.value.strategy.scan_depth=Math.max(1,Math.floor(a)))}const f=(0,r.computed)(()=>(n.value?.strategy?.keys||[]).join('\n'));function y(e){if(!o.value)return;const t=e.target.value.split(/\r?\n/).map(e=>e.trim()).filter(Boolean);o.value.strategy.keys=t}const h=(0,r.computed)(()=>(n.value?.strategy?.keys_secondary?.keys||[]).join('\n'));function k(e){if(!o.value)return;const t=e.target.value.split(/\r?\n/).map(e=>e.trim()).filter(Boolean);o.value.strategy.keys_secondary.keys=t}const N=(0,r.computed)(()=>'number'==typeof n.value?.position?.order?String(n.value.position.order):'');function V(e){if(!o.value)return;const t=e.target.value;if(!t.trim())return void(o.value.position.order=100);const a=Number(t);Number.isFinite(a)&&(o.value.position.order=Math.floor(a))}const b=(0,r.computed)(()=>'number'==typeof n.value?.position?.depth?String(n.value.position.depth):'0');function w(e){if(!o.value)return;const t=e.target.value,a=Number(t);Number.isFinite(a)&&(o.value.position.depth=Math.max(0,Math.floor(a)))}function C(e){if(!e.trim())return null;const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):null}const S=(0,r.computed)(()=>null==n.value?.recursion?.delay_until?'':String(n.value.recursion.delay_until));function B(e){o.value&&(o.value.recursion.delay_until=C(e.target.value))}const x=(0,r.computed)(()=>null==n.value?.effect?.sticky?'':String(n.value.effect.sticky));function I(e){o.value&&(o.value.effect.sticky=C(e.target.value))}const T=(0,r.computed)(()=>null==n.value?.effect?.cooldown?'':String(n.value.effect.cooldown));function A(e){o.value&&(o.value.effect.cooldown=C(e.target.value))}const M=(0,r.computed)(()=>null==n.value?.effect?.delay?'':String(n.value.effect.delay));function D(e){o.value&&(o.value.effect.delay=C(e.target.value))}const P=(0,r.ref)(''),O=(0,r.computed)(()=>{const e=n.value?.extra||{};try{return JSON.stringify(e,null,2)}catch{return'{}'}});function R(e){if(!o.value)return;const t=e.target.value;if(!t.trim())return o.value.extra={},void(P.value='');try{o.value.extra=JSON.parse(t),P.value=''}catch(e){P.value='JSON 格式错误：'+(e?.message||String(e))}}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Ul,[(0,r.createElementVNode)('div',zl,[(0,r.createCommentVNode)(' List '),(0,r.createElementVNode)('div',Fl,[(0,r.createElementVNode)('div',Wl,[(0,r.createElementVNode)('h4',null,[(0,r.createVNode)(E,{name:'book',size:'1em'}),t[9]||(t[9]=(0,r.createTextVNode)(' 额外世界书',-1))]),(0,r.createElementVNode)('button',{class:'add-mini-btn',onClick:l},'+')]),(0,r.createElementVNode)('div',Gl,[e.eventPack.extraWorldBooks.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',jl,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.extraWorldBooks,e=>((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:e.id,class:(0,r.normalizeClass)(['entry-item',{active:e.id===a.value}]),onClick:t=>a.value=e.id,type:'button'},[(0,r.createElementVNode)('div',Yl,[(0,r.createElementVNode)('span',Hl,(0,r.toDisplayString)(e.name?.trim()?e.name:'（未命名条目）'),1),(0,r.createElementVNode)('span',Xl,[!1===e.enabled?((0,r.openBlock)(),(0,r.createElementBlock)('span',Kl,'禁用')):((0,r.openBlock)(),(0,r.createElementBlock)('span',ql,'启用'))])]),(0,r.createElementVNode)('div',Ql,[e.strategy?.type?((0,r.openBlock)(),(0,r.createElementBlock)('span',Zl,(0,r.toDisplayString)(e.strategy.type),1)):(0,r.createCommentVNode)('v-if',!0),'number'==typeof e.probability?((0,r.openBlock)(),(0,r.createElementBlock)('span',er,' · '+(0,r.toDisplayString)(e.probability)+'%',1)):(0,r.createCommentVNode)('v-if',!0),'number'==typeof e.uid?((0,r.openBlock)(),(0,r.createElementBlock)('span',tr,' · UID: '+(0,r.toDisplayString)(e.uid),1)):(0,r.createCommentVNode)('v-if',!0)])],10,Jl))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',ar,'暂无条目'))])]),(0,r.createCommentVNode)(' Editor '),(0,r.createElementVNode)('div',nr,[(0,r.createElementVNode)('div',or,[(0,r.createElementVNode)('h4',null,[(0,r.createVNode)(E,{name:'edit',size:'1em'}),t[10]||(t[10]=(0,r.createTextVNode)(' 条目编辑',-1))]),(0,r.createElementVNode)('div',lr,[(0,r.createElementVNode)('button',{class:'danger-btn',disabled:!o.value,onClick:i},'删除',8,rr)])]),o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',ir,[(0,r.createElementVNode)('div',cr,[(0,r.createElementVNode)('div',sr,[t[11]||(t[11]=(0,r.createElementVNode)('label',null,'名称',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>o.value.name=e),type:'text',placeholder:'条目标题'},null,512),[[r.vModelText,o.value.name]])]),(0,r.createElementVNode)('div',dr,[t[14]||(t[14]=(0,r.createElementVNode)('label',null,'启用',-1)),(0,r.createElementVNode)('label',ur,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!1!==o.value.enabled,onChange:m},null,40,mr),t[12]||(t[12]=(0,r.createElementVNode)('span',{class:'check-ui','aria-hidden':'true'},null,-1)),t[13]||(t[13]=(0,r.createTextVNode)(' 启用该条目 ',-1))])]),(0,r.createElementVNode)('div',pr,[t[15]||(t[15]=(0,r.createElementVNode)('label',null,'激活概率%',-1)),(0,r.createElementVNode)('input',{type:'number',min:'0',max:'100',step:'1',value:c.value,onInput:s,placeholder:'100'},null,40,vr)]),(0,r.createElementVNode)('div',gr,[t[16]||(t[16]=(0,r.createElementVNode)('label',null,'UID',-1)),(0,r.createElementVNode)('input',{type:'number',min:'0',step:'1',value:d.value,onInput:u,placeholder:'(自动)'},null,40,fr),t[17]||(t[17]=(0,r.createElementVNode)('div',{class:'hint'},'留空则不指定 UID（由酒馆/系统自动分配；仅在本事件包内需要唯一时再填写）。',-1))]),(0,r.createElementVNode)('div',yr,[t[19]||(t[19]=(0,r.createElementVNode)('label',null,'激活策略',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[1]||(t[1]=e=>o.value.strategy.type=e)},[...t[18]||(t[18]=[(0,r.createElementVNode)('option',{value:'constant'},'常量 (蓝灯)',-1),(0,r.createElementVNode)('option',{value:'selective'},'可选项 (绿灯)',-1),(0,r.createElementVNode)('option',{value:'vectorized'},'向量化',-1)])],512),[[r.vModelSelect,o.value.strategy.type]])]),(0,r.createElementVNode)('div',hr,[t[21]||(t[21]=(0,r.createElementVNode)('label',null,'扫描深度',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[2]||(t[2]=e=>p.value=e)},[...t[20]||(t[20]=[(0,r.createElementVNode)('option',{value:'same_as_global'},'使用全局',-1),(0,r.createElementVNode)('option',{value:'custom'},'自定义',-1)])],512),[[r.vModelSelect,p.value]]),'custom'===p.value?((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:0,class:'mt',type:'number',min:'1',step:'1',value:v.value,onInput:g,placeholder:'例如：7'},null,40,kr)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',Nr,[t[22]||(t[22]=(0,r.createElementVNode)('label',null,'主要关键字（每行一个）',-1)),(0,r.createElementVNode)('textarea',{class:'mono',value:f.value,onInput:y,placeholder:'例如：\\n神乐光\\n小光'},null,40,Er),t[23]||(t[23]=(0,r.createElementVNode)('div',{class:'hint'},'仅对“可选项(绿灯)”策略生效。',-1))]),(0,r.createElementVNode)('div',Vr,[t[25]||(t[25]=(0,r.createElementVNode)('label',null,'次要关键字逻辑',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[3]||(t[3]=e=>o.value.strategy.keys_secondary.logic=e)},[...t[24]||(t[24]=[(0,r.createElementVNode)('option',{value:'and_any'},'and_any：任意命中',-1),(0,r.createElementVNode)('option',{value:'and_all'},'and_all：全部命中',-1),(0,r.createElementVNode)('option',{value:'not_all'},'not_all：至少一个未命中',-1),(0,r.createElementVNode)('option',{value:'not_any'},'not_any：全部未命中',-1)])],512),[[r.vModelSelect,o.value.strategy.keys_secondary.logic]])]),(0,r.createElementVNode)('div',br,[t[26]||(t[26]=(0,r.createElementVNode)('label',null,'次要关键字（每行一个）',-1)),(0,r.createElementVNode)('textarea',{class:'mono',value:h.value,onInput:k,placeholder:'可留空'},null,40,wr)]),(0,r.createElementVNode)('div',Cr,[t[27]||(t[27]=(0,r.createElementVNode)('label',null,'内容',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[4]||(t[4]=e=>o.value.content=e),class:'content',placeholder:'世界书条目内容...'},null,512),[[r.vModelText,o.value.content]])]),t[45]||(t[45]=(0,r.createElementVNode)('div',{class:'field span-2'},[(0,r.createElementVNode)('div',{class:'sub-title'},'插入位置')],-1)),(0,r.createElementVNode)('div',Sr,[t[29]||(t[29]=(0,r.createElementVNode)('label',null,'位置类型',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[5]||(t[5]=e=>o.value.position.type=e)},[...t[28]||(t[28]=[(0,r.createStaticVNode)('<option value="before_character_definition" data-v-5e9fa566>角色定义之前</option><option value="after_character_definition" data-v-5e9fa566>角色定义之后</option><option value="before_example_messages" data-v-5e9fa566>示例消息之前</option><option value="after_example_messages" data-v-5e9fa566>示例消息之后</option><option value="before_author_note" data-v-5e9fa566>作者注释之前</option><option value="after_author_note" data-v-5e9fa566>作者注释之后</option><option value="at_depth" data-v-5e9fa566>插入到指定深度</option>',7)])],512),[[r.vModelSelect,o.value.position.type]])]),(0,r.createElementVNode)('div',Br,[t[30]||(t[30]=(0,r.createElementVNode)('label',null,'顺序(order)',-1)),(0,r.createElementVNode)('input',{type:'number',step:'1',value:N.value,onInput:V,placeholder:'100'},null,40,xr)]),'at_depth'===o.value.position?.type?((0,r.openBlock)(),(0,r.createElementBlock)('div',_r,[t[32]||(t[32]=(0,r.createElementVNode)('label',null,'role',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[6]||(t[6]=e=>o.value.position.role=e)},[...t[31]||(t[31]=[(0,r.createElementVNode)('option',{value:'system'},'system',-1),(0,r.createElementVNode)('option',{value:'assistant'},'assistant',-1),(0,r.createElementVNode)('option',{value:'user'},'user',-1)])],512),[[r.vModelSelect,o.value.position.role]])])):(0,r.createCommentVNode)('v-if',!0),'at_depth'===o.value.position?.type?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ir,[t[33]||(t[33]=(0,r.createElementVNode)('label',null,'depth',-1)),(0,r.createElementVNode)('input',{type:'number',min:'0',step:'1',value:b.value,onInput:w,placeholder:'0'},null,40,Tr)])):(0,r.createCommentVNode)('v-if',!0),t[46]||(t[46]=(0,r.createElementVNode)('div',{class:'field span-2'},[(0,r.createElementVNode)('div',{class:'sub-title'},'递归 & 效果')],-1)),(0,r.createElementVNode)('div',Ar,[t[36]||(t[36]=(0,r.createElementVNode)('label',null,'防止入站递归',-1)),(0,r.createElementVNode)('label',Mr,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!!o.value.recursion?.prevent_incoming,onChange:t[7]||(t[7]=e=>{return t=e.target.checked,void(o.value&&(o.value.recursion.prevent_incoming=t));var t})},null,40,Dr),t[34]||(t[34]=(0,r.createElementVNode)('span',{class:'check-ui','aria-hidden':'true'},null,-1)),t[35]||(t[35]=(0,r.createTextVNode)(' prevent_incoming ',-1))])]),(0,r.createElementVNode)('div',Pr,[t[39]||(t[39]=(0,r.createElementVNode)('label',null,'防止出站递归',-1)),(0,r.createElementVNode)('label',Or,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!!o.value.recursion?.prevent_outgoing,onChange:t[8]||(t[8]=e=>{return t=e.target.checked,void(o.value&&(o.value.recursion.prevent_outgoing=t));var t})},null,40,Rr),t[37]||(t[37]=(0,r.createElementVNode)('span',{class:'check-ui','aria-hidden':'true'},null,-1)),t[38]||(t[38]=(0,r.createTextVNode)(' prevent_outgoing ',-1))])]),(0,r.createElementVNode)('div',Lr,[t[40]||(t[40]=(0,r.createElementVNode)('label',null,'delay_until',-1)),(0,r.createElementVNode)('input',{value:S.value,onInput:B,type:'number',min:'0',step:'1',placeholder:'留空为 null'},null,40,$r)]),(0,r.createElementVNode)('div',Ur,[t[41]||(t[41]=(0,r.createElementVNode)('label',null,'sticky',-1)),(0,r.createElementVNode)('input',{value:x.value,onInput:I,type:'number',min:'0',step:'1',placeholder:'留空为 null'},null,40,zr)]),(0,r.createElementVNode)('div',Fr,[t[42]||(t[42]=(0,r.createElementVNode)('label',null,'cooldown',-1)),(0,r.createElementVNode)('input',{value:T.value,onInput:A,type:'number',min:'0',step:'1',placeholder:'留空为 null'},null,40,Wr)]),(0,r.createElementVNode)('div',Gr,[t[43]||(t[43]=(0,r.createElementVNode)('label',null,'delay',-1)),(0,r.createElementVNode)('input',{value:M.value,onInput:D,type:'number',min:'0',step:'1',placeholder:'留空为 null'},null,40,jr)]),(0,r.createElementVNode)('div',Jr,[t[44]||(t[44]=(0,r.createElementVNode)('div',{class:'sub-title'},'extra (JSON)',-1)),(0,r.createElementVNode)('textarea',{class:'mono',value:O.value,onInput:R,placeholder:'{}'},null,40,Yr),P.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Hr,(0,r.toDisplayString)(P.value),1)):(0,r.createCommentVNode)('v-if',!0)])])])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Xr,[...t[47]||(t[47]=[(0,r.createElementVNode)('div',{class:'empty-panel'},'请选择或新增一个条目',-1)])]))])])]))}}),qr=(0,p.A)(Kr,[['__scopeId','data-v-5e9fa566']]),Qr=qr,Zr={class:'editor-section'},ei={class:'metadata-grid'},ti={class:'cover-uploader'},ai={key:0,class:'placeholder'},ni={class:'url-input-group'},oi={class:'input-hint'},li={class:'info-fields'},ri={class:'form-group full-width'},ii={class:'form-group full-width'},ci={class:'form-group full-width'},si={class:'linked-packs-selector'},di=['onClick'],ui={class:'pack-name'},mi={key:0,class:'empty-packs'},pi={class:'form-group full-width full-height'},vi=(0,r.defineComponent)({__name:'MetadataEditor',props:{eventPack:{},characterPacks:{}},emits:['trigger-upload'],setup(e){const t=e;function a(e){return!!t.eventPack.linkedCharacterPackIds&&t.eventPack.linkedCharacterPackIds.includes(e)}const n=(0,r.computed)(()=>t.eventPack.coverImage?{backgroundImage:`url(${t.eventPack.coverImage})`}:{});return(e,o)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Zr,[o[12]||(o[12]=(0,r.createElementVNode)('div',{class:'section-title'},[(0,r.createElementVNode)('h4',null,'元数据 (Metadata)')],-1)),(0,r.createElementVNode)('div',ei,[(0,r.createCommentVNode)(' Left Column: Image '),(0,r.createElementVNode)('div',ti,[o[7]||(o[7]=(0,r.createElementVNode)('label',null,'封面 / Cover',-1)),(0,r.createElementVNode)('div',{class:'image-preview',style:(0,r.normalizeStyle)(n.value),onClick:o[0]||(o[0]=t=>e.$emit('trigger-upload'))},[e.eventPack.coverImage?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',ai,[(0,r.createVNode)(E,{name:'image',size:'2em'}),o[5]||(o[5]=(0,r.createElementVNode)('span',null,'点击上传封面',-1))]))],4),(0,r.createElementVNode)('div',ni,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':o[1]||(o[1]=t=>e.eventPack.coverImage=t),placeholder:'或输入图片URL...',class:'url-input'},null,512),[[r.vModelText,e.eventPack.coverImage]]),(0,r.createElementVNode)('div',oi,[(0,r.createVNode)(E,{name:'info',size:'0.75em'}),o[6]||(o[6]=(0,r.createTextVNode)(' 推荐使用图片 URL（避免 base64 导致上传失败/体积过大） ',-1))])])]),(0,r.createCommentVNode)(' Right Column: Info '),(0,r.createElementVNode)('div',li,[(0,r.createElementVNode)('div',ri,[o[8]||(o[8]=(0,r.createElementVNode)('label',null,'ID (Unique Identifier)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':o[2]||(o[2]=t=>e.eventPack.id=t),disabled:'',class:'disabled-input'},null,512),[[r.vModelText,e.eventPack.id]])]),(0,r.createElementVNode)('div',ii,[o[9]||(o[9]=(0,r.createElementVNode)('label',null,'包名称 (Name)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':o[3]||(o[3]=t=>e.eventPack.name=t),placeholder:'为你的事件包起个名字...'},null,512),[[r.vModelText,e.eventPack.name]])]),(0,r.createElementVNode)('div',ci,[o[10]||(o[10]=(0,r.createElementVNode)('label',null,'关联角色包 (Linked Character Packs)',-1)),(0,r.createElementVNode)('div',si,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.characterPacks,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:(0,r.normalizeClass)(['pack-option',{selected:a(e.id)}]),onClick:a=>function(e){t.eventPack.linkedCharacterPackIds||(t.eventPack.linkedCharacterPackIds=[]);const a=t.eventPack.linkedCharacterPackIds.indexOf(e);a>=0?t.eventPack.linkedCharacterPackIds.splice(a,1):t.eventPack.linkedCharacterPackIds.push(e)}(e.id)},[(0,r.createElementVNode)('div',{class:'pack-cover',style:(0,r.normalizeStyle)({backgroundImage:`url(${e.coverImage})`})},null,4),(0,r.createElementVNode)('span',ui,(0,r.toDisplayString)(e.name),1),a(e.id)?((0,r.openBlock)(),(0,r.createBlock)(E,{key:0,name:'check',size:'1em',class:'check-icon'})):(0,r.createCommentVNode)('v-if',!0)],10,di))),128)),e.characterPacks&&0!==e.characterPacks.length?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',mi,' 未检测到已下载的角色包 (No downloaded character packs found) '))])]),(0,r.createElementVNode)('div',pi,[o[11]||(o[11]=(0,r.createElementVNode)('label',null,'描述 (Description)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':o[4]||(o[4]=t=>e.eventPack.description=t),placeholder:'描述这个事件包的内容...'},null,512),[[r.vModelText,e.eventPack.description]])])])])]))}}),gi=(0,p.A)(vi,[['__scopeId','data-v-6f86564c']]),fi=gi,yi={class:'editor-section'},hi={class:'section-title'},ki={key:0,class:'items-list'},Ni={class:'event-header'},Ei={class:'order-badge'},Vi=['onUpdate:modelValue'],bi=['onClick'],wi=['onUpdate:modelValue'],Ci={key:1,class:'empty-hint'},Si=(0,r.defineComponent)({__name:'PlotEventsEditor',props:{eventPack:{}},setup(e){const t=e;function a(){const e={id:Nl(),name:'新剧情事件',content:'',order:t.eventPack.plotEvents.length+1};t.eventPack.plotEvents.push(e)}return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',yi,[(0,r.createElementVNode)('div',hi,[n[1]||(n[1]=(0,r.createElementVNode)('h4',null,'剧情事件 (Plot Events)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:a},[(0,r.createVNode)(E,{name:'plus',size:'0.75em'}),n[0]||(n[0]=(0,r.createTextVNode)(' 添加',-1))])]),e.eventPack.plotEvents.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',ki,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.plotEvents,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'event-item'},[(0,r.createElementVNode)('div',Ni,[(0,r.createVNode)(E,{name:'book',size:'1.2em',style:{opacity:'0.5'}}),(0,r.createElementVNode)('span',Ei,'#'+(0,r.toDisplayString)(a+1),1),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'event-name',placeholder:'事件名称'},null,8,Vi),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:e=>function(e){t.eventPack.plotEvents.splice(e,1),t.eventPack.plotEvents.forEach((e,t)=>{e.order=t+1})}(a)},[(0,r.createVNode)(E,{name:'delete',size:'0.9em'})],8,bi)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'event-content',placeholder:'必须触发的主线剧情内容...'},null,8,wi),[[r.vModelText,e.content]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Ci,'暂无剧情事件'))]))}}),Bi=(0,p.A)(Si,[['__scopeId','data-v-5a9d1177']]),xi=Bi,_i={class:'editor-section'},Ii={class:'section-title'},Ti={key:0,class:'items-list'},Ai={class:'event-header'},Mi=['onUpdate:modelValue'],Di=['onClick'],Pi={class:'event-config'},Oi={class:'config-row'},Ri=['onUpdate:modelValue'],Li=['onUpdate:modelValue'],$i={key:1,class:'empty-hint'},Ui=(0,r.defineComponent)({__name:'RandomEventsEditor',props:{eventPack:{}},setup(e){const t=e;for(const e of t.eventPack.randomEvents||[])e.config||(e.config={probability:10}),'number'!=typeof e.config.probability&&(e.config.probability=10);function a(){const e={id:Nl(),name:'新随机事件',content:'',config:{probability:10}};t.eventPack.randomEvents.push(e)}return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',_i,[(0,r.createElementVNode)('div',Ii,[n[1]||(n[1]=(0,r.createElementVNode)('h4',null,'随机事件 (Random Events)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:a},[(0,r.createVNode)(E,{name:'plus',size:'0.75em'}),n[0]||(n[0]=(0,r.createTextVNode)(' 添加',-1))])]),e.eventPack.randomEvents.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ti,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.randomEvents,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'event-item'},[(0,r.createElementVNode)('div',Ai,[(0,r.createVNode)(E,{name:'book',size:'1.2em',style:{opacity:'0.5'}}),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'event-name',placeholder:'事件名称'},null,8,Mi),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:e=>function(e){t.eventPack.randomEvents.splice(e,1)}(a)},[(0,r.createVNode)(E,{name:'delete',size:'0.9em'})],8,Di)]),(0,r.createCommentVNode)(' Config Area '),(0,r.createElementVNode)('div',Pi,[(0,r.createElementVNode)('div',Oi,[n[2]||(n[2]=(0,r.createElementVNode)('label',null,'基础概率 (1-100):',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'number','onUpdate:modelValue':t=>e.config.probability=t,style:{width:'5em'}},null,8,Ri),[[r.vModelText,e.config.probability,void 0,{number:!0}]])]),n[3]||(n[3]=(0,r.createElementVNode)('div',{class:'config-hint'},'已取消触发类型，随机事件统一为完全随机。',-1))]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'event-content',placeholder:'事件内容 / 剧本...'},null,8,Li),[[r.vModelText,e.content]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',$i,'暂无随机事件，点击上方添加'))]))}}),zi=(0,p.A)(Ui,[['__scopeId','data-v-84947124']]),Fi=zi,Wi={class:'editor-section'},Gi={class:'world-settings-grid'},ji={class:'world-panel special'},Ji={class:'panel-header special'},Yi={class:'panel-content'},Hi={key:0,class:'world-items'},Xi={class:'card-header'},Ki=['onUpdate:modelValue'],qi=['onClick'],Qi=['onUpdate:modelValue'],Zi={key:1,class:'empty-panel'},ec=(0,r.defineComponent)({__name:'SpecialRulesEditor',props:{eventPack:{}},setup(e){const t=e;function a(){t.eventPack.specialRules||(t.eventPack.specialRules=[]),t.eventPack.specialRules.push({id:Nl(),name:'',content:''})}return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Wi,[(0,r.createElementVNode)('div',Gi,[(0,r.createCommentVNode)(' Special Rules '),(0,r.createElementVNode)('div',ji,[(0,r.createElementVNode)('div',Ji,[(0,r.createElementVNode)('h4',null,[(0,r.createVNode)(E,{name:'alert',size:'1em'}),n[0]||(n[0]=(0,r.createTextVNode)(' 特殊规则 (Special Rules)',-1))]),(0,r.createElementVNode)('button',{class:'add-mini-btn',onClick:a},'+')]),(0,r.createElementVNode)('div',Yi,[e.eventPack.specialRules&&e.eventPack.specialRules.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Hi,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.specialRules,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'world-card'},[(0,r.createElementVNode)('div',Xi,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'card-title-input',placeholder:'规则名称'},null,8,Ki),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'mini-delete',onClick:e=>function(e){t.eventPack.specialRules.splice(e,1)}(a)},'×',8,qi)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'card-content',placeholder:'规则描述...'},null,8,Qi),[[r.vModelText,e.content]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Zi,'暂无特殊规则'))])])])]))}}),tc=(0,p.A)(ec,[['__scopeId','data-v-a75bcf42']]),ac=tc,nc={class:'editor-section'},oc={class:'section-title'},lc={key:0,class:'items-list'},rc={class:'event-header'},ic={class:'order-badge'},cc=['onUpdate:modelValue'],sc=['onClick'],dc={class:'event-config'},uc={class:'config-row'},mc=['onUpdate:modelValue'],pc={class:'config-row'},vc=['onUpdate:modelValue'],gc=['onUpdate:modelValue'],fc={key:1,class:'empty-hint'},yc=(0,r.defineComponent)({__name:'StartPointsEditor',props:{eventPack:{}},setup(e){const t=e;function a(){t.eventPack.startPoints||(t.eventPack.startPoints=[]);const e={id:Date.now().toString(),title:'新开局锚点',time:'第1天 08:00',location:'未知地点',initialEvent:''};t.eventPack.startPoints.push(e)}return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',nc,[(0,r.createElementVNode)('div',oc,[n[1]||(n[1]=(0,r.createElementVNode)('h4',null,'开局锚点 (Start Points)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:a},[(0,r.createVNode)(E,{name:'plus',size:'0.75em'}),n[0]||(n[0]=(0,r.createTextVNode)(' 添加',-1))])]),n[4]||(n[4]=(0,r.createElementVNode)('div',{class:'description-text'},'定义玩家开始游戏时的时间、地点及初始事件剧情。',-1)),e.eventPack.startPoints.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',lc,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.startPoints,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'event-item'},[(0,r.createElementVNode)('div',rc,[(0,r.createVNode)(E,{name:'map-pin',size:'1.2em',style:{opacity:'0.5'}}),(0,r.createElementVNode)('span',ic,'#'+(0,r.toDisplayString)(a+1),1),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.title=t,class:'event-name',placeholder:'锚点标题 (例如: 默认开局 - 城市)'},null,8,cc),[[r.vModelText,e.title]]),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:e=>function(e){t.eventPack.startPoints.splice(e,1)}(a)},[(0,r.createVNode)(E,{name:'delete',size:'0.9em'})],8,sc)]),(0,r.createElementVNode)('div',dc,[(0,r.createElementVNode)('div',uc,[n[2]||(n[2]=(0,r.createElementVNode)('label',null,'初始时间:',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.time=t,placeholder:'例如: 2077年1月1日 8:00',class:'input-text'},null,8,mc),[[r.vModelText,e.time]])]),(0,r.createElementVNode)('div',pc,[n[3]||(n[3]=(0,r.createElementVNode)('label',null,'初始地点:',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.location=t,placeholder:'例如: 主要车站',class:'input-text'},null,8,vc),[[r.vModelText,e.location]])])]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.initialEvent=t,class:'event-content',placeholder:'描述开局时的剧情、环境描写或第一句对白...',rows:'4'},null,8,gc),[[r.vModelText,e.initialEvent]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',fc,'暂无开局锚点，点击上方添加'))]))}}),hc=(0,p.A)(yc,[['__scopeId','data-v-e982b446']]),kc=hc,Nc={class:'editor-section user-widgets-editor'},Ec={class:'section-title'},Vc={class:'title-actions'},bc={class:'security-notice'},wc={class:'preview-vars'},Cc={key:0,class:'preview-vars-error'},Sc={key:0,class:'widgets-list'},Bc=['onClick'],xc={class:'header-left'},_c=['onUpdate:modelValue'],Ic={class:'header-right'},Tc=['onClick'],Ac=['onClick'],Mc={class:'expand-indicator'},Dc={class:'widget-body'},Pc={class:'form-group'},Oc=['onUpdate:modelValue'],Rc={class:'code-section'},Lc={class:'code-header'},$c=['onClick'],Uc=['onUpdate:modelValue'],zc={key:0,class:'validation-result'},Fc={key:0,class:'validation-success'},Wc={key:0,class:'warning-count'},Gc={key:1,class:'validation-error'},jc={key:2,class:'validation-warnings'},Jc={class:'widget-actions'},Yc=['onClick'],Hc=['onClick'],Xc={key:1,class:'empty-hint'},Kc={class:'preview-container'},qc={class:'preview-header'},Qc={class:'preview-body'},Zc={class:'preview-console'},es={class:'console-logs'},ts={key:0,class:'no-logs'},as=(0,r.defineComponent)({__name:'UserWidgetsEditor',props:{eventPack:{}},setup(e){const t=e,a=(0,r.ref)(!1),n=(0,r.ref)(''),o=(0,r.ref)('info');function l(e,t='info'){n.value=e,o.value=t,a.value=!0}const i=(0,r.ref)([]),c=(0,r.ref)(null),s=(0,r.reactive)({}),d=(0,r.ref)(!1),u=(0,r.ref)(null),m=(0,r.ref)([]),p=(0,r.ref)(''),v=(0,r.computed)(()=>{const e=(p.value||'').trim();if(!e)return{value:null,error:''};try{const t=JSON.parse(e);return!t||'object'!=typeof t||Array.isArray(t)?{value:null,error:'预览变量必须是 JSON 对象（Object），不能是数组/字符串/数字。'}:{value:t,error:''}}catch(e){return{value:null,error:'预览变量 JSON 解析失败：'+(e?.message||String(e))}}});function g(){const e=Na(t.eventPack.variableTree,{dynamicKeySample:'Example'});return JSON.stringify(e,null,2)}function f(){p.value=g()}function y(){d.value&&(d.value=!1,queueMicrotask(()=>{d.value=!0}))}const h=(0,r.ref)({playerName:'测试玩家',gold:1e3,level:5,customVars:{hp:100,mp:50}});function k(){const e={id:Nl(),name:'新组件',description:'',vueCode:'',cssCode:'',createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};i.value.push(e),c.value=e.id}function N(e){if(!e.vueCode.trim())return void l('请先输入组件代码','warning');const t=vo(e.vueCode);s[e.id]=t,t.isValid?(u.value=e,m.value=[],d.value=!0):l('代码存在安全问题，无法预览','error')}function V(){d.value=!1,u.value=null,m.value=[]}function b(){m.value.push({type:'info',message:'组件加载成功'})}function w(e){m.value.push({type:'error',message:e})}function C(e){m.value.push({type:e.type,message:e.message})}return(0,r.onMounted)(()=>{t.eventPack.userWidgets&&t.eventPack.userWidgets.length>0?i.value=JSON.parse(JSON.stringify(t.eventPack.userWidgets)):t.eventPack.widgetStyles&&t.eventPack.widgetStyles.length>0&&(i.value=t.eventPack.widgetStyles.map(e=>({id:e.id,name:e.name,description:'',vueCode:e.vueCode,cssCode:'',linkedVariables:e.linkedVariables,position:'right-sidebar',order:0,allowStateModification:!1}))),p.value=String(t.eventPack.previewVariablesText||''),p.value.trim()||(p.value=g())}),(0,r.watch)(i,e=>{t.eventPack.userWidgets=JSON.parse(JSON.stringify(e))},{deep:!0}),(0,r.watch)(p,e=>{t.eventPack.previewVariablesText=String(e||'')},{immediate:!0}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Nc,[(0,r.createElementVNode)('div',Ec,[t[4]||(t[4]=(0,r.createElementVNode)('h4',null,'自定义UI组件 (User Widgets)',-1)),(0,r.createElementVNode)('div',Vc,[(0,r.createElementVNode)('button',{class:'add-btn',onClick:k},[(0,r.createVNode)(E,{name:'plus',size:'0.75em'}),t[3]||(t[3]=(0,r.createTextVNode)(' 添加组件',-1))])])]),(0,r.createCommentVNode)(' 安全提示 '),(0,r.createElementVNode)('div',bc,[(0,r.createVNode)(E,{name:'alert',size:'1em'}),t[5]||(t[5]=(0,r.createElementVNode)('div',{class:'notice-content'},[(0,r.createElementVNode)('strong',null,'安全须知'),(0,r.createElementVNode)('p',null,[(0,r.createTextVNode)(' 组件代码将在沙箱环境中运行，禁止访问敏感 API（如 localStorage、fetch 等）。 请使用提供的 '),(0,r.createElementVNode)('code',null,'sdk'),(0,r.createTextVNode)(' 对象与游戏交互。 ')])],-1))]),(0,r.createCommentVNode)(' 预览变量（仅 Workshop 预览用） '),(0,r.createElementVNode)('div',wc,[(0,r.createElementVNode)('div',{class:'preview-vars-header'},[t[6]||(t[6]=(0,r.createElementVNode)('div',{class:'preview-vars-title'},'预览变量（JSON，仅用于组件预览）',-1)),(0,r.createElementVNode)('div',{class:'preview-vars-actions'},[(0,r.createElementVNode)('button',{class:'preview-vars-btn',type:'button',onClick:f},'生成模板'),(0,r.createElementVNode)('button',{class:'preview-vars-btn primary',type:'button',onClick:y},'应用并刷新预览')])]),t[7]||(t[7]=(0,r.createElementVNode)('div',{class:'preview-vars-hint'},[(0,r.createTextVNode)(' 说明：Workshop 预览时通常没有真实世界书变量。组件通过 '),(0,r.createElementVNode)('code',null,'sdk.getVariable'),(0,r.createTextVNode)(' 等读取时，会优先读取这里的预览变量。 ')],-1)),v.value.error?((0,r.openBlock)(),(0,r.createElementBlock)('div',Cc,(0,r.toDisplayString)(v.value.error),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[0]||(t[0]=e=>p.value=e),class:'preview-vars-editor',spellcheck:'false',placeholder:'在这里输入预览变量 JSON...'},null,512),[[r.vModelText,p.value]])]),(0,r.createCommentVNode)(' 组件列表 '),i.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Sc,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:(0,r.normalizeClass)(['widget-card',{expanded:c.value===e.id}])},[(0,r.createElementVNode)('div',{class:'widget-header',onClick:t=>{return a=e.id,void(c.value=c.value===a?null:a);var a}},[(0,r.createElementVNode)('div',xc,[(0,r.createVNode)(E,{name:'folder',size:'1.2em'}),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'widget-name',placeholder:'组件名称',onClick:t[1]||(t[1]=(0,r.withModifiers)(()=>{},['stop']))},null,8,_c),[[r.vModelText,e.name]]),t[8]||(t[8]=(0,r.createElementVNode)('span',{class:'position-badge'},'右边栏',-1))]),(0,r.createElementVNode)('div',Ic,[(0,r.createElementVNode)('button',{class:'preview-btn',onClick:(0,r.withModifiers)(t=>N(e),['stop']),title:'预览组件'},[(0,r.createVNode)(E,{name:'play',size:'0.9em'})],8,Tc),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:(0,r.withModifiers)(e=>function(e){confirm('确定要删除这个组件吗？')&&(i.value.splice(e,1),l('组件已删除','success'))}(a),['stop']),title:'删除组件'},[(0,r.createVNode)(E,{name:'delete',size:'0.9em'})],8,Ac),(0,r.createElementVNode)('span',Mc,(0,r.toDisplayString)(c.value===e.id?'▲':'▼'),1)])],8,Bc),(0,r.withDirectives)((0,r.createElementVNode)('div',Dc,[(0,r.createCommentVNode)(' 基础设置 '),(0,r.createElementVNode)('div',Pc,[t[9]||(t[9]=(0,r.createElementVNode)('label',null,'组件描述',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.description=t,class:'form-input',placeholder:'简要描述组件功能'},null,8,Oc),[[r.vModelText,e.description]])]),(0,r.createCommentVNode)(' Vue 代码编辑器 '),(0,r.createElementVNode)('div',Rc,[(0,r.createElementVNode)('div',Lc,[t[11]||(t[11]=(0,r.createElementVNode)('label',null,'Vue 组件代码 (Options API)',-1)),(0,r.createElementVNode)('button',{class:'template-btn',onClick:t=>function(e){e.vueCode='{\n  // 组件接收 sdk prop，用于与游戏交互\n  props: [\'sdk\'],\n  \n  data() {\n    return {\n      message: \'Hello, World!\',\n      count: 0,\n      characters: [], // 存储角色列表\n      currentTime: \'未知\' // 当前时间\n    }\n  },\n  \n  mounted() {\n    // 组件挂载时加载数据\n    this.loadCharacters();\n    this.loadTime();\n  },\n  \n  computed: {\n    playerInfo() {\n      // 通过 sdk 安全地获取游戏数据\n      return {\n        name: this.sdk?.getPlayerName() || \'未知\',\n        gold: this.sdk?.getGold() || 0,\n        level: this.sdk?.getLevel() || 1\n      }\n    }\n  },\n  \n  methods: {\n    // 加载当前时间\n    loadTime() {\n      this.sdk?.getVariable(\'system.time\', (value) => {\n        this.currentTime = value || \'未知\';\n      });\n    },\n    \n    // 加载所有角色（动态工厂示例）\n    // 注意：David、Tanaka 等角色直接位于数据顶层\n    loadCharacters() {\n      // 获取所有属于 <characters> 模板的实例名称\n      this.sdk?.getDynamicKeys(\'characters\', (keys) => {\n        // 对每个实例名称获取数据\n        keys.forEach(name => {\n          // 直接访问顶层的实例（如 \'David\'）\n          this.sdk?.getDynamicInstance(\'characters\', name, null, (data) => {\n            this.characters.push({ name: name, ...data });\n          });\n        });\n      });\n    },\n    \n    handleClick() {\n      this.count++;\n      this.sdk?.showNotification(\'你点击了 \' + this.count + \' 次\', { type: \'info\' });\n      this.sdk?.log(\'按钮被点击\', this.count);\n      \n      // 示例：获取特定角色的信任值\n      this.sdk?.getDynamicInstance(\'characters\', \'David\', \'trust\', (trust) => {\n        if (trust !== null) {\n          this.sdk?.log(\'David 的信任值:\', trust);\n        }\n      });\n    }\n  },\n  \n  template: `\n    <div class="my-widget">\n      <h3>{{ message }}</h3>\n      <p>玩家: {{ playerInfo.name }}</p>\n      <p>金币: {{ sdk?.formatNumber(playerInfo.gold) }}</p>\n      <p>等级: {{ playerInfo.level }}</p>\n      <p>当前时间: {{ currentTime }}</p>\n      <div v-if="characters.length">\n        <h4>角色列表:</h4>\n        <div v-for="char in characters" :key="char.name">\n          {{ char.name }} (信任: {{ char.trust || 0 }})\n        </div>\n      </div>\n      <button @click="handleClick">点击计数: {{ count }}</button>\n    </div>\n  `\n}',l('模板代码已插入','success')}(e)},[(0,r.createVNode)(E,{name:'code',size:'0.8em'}),t[10]||(t[10]=(0,r.createTextVNode)(' 插入模板 ',-1))],8,$c)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.vueCode=t,class:'code-editor',placeholder:'请输入 Vue 组件配置对象...',spellcheck:'false'},null,8,Uc),[[r.vModelText,e.vueCode]]),t[12]||(t[12]=(0,r.createElementVNode)('div',{class:'code-hint'},[(0,r.createTextVNode)(' 组件接收 '),(0,r.createElementVNode)('code',null,'sdk'),(0,r.createTextVNode)(' prop，可调用 '),(0,r.createElementVNode)('code',null,'sdk.getGold()'),(0,r.createTextVNode)('、 '),(0,r.createElementVNode)('code',null,'sdk.showNotification()'),(0,r.createTextVNode)(' 等安全 API ')],-1))]),(0,r.createCommentVNode)(' 代码验证结果 '),s[e.id]?((0,r.openBlock)(),(0,r.createElementBlock)('div',zc,[s[e.id].isValid?((0,r.openBlock)(),(0,r.createElementBlock)('div',Fc,[(0,r.createVNode)(E,{name:'check',size:'1em'}),t[13]||(t[13]=(0,r.createTextVNode)(' 代码验证通过 ',-1)),s[e.id].warnings?.length?((0,r.openBlock)(),(0,r.createElementBlock)('span',Wc,' ('+(0,r.toDisplayString)(s[e.id].warnings.length)+' 个警告) ',1)):(0,r.createCommentVNode)('v-if',!0)])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Gc,[(0,r.createVNode)(E,{name:'alert',size:'1em'}),t[14]||(t[14]=(0,r.createTextVNode)(' 代码存在问题 ',-1)),(0,r.createElementVNode)('ul',null,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s[e.id].errors,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('li',{key:t},(0,r.toDisplayString)(e),1))),128))])])),s[e.id].warnings?.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',jc,[(0,r.createElementVNode)('ul',null,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s[e.id].warnings,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('li',{key:t},'⚠️ '+(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)('v-if',!0)])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 操作按钮 '),(0,r.createElementVNode)('div',Jc,[(0,r.createElementVNode)('button',{class:'validate-btn',onClick:t=>function(e){if(!e.vueCode.trim())return void l('请先输入组件代码','warning');const t=vo(e.vueCode);s[e.id]=t,t.isValid?l('代码验证通过！','success'):l('代码存在安全问题，请查看详情','error')}(e)},[(0,r.createVNode)(E,{name:'check',size:'0.8em'}),t[15]||(t[15]=(0,r.createTextVNode)(' 验证代码 ',-1))],8,Yc),(0,r.createElementVNode)('button',{class:'preview-btn',onClick:t=>N(e)},[(0,r.createVNode)(E,{name:'play',size:'0.8em'}),t[16]||(t[16]=(0,r.createTextVNode)(' 预览组件 ',-1))],8,Hc)])],512),[[r.vShow,c.value===e.id]])],2))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Xc,[(0,r.createVNode)(E,{name:'settings',size:'2em'}),t[17]||(t[17]=(0,r.createElementVNode)('p',null,'暂无自定义组件',-1)),(0,r.createElementVNode)('button',{class:'add-first-btn',onClick:k},'添加第一个组件')])),(0,r.createCommentVNode)(' 预览弹窗 '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'body'},[d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'preview-modal',onClick:(0,r.withModifiers)(V,['self'])},[(0,r.createElementVNode)('div',Kc,[(0,r.createElementVNode)('div',qc,[(0,r.createElementVNode)('h3',null,'组件预览: '+(0,r.toDisplayString)(u.value?.name),1),(0,r.createElementVNode)('button',{class:'close-btn',onClick:V},'×')]),(0,r.createElementVNode)('div',Qc,[u.value?((0,r.openBlock)(),(0,r.createBlock)(Vo,{key:0,'user-code':u.value.vueCode,'component-id':u.value.id,'game-state':h.value,'preview-variables':v.value.value,onLoaded:b,onError:w,onNotification:C},null,8,['user-code','component-id','game-state','preview-variables'])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',Zc,[t[18]||(t[18]=(0,r.createElementVNode)('div',{class:'console-header'},'控制台输出',-1)),(0,r.createElementVNode)('div',es,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(m.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:(0,r.normalizeClass)(['log-entry',e.type])},' ['+(0,r.toDisplayString)(e.type)+'] '+(0,r.toDisplayString)(e.message),3))),128)),m.value.length?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',ts,'暂无日志'))])])])])):(0,r.createCommentVNode)('v-if',!0)])),(0,r.createCommentVNode)(' TempMessage '),(0,r.createVNode)(M,{visible:a.value,'onUpdate:visible':t[2]||(t[2]=e=>a.value=e),message:n.value,type:o.value},null,8,['visible','message','type'])]))}}),ns=(0,p.A)(as,[['__scopeId','data-v-003f54b4']]),os=ns,ls={class:'node-row'},rs={key:1,class:'toggle-placeholder'},is={key:2,class:'dynamic-badge'},cs={key:3,class:'key-name'},ss={key:4,class:'comment'},ds={class:'node-actions'},us={key:0,class:'node-children'},ms={class:'edit-modal'},ps={class:'edit-field'},vs={class:'edit-field checkbox-field'},gs=['disabled'],fs={key:0,class:'hint'},ys={key:1,class:'hint warning'},hs={class:'edit-field'},ks={class:'edit-field checkbox-field'},Ns=['disabled'],Es={key:0,class:'hint'},Vs={key:0,class:'edit-field'},bs={class:'edit-field'},ws=(0,r.defineComponent)({__name:'VariableNode',props:{node:{},depth:{}},emits:['add-child','remove','update'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(!0),l=(0,r.ref)(!1),i=(0,r.computed)(()=>a.node.children&&a.node.children.length>0),c=(0,r.reactive)({key:'',isDynamic:!1,valueType:'String',hasDefault:!1,defaultString:'',defaultInt:0,defaultBoolean:!1,defaultStringList:'',comment:''});function s(){c.key=a.node.key,c.isDynamic=a.node.isDynamic,c.valueType=a.node.valueType,c.comment=a.node.comment||'';const e=a.node.defaultValue;c.hasDefault=void 0!==e,c.defaultString='string'==typeof e?e:'',c.defaultInt='number'==typeof e&&Number.isFinite(e)?Math.trunc(e):0,c.defaultBoolean='boolean'==typeof e&&e,c.defaultStringList=Array.isArray(e)?e.join(','):'',l.value=!0}function d(){l.value=!1}function u(){let e;if(c.hasDefault&&!i.value)if('String'===c.valueType)e=c.defaultString;else if('Int'===c.valueType)e='number'==typeof c.defaultInt?Math.trunc(c.defaultInt):0;else if('Boolean'===c.valueType)e=!!c.defaultBoolean;else if('StringList'===c.valueType){e=String(c.defaultStringList).split(',').map(e=>e.trim()).filter(Boolean)}n('update',{id:a.node.id,key:c.key,isDynamic:c.isDynamic,valueType:c.valueType,defaultValue:e,comment:c.comment||void 0,children:a.node.children}),l.value=!1}return(e,t)=>{const a=(0,r.resolveComponent)('VariableNode',!0);return(0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'variable-node',style:(0,r.normalizeStyle)({'--depth':e.depth})},[(0,r.createElementVNode)('div',ls,[(0,r.createCommentVNode)(' Expand/Collapse Toggle '),i.value||e.node.isDynamic?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'toggle-btn',onClick:t[0]||(t[0]=e=>o.value=!o.value)},[(0,r.createVNode)(E,{name:o.value?'chevron-down':'chevron-right',size:'0.8em'},null,8,['name'])])):((0,r.openBlock)(),(0,r.createElementBlock)('span',rs)),(0,r.createCommentVNode)(' Dynamic Badge '),e.node.isDynamic?((0,r.openBlock)(),(0,r.createElementBlock)('span',is,'<'+(0,r.toDisplayString)(e.node.key)+'>',1)):((0,r.openBlock)(),(0,r.createElementBlock)('span',cs,(0,r.toDisplayString)(e.node.key),1)),(0,r.createCommentVNode)(' Type Badge '),(0,r.createElementVNode)('span',{class:(0,r.normalizeClass)(['type-badge',e.node.valueType.toLowerCase()])},(0,r.toDisplayString)(e.node.valueType),3),(0,r.createCommentVNode)(' Comment '),e.node.comment?((0,r.openBlock)(),(0,r.createElementBlock)('span',ss,'// '+(0,r.toDisplayString)(e.node.comment),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Actions '),(0,r.createElementVNode)('div',ds,[(0,r.createElementVNode)('button',{class:'action-btn edit',onClick:s,title:'编辑'},[(0,r.createVNode)(E,{name:'edit',size:'0.75em'})]),(0,r.createElementVNode)('button',{class:'action-btn add',onClick:t[1]||(t[1]=t=>e.$emit('add-child',e.node.id)),title:'添加子节点'},[(0,r.createVNode)(E,{name:'plus',size:'0.75em'})]),(0,r.createElementVNode)('button',{class:'action-btn delete',onClick:t[2]||(t[2]=t=>e.$emit('remove',e.node.id)),title:'删除'},[(0,r.createVNode)(E,{name:'delete',size:'0.75em'})])])]),(0,r.createCommentVNode)(' Children '),o.value&&i.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',us,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.node.children,n=>((0,r.openBlock)(),(0,r.createBlock)(a,{key:n.id,node:n,depth:e.depth+1,onAddChild:t[3]||(t[3]=t=>e.$emit('add-child',t)),onRemove:t[4]||(t[4]=t=>e.$emit('remove',t)),onUpdate:t[5]||(t[5]=t=>e.$emit('update',t))},null,8,['node','depth']))),128))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Edit Modal '),l.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:1,class:'edit-overlay',onClick:(0,r.withModifiers)(d,['self'])},[(0,r.createElementVNode)('div',ms,[t[23]||(t[23]=(0,r.createElementVNode)('h4',null,'编辑节点',-1)),(0,r.createElementVNode)('div',ps,[t[15]||(t[15]=(0,r.createElementVNode)('label',null,'键名 (Key)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[6]||(t[6]=e=>c.key=e),type:'text',placeholder:'变量键名'},null,512),[[r.vModelText,c.key]])]),(0,r.createElementVNode)('div',vs,[(0,r.createElementVNode)('label',null,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[7]||(t[7]=e=>c.isDynamic=e),disabled:0===e.depth},null,8,gs),[[r.vModelCheckbox,c.isDynamic]]),t[16]||(t[16]=(0,r.createTextVNode)(' Dynamic (动态键，如 <characters>) ',-1))]),c.isDynamic?((0,r.openBlock)(),(0,r.createElementBlock)('span',fs,'Dynamic节点必须有子节点')):(0,r.createCommentVNode)('v-if',!0),0===e.depth?((0,r.openBlock)(),(0,r.createElementBlock)('span',ys,'根节点不能设置为 Dynamic')):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',hs,[t[18]||(t[18]=(0,r.createElementVNode)('label',null,'值类型 (Value Type)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[8]||(t[8]=e=>c.valueType=e)},[...t[17]||(t[17]=[(0,r.createElementVNode)('option',{value:'String'},'String (文本)',-1),(0,r.createElementVNode)('option',{value:'Int'},'Int (整数)',-1),(0,r.createElementVNode)('option',{value:'Boolean'},'Boolean (布尔)',-1),(0,r.createElementVNode)('option',{value:'StringList'},'StringList (["String"])',-1)])],512),[[r.vModelSelect,c.valueType]])]),(0,r.createElementVNode)('div',ks,[(0,r.createElementVNode)('label',null,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[9]||(t[9]=e=>c.hasDefault=e),disabled:i.value},null,8,Ns),[[r.vModelCheckbox,c.hasDefault]]),t[19]||(t[19]=(0,r.createTextVNode)(' 默认值 (Default Value) ',-1))]),i.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',Es,'当前节点有子节点：默认值只对叶子节点生效')):(0,r.createCommentVNode)('v-if',!0)]),c.hasDefault&&!i.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Vs,[t[21]||(t[21]=(0,r.createElementVNode)('label',null,'默认值内容',-1)),'String'===c.valueType?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:0,'onUpdate:modelValue':t[10]||(t[10]=e=>c.defaultString=e),type:'text',placeholder:'默认文本（可为空）'},null,512)),[[r.vModelText,c.defaultString]]):'Int'===c.valueType?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[11]||(t[11]=e=>c.defaultInt=e),type:'number',placeholder:'0'},null,512)),[[r.vModelText,c.defaultInt,void 0,{number:!0}]]):'Boolean'===c.valueType?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('select',{key:2,'onUpdate:modelValue':t[12]||(t[12]=e=>c.defaultBoolean=e)},[...t[20]||(t[20]=[(0,r.createElementVNode)('option',{value:!0},'true',-1),(0,r.createElementVNode)('option',{value:!1},'false',-1)])],512)),[[r.vModelSelect,c.defaultBoolean]]):'StringList'===c.valueType?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:3,'onUpdate:modelValue':t[13]||(t[13]=e=>c.defaultStringList=e),type:'text',placeholder:'用英文逗号分隔，例如：开心,悲伤'},null,512)),[[r.vModelText,c.defaultStringList]]):(0,r.createCommentVNode)('v-if',!0)])):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',bs,[t[22]||(t[22]=(0,r.createElementVNode)('label',null,'描述 (Comment)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[14]||(t[14]=e=>c.comment=e),type:'text',placeholder:'变量用途说明'},null,512),[[r.vModelText,c.comment]])]),(0,r.createElementVNode)('div',{class:'edit-actions'},[(0,r.createElementVNode)('button',{class:'cancel-btn',onClick:d},'取消'),(0,r.createElementVNode)('button',{class:'save-btn',onClick:u},'保存')])])])):(0,r.createCommentVNode)('v-if',!0)],4)}}}),Cs=(0,p.A)(ws,[['__scopeId','data-v-f020a9ba']]),Ss=Cs,Bs={class:'editor-section variables-editor'},xs={class:'section-title'},_s={class:'title-actions'},Is={class:'info-hint'},Ts={key:0,class:'variable-tree'},As={key:1,class:'empty-hint'},Ms={class:'schema-preview'},Ds={class:'preview-header'},Ps={key:0,class:'error-message'},Os={class:'schema-code'},Rs=(0,r.defineComponent)({__name:'VariablesEditor',props:{eventPack:{}},setup(e){const t=e,a=(0,r.ref)(!1),n=(0,r.ref)(''),o=(0,r.ref)('info');function l(e,t='info'){n.value=e,o.value=t,a.value=!0}const i=(0,r.ref)([]);(0,r.onMounted)(()=>{if(t.eventPack.variableTree&&t.eventPack.variableTree.length>0){let e=JSON.parse(JSON.stringify(t.eventPack.variableTree));e=function(e){const t=e.findIndex(e=>'characters'===e.key&&e.isDynamic);if(-1!==t){const a={id:'characters',key:'characters',isDynamic:!1,valueType:'String',children:[{id:'characters.<name>',key:'name',isDynamic:!0,valueType:'String',children:e[t].children}]},n=[...e];return n[t]=a,console.log('[VariablesEditor] Migrated old format: <characters> -> characters.<name>'),n}return e}(e),i.value=e}else{const e=Va(Qt);i.value=e}}),(0,r.watch)(i,e=>{t.eventPack.variableTree=JSON.parse(JSON.stringify(e))},{deep:!0});const c=(0,r.ref)(''),s=(0,r.computed)(()=>{try{const e=ka(i.value);return c.value='',ba(e)}catch(e){return c.value=e.message||String(e),'{}'}});function d(){return'var_'+Date.now()+'_'+Math.random().toString(36).substring(2,8)}function u(){const e={id:d(),key:'newVariable',isDynamic:!1,valueType:'String',defaultValue:void 0,comment:''};i.value.push(e),l('根节点已添加（根节点不能设置为 Dynamic）','info')}function m(e){const t={id:d(),key:'child',isDynamic:!1,valueType:'String',defaultValue:void 0,comment:''};!function a(n,o){for(const l of n){const n=l.isDynamic?`<${l.key}>`:l.key,r=o?`${o}.${n}`:n;if(l.id===e)return l.children||(l.children=[]),l.children.push(t),!0;if(l.children&&a(l.children,r))return!0}return!1}(i.value,'')}function p(e){const t=function t(a,n){for(const o of a){const a=o.isDynamic?`<${o.key}>`:o.key,l=n?`${n}.${a}`:a;if(o.id===e)return{node:o,path:l};if(o.children){const e=t(o.children,l);if(e)return e}}return null}(i.value,'');if(t){const e=t.node,a=t.path,n='string'==typeof e.id&&e.id.startsWith('var_'),o=ma(e.id),r=!n&&!!a&&ma(a);if(o||r)return void l('Cannot remove default variable node (This is a fixed schema path).','warning')}!function t(a){const n=a.findIndex(t=>t.id===e);if(-1!==n)return a.splice(n,1),!0;for(const e of a)if(e.children&&t(e.children))return!0;return!1}(i.value)}function v(e){!function t(a,n=!1){for(let o=0;o<a.length;o++){if(a[o].id===e.id){if(n&&e.isDynamic)return l('根节点不能设置为 Dynamic（动态键只能在嵌套结构中使用）','warning'),!1;const t=a[o].children;return a[o]={...e,children:t},!0}const r=a[o].children;if(r&&t(r,!1))return!0}return!1}(i.value,!0)}async function g(){try{await navigator.clipboard.writeText(s.value)}catch(e){console.error('Failed to copy:',e)}}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Bs,[(0,r.createElementVNode)('div',xs,[t[2]||(t[2]=(0,r.createElementVNode)('h4',null,'变量结构 (Variable Schema)',-1)),(0,r.createElementVNode)('div',_s,[(0,r.createElementVNode)('button',{class:'add-btn',onClick:u},[(0,r.createVNode)(E,{name:'plus',size:'0.75em'}),t[1]||(t[1]=(0,r.createTextVNode)(' 添加根节点',-1))])])]),(0,r.createElementVNode)('div',Is,[(0,r.createVNode)(E,{name:'info',size:'0.9em'}),t[3]||(t[3]=(0,r.createElementVNode)('span',null,[(0,r.createTextVNode)(' 树状结构定义变量。勾选 '),(0,r.createElementVNode)('strong',null,'Dynamic'),(0,r.createTextVNode)(' 表示动态键（如角色名），Dynamic节点必须有子节点。 值类型: Int, String, Boolean, StringList (["String"]) ')],-1))]),(0,r.createCommentVNode)(' Tree View '),i.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ts,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,e=>((0,r.openBlock)(),(0,r.createBlock)(Ss,{key:e.id,node:e,depth:0,onAddChild:m,onRemove:p,onUpdate:v},null,8,['node']))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',As,'暂无自定义变量，点击上方"添加根节点"开始构建变量结构')),(0,r.createCommentVNode)(' Preview '),(0,r.createElementVNode)('div',Ms,[(0,r.createElementVNode)('div',Ds,[t[5]||(t[5]=(0,r.createElementVNode)('h5',null,'Schema 预览 (JSON)',-1)),(0,r.createElementVNode)('button',{class:'copy-btn',onClick:g},[(0,r.createVNode)(E,{name:'copy',size:'0.8em'}),t[4]||(t[4]=(0,r.createTextVNode)(' 复制',-1))])]),c.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ps,(0,r.toDisplayString)(c.value),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('pre',Os,(0,r.toDisplayString)(s.value),1)]),(0,r.createCommentVNode)(' Temporary Message '),(0,r.createVNode)(M,{visible:a.value,'onUpdate:visible':t[0]||(t[0]=e=>a.value=e),message:n.value,type:o.value},null,8,['visible','message','type'])]))}}),Ls=(0,p.A)(Rs,[['__scopeId','data-v-3c13ed4d']]),$s=Ls,Us={class:'editor-section'},zs={class:'sub-section'},Fs={class:'section-title'},Ws={key:0,class:'visual-grid'},Gs=['onClick'],js=['src'],Js={key:1,class:'no-image'},Ys={class:'image-meta'},Hs=['onUpdate:modelValue'],Xs={class:'diff-row'},Ks=['onUpdate:modelValue'],qs=['onUpdate:modelValue'],Qs={class:'fallback-row'},Zs={class:'fallback-check pretty-check'},ed=['checked','onChange'],td={key:0,class:'hint-badge'},ad={class:'url-input-group'},nd=['onUpdate:modelValue'],od=['onClick'],ld=['onClick'],rd={key:1,class:'empty-hint'},id={class:'sub-section',style:{'margin-top':'2em'}},cd={class:'section-title'},sd={key:0,class:'visual-grid'},dd=['onClick'],ud=['src'],md={key:1,class:'no-image'},pd={class:'image-meta'},vd={class:'url-input-group'},gd=['onUpdate:modelValue'],fd=['onClick'],yd=['onUpdate:modelValue'],hd={class:'fallback-row'},kd={class:'fallback-check pretty-check'},Nd=['checked','onChange'],Ed={key:0,class:'hint-badge'},Vd={key:1,class:'hint-badge'},bd=['onClick'],wd={key:1,class:'empty-hint'},Cd=(0,r.defineComponent)({__name:'VisualsEditor',props:{eventPack:{}},emits:['preview-char','preview-bg'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(null),l=(0,r.ref)(null);function i(){a.eventPack.characterImages.push({id:Nl(),characterName:'',expression:'Default',outfit:'',isFallback:!1,imageUrl:''})}function c(e){return((0,Ca.V_)(e)[0]||'').trim().toLowerCase()}function s(){a.eventPack.backgroundImages.push({id:Nl(),imageUrl:'',isResident:!1})}function d(e,t){const o=('char'===t?a.eventPack.characterImages:a.eventPack.backgroundImages)[e];o.imageUrl?n('char'===t?'preview-char':'preview-bg',o):u(e,t)}function u(e,t){l.value={index:e,type:t},o.value?.click()}async function m(e){const t=e.target,n=t.files?.[0];if(n&&l.value)try{const e=await async function(e){return new Promise((t,a)=>{const n=new FileReader;n.onload=e=>{const n=new Image;n.onload=()=>{const e=document.createElement('canvas'),o=e.getContext('2d');let l=n.width,r=n.height;const i=1600;if((l>i||r>i)&&(l>r?(r=Math.round(r*i/l),l=i):(l=Math.round(l*i/r),r=i)),e.width=l,e.height=r,o){o.drawImage(n,0,0,l,r);const a=e.toDataURL('image/webp',.85);t(a)}else a(new Error('Failed to get canvas context'))},n.onerror=a,n.src=e.target?.result},n.onerror=a,n.readAsDataURL(e)})}(n),{index:t,type:o}=l.value;if('char'===o){const n=a.eventPack.characterImages[t];n&&(n.imageUrl=e)}else{const n=a.eventPack.backgroundImages[t];n&&(n.imageUrl=e)}}catch(e){console.error('Image processing failed:',e),alert('图片处理失败，请重试')}finally{l.value=null,o.value&&(o.value.value='')}}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Us,[(0,r.createCommentVNode)(' Character Images '),(0,r.createElementVNode)('div',zs,[(0,r.createElementVNode)('div',Fs,[t[1]||(t[1]=(0,r.createElementVNode)('h4',null,'角色立绘 (Character Images)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:i},[(0,r.createVNode)(E,{name:'plus',size:'0.75em'}),t[0]||(t[0]=(0,r.createTextVNode)(' 添加',-1))])]),e.eventPack.characterImages.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ws,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.characterImages,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'char-image-item'},[(0,r.createCommentVNode)(' Image Preview / Uploader '),(0,r.createElementVNode)('div',{class:'image-preview char-preview',onClick:e=>d(n,'char')},[e.imageUrl?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.imageUrl},null,8,js)):((0,r.openBlock)(),(0,r.createElementBlock)('div',Js,[(0,r.createVNode)(E,{name:'upload-cloud',size:'2em'}),t[2]||(t[2]=(0,r.createElementVNode)('span',null,'点击上传',-1))]))],8,Gs),(0,r.createElementVNode)('div',Ys,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.characterName=t,placeholder:'角色名 (可用逗号分隔别名)'},null,8,Hs),[[r.vModelText,e.characterName]]),(0,r.createElementVNode)('div',Xs,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.expression=t,placeholder:'表情差分 (例如: 开心)'},null,8,Ks),[[r.vModelText,e.expression]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.outfit=t,placeholder:'服装差分 (例如: 校服)'},null,8,qs),[[r.vModelText,e.outfit]])]),(0,r.createElementVNode)('div',Qs,[(0,r.createElementVNode)('label',Zs,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!!e.isFallback,onChange:e=>function(e,t){const n=a.eventPack.characterImages[e];if(!n)return;if(!t)return void(n.isFallback=!1);const o=c(n.characterName);for(let t=0;t<a.eventPack.characterImages.length;t++){if(t===e)continue;const n=a.eventPack.characterImages[t];n&&c(n.characterName)===o&&(n.isFallback=!1)}n.isFallback=!0}(n,e.target.checked)},null,40,ed),t[3]||(t[3]=(0,r.createElementVNode)('span',{class:'check-ui','aria-hidden':'true'},null,-1)),t[4]||(t[4]=(0,r.createTextVNode)(' 常驻兜底立绘 ',-1))]),e.isFallback?((0,r.openBlock)(),(0,r.createElementBlock)('div',td,[(0,r.createVNode)(E,{name:'image',size:'0.8em'}),t[5]||(t[5]=(0,r.createTextVNode)(' 匹配不到表情/服装时使用 ',-1))])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',ad,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.imageUrl=t,placeholder:'URL...'},null,8,nd),[[r.vModelText,e.imageUrl]]),(0,r.createElementVNode)('button',{class:'icon-btn',title:'上传图片',onClick:e=>u(n,'char')},[(0,r.createVNode)(E,{name:'upload-cloud',size:'1em'})],8,od)]),(0,r.createElementVNode)('button',{class:'delete-btn full',onClick:e=>function(e){a.eventPack.characterImages.splice(e,1)}(n)},'删除',8,ld)])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',rd,'暂无角色图片'))]),(0,r.createCommentVNode)(' Background Images '),(0,r.createElementVNode)('div',id,[(0,r.createElementVNode)('div',cd,[t[7]||(t[7]=(0,r.createElementVNode)('h4',null,'背景图片 (Backgrounds)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:s},[(0,r.createVNode)(E,{name:'plus',size:'0.75em'}),t[6]||(t[6]=(0,r.createTextVNode)(' 添加',-1))])]),e.eventPack.backgroundImages.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',sd,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.backgroundImages,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'bg-image-item'},[(0,r.createCommentVNode)(' Image Preview / Uploader '),(0,r.createElementVNode)('div',{class:'image-preview bg-preview',onClick:e=>d(n,'bg')},[e.imageUrl?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.imageUrl},null,8,ud)):((0,r.openBlock)(),(0,r.createElementBlock)('div',md,[(0,r.createVNode)(E,{name:'upload-cloud',size:'2em'}),t[8]||(t[8]=(0,r.createElementVNode)('span',null,'点击上传',-1))]))],8,dd),(0,r.createElementVNode)('div',pd,[(0,r.createElementVNode)('div',vd,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.imageUrl=t,placeholder:'URL...'},null,8,gd),[[r.vModelText,e.imageUrl]]),(0,r.createElementVNode)('button',{class:'icon-btn',title:'上传图片',onClick:e=>u(n,'bg')},[(0,r.createVNode)(E,{name:'upload-cloud',size:'1em'})],8,fd)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.linkedVariable=t,placeholder:'触发条件 (留空为常驻/轮换，逗号分隔)'},null,8,yd),[[r.vModelText,e.linkedVariable]]),(0,r.createElementVNode)('div',hd,[(0,r.createElementVNode)('label',kd,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!!e.isResident,onChange:e=>function(e,t){const n=a.eventPack.backgroundImages[e];n&&(n.isResident=!!t)}(n,e.target.checked)},null,40,Nd),t[9]||(t[9]=(0,r.createElementVNode)('span',{class:'check-ui','aria-hidden':'true'},null,-1)),t[10]||(t[10]=(0,r.createTextVNode)(' 常驻兜底背景（可多选） ',-1))]),e.isResident?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ed,[(0,r.createVNode)(E,{name:'image',size:'0.8em'}),t[11]||(t[11]=(0,r.createTextVNode)(' 未匹配到地点时也可作为默认背景 ',-1))])):e.linkedVariable?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',Vd,[(0,r.createVNode)(E,{name:'image',size:'0.8em'}),t[12]||(t[12]=(0,r.createTextVNode)(' 留空触发条件：默认参与常驻/轮换 ',-1))]))]),(0,r.createElementVNode)('button',{class:'delete-btn full',onClick:e=>function(e){a.eventPack.backgroundImages.splice(e,1)}(n)},'删除',8,bd)])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',wd,'暂无背景图片'))]),(0,r.createCommentVNode)(' Hidden File Input '),(0,r.createElementVNode)('input',{type:'file',ref_key:'fileInputRef',ref:o,accept:'image/*',style:{display:'none'},onChange:m},null,544)]))}}),Sd=(0,p.A)(Cd,[['__scopeId','data-v-68371988']]),Bd={class:'editor-section'},xd={class:'world-settings-grid'},_d={class:'world-panel worldview'},Id={class:'panel-header worldview'},Td={class:'panel-content'},Ad={key:0,class:'world-items'},Md={class:'card-header'},Dd=['onUpdate:modelValue'],Pd=['onClick'],Od=['onUpdate:modelValue'],Rd={key:1,class:'empty-panel'},Ld={class:'world-panel power'},$d={class:'panel-header power'},Ud={class:'panel-content'},zd={key:0,class:'world-items'},Fd={class:'card-header'},Wd=['onUpdate:modelValue'],Gd=['onClick'],jd=['onUpdate:modelValue'],Jd={key:1,class:'empty-panel'},Yd=(0,r.defineComponent)({__name:'WorldSettingsEditor',props:{eventPack:{}},setup(e){const t=e;function a(){t.eventPack.worldviews.push({id:Nl(),name:'',content:''})}function n(){t.eventPack.powerSystems.push({id:Nl(),name:'',content:''})}return(e,o)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Bd,[(0,r.createElementVNode)('div',xd,[(0,r.createCommentVNode)(' Worldview '),(0,r.createElementVNode)('div',_d,[(0,r.createElementVNode)('div',Id,[(0,r.createElementVNode)('h4',null,[(0,r.createVNode)(E,{name:'world',size:'1em'}),o[0]||(o[0]=(0,r.createTextVNode)(' 世界观 (Worldview)',-1))]),(0,r.createElementVNode)('button',{class:'add-mini-btn',onClick:a},'+')]),(0,r.createElementVNode)('div',Td,[e.eventPack.worldviews.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ad,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.worldviews,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'world-card'},[(0,r.createElementVNode)('div',Md,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'card-title-input',placeholder:'条目名称'},null,8,Dd),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'mini-delete',onClick:e=>function(e){t.eventPack.worldviews.splice(e,1)}(a)},'×',8,Pd)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'card-content',placeholder:'详细描述...'},null,8,Od),[[r.vModelText,e.content]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Rd,'暂无世界观条目'))])]),(0,r.createCommentVNode)(' Power System '),(0,r.createElementVNode)('div',Ld,[(0,r.createElementVNode)('div',$d,[(0,r.createElementVNode)('h4',null,[(0,r.createVNode)(E,{name:'lightning',size:'1em'}),o[1]||(o[1]=(0,r.createTextVNode)(' 力量体系 (Power System)',-1))]),(0,r.createElementVNode)('button',{class:'add-mini-btn',onClick:n},'+')]),(0,r.createElementVNode)('div',Ud,[e.eventPack.powerSystems.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',zd,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.powerSystems,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'world-card'},[(0,r.createElementVNode)('div',Fd,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'card-title-input',placeholder:'体系名称'},null,8,Wd),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'mini-delete',onClick:e=>function(e){t.eventPack.powerSystems.splice(e,1)}(a)},'×',8,Gd)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'card-content',placeholder:'规则描述...'},null,8,jd),[[r.vModelText,e.content]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Jd,'暂无力量体系'))])])])]))}}),Hd=(0,p.A)(Yd,[['__scopeId','data-v-7e9125f9']]),Xd={class:'event-pack-editor'},Kd={class:'editor-sidebar'},qd={class:'sidebar-group'},Qd={class:'count-badge'},Zd={class:'sidebar-group'},eu={class:'count-badge'},tu={class:'count-badge'},au={class:'count-badge'},nu={class:'sidebar-group'},ou={class:'count-badge'},lu={class:'sidebar-group'},ru={class:'editor-main'},iu=(0,r.defineComponent)({__name:'EventPackEditor',props:{initialData:{},customerVariables:{},characterPacks:{},disableAutosave:{type:Boolean}},emits:['preview-char','preview-bg','preview-widget','auto-save'],setup(e,{expose:t,emit:a}){const n=(0,r.ref)('METADATA'),o=e,l=a,i=(0,r.ref)(null),c=(0,r.ref)(!1),s=(0,r.ref)('');function d(){i.value?.click()}function u(e){const t=e.target,a=t.files?.[0];if(a){const e=new FileReader;e.onload=e=>{s.value=e.target?.result,c.value=!0,t.value=''},e.readAsDataURL(a)}}function m(e){p.value.coverImage=e,c.value=!1}const p=(0,r.ref)({id:'',name:'',description:'',coverImage:'',randomEvents:[],plotEvents:[],conditionalEvents:[],worldviews:[],powerSystems:[],specialRules:[],extraWorldBooks:[],variables:[],widgetStyles:[],characterImages:[],backgroundImages:[],startPoints:[],linkedCharacterPackIds:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}),v=(0,r.ref)(!1),g=(0,r.ref)(!1),f=(0,r.ref)(null);function y(){p.value.id||(p.value.id=Nl()),setTimeout(()=>{v.value=!0},500)}function h(){f.value&&(p.value=f.value),g.value=!1,y()}function k(){wl().finally(()=>{g.value=!1,y()})}(0,r.onMounted)(async()=>{if(o.initialData){const e=JSON.parse(JSON.stringify(o.initialData));e.startPoints||(e.startPoints=[]),e.randomEvents||(e.randomEvents=[]),e.plotEvents||(e.plotEvents=[]),e.conditionalEvents||(e.conditionalEvents=[]),e.worldviews||(e.worldviews=[]),e.powerSystems||(e.powerSystems=[]),e.specialRules||(e.specialRules=[]),e.extraWorldBooks||(e.extraWorldBooks=[]),e.variables||(e.variables=[]),e.widgetStyles||(e.widgetStyles=[]),e.characterImages||(e.characterImages=[]),e.backgroundImages||(e.backgroundImages=[]),e.linkedCharacterPackIds||(e.linkedCharacterPackIds=[]),p.value=e,y()}else{if(o.disableAutosave)return void y();const e=await async function(){try{return await pe.idbService.getRuntimeAsset(El)??null}catch{return null}}();let t=!1;e&&(e&&(e.name||e.randomEvents?.length||e.plotEvents?.length)?(f.value=e,t=!0,g.value=!0):await wl().catch(()=>{})),t||y()}}),(0,r.watch)(()=>p.value,e=>{if(v.value&&!o.disableAutosave){try{Cl(e)}catch(e){console.warn('[EventPackEditor] Autosave failed:',e)}l('auto-save','已自动保存 '+(new Date).toLocaleTimeString())}},{deep:!0});const N=(0,r.computed)(()=>[...o.customerVariables||[],...p.value.variables]);function V(e){l('preview-char',e)}function b(e){l('preview-bg',e)}return t({eventPack:p,getEventPack:()=>{try{return JSON.parse(JSON.stringify(p.value))}catch{return p.value}}}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Xd,[(0,r.createCommentVNode)(' Sidebar Navigation '),(0,r.createElementVNode)('div',Kd,[(0,r.createElementVNode)('div',qd,[t[15]||(t[15]=(0,r.createElementVNode)('h3',null,'基本信息',-1)),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'METADATA'===n.value}),onClick:t[0]||(t[0]=e=>n.value='METADATA')},[(0,r.createVNode)(E,{name:'edit',size:'0.9em'}),t[13]||(t[13]=(0,r.createTextVNode)(' 元数据 & 封面 ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'START_POINTS'===n.value}),onClick:t[1]||(t[1]=e=>n.value='START_POINTS')},[(0,r.createVNode)(E,{name:'map-pin',size:'0.9em'}),t[14]||(t[14]=(0,r.createTextVNode)(' 开局锚点 ',-1)),(0,r.createElementVNode)('span',Qd,(0,r.toDisplayString)(p.value.startPoints?p.value.startPoints.length:0),1)],2)]),(0,r.createElementVNode)('div',Zd,[t[19]||(t[19]=(0,r.createElementVNode)('h3',null,'事件配置',-1)),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'RANDOM_EVENTS'===n.value}),onClick:t[2]||(t[2]=e=>n.value='RANDOM_EVENTS')},[(0,r.createVNode)(E,{name:'book',size:'0.9em'}),t[16]||(t[16]=(0,r.createTextVNode)(' 随机事件 ',-1)),(0,r.createElementVNode)('span',eu,(0,r.toDisplayString)(p.value.randomEvents.length),1)],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'PLOT_EVENTS'===n.value}),onClick:t[3]||(t[3]=e=>n.value='PLOT_EVENTS')},[(0,r.createVNode)(E,{name:'book',size:'0.9em'}),t[17]||(t[17]=(0,r.createTextVNode)(' 剧情事件 ',-1)),(0,r.createElementVNode)('span',tu,(0,r.toDisplayString)(p.value.plotEvents.length),1)],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'CONDITIONAL_EVENTS'===n.value}),onClick:t[4]||(t[4]=e=>n.value='CONDITIONAL_EVENTS')},[(0,r.createVNode)(E,{name:'book',size:'0.9em'}),t[18]||(t[18]=(0,r.createTextVNode)(' 条件事件 ',-1)),(0,r.createElementVNode)('span',au,(0,r.toDisplayString)(p.value.conditionalEvents.length),1)],2)]),(0,r.createElementVNode)('div',nu,[t[24]||(t[24]=(0,r.createElementVNode)('h3',null,'世界设定',-1)),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'WORLD_SETTINGS'===n.value}),onClick:t[5]||(t[5]=e=>n.value='WORLD_SETTINGS')},[(0,r.createVNode)(E,{name:'world',size:'0.9em'}),t[20]||(t[20]=(0,r.createTextVNode)(' 世界观 & 力量 ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'EXTRA_WORLDBOOKS'===n.value}),onClick:t[6]||(t[6]=e=>n.value='EXTRA_WORLDBOOKS')},[(0,r.createVNode)(E,{name:'book',size:'0.9em'}),t[21]||(t[21]=(0,r.createTextVNode)(' 额外世界书 ',-1)),(0,r.createElementVNode)('span',ou,(0,r.toDisplayString)(p.value.extraWorldBooks.length),1)],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'SPECIAL_RULES'===n.value}),onClick:t[7]||(t[7]=e=>n.value='SPECIAL_RULES')},[(0,r.createVNode)(E,{name:'alert',size:'0.9em'}),t[22]||(t[22]=(0,r.createTextVNode)(' 特殊规则 ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'VARIABLES'===n.value}),onClick:t[8]||(t[8]=e=>n.value='VARIABLES')},[(0,r.createVNode)(E,{name:'code',size:'0.9em'}),t[23]||(t[23]=(0,r.createTextVNode)(' 变量 & 逻辑 ',-1))],2)]),(0,r.createElementVNode)('div',lu,[t[27]||(t[27]=(0,r.createElementVNode)('h3',null,'视觉资源',-1)),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'VISUALS'===n.value}),onClick:t[9]||(t[9]=e=>n.value='VISUALS')},[(0,r.createVNode)(E,{name:'image',size:'0.9em'}),t[25]||(t[25]=(0,r.createTextVNode)(' 角色 & 背景图 ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'WIDGETS'===n.value}),onClick:t[10]||(t[10]=e=>n.value='WIDGETS')},[(0,r.createVNode)(E,{name:'settings',size:'0.9em'}),t[26]||(t[26]=(0,r.createTextVNode)(' UI组件样式 ',-1))],2)])]),(0,r.createCommentVNode)(' Main Content Area '),(0,r.createElementVNode)('div',ru,[(0,r.createCommentVNode)(' Hidden File Input for Image Upload '),(0,r.createElementVNode)('input',{type:'file',ref_key:'fileInput',ref:i,accept:'image/*',style:{display:'none'},onChange:u},null,544),(0,r.createCommentVNode)(' Image Cropper Modal '),c.value?((0,r.openBlock)(),(0,r.createBlock)(Yo,{key:0,'image-url':s.value,'aspect-ratio':16/9,onConfirm:m,onCancel:t[11]||(t[11]=e=>c.value=!1)},null,8,['image-url'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Section Components '),'METADATA'===n.value?((0,r.openBlock)(),(0,r.createBlock)(fi,{key:1,eventPack:p.value,characterPacks:e.characterPacks,onTriggerUpload:d},null,8,['eventPack','characterPacks'])):'START_POINTS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(kc,{key:2,eventPack:p.value},null,8,['eventPack'])):'RANDOM_EVENTS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Fi,{key:3,eventPack:p.value},null,8,['eventPack'])):'PLOT_EVENTS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(xi,{key:4,eventPack:p.value},null,8,['eventPack'])):'CONDITIONAL_EVENTS'===n.value?((0,r.openBlock)(),(0,r.createBlock)($l,{key:5,eventPack:p.value,allVariables:N.value},null,8,['eventPack','allVariables'])):'WORLD_SETTINGS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Hd,{key:6,eventPack:p.value},null,8,['eventPack'])):'EXTRA_WORLDBOOKS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Qr,{key:7,eventPack:p.value},null,8,['eventPack'])):'SPECIAL_RULES'===n.value?((0,r.openBlock)(),(0,r.createBlock)(ac,{key:8,eventPack:p.value},null,8,['eventPack'])):'VARIABLES'===n.value?((0,r.openBlock)(),(0,r.createBlock)($s,{key:9,eventPack:p.value},null,8,['eventPack'])):'VISUALS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Sd,{key:10,eventPack:p.value,onPreviewChar:V,onPreviewBg:b},null,8,['eventPack'])):'WIDGETS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(os,{key:11,eventPack:p.value},null,8,['eventPack'])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createVNode)(me,{visible:g.value,title:'恢复草稿',message:'发现未保存的草稿，是否恢复？点击“取消”将丢弃该草稿。','onUpdate:visible':t[12]||(t[12]=e=>!e&&g.value?k():null),onConfirm:h,onCancel:k},null,8,['visible'])]))}}),cu=(0,p.A)(iu,[['__scopeId','data-v-9062f2fa']]),su={class:'visual-preview'},du={class:'background-layer'},uu=['src'],mu={class:'character-layer'},pu=['src'],vu={class:'hud-layer'},gu={class:'location-pill'},fu={class:'location-text'},yu={class:'location-name'},hu={class:'location-time'},ku={class:'dialogue-wrapper'},Nu={class:'dialogue-box'},Eu={key:0,class:'speaker-name'},Vu={class:'dialogue-content'},bu={class:'preview-info'},wu={key:0,class:'info-badge'},Cu={key:0,class:'diff-name'},Su={key:1,class:'info-badge'},Bu=(0,r.defineComponent)({__name:'VisualPreview',props:{bgImage:{},charImage:{},charName:{},diffName:{},expression:{},outfit:{},location:{},time:{},speakerName:{},dialogueText:{},condition:{},charScale:{default:80},charX:{default:50},charY:{default:0}},setup(e){const t=e,a=(0,r.computed)(()=>({height:`${t.charScale}%`,left:`${t.charX}%`,bottom:`${t.charY}%`,transform:'translateX(-50%)'}));return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',su,[(0,r.createCommentVNode)(' Background Layer '),(0,r.createElementVNode)('div',du,[e.bgImage?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.bgImage,alt:'Background',class:'bg-image'},null,8,uu)):(0,r.createCommentVNode)('v-if',!0),t[0]||(t[0]=(0,r.createElementVNode)('div',{class:'bg-gradient'},null,-1))]),(0,r.createCommentVNode)(' Character Layer '),(0,r.createElementVNode)('div',mu,[(0,r.createVNode)(r.Transition,{name:'fade',appear:''},{default:(0,r.withCtx)(()=>[e.charImage?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.charImage,class:'char-img',style:(0,r.normalizeStyle)(a.value)},null,12,pu)):(0,r.createCommentVNode)('v-if',!0)]),_:1})]),(0,r.createCommentVNode)(' HUD Layer (simplified) '),(0,r.createElementVNode)('div',vu,[(0,r.createElementVNode)('div',gu,[(0,r.createVNode)(E,{name:'location',size:'0.875em'}),(0,r.createElementVNode)('div',fu,[(0,r.createElementVNode)('span',yu,(0,r.toDisplayString)(e.location||'LOCATION'),1),(0,r.createElementVNode)('span',hu,(0,r.toDisplayString)(e.time||'00:00'),1)])])]),(0,r.createCommentVNode)(' Dialogue Layer '),(0,r.createElementVNode)('div',ku,[(0,r.createElementVNode)('div',Nu,[e.speakerName?((0,r.openBlock)(),(0,r.createElementBlock)('div',Eu,(0,r.toDisplayString)(e.speakerName),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',Vu,[(0,r.createElementVNode)('p',null,(0,r.toDisplayString)(e.dialogueText||'预览文本...'),1)])])]),(0,r.createCommentVNode)(' Preview Info Overlay '),(0,r.createElementVNode)('div',bu,[e.charName?((0,r.openBlock)(),(0,r.createElementBlock)('div',wu,[(0,r.createVNode)(E,{name:'user',size:'0.75em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(e.charName)+' ',1),e.expression||e.outfit||e.diffName?((0,r.openBlock)(),(0,r.createElementBlock)('span',Cu,[t[1]||(t[1]=(0,r.createTextVNode)(' / ',-1)),e.expression?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[(0,r.createTextVNode)((0,r.toDisplayString)(e.expression),1)],64)):e.diffName?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createTextVNode)((0,r.toDisplayString)(e.diffName),1)],64)):(0,r.createCommentVNode)('v-if',!0),e.outfit?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createTextVNode)(' · '+(0,r.toDisplayString)(e.outfit),1)],64)):(0,r.createCommentVNode)('v-if',!0)])):(0,r.createCommentVNode)('v-if',!0)])):(0,r.createCommentVNode)('v-if',!0),e.condition?((0,r.openBlock)(),(0,r.createElementBlock)('div',Su,[(0,r.createVNode)(E,{name:'settings',size:'0.75em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(e.condition),1)])):(0,r.createCommentVNode)('v-if',!0)])]))}}),xu=(0,p.A)(Bu,[['__scopeId','data-v-651a8ef6']]),_u={key:0,class:'editor-backdrop'},Iu={class:'workshop-header'},Tu={class:'title-group'},Au={key:0,class:'editor-badge'},Mu={key:'gallery',class:'gallery-view'},Du={class:'gallery-header'},Pu={class:'header-left'},Ou={class:'search-box'},Ru={class:'filter-tabs'},Lu=['onClick'],$u={class:'header-right'},Uu={class:'upload-dropdown'},zu={class:'upload-dropdown'},Fu={key:0,class:'dropdown-menu'},Wu={key:0,class:'autosave-toast'},Gu={key:0,class:'my-works-toolbar'},ju={class:'gallery-grid'},Ju={key:0,class:'empty-state'},Yu={key:2,class:'empty-state'},Hu={key:0},Xu={key:1},Ku={class:'intro-panel'},qu={class:'intro-header'},Qu={class:'intro-title'},Zu={class:'intro-sub'},em={class:'intro-type'},tm={class:'intro-author'},am={class:'intro-content'},nm={key:'event-editor',class:'editor-view'},om={class:'editor-container'},lm={class:'editor-content'},rm={key:'char-editor',class:'editor-view'},im={class:'editor-container'},cm={class:'editor-content'},sm={class:'preview-modal'},dm={class:'widget-preview-modal'},um={class:'widget-preview-header'},mm={class:'widget-preview-body'},pm={class:'widget-preview-vars'},vm={class:'vars-header'},gm={class:'vars-actions'},fm={key:0,class:'vars-error'},ym={class:'widget-preview-render'},hm={key:0,class:'widget-error'},km={class:'widget-preview-console'},Nm={class:'console-logs'},Em={key:0,class:'no-logs'},Vm={class:'upload-header'},bm={class:'upload-stage'},wm={class:'upload-progress'},Cm={key:0,class:'upload-meta'},Sm={class:'upload-actions'},Bm=['disabled'],xm=(0,r.defineComponent)({__name:'Workshop',setup(e){const t=(0,i.useRouter)(),a=(0,r.ref)(!1),n=(0,r.reactive)({w:0,h:0});const o=(0,r.computed)(()=>{if(!a.value)return;const e=n.h;return e?{height:`${e}px`}:void 0}),l=(e=!1)=>{try{if(a.value=function(){if('undefined'==typeof window)return!1;const e=navigator.userAgent||'',t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),a=window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,n=(navigator.maxTouchPoints||0)>0,o=window.innerWidth<=1024;return t||a||n&&o}(),!a.value)return;const t=Math.max(0,Math.floor(window.innerWidth||0)),o=Math.max(0,Math.floor(window.innerHeight||0));if(!t||!o)return;const l=Math.abs(t-(n.w||t))>80;(e||0===n.w||0===n.h||l)&&(n.w=t,n.h=o)}catch{}},c=()=>l(!1),s=()=>l(!0);(0,r.onMounted)(()=>{l(!0),a.value&&(window.addEventListener('resize',c,{passive:!0}),window.addEventListener('orientationchange',s,{passive:!0}))}),(0,r.onBeforeUnmount)(()=>{try{window.removeEventListener('resize',c),window.removeEventListener('orientationchange',s)}catch{}});const d=(0,r.ref)('GALLERY'),u=(0,r.ref)('explore'),m=(0,r.ref)('ALL'),p=(0,r.ref)(''),v=(0,r.ref)(!1),g=(0,r.ref)(null),f=(0,r.ref)('');let y;const h=(0,r.ref)(null);let k=null;function N(){h.value=null,U()}function V(){k&&window.clearTimeout(k),k=null;const e=F();if(!e.isValid||'number'!=typeof e.expiresAt)return;const t=Math.max(0,e.expiresAt-Date.now());k=window.setTimeout(()=>{N(),'my-works'===u.value&&(u.value='downloaded')},t)}function b(){t.push('/')}function w(e){if('my-works'===e&&!W())return Ne('请先在首页登录（7天有效）','warning'),void(u.value='downloaded');u.value=e}const C=(0,r.ref)('idle');async function B(e){if('pending'===C.value)return!1;C.value='pending';(e?.forceReauth??!1)&&(P.clear(),fetch('https://workshop.ab003317.dpdns.org/api/auth/logout',{method:'POST',credentials:'include',headers:{'X-Requested-With':'XMLHttpRequest'}}).catch(()=>{}));const t=(()=>{const e=new Uint32Array(4);return window.crypto.getRandomValues(e),Array.from(e,e=>e.toString(36)).join('')})(),a=(window.screen.width-500)/2,n=(window.screen.height-800)/2,o=`https://discord.com/api/oauth2/authorize?client_id=1456699602181820426&redirect_uri=${encodeURIComponent('https://workshop.ab003317.dpdns.org/api/auth/discord/callback')}&response_type=code&scope=identify&state=${t}`,l=window.open(o,'DiscordLogin',`width=500,height=800,top=${n},left=${a}`);return new Promise(e=>{const a=setInterval(async()=>{try{const n=`https://workshop.ab003317.dpdns.org/api/auth/check?socketId=${t}`,o=await fetch(n,{credentials:'include'});if(!o.ok)return;const r=await o.json();if('success'===r.status){clearInterval(a),C.value='idle';const t=r.data.user||r.data,n=r?.data?.accessToken||r?.data?.token||null;'string'==typeof n&&n.length>0?P.setAccessToken(n):P.setAccessToken(null);const o=t.avatar&&!t.avatar.startsWith('http')?`https://cdn.discordapp.com/avatars/${t.id}/${t.avatar}.png`:t.avatar||'',i={username:t.username,avatar:o,id:t.id};h.value=i,L(i),V();try{l&&!l.closed&&l.close()}catch{}e(!0)}l&&l.closed}catch(e){console.error('[Workshop] login poll error:',e),C.value='error'}},1e3);setTimeout(()=>{clearInterval(a),'pending'===C.value&&(C.value='timeout',Ne('登录超时，请重试','warning')),e(!1)},12e4)})}async function x(e){if(!await B({forceReauth:!0}))return null;try{return await e()}finally{P.clear()}}const I=(0,r.ref)(null),T=(0,r.ref)(null),A=(0,r.ref)(void 0),D=(0,r.ref)(void 0),O=(0,r.ref)(null),R=(0,r.ref)(0),G=(0,r.computed)(()=>`event:${O.value||'new'}:${R.value}`),j=(0,r.computed)(()=>`char:${O.value||'new'}:${R.value}`),J=(0,r.ref)(!1),Y=(0,r.ref)(''),H=(0,r.ref)(''),Q=(0,r.ref)(''),Z=(0,r.ref)(''),ee=(0,r.ref)(''),te=(0,r.ref)(''),ae=(0,r.ref)(''),ne=(0,r.ref)(!1),oe=(0,r.ref)(null),le=(0,r.ref)(0),re=(0,r.ref)([]),ie=(0,r.ref)(''),ce=(0,r.ref)({playerName:'测试玩家',gold:1e3,level:5,customVars:{hp:100,mp:50}}),se=(0,r.ref)(''),de=(0,r.computed)(()=>{const e=(se.value||'').trim();if(!e)return{value:null,error:''};try{const t=JSON.parse(e);return!t||'object'!=typeof t||Array.isArray(t)?{value:null,error:'预览变量必须是 JSON 对象（Object），不能是数组/字符串/数字。'}:{value:t,error:''}}catch(e){return{value:null,error:'预览变量 JSON 解析失败：'+(e?.message||String(e))}}});function ue(){const e=A.value,t=Na(e?.variableTree,{dynamicKeySample:'Example'});return JSON.stringify(t,null,2)}function ve(){const e=A.value;e&&(e.previewVariablesText=se.value)}function ge(){se.value=ue(),ve()}function fe(){ve(),le.value++}const ye=(0,r.ref)(!1),he=(0,r.ref)(''),ke=(0,r.ref)('info');function Ne(e,t='info'){he.value=e,ke.value=t,ye.value=!0}const Ee=(0,r.ref)(!1),Ve=(0,r.ref)('正在上传...'),be=(0,r.ref)(''),we=(0,r.ref)(null),Ce=(0,r.ref)(0),Se=(0,r.ref)(0),Be=(0,r.ref)(!1),xe=(0,r.ref)('取消');let _e=null;function Ie(){Ee.value=!1,Ve.value='正在上传...',be.value='',we.value=null,Ce.value=0,Se.value=0,Be.value=!1,xe.value='取消',_e=null}function Te(){try{_e?.abort()}catch{}}const Ae=(0,r.ref)(!1),Me=(0,r.ref)(''),De=(0,r.ref)(''),Pe=(0,r.ref)(null);function Oe(e,t,a){Me.value=e,De.value=t,Pe.value=a,Ae.value=!0}function Re(){const e=Pe.value;Ae.value=!1,Pe.value=null,e&&queueMicrotask(()=>{try{const t=e();t&&'function'==typeof t.then&&t.then(void 0,e=>{console.error('[Workshop] confirm action failed:',e),Ne('操作失败，请查看控制台日志','error')})}catch(e){console.error('[Workshop] confirm action threw:',e),Ne('操作失败，请查看控制台日志','error')}})}function Le(e){const t=(0,r.toRaw)(e);try{return structuredClone(t)}catch{return JSON.parse(JSON.stringify(t))}}const $e=(0,r.ref)([]),Ue=(0,r.ref)([]),ze=(0,r.ref)(!1),Fe=(0,r.ref)([]),We=(0,r.ref)('idle');function Ge(e){if(!e)return{};try{const t=JSON.parse(e);if(t&&'object'==typeof t&&('EVENT'===t.type||'CHARACTER'===t.type))return{type:t.type,data:t.data}}catch{}return{}}function je(e){const t=Ge(e.code),a=('EVENT'===e.packType||'CHARACTER'===e.packType?e.packType:void 0)||t.type||'EVENT',n=String(e.coverImage||t.data?.coverImage||'').trim();return{id:e._id,type:a,title:e.title,description:e.description||'',author:e.authorName||'Unknown',tags:[],likes:e.likes||0,downloadCount:'number'==typeof e.downloadCount?e.downloadCount:void 0,img:n||'https://picsum.photos/400/250?random='+encodeURIComponent(e._id)}}async function Je(){W()?await x(async()=>{try{Ne('正在获取配额信息...','info');const e=await Xt.getUserUsage(),t=Math.round(e.used/1024/1024*10)/10;Ne(`配额：已用 ${t}MB / ${Math.round(e.max/1024/1024*10)/10}MB（${e.percentage}%）`,'success')}catch(e){console.error(e);const t=e?.response?.status,a=e?.response?.data?.error||e?.response?.data?.message;if(401===t)return void Ne('获取配额失败：认证失败，请重试','warning');Ne('获取配额失败'+(a?'：'+a:''),'error')}}):Ne('请先在首页登录（7天有效）','warning')}const Ye=(0,r.ref)(!1),He=(0,r.ref)(null);function Xe(e){He.value=e,Ye.value=!0}async function Ke(){ze.value=!0;try{const e=await Xt.listPublicItems({page:1,limit:50});Ue.value=e.data||[]}catch(e){const t=e,a=t?.response?.status,n=t?.response?.data?.error||t?.response?.data?.message,o=String(t?.message||'').toLowerCase();if(!a&&('ECONNABORTED'===t?.code||o.includes('timeout')||o.includes('network'))){try{const e=await Xt.listPublicItems({page:1,limit:10},{timeoutMs:3e4});Ue.value=e.data||[],Ne('云端响应较慢：已加载精简列表（10条）','warning')}catch{Ne('云端连接超时/网络中断（可能是服务器暂不可用），请稍后重试','warning')}return}if(console.error('Failed to load cloud workshop items:',e),503===a)return void Ne(`云端服务暂不可用（${n||'503'}），请稍后重试`,'warning');Ne('云端加载失败，请检查网络或稍后重试','warning')}finally{ze.value=!1}}async function qe(){if(!h.value)return Fe.value=[],void(We.value='idle');Fe.value=[],We.value='unauth'}(0,r.onMounted)(async()=>{const e=F();e.isValid&&e.user?(h.value=e.user,V()):N();const t=(await X()).workshop;if(t){if(t.viewMode){const e=t.viewMode;'my-works'!==e||W()?u.value=e:u.value='downloaded'}t.filterType&&(m.value=t.filterType),t.mode&&(d.value=t.mode),'string'==typeof t.searchQuery&&(p.value=t.searchQuery)}const a=localStorage.getItem('downloaded_works');if(a)try{const e=JSON.parse(a);if(Array.isArray(e)){for(const t of e)await pe.idbService.saveWork(t);console.log('Migrated works to IDB'),localStorage.removeItem('downloaded_works')}}catch(e){console.error('Failed to parse downloaded_works:',e)}try{$e.value=await pe.idbService.getAllWorks()}catch(e){console.error('Failed to load works from IDB:',e)}await Ke(),'my-works'===u.value&&await qe()}),(0,r.onBeforeUnmount)(()=>{k&&window.clearTimeout(k),k=null});let Qe=null;function Ze(e){f.value=e,clearTimeout(y),y=window.setTimeout(()=>{f.value=''},2e3)}(0,r.watch)([u,m,d,p],async()=>{Qe&&clearTimeout(Qe),Qe=setTimeout(async()=>{await async function(e){return K({currentPage:'Workshop',workshop:e})}({viewMode:u.value,filterType:m.value,mode:d.value,searchQuery:p.value})},300)}),(0,r.watch)(u,async e=>{'explore'===e&&await Ke(),'my-works'===e&&await qe()});const et=(0,r.computed)(()=>Ue.value.map(je)),tt=(0,r.computed)(()=>Fe.value.map(je)),at=(0,r.computed)(()=>{const e=h.value;return e?Ue.value.filter(t=>String(t.authorId||'')===String(e.id||'')):[]}),nt=(0,r.computed)(()=>at.value.map(je)),ot=(0,r.computed)(()=>tt.value.length?tt.value:'unauth'===We.value?nt.value:[]),lt=(0,r.computed)(()=>{const e=new Map;for(const t of Ue.value)e.set(String(t._id),t);for(const t of Fe.value)e.set(String(t._id),t);return e});function rt(e,t){if(!t)return;const a=String(t).trim();return a?a.startsWith('http://')||a.startsWith('https://')?a:e?`https://cdn.discordapp.com/avatars/${encodeURIComponent(e)}/${encodeURIComponent(a)}.png?size=96`:void 0:void 0}function it(e){if(dt(e)&&h.value?.avatar)return h.value.avatar;const t=lt.value.get(String(e.id));if(!t)return;const a=t;return rt(t.authorId,a.authorAvatarUrl)||rt(t.authorId,a.authorAvatar)||rt(t.authorId,a.authorAvatarHash)||function(e){if(e)try{const t=Number((BigInt(e)>>22n)%6n);if(!Number.isFinite(t)||t<0||t>5)return;return`https://cdn.discordapp.com/embed/avatars/${t}.png`}catch{return}}(t.authorId)}function ct(e){return!!ot.value.find(t=>String(t.id)===String(e.id))}function st(e){return'my-works'===u.value&&ct(e)&&!dt(e)}function dt(e){return wt.value.find(t=>t.id===e.id||t.cloudItemId===e.id)}function ut(e){const t=new WeakSet,a=e=>{if(null==e)return e;const n=typeof e;if('number'===n||'string'===n||'boolean'===n)return e;if('object'!==n)return String(e);if(t.has(e))return'[Circular]';if(t.add(e),Array.isArray(e))return e.map(a);const o={};for(const t of Object.keys(e).sort()){const n=a(e[t]);void 0!==n&&(o[t]=n)}return o};return JSON.stringify(a(e))}function mt(e){const t=JSON.parse(JSON.stringify(e.data));t.id||(t.id=e.id);const a=JSON.stringify({type:e.type,data:t}),n='string'==typeof t?.coverImage?t.coverImage.trim():'';return{title:(e.type,e.data.name),description:e.data.description||'',code:a,coverImage:n||void 0,isPublic:!0}}function pt(e){if(!e||'object'!=typeof e)return null;return{title:'string'==typeof e.title?e.title.trim():'',description:'string'==typeof e.description?e.description.trim():'',code:'string'==typeof e.code?e.code:'',coverImage:('string'==typeof e.coverImage?e.coverImage.trim():'')||void 0,isPublic:'boolean'!=typeof e.isPublic||e.isPublic}}function vt(e){const t=e?.cloudItemId;return'string'==typeof t&&t.trim()?t.trim():void 0}function gt(e){const t=dt(e);if(!t)return!1;if(t.cloudBaseline){const e=pt(mt(t)),a=pt(t.cloudBaseline);return!e||(!a||!a.code||ut(e)!==ut(a))}return!0}function ft(e){const t=dt(e);return t?!!vt(t):ct(e)}function yt(e){const t=dt(e),a=ct(e);if(!t)return a?'云端':void 0;const n=vt(t);return n&&a||n?'同时':'本地'}function ht(e){const t=dt(e);if(!t)return!1;return!vt(t)||gt(e)}function kt(e){return vt(dt(e))?'同步到云端（仅在有变更时显示）':'上传到云端'}function Nt(e){const t=Dt(e);return!!t&&'mine'!==t.owner}function Et(e){const t=Dt(e);if(t)return'mine'===t.owner?'我的作品':void 0}async function Vt(e){if(!W())return void Oe('需要登录','移到“我的作品”需要先在首页登录（7天有效）。\n现在回首页登录吗？',()=>{b()});const t=Dt(e);if(!t)return void Ne('未找到本地作品（可能已被删除）','warning');if('mine'===t.owner)return void Ne('已在“我的作品”中','info');const a=Le({...t,owner:'mine'});try{await pe.idbService.saveWork(a),$e.value=$e.value.map(e=>String(e.id)===String(a.id)?a:e),Ne('已移到“我的作品”','success')}catch(e){console.error('[Workshop] move-to-mine failed:',e);Ne('DataCloneError'===e?.name?'存储失败（数据无法写入本地数据库）':'移动失败，请重试','error')}}const bt=(0,r.computed)(()=>$e.value),wt=(0,r.computed)(()=>$e.value.filter(e=>'mine'===e.owner)),Ct=(0,r.computed)(()=>{const e=[];return $e.value.forEach(t=>{'CHARACTER'===t.type&&e.push(t.data)}),e}),St=(0,r.computed)(()=>bt.value.map((e,t)=>({id:e.id,type:e.type,title:(e.type,e.data.name),description:e.data.description||e.data.desc||'',author:'Local',tags:[],likes:0,isDownloaded:!0,img:e.data.coverImage||'https://picsum.photos/400/250?random='+(t+100)}))),Bt=(0,r.computed)(()=>wt.value.map((e,t)=>({id:e.id,type:e.type,title:(e.type,e.data.name),description:e.data.description||e.data.desc||'',author:h.value?.username||'Local',tags:[],likes:0,img:e.data.coverImage||'https://picsum.photos/400/250?random='+(t+500)}))),xt=(0,r.computed)(()=>{const e=[],t=new Set;for(const a of ot.value){const n=String(a.id);t.has(n)||(e.push(a),t.add(n))}for(const a of Bt.value){const n=String(a.id);if(t.has(n))continue;const o=vt(dt(a));o&&t.has(String(o))||(e.push(a),t.add(n))}return e}),_t=[{value:'ALL',label:'全部'},{value:'EVENT',label:'事件包'},{value:'CHARACTER',label:'人设包'}],It=(0,r.computed)(()=>{let e=[];return e='explore'===u.value?et.value:'my-works'===u.value?xt.value:St.value,e.filter(e=>{const t='ALL'===m.value||e.type===m.value,a=!p.value||e.title.toLowerCase().includes(p.value.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(p.value.toLowerCase()));return t&&a})});async function Tt(){'GALLERY'!==d.value?(d.value='GALLERY',A.value=void 0,D.value=void 0):(await q(),t.push('/'))}function At(){v.value=!1,A.value=void 0,O.value=null,d.value='EVENT_EDITOR'}function Mt(){v.value=!1,D.value=void 0,O.value=null,d.value='CHARACTER_EDITOR'}function Dt(e){const t=String(e.id),a=$e.value.find(e=>String(e.id)===t);if(a)return a;const n=$e.value.find(e=>String(e.cloudItemId||'')===t);return n||void 0}function Pt(e){return Array.isArray(e)?e.filter(e=>e&&'object'==typeof e).map(e=>{const t={...e};return t.id&&'string'==typeof t.id||(t.id=crypto.randomUUID()),t}):[]}function Ot(e){const t=(new Date).toISOString(),a=e&&'object'==typeof e?e:{},n=String(a.id||'').trim()||crypto.randomUUID(),o=Array.isArray(a.linkedCharacterPackIds)?a.linkedCharacterPackIds.filter(e=>'string'==typeof e):'string'==typeof a.linkedCharacterPackId&&a.linkedCharacterPackId.trim()?[a.linkedCharacterPackId.trim()]:void 0;return{id:n,name:String(a.name||a.title||'未命名事件包'),description:String(a.description||a.desc||''),coverImage:'string'==typeof a.coverImage?a.coverImage:void 0,linkedCharacterPackId:'string'==typeof a.linkedCharacterPackId?a.linkedCharacterPackId:void 0,linkedCharacterPackIds:o,randomEvents:Pt(a.randomEvents),plotEvents:Pt(a.plotEvents),conditionalEvents:Pt(a.conditionalEvents),worldviews:Pt(a.worldviews),powerSystems:Pt(a.powerSystems),specialRules:Pt(a.specialRules),extraWorldBooks:Pt(a.extraWorldBooks),variables:Array.isArray(a.variables)?a.variables:[],variableTree:Array.isArray(a.variableTree)?a.variableTree:void 0,previewVariablesText:'string'==typeof a.previewVariablesText?a.previewVariablesText:void 0,widgetStyles:Array.isArray(a.widgetStyles)?a.widgetStyles:[],userWidgets:Array.isArray(a.userWidgets)?a.userWidgets:void 0,characterImages:Pt(a.characterImages),backgroundImages:Pt(a.backgroundImages),startPoints:Pt(a.startPoints),createdAt:String(a.createdAt||t),updatedAt:String(a.updatedAt||t)}}function Rt(e){const t=(new Date).toISOString(),a=e&&'object'==typeof e?e:{},n=String(a.id||'').trim()||crypto.randomUUID(),o=Array.isArray(a.presets)?a.presets.filter(e=>e&&'object'==typeof e).map(e=>{const t={...e};return t.id&&'string'==typeof t.id||(t.id=crypto.randomUUID()),t.name=String(t.name||'未命名角色'),t}):[];return{id:n,name:String(a.name||a.title||'未命名人设包'),description:'string'==typeof a.description?a.description:'string'==typeof a.desc?a.desc:void 0,coverImage:'string'==typeof a.coverImage?a.coverImage:void 0,presets:o,createdAt:String(a.createdAt||t),updatedAt:String(a.updatedAt||t)}}function Lt(e){if(!e||'object'!=typeof e)return null;if(('EVENT'===e.type||'CHARACTER'===e.type)&&e.data)return e.type;if(Array.isArray(e.presets))return'CHARACTER';return['randomEvents','plotEvents','conditionalEvents','worldviews','powerSystems','specialRules','extraWorldBooks','variableTree','userWidgets','characterImages','backgroundImages','startPoints'].some(t=>t in e)?'EVENT':null}function $t(){v.value=!1,g.value?.click()}function Ut(e){const t=Dt(e);if(!t)return void Ne('未找到本地作品，无法下载文件','warning');const a=(new Date).toISOString(),n={format:'tavern-helper-workshop-pack',version:1,type:t.type,exportedAt:a,data:t.data},o=(t.type,t.data.name);var l;!function(e,t){const a=new Blob([t],{type:'application/json;charset=utf-8'}),n=URL.createObjectURL(a),o=document.createElement('a');o.href=n,o.download=e,o.style.display='none',document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(n)}(`${l=o||t.id,(String(l||'').trim()||'workshop-pack').replace(/[<>:"/\\|?*]+/g,'_').replace(/\s+/g,' ').trim().slice(0,80)}.${'EVENT'===t.type?'event':'character'}.json`,JSON.stringify(n,null,2))}function zt(e){if('downloaded'===u.value){const t=bt.value.find(t=>t.id===e.id);t&&(O.value=t.id,'EVENT'===t.type?(A.value=JSON.parse(JSON.stringify(t.data)),d.value='EVENT_EDITOR'):(D.value=JSON.parse(JSON.stringify(t.data)),d.value='CHARACTER_EDITOR'))}else if('my-works'===u.value){const t=wt.value.find(t=>t.id===e.id||t.cloudItemId===e.id);if(!t)return void Ne('该作品仅在云端，先下载到本地再编辑','warning');O.value=t.id,'EVENT'===t.type?(A.value=JSON.parse(JSON.stringify(t.data)),d.value='EVENT_EDITOR'):(D.value=JSON.parse(JSON.stringify(t.data)),d.value='CHARACTER_EDITOR')}}async function Ft(e){try{const t=String(e.id),a=await Xt.getItem(t),n=Ge(a.data.code);if(!n.type||!n.data)return void Ne('下载失败：云端数据格式不支持','error');try{!!h.value&&(String(a.data.authorId)===String(h.value?.id)||String(a.data.authorName)===String(h.value?.username))||Xt.recordDownload(a.data._id).catch(()=>{})}catch{}const o=(new Date).toISOString(),l={id:n.data.id||crypto.randomUUID(),type:n.type,data:n.data,downloadedAt:o};'my-works'===u.value&&(l.owner='mine',l.cloudItemId=a.data._id,l.cloudBaseline=function(e){const t=e,a='string'==typeof t.coverImage?t.coverImage.trim():'',n='number'==typeof t.revision&&Number.isFinite(t.revision)?t.revision:void 0;return{title:e.title||'',description:e.description||'',code:e.code||'',coverImage:a||void 0,isPublic:!!e.isPublic,updatedAt:e.updatedAt,revision:n}}(a.data)),await pe.idbService.saveWork(l);const r=$e.value.findIndex(e=>e.id===l.id);r>=0?$e.value[r]=l:$e.value.push(l),Ne('已下载到本地','success')}catch(e){console.error(e),Ne('下载失败','error')}}async function Wt(e){const t=dt(e);if(!t)return void Ne('未找到本地作品，无法上传','error');const a=!!vt(t);if(a&&!gt(e))return void Ne('本地与云端内容一致，无需同步','info');let n,o,l=null,r='',i='',c=null,s='',d=null;const u=e=>{const t=String(n||'').trim(),l=o,r=String(e?.updatedAt||'').trim(),i='number'==typeof e?.revision&&Number.isFinite(e.revision)?e.revision:void 0;if(a){if(void 0!==l&&void 0!==i&&i>l)return!0;if(t&&r&&r!==t)return!0}return!1};Oe(a?'同步到云端':'上传到云端',a?'检测到本地与云端内容不同：确定要用本地版本覆盖云端吗？':'确定要把这个作品上传到云端吗？',()=>{Oe('再次确认',a?'同步后将覆盖云端源文件（不可恢复）。仍要继续吗？':'上传后将与云端同步，并可能对他人可见。仍要继续吗？',async()=>{await x(async()=>{try{Ie(),Ee.value=!0,Ve.value=a?'正在同步到云端...':'正在上传到云端...',be.value='准备上传...',we.value=0,Be.value=!0,xe.value='取消上传',Ne(a?'正在同步...':'正在上传...','info');const e=mt(t);if(l=e,e.title=String(e.title??'').trim(),e.description=String(e.description??'').trim(),e.code=String(e.code??''),!e.title)return void Ne('上传失败：作品名称不能为空（请先在本地填写名称）','error');if(!e.code)return void Ne('上传失败：缺少作品内容（code 为空）','error');const m=Ge(e.code),p=String(m.data?.id??t.id??'').trim();if(r=p,!p)return void Ne('上传失败：缺少作品ID（clientWorkId）','error');const v=crypto.randomUUID();i=v;const g=async e=>{try{if(!globalThis.crypto||!('subtle'in globalThis.crypto)||!globalThis.crypto.subtle)return null;const t=(new TextEncoder).encode(e),a=await globalThis.crypto.subtle.digest('SHA-256',t);return Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,'0')).join('')}catch{return null}};let f,y;c=await g(e.code);try{const e=String(t?.cloudBaseline?.updatedAt||'').trim();e&&(f=e);const a=t?.cloudBaseline?.revision;if('number'==typeof a&&Number.isFinite(a)&&(y=a),!f){const e=await Xt.getMyItemByClientId(p,{timeoutMs:15e3});e?.data?.updatedAt&&(f=e.data.updatedAt),'number'==typeof e?.data?.revision&&Number.isFinite(e.data.revision)&&(y=e.data.revision)}}catch{}n=f,o=y;try{const t=(new TextEncoder).encode(JSON.stringify(e)).byteLength;d=t;const a=Math.ceil(t/1024),n=Math.round(t/1024/1024*10)/10;if(t>31457280)return void Ne(`上传已取消：内容过大（约 ${n}MB / ${a}KB，超过 30MB 上限），请改用 URL 资源或拆分上传`,'error')}catch{}const h=new AbortController;_e=h;const k=e=>new Promise(t=>setTimeout(t,e)),N=(e,t)=>{if(Ce.value=Math.max(0,e||0),Se.value=Math.max(0,t||0),t&&t>0){const a=Math.min(100,Math.max(0,Math.round(e/t*100)));we.value=a,be.value=a>=100?'上传完成，等待服务器写入...':`正在上传... ${a}%`}else we.value=null,be.value='正在上传...'},E=async e=>{const t=Date.now()+6e4;let a=1e3;for(be.value='已收到异步回执，服务器处理中...',we.value=null,Be.value=!0,xe.value='停止等待（后台继续）';Date.now()<t;){if(h.signal.aborted){throw Object.assign(new Error('canceled'),{name:'CanceledError',code:'ERR_CANCELED'})}const t=await Xt.getOperation(e,{timeoutMs:15e3,signal:h.signal}),n=t?.data;if('done'===n?.status)return n;if('failed'===n?.status){const e=String(n?.error?.message||n?.error?.code||'upload failed'),t=new Error(e);throw t.status=n?.error?.status,t}const o=n?.progress?.percent,l='number'==typeof o&&Number.isFinite(o)?Math.min(100,Math.max(0,Math.round(o))):null,r=String(n?.progress?.message||n?.progress?.stage||n?.status||'processing');null===l?(we.value=null,be.value=`服务器处理中...（${r}）`):(we.value=l,be.value=`服务器处理中... ${l}%（${r}）`),await k(a),a=Math.min(2e3,Math.floor(1.5*a))}const n=new Error('upload still processing');throw n.code='WORKSHOP_OPERATION_TIMEOUT',n.operationId=e,n},V=async()=>Xt.upsertItemByClientId(p,e,{signal:h.signal,requestId:v,clientContentSha256:c||void 0,async:!0,onUploadProgress:e=>{try{const t=d,a='number'==typeof e.total?e.total:'number'==typeof t&&Number.isFinite(t)?t:null;N(Number(e.loaded||0),a)}catch{}}}),b=await V();if(b&&'object'==typeof b&&'string'==typeof b.operationId&&b.operationId){const n=String(b.operationId);s=n;const o=await E(n),l=await Xt.getMyItemByClientId(p,{timeoutMs:3e4,signal:h.signal}),r=l?.data;if(!r)return Ie(),Ne(`${a?'同步':'上传'}完成，但获取云端作品失败（operationId=${n}）`,'warning'),void Ke().catch(()=>{});t.cloudItemId=r._id,t.owner='mine',t.cloudBaseline={title:e.title,description:e.description,code:e.code,coverImage:e.coverImage,isPublic:e.isPublic,updatedAt:r.updatedAt,revision:r.revision};const i=Le(t);await pe.idbService.saveWork(i);const d=$e.value.findIndex(e=>e.id===t.id);d>=0&&($e.value[d]=i);const m=c,v=String(r.contentSha256||o?.serverContentSha256||'').trim();return Ie(),m&&v&&v===m?Ne(o?.created?'上传成功（异步回执已确认，哈希匹配）':'同步成功（异步回执已确认，哈希匹配）','success'):u(r)?Ne(o?.created?'上传成功（异步回执已确认，版本已更新）':'同步成功（异步回执已确认，版本已更新）','success'):Ne(o?.created?'上传成功（异步回执已确认）':'同步成功（异步回执已确认）','success'),void Ke().catch(()=>{})}const w=b;if(w?.data?._id){t.cloudItemId=w.data._id,t.owner='mine',t.cloudBaseline={title:e.title,description:e.description,code:e.code,coverImage:e.coverImage,isPublic:e.isPublic,updatedAt:w.data.updatedAt,revision:w.data.revision};const a=Le(t);await pe.idbService.saveWork(a);const n=$e.value.findIndex(e=>e.id===t.id);n>=0&&($e.value[n]=a),Ie(),Ne(w.created?'上传成功':'同步成功','success');try{await Ke()}catch(e){console.warn('[Workshop] refreshCloud failed after upload:',e)}return}throw new Error('未知的上传回执格式')}catch(e){console.error(e),Ee.value&&Ie();if('ERR_CANCELED'===e?.code||'CanceledError'===e?.name)return void Ne(s?`已停止等待：后台仍在处理（operationId=${s}）`:'已取消上传','info');if('WORKSHOP_OPERATION_TIMEOUT'===e?.code){const t=String(e?.operationId||s||'').trim();return void Ne(`${a?'同步':'上传'}已提交后台处理，仍在进行中${t?`（operationId=${t}）`:''}，请稍后刷新云端或稍后重试等待`,'warning')}if(String(e?.message||'').toLowerCase().includes('cors')||'ERR_NETWORK'===e?.code&&e?.request&&0===e?.request?.status)return void Ne('上传失败：浏览器 CORS 拦截了请求。请后端允许跨域请求头（X-Requested-With / X-Client-Request-Id / X-Client-Content-Sha256 / Authorization 等）。','error');const n=e?.response?.status,o=e?.response?.data,d=o?.error||o?.message;let m='';try{if(o&&'object'==typeof o){const e=o.details??o.errors??o.issues;e&&(m='string'==typeof e?e:JSON.stringify(e)),!m&&o.message&&'string'==typeof o.message&&(m=o.message)}}catch{}const p=String(e?.message||'').toLowerCase();if(!n&&('ECONNABORTED'===e?.code||p.includes('timeout')||p.includes('network'))){try{if(r&&l&&i){const e=await Xt.upsertItemByClientId(r,l,{timeoutMs:2e4,requestId:i,clientContentSha256:c||void 0,async:!0});if(e&&'object'==typeof e&&'string'==typeof e.operationId&&e.operationId){const n=String(e.operationId);s=n;const o=e=>new Promise(t=>setTimeout(t,e)),i=Date.now()+6e4;let d=1e3;for(;Date.now()<i;){const e=await Xt.getOperation(n,{timeoutMs:15e3}),t=e?.data;if('done'===t?.status)break;if('failed'===t?.status)throw new Error(String(t?.error?.message||t?.error?.code||'upload failed'));await o(d),d=Math.min(2e3,Math.floor(1.5*d))}const m=await Xt.getMyItemByClientId(r,{timeoutMs:3e4}),p=m?.data;if(p){t.cloudItemId=p._id,t.owner='mine',t.cloudBaseline={title:String(l.title??'').trim(),description:String(l.description??'').trim(),code:String(l.code??''),coverImage:l.coverImage,isPublic:l.isPublic,updatedAt:p.updatedAt,revision:p.revision};const e=Le(t);await pe.idbService.saveWork(e);const n=$e.value.findIndex(e=>e.id===t.id);n>=0&&($e.value[n]=e);const o=c;return o&&String(p.contentSha256||'')===o?Ne((a?'同步':'上传')+'成功（已获取异步回执，哈希匹配）','success'):u(p)?Ne((a?'同步':'上传')+'成功（已获取异步回执，版本已更新）','success'):Ne((a?'同步':'上传')+'成功（已获取异步回执）','success'),void Ke().catch(()=>{})}return void Ne(`${a?'同步':'上传'}已提交后台处理（operationId=${n}），请稍后刷新云端确认`,'warning')}if(e?.data?._id){t.cloudItemId=e.data._id,t.owner='mine',t.cloudBaseline={title:String(l.title??'').trim(),description:String(l.description??'').trim(),code:String(l.code??''),coverImage:l.coverImage,isPublic:l.isPublic,updatedAt:e.data.updatedAt,revision:e.data.revision};const n=Le(t);await pe.idbService.saveWork(n);const o=$e.value.findIndex(e=>e.id===t.id);return o>=0&&($e.value[o]=n),Ne((a?'同步':'上传')+'成功（已按 request-id 幂等重试获取回执）','success'),void Ke().catch(()=>{})}}}catch(e){console.warn('[Workshop] upload idempotent retry failed:',e)}try{const e=r;if(e&&l){const n=await Xt.getMyItemByClientId(e,{timeoutMs:3e4}),o=n?.data;if(o){t.cloudItemId=o._id,t.owner='mine',t.cloudBaseline={title:String(l.title??'').trim(),description:String(l.description??'').trim(),code:String(l.code??''),coverImage:l.coverImage,isPublic:l.isPublic,updatedAt:o.updatedAt,revision:o.revision};const e=Le(t);await pe.idbService.saveWork(e);const n=$e.value.findIndex(e=>e.id===t.id);n>=0&&($e.value[n]=e);const r=c;return r&&String(o.contentSha256||'')===r?Ne((a?'同步':'上传')+'已确认成功（云端哈希匹配）','success'):u(o)?Ne((a?'同步':'上传')+'已确认成功（云端版本已更新）','success'):Ne((a?'同步':'上传')+'可能已成功（云端已找到记录）','warning'),void Ke().catch(()=>{})}}}catch(e){console.warn('[Workshop] upload verify failed:',e)}return void Ne((a?'同步':'上传')+'响应超时/中断：请稍后刷新云端列表确认','warning')}if(401===n)return void Ne('上传失败：认证失败，请重试（会重新登录）','warning');if(413===n)return void Ne('上传失败：服务端拒绝请求（413）。建议使用图片 URL，或联系后端提高单次上传限制','warning');if(503===n)return void Ne(`上传失败：云端服务暂不可用（${d||'503'}）`,'warning');Ne(`${a?'同步失败':'上传失败'}${d?'：'+d:''}${m?`\n${m}`:''}`,'error')}})})})}function Gt(e){if('my-works'===u.value){const t=dt(e);return t?void Oe('删除本地副本','仅删除本地文件（不会删除云端源文件）。确定继续吗？',async()=>{try{await pe.idbService.deleteWork(t.id);const e=$e.value.findIndex(e=>e.id===t.id);-1!==e&&$e.value.splice(e,1),Ne('本地副本已删除','success')}catch(e){console.error(e),Ne('删除失败','error')}}):void Ne('未找到本地副本，无法删除本地文件','warning')}Oe('删除作品','确定要删除这个已下载的作品吗？此操作不可恢复。',async()=>{try{await pe.idbService.deleteWork(e.id);const t=$e.value.findIndex(t=>t.id===e.id);-1!==t&&$e.value.splice(t,1)}catch(e){console.error(e),Ne('删除失败','error')}})}function jt(e){const t=vt(dt(e))||(ct(e)?String(e.id):void 0);t?Oe('删除云端源文件',`将从云端彻底删除「${e.title}」。此操作不可恢复，确定继续吗？`,()=>{Oe('再次确认','删除的是云端“源文件”，不是本地副本。仍要继续吗？',()=>{Oe('最后确认',`最后一次确认：真的要删除云端作品「${e.title}」吗？`,async()=>{await x(async()=>{try{Ne('正在删除云端源文件...','info'),await Xt.deleteItem(t);const e=wt.value.find(e=>e.cloudItemId===t);if(e){const t={...e};delete t.cloudItemId;const a=Le(t);await pe.idbService.saveWork(a);const n=$e.value.findIndex(t=>t.id===e.id);n>=0&&($e.value[n]=a)}await Ke(),await qe(),Ne(e?'云端源文件已删除（本地副本保留）':'云端源文件已删除','success')}catch(e){console.error(e);const t=e?.response?.status,a='number'==typeof t?t:'string'==typeof t?Number(t):void 0,n=e?.response?.data?.error||e?.response?.data?.message;if(401===a)return void Ne('删除失败：认证失败，请重试（会重新登录）','warning');if(503===a)return void Ne(`删除失败：云端服务暂不可用（${n||'503'}）`,'warning');Ne('删除失败'+(n?'：'+n:''),'error')}})})})}):Ne('该作品不在云端，无法删除云端源文件','warning')}function Jt(){'EVENT_EDITOR'===d.value&&wl().catch(()=>{}),'EVENT_EDITOR'===d.value?A.value=void 0:'CHARACTER_EDITOR'===d.value&&(D.value=void 0),O.value=null,R.value++}async function Yt(){const e=(new Date).toISOString(),t=e=>{const t=$e.value.find(t=>t.id===e);if(t)return t;const a=O.value;return a?$e.value.find(e=>e.id===a):void 0},a=e=>e?.owner?e.owner:'my-works'===u.value?'mine':'downloaded'===u.value?'downloaded':h.value?'mine':'downloaded',n=(e,t)=>{t&&(t.cloudItemId&&!e.cloudItemId&&(e.cloudItemId=t.cloudItemId),t.cloudBaseline&&!e.cloudBaseline&&(e.cloudBaseline=Le(t.cloudBaseline)))},o=async e=>{if(!O.value)return;if(O.value===e)return;const t=O.value;try{await pe.idbService.deleteWork(t)}catch{}const a=$e.value.findIndex(e=>e.id===t);a>=0&&$e.value.splice(a,1)};let l;if('EVENT_EDITOR'===d.value&&I.value){const r=JSON.parse(JSON.stringify(I.value.eventPack)),i=t(r.id),c={id:r.id,type:'EVENT',data:r,downloadedAt:e};c.owner=a(i),n(c,i),l=c.owner;try{const e=Le(c);await pe.idbService.saveWork(e),await o(c.id);const t=$e.value.findIndex(e=>e.id===c.id);t>=0?$e.value[t]=e:$e.value.push(e),Ze('保存成功')}catch(e){return console.error(e),void Ze('保存失败: '+e)}}else if('CHARACTER_EDITOR'===d.value&&T.value){const r=JSON.parse(JSON.stringify(T.value.charPack)),i=t(r.id),c={id:r.id,type:'CHARACTER',data:r,downloadedAt:e};c.owner=a(i),n(c,i),l=c.owner;try{const e=Le(c);await pe.idbService.saveWork(e),await o(c.id);const t=$e.value.findIndex(e=>e.id===c.id);t>=0?$e.value[t]=e:$e.value.push(e),Ze('保存成功')}catch(e){return console.error(e),void Ze('保存失败: '+e)}}d.value='GALLERY',O.value=null,u.value='mine'===l?'my-works':'downloaded'}function Ht(e){H.value=e.imageUrl,Q.value=e.characterName,Y.value='',ae.value='',J.value=!0}function Kt(e){Y.value=e.imageUrl,H.value='',Q.value='',Z.value='',ee.value=e.linkedVariable||'',ae.value=e.naturalCondition||e.linkedVariable||'',J.value=!0}function qt(e){if(console.log('[Workshop] handlePreviewWidget 收到:',{id:e.id,name:e.name,vueCode:e.vueCode?.substring(0,100),fullCode:e.vueCode}),!e.vueCode||!e.vueCode.trim())return void Ne('请先输入组件代码','warning');const t=vo(e.vueCode);if(!t.isValid)return ie.value=`代码安全检查失败:\n${t.errors.join('\n')}`,void Ne('代码存在安全问题，无法预览','error');oe.value=e,re.value=[],ie.value='';const a=A.value,n=(a?.previewVariablesText||'').trim();se.value=n||ue(),ve(),le.value++,ne.value=!0}function Qt(){re.value.push({type:'info',message:'组件加载成功'})}function Zt(e){ie.value=e,re.value.push({type:'error',message:e})}function ea(e){re.value.push({type:e.type,message:e.message}),Ne(e.message,e.type)}function ta(){ne.value=!1,oe.value=null,re.value=[],ie.value=''}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'workshop-view',style:(0,r.normalizeStyle)(o.value)},[(0,r.createCommentVNode)(' Background Dimmer for Editor '),'GALLERY'!==d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',_u)):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Header '),(0,r.createElementVNode)('div',Iu,[(0,r.createElementVNode)('button',{class:'back-btn',onClick:Tt},[(0,r.createVNode)(E,{name:'back',size:'1.125em'})]),(0,r.createElementVNode)('div',Tu,[(0,r.createVNode)(E,{name:'hammer',size:'1.25em',class:'title-icon'}),t[13]||(t[13]=(0,r.createElementVNode)('h1',null,'创意工坊 WORKSHOP',-1)),'GALLERY'!==d.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',Au,(0,r.toDisplayString)('EVENT_EDITOR'===d.value?'事件包编辑':'人设包编辑'),1)):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createCommentVNode)(' Main Panel '),(0,r.createVNode)(S,{class:'main-panel'},{default:(0,r.withCtx)(()=>[(0,r.createVNode)(r.Transition,{name:'fade',mode:'out-in'},{default:(0,r.withCtx)(()=>['GALLERY'===d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Mu,[(0,r.createCommentVNode)(' Gallery Header '),(0,r.createElementVNode)('div',Du,[(0,r.createElementVNode)('div',Pu,[(0,r.createElementVNode)('div',Ou,[(0,r.createVNode)(E,{name:'search',size:'1.125em',class:'search-icon'}),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[0]||(t[0]=e=>p.value=e),placeholder:'搜索 Tag / 标题...'},null,512),[[r.vModelText,p.value]])]),(0,r.createElementVNode)('div',Ru,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(_t,e=>(0,r.createElementVNode)('button',{key:e.value,class:(0,r.normalizeClass)({active:m.value===e.value}),onClick:t=>m.value=e.value},(0,r.toDisplayString)(e.label),11,Lu)),64))])]),(0,r.createElementVNode)('div',$u,[(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['my-works-btn',{active:'explore'===u.value}]),onClick:t[1]||(t[1]=e=>w('explore'))},[(0,r.createVNode)(E,{name:'world',size:'1em'}),t[14]||(t[14]=(0,r.createTextVNode)(' 浏览 ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['my-works-btn',{active:'my-works'===u.value}]),onClick:t[2]||(t[2]=e=>w('my-works'))},[(0,r.createVNode)(E,{name:'user',size:'1em'}),t[15]||(t[15]=(0,r.createTextVNode)(' 我的作品 ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['downloaded-btn',{active:'downloaded'===u.value}]),onClick:t[3]||(t[3]=e=>w('downloaded'))},[(0,r.createVNode)(E,{name:'download',size:'1em'}),t[16]||(t[16]=(0,r.createTextVNode)(' 已下载 ',-1))],2),(0,r.createElementVNode)('div',Uu,[(0,r.createElementVNode)('button',{class:'import-btn',type:'button',onClick:$t},[(0,r.createVNode)(E,{name:'import',size:'1.125em'}),t[17]||(t[17]=(0,r.createTextVNode)(' 导入 ',-1))])]),(0,r.createElementVNode)('div',zu,[(0,r.createElementVNode)('button',{class:'upload-btn',onClick:t[4]||(t[4]=e=>v.value=!v.value)},[(0,r.createVNode)(E,{name:'plus',size:'1.125em'}),t[18]||(t[18]=(0,r.createTextVNode)(' 新建 ',-1))]),(0,r.createVNode)(r.Transition,{name:'dropdown'},{default:(0,r.withCtx)(()=>[v.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Fu,[(0,r.createElementVNode)('button',{onClick:At},[(0,r.createVNode)(E,{name:'book',size:'0.875em'}),t[19]||(t[19]=(0,r.createTextVNode)(' 事件包 ',-1))]),(0,r.createElementVNode)('button',{onClick:Mt},[(0,r.createVNode)(E,{name:'user',size:'0.875em'}),t[20]||(t[20]=(0,r.createTextVNode)(' 人设包 ',-1))])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])])]),(0,r.createCommentVNode)(' Auto-save Toast '),(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[f.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Wu,[(0,r.createVNode)(E,{name:'check',size:'1em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(f.value),1)])):(0,r.createCommentVNode)('v-if',!0)]),_:1}),(0,r.createCommentVNode)(' Local file import inputs (hidden) '),(0,r.createElementVNode)('input',{ref_key:'importPackInput',ref:g,class:'hidden-file-input',type:'file',accept:'application/json,.json',multiple:'',onChange:t[5]||(t[5]=e=>async function(e){const t=e.target,a=Array.from(t.files||[]);if(t.value='',!a.length)return;let n=0;try{for(const e of a){const t=await e.text();let a;try{a=JSON.parse(t)}catch{Ne(`导入失败：文件不是有效 JSON：${e.name}`,'error');continue}const o=async t=>{const a=Lt(t);if(!a)return void Ne(`导入失败：无法识别类型：${e.name}`,'error');const o=t&&'object'==typeof t&&('EVENT'===t.type||'CHARACTER'===t.type)&&t.data?t.data:t,l='EVENT'===a?Ot(o):Rt(o),r=(new Date).toISOString(),i={id:l.id,type:a,data:l,downloadedAt:r};await pe.idbService.saveWork(i);const c=$e.value.findIndex(e=>e.id===i.id);c>=0?$e.value[c]=i:$e.value.push(i),n++};if(Array.isArray(a))for(const e of a)await o(e);else await o(a)}n>0&&(u.value='downloaded',Ne(`已导入到“已下载”：${n} 个`,'success'))}catch(e){console.error('[Workshop] import failed:',e),Ne('导入失败：请查看控制台日志','error')}}(e))},null,544),(0,r.createCommentVNode)(' My Works actions (inside My Works view) '),'my-works'===u.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Gu,[(0,r.createElementVNode)('button',{class:'my-works-btn',onClick:Je},[(0,r.createVNode)(E,{name:'info',size:'1em'}),t[21]||(t[21]=(0,r.createTextVNode)(' 查看配额 ',-1))])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Gallery Grid '),(0,r.createElementVNode)('div',ju,['my-works'!==u.value||h.value?It.value.length?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:1},(0,r.renderList)(It.value,e=>((0,r.openBlock)(),(0,r.createBlock)($o,{key:e.id,item:e,'author-avatar-url':it(e),'is-downloaded':'downloaded'===u.value,'can-move-to-mine':'downloaded'===u.value&&Nt(e),'move-to-mine-title':'移到我的作品','can-edit':'downloaded'===u.value||'my-works'===u.value&&!!wt.value.find(t=>t.id===e.id||t.cloudItemId===e.id),'can-delete':'downloaded'===u.value||'my-works'===u.value&&!!dt(e),'can-delete-remote':'my-works'===u.value&&ft(e),'can-download':'explore'===u.value||'my-works'===u.value&&st(e),'can-upload':'my-works'===u.value&&ht(e),'can-file-download':'downloaded'===u.value||'my-works'===u.value&&!!dt(e),'file-download-title':'导出为JSON文件','upload-title':'my-works'===u.value?kt(e):void 0,'upload-icon':'my-works'===u.value?'upload-cloud':void 0,'status-label':'my-works'===u.value?yt(e):'downloaded'===u.value?Et(e):void 0,onEdit:zt,onDelete:Gt,onDeleteRemote:jt,onDownload:Ft,onUpload:Wt,onMoveToMine:Vt,onFileDownload:Ut,onInfo:Xe},null,8,['item','author-avatar-url','is-downloaded','can-move-to-mine','can-edit','can-delete','can-delete-remote','can-download','can-upload','can-file-download','upload-title','upload-icon','status-label']))),128)):((0,r.openBlock)(),(0,r.createElementBlock)('div',Yu,[(0,r.createVNode)(E,{name:'folder',size:'3em'}),'my-works'===u.value&&'unauth'===We.value&&h.value?((0,r.openBlock)(),(0,r.createElementBlock)('p',Hu,'这里只展示你发布的公开作品（不需要验证登录）。上传/删除云端等危险操作会要求再次登录验证。')):((0,r.openBlock)(),(0,r.createElementBlock)('p',Xu,(0,r.toDisplayString)('downloaded'===u.value?'暂无已下载作品':'没有找到相关内容'),1))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Ju,[(0,r.createVNode)(E,{name:'user',size:'3em'}),t[22]||(t[22]=(0,r.createElementVNode)('p',null,'未在首页登录：请先登录（7天有效）再进入“我的作品”',-1)),(0,r.createElementVNode)('button',{class:'my-works-btn active',onClick:b},'回首页登录')]))]),(0,r.createCommentVNode)(' Intro Modal '),(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[Ye.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'intro-overlay',onClick:t[7]||(t[7]=(0,r.withModifiers)(e=>Ye.value=!1,['self']))},[(0,r.createElementVNode)('div',Ku,[(0,r.createElementVNode)('div',qu,[(0,r.createElementVNode)('div',Qu,(0,r.toDisplayString)(He.value?.title||'简介'),1),(0,r.createElementVNode)('button',{class:'intro-close',type:'button',onClick:t[6]||(t[6]=e=>Ye.value=!1)},'✕')]),(0,r.createElementVNode)('div',Zu,[(0,r.createElementVNode)('span',em,(0,r.toDisplayString)('EVENT'===He.value?.type?'事件包':'人设包'),1),(0,r.createElementVNode)('span',tm,'· '+(0,r.toDisplayString)(He.value?.author||'Unknown'),1)]),(0,r.createElementVNode)('div',am,(0,r.toDisplayString)(He.value?.description?.trim()||'暂无简介'),1)])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])):'EVENT_EDITOR'===d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',nm,[(0,r.createElementVNode)('div',om,[(0,r.createElementVNode)('div',lm,[((0,r.openBlock)(),(0,r.createBlock)(cu,{key:G.value,ref_key:'eventEditorRef',ref:I,'initial-data':A.value,'character-packs':Ct.value,onPreviewChar:Ht,onPreviewBg:Kt,onPreviewWidget:qt,onAutoSave:Ze},null,8,['initial-data','character-packs']))]),(0,r.createCommentVNode)(' Bottom Actions '),(0,r.createElementVNode)('div',{class:'editor-actions'},[(0,r.createElementVNode)('button',{class:'action-reset',onClick:Jt},'清空重置'),(0,r.createElementVNode)('button',{class:'action-submit',onClick:Yt},'保存到已下载作品')])])])):'CHARACTER_EDITOR'===d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',rm,[(0,r.createElementVNode)('div',im,[(0,r.createElementVNode)('div',cm,[((0,r.openBlock)(),(0,r.createBlock)(kl,{key:j.value,ref_key:'charEditorRef',ref:T,'initial-data':D.value,onAutoSave:Ze},null,8,['initial-data']))]),(0,r.createCommentVNode)(' Bottom Actions '),(0,r.createElementVNode)('div',{class:'editor-actions'},[(0,r.createElementVNode)('button',{class:'action-reset',onClick:Jt},'清空重置'),(0,r.createElementVNode)('button',{class:'action-submit',onClick:Yt},'保存到已下载作品')])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})]),_:1}),(0,r.createCommentVNode)(' Visual Preview Modal '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'body'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[J.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'preview-overlay',onClick:t[9]||(t[9]=(0,r.withModifiers)(e=>J.value=!1,['self']))},[(0,r.createElementVNode)('div',sm,[(0,r.createElementVNode)('button',{class:'close-btn',onClick:t[8]||(t[8]=e=>J.value=!1)},'×'),(0,r.createVNode)(xu,{'bg-image':Y.value,'char-image':H.value,'char-name':Q.value,'diff-name':Z.value,location:ee.value,time:te.value,condition:ae.value},null,8,['bg-image','char-image','char-name','diff-name','location','time','condition'])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])),(0,r.createCommentVNode)(' Widget Preview Modal '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'body'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[ne.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'widget-preview-overlay',onClick:(0,r.withModifiers)(ta,['self'])},[(0,r.createElementVNode)('div',dm,[(0,r.createElementVNode)('div',um,[(0,r.createElementVNode)('h3',null,'组件预览: '+(0,r.toDisplayString)(oe.value?.name),1),(0,r.createElementVNode)('button',{class:'close-btn',onClick:ta},'×')]),(0,r.createElementVNode)('div',mm,[(0,r.createElementVNode)('div',pm,[(0,r.createElementVNode)('div',vm,[t[23]||(t[23]=(0,r.createElementVNode)('div',{class:'vars-title'},'预览变量（JSON，仅用于预览）',-1)),(0,r.createElementVNode)('div',gm,[(0,r.createElementVNode)('button',{class:'vars-btn',type:'button',onClick:(0,r.withModifiers)(ge,['stop'])},'生成模板'),(0,r.createElementVNode)('button',{class:'vars-btn primary',type:'button',onClick:(0,r.withModifiers)(fe,['stop'])},' 应用并刷新 ')])]),de.value.error?((0,r.openBlock)(),(0,r.createElementBlock)('div',fm,(0,r.toDisplayString)(de.value.error),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[10]||(t[10]=e=>se.value=e),class:'vars-textarea',spellcheck:'false',placeholder:'在这里输入预览变量 JSON...'},null,512),[[r.vModelText,se.value]])]),(0,r.createElementVNode)('div',ym,[ie.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',hm,[(0,r.createVNode)(E,{name:'alert',size:'1.5em'}),(0,r.createElementVNode)('pre',null,(0,r.toDisplayString)(ie.value),1)])):oe.value&&le.value?((0,r.openBlock)(),(0,r.createBlock)(Vo,{key:`widget-preview-${le.value}`,'user-code':oe.value.vueCode,'component-id':`preview-${oe.value.id}-${le.value}`,'game-state':ce.value,'preview-variables':de.value.value,'allow-state-modification':!1,onLoaded:Qt,onError:Zt,onNotification:ea},null,8,['user-code','component-id','game-state','preview-variables'])):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createElementVNode)('div',km,[t[24]||(t[24]=(0,r.createElementVNode)('div',{class:'console-header'},'控制台',-1)),(0,r.createElementVNode)('div',Nm,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(re.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:(0,r.normalizeClass)(['log-entry',e.type])},' ['+(0,r.toDisplayString)(e.type)+'] '+(0,r.toDisplayString)(e.message),3))),128)),re.value.length?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',Em,'暂无日志'))])])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])),(0,r.createCommentVNode)(' Upload Progress Overlay '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'body'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[Ee.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'upload-overlay',onClick:(0,r.withModifiers)(()=>{},['self'])},[(0,r.createVNode)(S,{class:'upload-box'},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',Vm,[(0,r.createVNode)(E,{name:'upload-cloud',size:'1.5em',class:'upload-icon'}),(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(Ve.value),1)]),(0,r.createElementVNode)('div',bm,(0,r.toDisplayString)(be.value),1),(0,r.createElementVNode)('div',wm,[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['upload-progress-bar',{indeterminate:null===we.value}]),style:(0,r.normalizeStyle)(null===we.value?void 0:{width:we.value+'%'})},null,6)]),Se.value>0&&null!==we.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Cm,(0,r.toDisplayString)(Math.round(Ce.value/1024))+'KB / '+(0,r.toDisplayString)(Math.round(Se.value/1024))+'KB （'+(0,r.toDisplayString)(we.value)+'%） ',1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',Sm,[(0,r.createElementVNode)('button',{class:'btn-cancel',type:'button',disabled:!Be.value,onClick:Te},(0,r.toDisplayString)(xe.value),9,Bm)])]),_:1})])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])),(0,r.createCommentVNode)(' Confirm Modal '),(0,r.createVNode)(me,{visible:Ae.value,'onUpdate:visible':t[11]||(t[11]=e=>Ae.value=e),title:Me.value,message:De.value,onConfirm:Re},null,8,['visible','title','message']),(0,r.createVNode)(M,{visible:ye.value,'onUpdate:visible':t[12]||(t[12]=e=>ye.value=e),message:he.value,type:ke.value},null,8,['visible','message','type'])],4))}}),_m=(0,p.A)(xm,[['__scopeId','data-v-b9e39c94']]),Im={key:0,class:'char-name-container'},Tm={class:'char-name-box'},Am={class:'char-name'},Mm={class:'dialogue-text-wrapper'},Dm={key:0,class:'cursor'},Pm={class:'dialogue-controls'},Om=(0,r.defineComponent)({__name:'DialogueBox',props:{name:{},text:{},effect:{},protagonistName:{},autoMode:{type:Boolean},skipMode:{type:Boolean},settings:{}},emits:['next','back','log','auto','skip'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(''),l=(0,r.ref)(!1);let i=null,c=null;const s=e=>'string'==typeof e&&e.trim().length>0,d=()=>{const e=(a.name||'').trim();if(!e)return!0;const t=(a.protagonistName||'').trim(),n=e.toLowerCase();return t&&e===t||'user'===n||'<user>'===n||'玩家'===e||'主角'===e},u=(0,r.ref)([]),m=(0,r.ref)(0),p=(0,r.ref)(!1),v=()=>{u.value=(e=>{const t=String(e??'');if(!t)return[];const a=[];let n=0;for(;n<t.length;){if('*'===t[n]&&'*'===t[n+1]){a.push({kind:'narration',text:'**'}),n+=2;continue}if('*'===t[n]&&'*'!==t[n+1]){let e=n+1;for(;e<t.length&&('*'!==t[e]||'*'===t[e+1]||'\\'===t[e-1]);)e++;if(e<t.length&&'*'===t[e]){const o=t.slice(n+1,e);o&&a.push({kind:'psych',text:o}),n=e+1;continue}a.push({kind:'narration',text:'*'}),n+=1;continue}if('「'===t[n]){const e=t.indexOf('」',n+1);if(-1!==e){const o=t.slice(n,e+1);a.push({kind:'dialogue',text:o}),n=e+1;continue}a.push({kind:'narration',text:'「'}),n+=1;continue}const e=[t.indexOf('*',n),t.indexOf('「',n)].filter(e=>-1!==e).sort((e,t)=>e-t)[0];let o='number'==typeof e&&e>=0?e:t.length;o<=n&&(o=Math.min(n+1,t.length));const l=t.slice(n,o);l&&a.push({kind:'narration',text:l}),n=o}const o=[];for(const e of a){const t=o[o.length-1];t&&t.kind===e.kind?t.text+=e.text:o.push({...e})}return o})(a.text)},g=()=>u.value.reduce((e,t)=>e+(t.text?.length||0),0),f=(0,r.ref)([]),y=()=>{p.value?f.value=[{kind:'narration',text:o.value}]:f.value=(e=>{if(e<=0)return[];const t=[];let a=e;for(const e of u.value){if(a<=0)break;const n=e.text||'';if(!n)continue;const o=n.slice(0,a);o&&t.push({kind:e.kind,text:o}),a-=o.length}return t})(m.value)},h=(0,r.ref)('');(0,r.watch)(()=>[a.name,a.text,a.protagonistName],()=>{v();const e=(a.name||'').trim();h.value=e&&(u.value.some(e=>'dialogue'===e.kind)||u.value.some(e=>'psych'===e.kind))?e:''},{immediate:!0});const k=e=>{const t=s(a.settings.dialogueTextColor)?a.settings.dialogueTextColor:'',n=s(a.settings.narrationTextColor)?a.settings.narrationTextColor:'',o=s(a.settings.psychTextColor)?a.settings.psychTextColor:'';return'dialogue'===e&&t?{color:t}:'psych'===e?d()&&o?{color:o}:!d()&&n?{color:n}:{}:'narration'===e&&n?{color:n}:{}},N=()=>{if(i&&(clearInterval(i),i=null),0===a.settings.textSpeed||a.skipMode)return p.value=!1,m.value=g(),y(),void(l.value=!1);l.value=!0;const e=Math.max(a.settings.textSpeed,1);p.value=!1,m.value=0,y();const t=g(),n=performance.now(),o=()=>{const a=performance.now()-n,l=Math.floor(a/e);l>=t?(m.value=t,y(),V()):(l>m.value&&(m.value=l,y()),c=requestAnimationFrame(o))};c=requestAnimationFrame(o)},V=()=>{i&&(clearInterval(i),i=null),c&&(cancelAnimationFrame(c),c=null),p.value||(m.value=g()),y(),l.value=!1},b=()=>{l.value?V():n('next')};return(0,r.watch)(()=>a.text,()=>{N()}),(0,r.watch)(()=>a.effect,()=>{N()}),(0,r.watch)(()=>a.skipMode,e=>{e&&l.value&&V()}),(0,r.onMounted)(()=>{N()}),(0,r.onUnmounted)(()=>{i&&clearInterval(i),c&&cancelAnimationFrame(c)}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'dialogue-layer',style:(0,r.normalizeStyle)({bottom:(e.settings.dialogueBottom??3)+'em'})},[(0,r.createVNode)(S,{class:'dialogue-panel',style:(0,r.normalizeStyle)({opacity:(e.settings.dialogueOpacity??85)/100,width:(e.settings.dialogueWidth??90)+'%',height:(e.settings.dialogueHeight??200)+'px',padding:`${e.settings.dialoguePaddingY??2}em ${e.settings.dialoguePaddingX??2.5}em`}),onClick:(0,r.withModifiers)(b,['stop'])},{default:(0,r.withCtx)(()=>[(0,r.createCommentVNode)(' Character Name '),h.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Im,[(0,r.createElementVNode)('div',Tm,[(0,r.createElementVNode)('span',Am,(0,r.toDisplayString)(h.value),1)]),(0,r.createCommentVNode)(' Decorative Line '),t[4]||(t[4]=(0,r.createElementVNode)('div',{class:'name-deco-line'},null,-1))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Main Text '),(0,r.createElementVNode)('div',Mm,[(0,r.createElementVNode)('p',{class:'dialogue-text',style:(0,r.normalizeStyle)({fontSize:e.settings.fontSize+'px'})},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(f.value,(e,t)=>{return(0,r.openBlock)(),(0,r.createElementBlock)('span',{key:t,class:(0,r.normalizeClass)((a=e.kind,'dialogue'===a?'seg-dialogue':'psych'===a&&d()?'seg-psych':'seg-narration')),style:(0,r.normalizeStyle)(k(e.kind))},(0,r.toDisplayString)(e.text),7);var a}),128)),l.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',Dm,'|')):(0,r.createCommentVNode)('v-if',!0)],4)]),(0,r.createCommentVNode)(' In-Dialogue Controls '),(0,r.createElementVNode)('div',Pm,[(0,r.createElementVNode)('button',{class:'control-btn hover-violet',onClick:t[0]||(t[0]=(0,r.withModifiers)(t=>e.$emit('log'),['stop']))},[(0,r.createVNode)(E,{name:'message',size:14}),t[5]||(t[5]=(0,r.createTextVNode)(' Log ',-1))]),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['control-btn hover-cyan',{active:e.autoMode}]),onClick:t[1]||(t[1]=(0,r.withModifiers)(t=>e.$emit('auto'),['stop']))},[(0,r.createVNode)(E,{name:'next',size:14}),t[6]||(t[6]=(0,r.createTextVNode)(' Auto ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['control-btn hover-pink',{active:e.skipMode}]),onClick:t[2]||(t[2]=(0,r.withModifiers)(t=>e.$emit('skip'),['stop']))},[(0,r.createVNode)(E,{name:'next',size:14,class:'rotate-90'}),t[7]||(t[7]=(0,r.createTextVNode)(' Skip ',-1))],2)]),(0,r.createCommentVNode)(' Back Indicator '),(0,r.createElementVNode)('div',{class:'back-indicator',onClick:t[3]||(t[3]=(0,r.withModifiers)(t=>e.$emit('back'),['stop']))},[(0,r.createVNode)(E,{name:'next',size:24,class:'rotate-90'})])]),_:1},8,['style'])],4))}}),Rm=(0,p.A)(Om,[['__scopeId','data-v-21001e54']]),Lm={class:'error-log-panel'},$m={class:'log-header'},Um={class:'header-left'},zm={class:'icon-wrapper'},Fm={key:0,class:'count-badge'},Wm={key:0,class:'empty-state'},Gm={key:1,class:'log-content'},jm={class:'error-header'},Jm={class:'error-index'},Ym={class:'error-time'},Hm={class:'error-message'},Xm={key:0,class:'error-command'},Km={class:'command-actions'},qm=['onClick'],Qm=['onClick'],Zm={key:1,class:'error-details'},ep={key:2,class:'reprocess-panel'},tp={class:'reprocess-title'},ap={class:'reprocess-actions'},np=['disabled'],op=['disabled'],lp={key:3,class:'log-footer'},rp={class:'footer-info'},ip=(0,r.defineComponent)({__name:'ErrorLogModal',props:{visible:{type:Boolean,default:!1},errors:{default:()=>[]}},emits:['update:visible','clear','reprocess','notify'],setup(e,{emit:t}){const a=e,n=t,o=e=>{const t=new Date(e),a=(new Date).getTime()-t.getTime(),n=Math.floor(a/6e4),o=Math.floor(a/36e5);return n<1?'刚刚':n<60?`${n} 分钟前`:o<24?`${o} 小时前`:t.toLocaleString('zh-CN',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})},l=(0,r.ref)(!1);let i=null;const c=(0,r.computed)(()=>{for(let e=0;e<a.errors.length;e++){const t=a.errors[a.errors.length-1-e];if(t?.command)return t.command}return''}),s=(0,r.ref)('');const d=()=>{if(!l.value)return n('notify',{text:'再点一次“清空日志”以确认',success:!1,duration:2e3}),l.value=!0,i&&window.clearTimeout(i),void(i=window.setTimeout(()=>{l.value=!1,i=null},2500));l.value=!1,i&&(window.clearTimeout(i),i=null),n('clear')},u=()=>{c.value&&(s.value=c.value,n('notify',{text:'已填入最新错误指令',success:!0,duration:1500}))},m=()=>{const e=s.value.trim();e&&n('reprocess',e)};return(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'error-log-overlay',onClick:t[2]||(t[2]=(0,r.withModifiers)(t=>e.$emit('update:visible',!1),['self']))},[(0,r.createElementVNode)('div',Lm,[(0,r.createElementVNode)('div',$m,[(0,r.createElementVNode)('div',Um,[(0,r.createElementVNode)('div',zm,[(0,r.createVNode)(E,{name:'alert',size:24})]),t[3]||(t[3]=(0,r.createElementVNode)('span',{class:'title'},'变量处理错误日志',-1)),e.errors.length>0?((0,r.openBlock)(),(0,r.createElementBlock)('span',Fm,(0,r.toDisplayString)(e.errors.length),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('update:visible',!1))},'✕')]),0===e.errors.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Wm,[(0,r.createVNode)(E,{name:'check',size:48}),t[4]||(t[4]=(0,r.createElementVNode)('p',null,'暂无错误记录',-1)),t[5]||(t[5]=(0,r.createElementVNode)('span',{class:'sub-text'},'所有变量指令都执行成功',-1))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Gm,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.errors,(a,l)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:l,class:'error-item'},[(0,r.createElementVNode)('div',jm,[(0,r.createElementVNode)('span',Jm,'#'+(0,r.toDisplayString)(e.errors.length-l),1),(0,r.createElementVNode)('span',Ym,(0,r.toDisplayString)(o(a.timestamp)),1)]),(0,r.createElementVNode)('div',Hm,(0,r.toDisplayString)(a.message),1),a.command?((0,r.openBlock)(),(0,r.createElementBlock)('div',Xm,[t[8]||(t[8]=(0,r.createElementVNode)('span',{class:'command-label'},'指令:',-1)),(0,r.createElementVNode)('code',null,(0,r.toDisplayString)(a.command),1),(0,r.createElementVNode)('div',Km,[(0,r.createElementVNode)('button',{class:'mini-btn',onClick:e=>(async e=>{try{await navigator.clipboard.writeText(e),n('notify',{text:'已复制指令',success:!0,duration:1500})}catch{n('notify',{text:'复制失败（浏览器权限限制）',success:!1,duration:2e3})}})(a.command)},[(0,r.createVNode)(E,{name:'copy',size:14}),t[6]||(t[6]=(0,r.createTextVNode)(' 复制 ',-1))],8,qm),(0,r.createElementVNode)('button',{class:'mini-btn primary',onClick:e=>{return t=a.command,s.value=t,void n('notify',{text:'已填入到“重新处理变量”编辑框',success:!0,duration:1500});var t}},[(0,r.createVNode)(E,{name:'edit',size:14}),t[7]||(t[7]=(0,r.createTextVNode)(' 用此指令编辑 ',-1))],8,Qm)])])):(0,r.createCommentVNode)('v-if',!0),a.details?((0,r.openBlock)(),(0,r.createElementBlock)('div',Zm,[t[9]||(t[9]=(0,r.createElementVNode)('span',{class:'details-label'},'详情:',-1)),(0,r.createElementVNode)('pre',null,(0,r.toDisplayString)(a.details),1)])):(0,r.createCommentVNode)('v-if',!0)]))),128))])),(0,r.createCommentVNode)(' Reprocess editor '),e.errors.length>0?((0,r.openBlock)(),(0,r.createElementBlock)('div',ep,[(0,r.createElementVNode)('div',tp,[(0,r.createVNode)(E,{name:'hammer',size:18}),t[10]||(t[10]=(0,r.createTextVNode)(' 重新处理变量 ',-1))]),t[13]||(t[13]=(0,r.createElementVNode)('div',{class:'reprocess-desc'},' 把上面错误的那一句指令贴进来修改，然后点“应用重新处理”。支持单条或多条指令（可多行）。 ',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[1]||(t[1]=e=>s.value=e),class:'reprocess-input',spellcheck:'false',placeholder:'例如：\\n\\n[$$ UPDATE(\'系统.时间\', \'第3天\') $$]'},null,512),[[r.vModelText,s.value]]),(0,r.createElementVNode)('div',ap,[(0,r.createElementVNode)('button',{class:'mini-btn',onClick:u,disabled:!c.value},[(0,r.createVNode)(E,{name:'download',size:14}),t[11]||(t[11]=(0,r.createTextVNode)(' 填入最新错误指令 ',-1))],8,np),(0,r.createElementVNode)('button',{class:'mini-btn primary',onClick:m,disabled:!s.value.trim()},[(0,r.createVNode)(E,{name:'play',size:14}),t[12]||(t[12]=(0,r.createTextVNode)(' 应用重新处理 ',-1))],8,op)])])):(0,r.createCommentVNode)('v-if',!0),e.errors.length>0?((0,r.openBlock)(),(0,r.createElementBlock)('div',lp,[(0,r.createElementVNode)('button',{class:'btn-clear',onClick:d},[(0,r.createVNode)(E,{name:'trash',size:16}),t[14]||(t[14]=(0,r.createTextVNode)(' 清空日志 ',-1))]),(0,r.createElementVNode)('span',rp,'共 '+(0,r.toDisplayString)(e.errors.length)+' 条错误记录',1)])):(0,r.createCommentVNode)('v-if',!0)])])):(0,r.createCommentVNode)('v-if',!0)]),_:1}))}}),cp=(0,p.A)(ip,[['__scopeId','data-v-1628de53']]),sp={class:'hud-layer group'},dp={class:'location-icon-wrapper'},up={class:'location-text'},mp={class:'time-text'},pp=(0,r.defineComponent)({__name:'GameHud',props:{overrideTime:{},overrideLocation:{},typingSpeedMs:{}},setup(e){const t=e,a=(0,r.ref)(''),n=(0,r.ref)(''),o=(0,r.ref)(''),l=(0,r.ref)('');let i=null,c=null,s=null;const{getCurrentTime:d,getCurrentLocation:u}=Ot(),m=async()=>{try{const[e,r]=await Promise.all([d(),u()]);a.value='string'==typeof e?e:'',n.value='string'==typeof r?r:'',null==t.overrideTime&&(o.value=a.value),null==t.overrideLocation&&(l.value=n.value)}catch{}};(0,r.onMounted)(async()=>{await m(),t.overrideTime?o.value=t.overrideTime:o.value=a.value,t.overrideLocation?l.value=t.overrideLocation:l.value=n.value,s=setInterval(m,1e3)});const p=e=>{'time'===e&&i&&(clearInterval(i),i=null),'location'===e&&c&&(clearInterval(c),c=null)},v=(e,a)=>{p(e);Math.max(t.typingSpeedMs??30,16);const n='time'===e?o:l,r=String(a??'');let s=0;const d='!@#$%^&*()_+-=[]{}|;:,.<>?ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',u=e=>Array.from({length:e},()=>d[Math.floor(88*Math.random())]).join(''),m=setInterval(()=>{s+=50,s<600?n.value=u(r.length||5):(n.value=r,p(e))},50);'time'===e?i=m:c=m};(0,r.watch)(()=>t.overrideTime,(e,t)=>{e!==t&&('string'==typeof e?v('time',e):(p('time'),o.value=a.value))}),(0,r.watch)(()=>t.overrideLocation,(e,t)=>{e!==t&&('string'==typeof e?v('location',e):(p('location'),l.value=n.value))}),(0,r.onUnmounted)(()=>{s&&(clearInterval(s),s=null),p('time'),p('location')});const g=(0,r.computed)(()=>(l.value||'').trim()||'UNKNOWN'),f=(0,r.computed)(()=>(o.value||'').trim()||'----/--/-- --:--');return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',sp,[(0,r.createElementVNode)('div',dp,[(0,r.createVNode)(E,{name:'location',size:20})]),(0,r.createElementVNode)('div',null,[(0,r.createElementVNode)('div',up,(0,r.toDisplayString)(g.value),1),(0,r.createElementVNode)('div',mp,(0,r.toDisplayString)(f.value),1)])]))}}),vp=(0,p.A)(pp,[['__scopeId','data-v-83a8506e']]),gp={class:'sidebar-content'},fp={class:'btn-icon-wrapper'},yp={class:'btn-icon-wrapper'},hp={class:'btn-icon-wrapper'},kp={class:'btn-icon-wrapper'},Np={key:0,class:'error-badge'},Ep={class:'btn-icon-wrapper danger-bg'},Vp=(0,r.defineComponent)({__name:'LeftSidebar',props:{errorCount:{default:0}},emits:['saveload','asset','variables','settings','errorlog','exit'],setup(e){const t=e,a=(0,r.computed)(()=>t.errorCount>0),n=(0,r.ref)(null),o=(0,r.ref)(!1);let l=0,i=0;const c=()=>window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1;function s(e){if(!c())return;if(o.value)return;const t=e.touches[0];t&&(l=t.clientX,i=t.clientY)}function d(e){if(!c())return;if(o.value)return;const t=e.changedTouches[0];if(!t)return;if(l>28)return;const a=t.clientX-l,n=t.clientY-i;Math.abs(a)<40||Math.abs(a)<Math.abs(n)||a>0&&(o.value=!0)}function u(){o.value=!o.value}function m(e){'touch'!==e.pointerType&&(o.value=!0)}function p(e){'touch'!==e.pointerType&&(o.value=!1)}function v(e){if(!o.value)return;const t=n.value;if(!t)return;const a=e.target;a&&t.contains(a)||(o.value=!1)}return(0,r.onMounted)(()=>{document.addEventListener('pointerdown',v),document.addEventListener('touchstart',s,{passive:!0}),document.addEventListener('touchend',d,{passive:!0})}),(0,r.onUnmounted)(()=>{document.removeEventListener('pointerdown',v),document.removeEventListener('touchstart',s),document.removeEventListener('touchend',d)}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{ref_key:'rootRef',ref:n,class:(0,r.normalizeClass)(['left-sidebar group',{open:o.value}]),onPointerenter:m,onPointerleave:p},[(0,r.createCommentVNode)(' Invisible Trigger Area '),(0,r.createElementVNode)('div',{class:'trigger-area',onPointerdown:(0,r.withModifiers)(u,['stop','prevent'])},null,32),(0,r.createCommentVNode)(' Expanded Content '),(0,r.createElementVNode)('div',gp,[(0,r.createElementVNode)('button',{class:'sidebar-btn',onClick:t[0]||(t[0]=t=>e.$emit('saveload'))},[(0,r.createElementVNode)('div',fp,[(0,r.createVNode)(E,{name:'save',size:20})]),t[6]||(t[6]=(0,r.createElementVNode)('span',{class:'btn-label'},'SAVE/LOAD',-1))]),(0,r.createElementVNode)('button',{class:'sidebar-btn',onClick:t[1]||(t[1]=t=>e.$emit('asset'))},[(0,r.createElementVNode)('div',yp,[(0,r.createVNode)(E,{name:'edit',size:20})]),t[7]||(t[7]=(0,r.createElementVNode)('span',{class:'btn-label'},'ASSET',-1))]),(0,r.createElementVNode)('button',{class:'sidebar-btn',onClick:t[2]||(t[2]=t=>e.$emit('variables'))},[(0,r.createElementVNode)('div',hp,[(0,r.createVNode)(E,{name:'code',size:20})]),t[8]||(t[8]=(0,r.createElementVNode)('span',{class:'btn-label'},'VAR',-1))]),t[12]||(t[12]=(0,r.createElementVNode)('div',{class:'sidebar-divider'},null,-1)),(0,r.createElementVNode)('button',{class:'sidebar-btn',onClick:t[3]||(t[3]=t=>e.$emit('settings'))},[(0,r.createElementVNode)('div',kp,[(0,r.createVNode)(E,{name:'settings',size:20})]),t[9]||(t[9]=(0,r.createElementVNode)('span',{class:'btn-label'},'SET',-1))]),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['sidebar-btn',{'has-errors':a.value}]),onClick:t[4]||(t[4]=t=>e.$emit('errorlog'))},[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['btn-icon-wrapper',{'error-bg':a.value}])},[(0,r.createVNode)(E,{name:'alert',size:20}),e.errorCount>0?((0,r.openBlock)(),(0,r.createElementBlock)('span',Np,(0,r.toDisplayString)(e.errorCount>99?'99+':e.errorCount),1)):(0,r.createCommentVNode)('v-if',!0)],2),t[10]||(t[10]=(0,r.createElementVNode)('span',{class:'btn-label'},'ERROR',-1))],2),t[13]||(t[13]=(0,r.createElementVNode)('div',{class:'sidebar-divider'},null,-1)),(0,r.createElementVNode)('button',{class:'sidebar-btn danger',onClick:t[5]||(t[5]=t=>e.$emit('exit'))},[(0,r.createElementVNode)('div',Ep,[(0,r.createVNode)(E,{name:'home',size:20})]),t[11]||(t[11]=(0,r.createElementVNode)('span',{class:'btn-label'},'HOME',-1))])])],34))}}),bp=(0,p.A)(Vp,[['__scopeId','data-v-3a4a3550']]),wp={class:'perf-text'},Cp=(0,r.defineComponent)({__name:'PerformanceOverlay',props:{text:{},effect:{},textSpeedMs:{},skipMode:{type:Boolean}},emits:['done'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(!1),l=(0,r.ref)('');let i=null;const c=(0,r.computed)(()=>{const e=a.effect||'plain';return'rise'===e?'effect-rise':'retype-typo'===e?'effect-retype':'effect-plain'}),s=()=>{i&&(clearInterval(i),i=null)},d=()=>{s(),o.value=!1,setTimeout(()=>{n('done')},1200)};(0,r.watch)(()=>[a.text,a.effect,a.textSpeedMs,a.skipMode],()=>(()=>{s();const e=String(a.text??'');if(a.skipMode||(a.textSpeedMs??30)<=0)return l.value=e,void d();l.value='',o.value=!0;const t=Math.max(a.textSpeedMs??30,16);let n=0;i=setInterval(()=>{if(n<e.length)return l.value+=e[n],void n++;d()},t)})(),{immediate:!0}),(0,r.onUnmounted)(()=>s());const u=()=>{if(o.value)return l.value=String(a.text??''),void d();n('done')};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'perf-overlay',onClick:(0,r.withModifiers)(u,['stop'])},[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['perf-panel',c.value])},[(0,r.createElementVNode)('div',wp,(0,r.toDisplayString)(l.value),1),(0,r.createCommentVNode)(' <div class="perf-hint" v-if="!isTyping">(点击继续)</div> ')],2)]))}}),Sp=(0,p.A)(Cp,[['__scopeId','data-v-0bf7f76c']]),Bp='mycard_input_history';const xp={key:0,class:'orb-icon'},_p={class:'panel-header'},Ip={class:'textarea-wrapper'},Tp={class:'btn-group'},Ap={key:0,class:'history-list'},Mp={key:0,class:'history-empty'},Dp=['onClick'],Pp={class:'history-time'},Op={class:'history-content'},Rp=['onClick'],Lp=(0,r.defineComponent)({__name:'QuickInput',setup(e){const{isExpanded:t,inputText:a,showHistory:n,isSending:o,inputHistory:l,toggle:i,toggleHistory:c,send:s,useHistoryItem:d,deleteHistoryItem:u}=function(){const e=(0,r.ref)(!1),t=(0,r.ref)(''),a=(0,r.ref)(!1),n=(0,r.ref)(!1),o=(0,r.reactive)([]),l=async()=>{try{const e=await fe(Bp);if(Array.isArray(e))return o.splice(0,o.length,...e),void console.log(`[useQuickInput] 已加载 ${o.length} 条历史记录`)}catch{}try{const e=localStorage.getItem(Bp);if(e){const t=JSON.parse(e);Array.isArray(t)&&(o.splice(0,o.length,...t),await ye(Bp,t)),localStorage.removeItem(Bp),console.log(`[useQuickInput] 已迁移并加载 ${o.length} 条历史记录`)}}catch(e){console.error('[useQuickInput] 加载历史记录失败:',e),o.splice(0,o.length)}},i=()=>{try{he(Bp,[...o],200)}catch(e){console.error('[useQuickInput] 保存历史记录失败:',e)}},c=e=>{const t=(new Date).toLocaleString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});o.unshift({id:Date.now(),content:e,timestamp:t}),o.length>50&&o.splice(50),i()},s=async e=>{if(e&&e.trim())try{console.log('[useQuickInput] 准备发送:',e);try{const e=await ga('同梦');await Jt(e),console.log('[useQuickInput] 偏移度提示词已更新')}catch(e){console.warn('[useQuickInput] 更新偏移度提示词失败:',e)}const t=(()=>{try{return sessionStorage.getItem('last_final_text')||''}catch{return''}})(),a=6e3,n=t.length>a?t.slice(-a):t,o='\n<输出格式要求>\n必须严格按顺序输出以下标签，且标签必须成对完整：\n<think>...</think><content>...</content><小总结>...</小总结>\n可选：<大总结>...</大总结>\n规则：第一个标签一定是 <think>；</think> 必须紧贴 <content> 前；</content> 必须紧贴 <小总结> 前。\n注意：<think>...</think> 内不得出现 <content>/<小总结>/<大总结> 等标签。\n</输出格式要求>\n',l='auto_big_summary_need_big',r=await(async()=>{try{const e=await we(),t=Boolean(e?.autoBigSummaryEnabled),a='1'===(sessionStorage.getItem(l)||'');return t&&a}catch{return!1}})()?'\n<自动大总结提示>\n现在需要输出一次大总结：请在本次回复中额外输出一段 <大总结>...</大总结>，总结截至目前的整体剧情与关键状态变更。\n并保持标签顺序与相邻规则不变（</content>后紧贴<小总结>，<大总结>可放在<小总结>之后）。\n</自动大总结提示>\n':'',i=n?`\n<前文(上一轮完整输出)>\n${n}\n</前文(上一轮完整输出)>\n`:'',c={injects:[...i?[{role:'system',content:o+r+i,position:'in_chat',depth:0,should_scan:!0}]:[{role:'system',content:o+r,position:'in_chat',depth:0,should_scan:!0}],{role:'user',content:`<行动选择>\n${e}\n</行动选择>`,position:'in_chat',depth:0,should_scan:!0}],should_stream:!0};console.log('[useQuickInput] GenerateConfig:',c),await TavernHelper.generate(c),console.log('[useQuickInput] 发送完成')}catch(e){throw console.error('[useQuickInput] 发送失败:',e),e}else console.warn('[useQuickInput] 发送内容为空')};return l(),{isExpanded:e,inputText:t,showHistory:a,isSending:n,inputHistory:o,toggle:()=>{e.value=!e.value,e.value||(a.value=!1)},toggleHistory:()=>{a.value=!a.value},send:async o=>{const l=t.value.trim();if(l){console.log('[useQuickInput] 发送内容:',l),n.value=!0;try{c(l),o?await o(l):await s(l),t.value='',e.value=!1,a.value=!1}catch(e){throw console.error('[useQuickInput] 发送失败:',e),e}finally{n.value=!1}}else console.warn('[useQuickInput] 发送内容为空')},executeQuickSend:s,clear:()=>{t.value=''},addToHistory:c,useHistoryItem:e=>{const n=o.find(t=>t.id===e);n&&(t.value=n.content,a.value=!1)},deleteHistoryItem:e=>{const t=o.findIndex(t=>t.id===e);t>-1&&(o.splice(t,1),i())},clearHistory:()=>{o.splice(0,o.length),i()},loadHistory:l}}(),m=(0,r.ref)(null),p=(0,r.ref)(null);let v=null;const g=(0,r.ref)(!1),f=(0,r.ref)(!1),y=(0,r.ref)(!1),h=(0,r.ref)(0),k=(0,r.ref)(0),N=(0,r.ref)(0),E=(0,r.ref)(0);let V=null,b=null,w=!1;const C=()=>{p.value&&(p.value.style.height='auto',p.value.style.height=Math.min(p.value.scrollHeight,280)+'px')};function S(e){if(!e.style.left||'auto'===e.style.left){const t=e.getBoundingClientRect();e.style.left=t.left+'px',e.style.top=t.top+'px',e.style.right='auto',e.style.bottom='auto'}}function B(e){if('mouse'===e.pointerType&&0!==e.button)return;const a=m.value;if(a&&(V=e.pointerId,b=e.pointerType,!t.value)){S(a),g.value=!0,f.value=!1,h.value=e.clientX,k.value=e.clientY,N.value=e.clientX-a.offsetLeft,E.value=e.clientY-a.offsetTop;try{a.setPointerCapture(e.pointerId)}catch{}document.addEventListener('pointermove',I,{passive:!1}),document.addEventListener('pointerup',T),document.addEventListener('pointercancel',T)}}function x(e){if('mouse'===e.pointerType&&0!==e.button)return;if(!t.value)return;const a=m.value;if(a){V=e.pointerId,b=e.pointerType,S(a),y.value=!0,f.value=!1,h.value=e.clientX,k.value=e.clientY,N.value=e.clientX-a.offsetLeft,E.value=e.clientY-a.offsetTop;try{a.setPointerCapture(e.pointerId)}catch{}document.addEventListener('pointermove',I,{passive:!1}),document.addEventListener('pointerup',T),document.addEventListener('pointercancel',T),e.preventDefault()}}function I(e){if(!g.value&&!y.value)return;if(null!=V&&e.pointerId!==V)return;const t=m.value;if(!t)return;const a=Math.abs(e.clientX-h.value),n=Math.abs(e.clientY-k.value);(a>5||n>5)&&(f.value=!0);let o=e.clientX-N.value,l=e.clientY-E.value;const r=window.innerWidth-t.offsetWidth,i=window.innerHeight-t.offsetHeight;o=Math.max(0,Math.min(o,r)),l=Math.max(0,Math.min(l,i)),t.style.left=o+'px',t.style.top=l+'px',t.style.right='auto',t.style.bottom='auto','touch'===b&&e.preventDefault()}function T(e){if(null!=V&&e.pointerId!==V)return;const a=m.value,n=(g.value||y.value,f.value);g.value=!1,y.value=!1,V=null,b=null,document.removeEventListener('pointermove',I),document.removeEventListener('pointerup',T),document.removeEventListener('pointercancel',T),n||t.value||(a&&S(a),w=!0,window.setTimeout(()=>{w=!1},0),i())}function A(){if(w)return;if(t.value)return;const e=m.value;e&&(S(e),i())}return(0,r.watch)(t,e=>{if(e)v||(v=function(){const e=document.documentElement,t=document.body,a=document.scrollingElement||e,n='number'==typeof window.scrollY?window.scrollY:a.scrollTop,o='number'==typeof window.scrollX?window.scrollX:a.scrollLeft,l={docOverflow:e.style.overflow,docOverscroll:e.style.overscrollBehavior,bodyOverflow:t.style.overflow,bodyPosition:t.style.position,bodyTop:t.style.top,bodyLeft:t.style.left,bodyRight:t.style.right,bodyWidth:t.style.width};return e.style.overflow='hidden',e.style.overscrollBehavior='none',t.style.overflow='hidden',t.style.position='fixed',t.style.top=`-${n}px`,t.style.left=`-${o}px`,t.style.right='0',t.style.width='100%',()=>{e.style.overflow=l.docOverflow,e.style.overscrollBehavior=l.docOverscroll,t.style.overflow=l.bodyOverflow,t.style.position=l.bodyPosition,t.style.top=l.bodyTop,t.style.left=l.bodyLeft,t.style.right=l.bodyRight,t.style.width=l.bodyWidth;try{window.scrollTo(o,n)}catch{}}}()),(0,r.nextTick)(()=>{try{p.value?.focus?.({preventScroll:!0})}catch{p.value?.focus()}C()});else if(v){const e=v;v=null,e()}}),(0,r.onMounted)(()=>{}),(0,r.onUnmounted)(()=>{if(document.removeEventListener('pointermove',I),document.removeEventListener('pointerup',T),document.removeEventListener('pointercancel',T),v){const e=v;v=null,e()}}),(e,v)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['quick-input-orb',{expanded:(0,r.unref)(t),dragging:g.value}]),ref_key:'orbRef',ref:m,onPointerdown:B,onClick:A},[(0,r.createCommentVNode)(' 收起状态显示的图标 '),(0,r.unref)(t)?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',xp,'✎')),(0,r.createCommentVNode)(' 展开的输入面板 '),(0,r.createVNode)(r.Transition,{name:'quick-input-panel',persisted:''},{default:(0,r.withCtx)(()=>[(0,r.withDirectives)((0,r.createElementVNode)('div',{class:'input-panel',onClick:v[6]||(v[6]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.createElementVNode)('div',_p,[(0,r.createElementVNode)('div',{class:'panel-title panel-drag-handle',onPointerdown:(0,r.withModifiers)(x,['stop'])},'Quick Input',32),(0,r.createElementVNode)('button',{type:'button',class:'panel-close','aria-label':'Close Quick Input',onPointerdown:v[0]||(v[0]=(0,r.withModifiers)(()=>{},['stop'])),onClick:v[1]||(v[1]=(0,r.withModifiers)((...e)=>(0,r.unref)(i)&&(0,r.unref)(i)(...e),['stop']))},' ✕ ',32)]),(0,r.createElementVNode)('div',Ip,[(0,r.withDirectives)((0,r.createElementVNode)('textarea',{ref_key:'textareaRef',ref:p,'onUpdate:modelValue':v[2]||(v[2]=e=>(0,r.isRef)(a)?a.value=e:null),placeholder:'输入你的行动...',onInput:C,onKeydown:v[3]||(v[3]=(0,r.withKeys)((0,r.withModifiers)(e=>(0,r.unref)(s)(),['ctrl']),['enter']))},null,544),[[r.vModelText,(0,r.unref)(a)]])]),(0,r.createElementVNode)('div',Tp,[(0,r.createElementVNode)('div',{class:'orb-btn',onClick:v[4]||(v[4]=(0,r.withModifiers)((...e)=>(0,r.unref)(c)&&(0,r.unref)(c)(...e),['stop']))},(0,r.toDisplayString)((0,r.unref)(n)?'Hide':'History'),1),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['orb-btn primary',{disabled:(0,r.unref)(o)}]),onClick:v[5]||(v[5]=(0,r.withModifiers)(e=>(0,r.unref)(s)(),['stop']))},(0,r.toDisplayString)((0,r.unref)(o)?'Sending...':'Send'),3)]),(0,r.createCommentVNode)(' 历史记录列表 '),(0,r.unref)(n)?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ap,[0===(0,r.unref)(l).length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Mp,'暂无历史记录')):(0,r.createCommentVNode)('v-if',!0),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(l),e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'history-item',onClick:(0,r.withModifiers)(t=>(0,r.unref)(d)(e.id),['stop'])},[(0,r.createElementVNode)('div',Pp,(0,r.toDisplayString)(e.timestamp),1),(0,r.createElementVNode)('div',Op,(0,r.toDisplayString)(e.content),1),(0,r.createElementVNode)('div',{class:'history-delete',onClick:(0,r.withModifiers)(t=>(0,r.unref)(u)(e.id),['stop'])},'✕',8,Rp)],8,Dp))),128))])):(0,r.createCommentVNode)('v-if',!0)],512),[[r.vShow,(0,r.unref)(t)]])]),_:1})],34))}}),$p=(0,p.A)(Lp,[['__scopeId','data-v-72cea2e8']]),Up={class:'widgets-header-row'},zp={class:'widgets-container'},Fp={key:0,class:'empty-state'},Wp={key:1,class:'missing-state'},Gp=(0,r.defineComponent)({__name:'RightSidebar',props:{settings:{},forceOpen:{type:Boolean,default:!1},gameState:{}},setup(e){const t=e,a=(0,r.computed)(()=>t.settings?.enabledSidebarWidgets||[]),n=e=>(0,wa.WC)(e),o=e=>{const t=n(e),a=t?.code??t?.vueCode??t?.jsCode??t?.sourceCode;return'string'==typeof a&&a.trim()?a:null},l=e=>{const t=n(e),a=t?.cssCode??t?.css??'';return'string'==typeof a?a:''},i=(0,r.ref)(0),c=(0,r.ref)(!1),s=(0,r.ref)(320),d=(0,r.ref)(null),u=(0,r.ref)(null),m=(0,r.ref)(!1),p=(0,r.computed)(()=>!!t.forceOpen||m.value);let v=null;const g=()=>{i.value++,k()},f=()=>window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,y=e=>{t.forceOpen||'mouse'!==e.pointerType&&(m.value=!m.value)},h=()=>{const e=d.value;if(!e)return;const t=Math.ceil(e.scrollWidth||e.getBoundingClientRect().width);if(t>0){const e=Math.floor(.9*window.innerWidth);s.value=Math.min(t+2,e)}},k=async()=>{c.value=!0,await(0,r.nextTick)(),h(),c.value=!1};let N=null,E=null,V=null,b=0,w=0;return(0,r.onMounted)(()=>{k(),N=e=>{if(!p.value)return;if(t.forceOpen)return;if(!m.value)return;const a=u.value,n=e.target;a&&n&&a.contains(n)||(m.value=!1)},E=e=>{if(t.forceOpen)return;if(p.value&&m.value){const t=u.value,a=e.target;if(t&&a&&!t.contains(a))return void(m.value=!1)}if(!f())return;if(p.value)return;const a=e.touches[0];a&&(b=a.clientX,w=a.clientY)},V=e=>{if(!f())return;if(t.forceOpen)return;if(p.value)return;const a=e.changedTouches[0];if(!a)return;if(b<window.innerWidth-28)return;const n=a.clientX-b,o=a.clientY-w;Math.abs(n)<40||Math.abs(n)<Math.abs(o)||n<0&&(m.value=!0)},document.addEventListener('pointerdown',N,!0),document.addEventListener('touchstart',E,{passive:!0}),document.addEventListener('touchend',V,{passive:!0}),d.value&&(v=new ResizeObserver(()=>{const e=d.value;if(e){const t=Math.ceil(e.scrollWidth||e.getBoundingClientRect().width);if(t>0){const e=Math.floor(.9*window.innerWidth);s.value=Math.min(t+2,e)}}}),v.observe(d.value)),window.addEventListener('resize',h)}),(0,r.onBeforeUnmount)(()=>{v&&(v.disconnect(),v=null),N&&(document.removeEventListener('pointerdown',N,!0),N=null),E&&(document.removeEventListener('touchstart',E),E=null),V&&(document.removeEventListener('touchend',V),V=null),window.removeEventListener('resize',h)}),(0,r.watch)(a,()=>{k()}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{ref_key:'rootRef',ref:u,class:(0,r.normalizeClass)(['right-sidebar',{open:p.value,measuring:c.value}]),style:(0,r.normalizeStyle)({'--open-width':s.value+'px'})},[e.forceOpen?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'trigger-area',onPointerdown:(0,r.withModifiers)(y,['stop','prevent'])},null,32)),(0,r.createElementVNode)('div',{ref_key:'panelEl',ref:d,class:'widgets-panel'},[(0,r.createElementVNode)('div',Up,[t[0]||(t[0]=(0,r.createElementVNode)('div',{class:'widgets-header-title'},'SIDEBAR',-1)),(0,r.createElementVNode)('button',{class:'refresh-btn',type:'button',onClick:(0,r.withModifiers)(g,['stop'])},'刷新')]),(0,r.createElementVNode)('div',zp,[0===a.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Fp,'未启用组件')):(0,r.createCommentVNode)('v-if',!0),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.value,t=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:'widget-host'},[o(t)?((0,r.openBlock)(),(0,r.createBlock)(Vo,{key:t+':'+i.value,'user-code':o(t),'user-css':l(t),'component-id':t,'game-state':e.gameState,onLoaded:k,onError:k},null,8,['user-code','user-css','component-id','game-state'])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Wp,'组件不存在或代码为空：'+(0,r.toDisplayString)(t),1))]))),128))])],512)],6))}}),jp=(0,p.A)(Gp,[['__scopeId','data-v-c5ebd980']]),Jp={class:'saveload-container',role:'dialog','aria-modal':'true'},Yp={class:'header'},Hp={class:'header-left'},Xp={class:'page-title'},Kp={key:0,class:'mode-switch'},qp={class:'header-actions'},Qp={class:'saves-container'},Zp={key:0,class:'loading-state'},ev={class:'system-saves'},tv={class:'save-thumbnail'},av=['src'],nv={key:1,class:'placeholder-thumb'},ov={class:'save-info'},lv={class:'save-header'},rv={class:'save-chapter'},iv={key:0,class:'save-date'},cv={class:'save-summary'},sv={key:0,class:'save-firstline'},dv={class:'save-actions'},uv=['onClick'],mv={class:'slots-col',role:'list'},pv=['onClick'],vv={class:'save-thumbnail'},gv=['src'],fv={key:1,class:'placeholder-thumb'},yv={class:'slot-index-badge'},hv={class:'save-info'},kv={class:'save-header'},Nv={class:'save-chapter'},Ev={key:0,class:'save-date'},Vv={class:'save-summary'},bv={key:0,class:'save-firstline'},wv={class:'save-actions'},Cv=['title','onClick'],Sv=['onClick'],Bv=['onClick'],xv={class:'save-thumbnail'},_v=['src'],Iv={key:1,class:'placeholder-thumb'},Tv={class:'save-info'},Av={class:'save-header'},Mv={class:'save-chapter'},Dv={class:'save-date'},Pv={class:'save-summary'},Ov={key:0,class:'save-firstline'},Rv={class:'save-actions'},Lv=['onClick'],$v=['onClick'],Uv=['onClick'],zv={class:'no-saves'},Fv={class:'rename-header'},Wv={class:'rename-desc'},Gv=['onKeydown'],jv=(0,r.defineComponent)({__name:'SaveLoadModal',props:{visible:{type:Boolean},mode:{default:'both'}},emits:['update:visible','close','save','load','delete'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.computed)(()=>'both'===a.mode||'save'===a.mode),l=(0,r.ref)('load'===a.mode?'load':'save'),i=(0,r.ref)([]),c=(0,r.ref)(!1),s=(0,r.computed)(()=>i.value.filter(e=>'manual'===e.slotType).sort((e,t)=>t.timestamp-e.timestamp).slice(0,7)),d=(0,r.computed)(()=>{const e=[];for(let t=0;t<7;t++)e.push(s.value[t]||null);return e}),u=(0,r.computed)(()=>[...i.value].sort((e,t)=>t.timestamp-e.timestamp)),m=(0,r.computed)(()=>[{key:'cloud',slotType:'cloud',fallbackTitle:'云存档',save:i.value.find(e=>'cloud'===e.slotType||'cloud'===e.id)||null},{key:'auto1',slotType:'auto',autoIndex:1,fallbackTitle:'自动存档 1',save:i.value.find(e=>'auto'===e.slotType&&(1===e.autoIndex||'auto_1'===e.id))||null},{key:'auto2',slotType:'auto',autoIndex:2,fallbackTitle:'自动存档 2',save:i.value.find(e=>'auto'===e.slotType&&(2===e.autoIndex||'auto_2'===e.id))||null}]),p=e=>{if(!e)return'';const t='string'==typeof e.firstLine?e.firstLine.trim():'';if(t)return t;const a=e=>{if(!e||'object'!=typeof e)return'';if('performance'===e.kind)return'';const t=[e.text,e.content,e.message,e.rawText,e.raw];for(const e of t){const t='string'==typeof e?e.trim():'';if(t)return t.slice(0,120)}return''},n=e=>{if(!Array.isArray(e))return'';for(const t of e){const e=a(t);if(e)return e}return''},o=e?.sessionData;return n(o?.dialogueQueue)||n(o?.historyLog)||n(e?.historyLog)||''},v=(0,r.ref)(!1),g=(0,r.ref)(''),f=(0,r.ref)('new'),y=(0,r.ref)(0),h=(0,r.ref)(void 0),k=(0,r.ref)(!1),N=(0,r.ref)(null),V=(0,r.ref)(!1),b=(0,r.ref)(''),w=(0,r.ref)('info');function C(e,t='info'){b.value=e,w.value=t,V.value=!0}async function B(){c.value=!0;try{await Je(),i.value=await pe.idbService.getAllSaves()}catch(e){console.error('[SaveLoadModal] Failed to load saves:',e),i.value=[]}finally{c.value=!1}}function x(e,t,a){f.value=e,y.value=a,h.value=t?.id;const n=t?.title||`手动存档 ${a+1}`;g.value=n,v.value=!0}function I(){v.value=!1}function T(){const e=g.value.trim();if(!e)return void C('请输入存档标题','warning');const t='overwrite'===f.value?h.value:void 0;n('save',t,e),v.value=!1}function A(e){N.value=e,k.value=!0}async function D(){const e=N.value;if(N.value=null,e)try{await pe.idbService.deleteSave(e),await B(),n('delete',e),C('存档已删除','success')}catch(e){console.error('[SaveLoadModal] Failed to delete save:',e),C('删除失败','error')}}function P(e){return new Date(e).toLocaleString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})}(0,r.watch)(()=>a.visible,async e=>{e?(await B(),l.value='load'===a.mode?'load':'save'):(v.value=!1,k.value=!1,N.value=null,V.value=!1)}),(0,r.onMounted)(async()=>{a.visible&&await B()});const O=(e,t)=>'auto'===e?`AUTO${t||''}`:'cloud'===e?'CLOUD':'MANUAL',R=e=>'auto'===e?'badge-auto':'cloud'===e?'badge-cloud':'badge-manual';function L(){v.value=!1,k.value=!1,N.value=null,V.value=!1,n('update:visible',!1),n('close')}async function U(e){try{const t=await async function(e){const t=JSON.stringify(e,null,2);return new Blob([t],{type:'application/json'})}(e),a=URL.createObjectURL(t),n=document.createElement('a');n.href=a,n.download=`save_${e.id}_${Date.now()}.json`,n.click(),URL.revokeObjectURL(a),C('导出成功','success')}catch(e){console.error('[SaveLoadModal] Failed to export:',e),C('导出失败','error')}}function F(){const e=document.createElement('input');e.type='file',e.accept='.json',e.onchange=async e=>{const t=e.target.files?.[0];if(t)try{C('正在导入...','loading');const e=await t.text();await async function(e){const t=JSON.parse(e);return t.id=`imported_${Date.now()}`,t.slotType='manual',delete t.autoIndex,t.isCloud=!1,t.timestamp=Date.now(),await pe.idbService.saveSave(t),t}(e),await B(),C('导入成功','success')}catch(e){console.error('[SaveLoadModal] Failed to import:',e),C('导入失败','error')}},e.click()}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createVNode)(r.Transition,{name:'fade-scale'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'saveload-overlay',onClick:(0,r.withModifiers)(L,['self'])},[(0,r.createElementVNode)('div',Jp,[(0,r.createCommentVNode)(' Header (LoadGame-like) '),(0,r.createElementVNode)('div',Yp,[(0,r.createElementVNode)('div',Hp,[(0,r.createElementVNode)('h2',Xp,(0,r.toDisplayString)(o.value?'记忆回溯':'读档'),1),o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Kp,[(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['mode-btn',{active:'save'===l.value}]),onClick:t[0]||(t[0]=e=>l.value='save')},' 存档 ',2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['mode-btn',{active:'load'===l.value}]),onClick:t[1]||(t[1]=e=>l.value='load')},' 读档 ',2)])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',qp,[(0,r.createElementVNode)('button',{class:'import-btn',onClick:F},[(0,r.createVNode)(E,{name:'import',size:16}),t[6]||(t[6]=(0,r.createElementVNode)('span',null,'导入存档',-1))]),(0,r.createElementVNode)('button',{class:'close-x',onClick:L,'aria-label':'Close'},'✕')])]),(0,r.createCommentVNode)(' Save Slots Panel (LoadGame-like) '),(0,r.createVNode)(S,{class:'saves-panel',fullHeight:!0},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',Qp,[(0,r.createCommentVNode)(' Loading State '),c.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Zp,[...t[7]||(t[7]=[(0,r.createElementVNode)('div',{class:'loading-spinner'},null,-1),(0,r.createElementVNode)('p',null,'加载中...',-1)])])):'save'===l.value&&o.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Save Slots Column (7 manual slots) '),(0,r.createElementVNode)('div',ev,[t[9]||(t[9]=(0,r.createElementVNode)('div',{class:'section-title'},'自动 / 云存档（只读）',-1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(m.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.key,class:'save-item system-save',onClick:t[2]||(t[2]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.createElementVNode)('div',tv,[e.save&&(e.save.screenshot||e.save.thumbnail)?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.save.screenshot||e.save.thumbnail,alt:'Save'},null,8,av)):((0,r.openBlock)(),(0,r.createElementBlock)('div',nv,[(0,r.createVNode)(E,{name:'image',size:32})])),t[8]||(t[8]=(0,r.createElementVNode)('div',{class:'thumbnail-overlay'},null,-1)),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['slot-badge',R(e.slotType)])},(0,r.toDisplayString)(O(e.slotType,e.autoIndex)),3)]),(0,r.createElementVNode)('div',ov,[(0,r.createElementVNode)('div',lv,[(0,r.createElementVNode)('h3',rv,(0,r.toDisplayString)(e.save?.title||e.fallbackTitle),1),e.save?((0,r.openBlock)(),(0,r.createElementBlock)('span',iv,(0,r.toDisplayString)(P(e.save.timestamp)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('p',cv,(0,r.toDisplayString)(e.save?.eventPackName||'暂无存档'),1),p(e.save)?((0,r.openBlock)(),(0,r.createElementBlock)('p',sv,(0,r.toDisplayString)(p(e.save)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',dv,[e.save?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn export-btn',title:'Export',onClick:(0,r.withModifiers)(t=>U(e.save),['stop'])},[(0,r.createVNode)(E,{name:'export',size:18})],8,uv)):(0,r.createCommentVNode)('v-if',!0)])]))),128))]),t[12]||(t[12]=(0,r.createElementVNode)('div',{class:'section-title'},'手动存档',-1)),(0,r.createElementVNode)('div',mv,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(d.value,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:`slot-${a}`,class:(0,r.normalizeClass)(['save-item save-slot',{empty:!e}]),role:'listitem',onClick:t=>e?x('overwrite',e,a):x('new',null,a)},[(0,r.createElementVNode)('div',vv,[e&&(e.screenshot||e.thumbnail)?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.screenshot||e.thumbnail,alt:'Save'},null,8,gv)):((0,r.openBlock)(),(0,r.createElementBlock)('div',fv,[(0,r.createVNode)(E,{name:'plus',size:32})])),t[10]||(t[10]=(0,r.createElementVNode)('div',{class:'thumbnail-overlay'},null,-1)),t[11]||(t[11]=(0,r.createElementVNode)('div',{class:'slot-badge badge-manual'},'MANUAL',-1)),(0,r.createElementVNode)('div',yv,(0,r.toDisplayString)(a+1),1)]),(0,r.createElementVNode)('div',hv,[(0,r.createElementVNode)('div',kv,[(0,r.createElementVNode)('h3',Nv,(0,r.toDisplayString)(e?.title||`空位 ${a+1}`),1),e?((0,r.openBlock)(),(0,r.createElementBlock)('span',Ev,(0,r.toDisplayString)(P(e.timestamp)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('p',Vv,(0,r.toDisplayString)(e?.eventPackName||'点击保存进度'),1),p(e)?((0,r.openBlock)(),(0,r.createElementBlock)('p',bv,(0,r.toDisplayString)(p(e)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',wv,[(0,r.createElementVNode)('button',{class:'action-btn overwrite-btn',title:e?'改名 / 覆盖':'新建存档',onClick:(0,r.withModifiers)(t=>e?x('overwrite',e,a):x('new',null,a),['stop'])},[(0,r.createVNode)(E,{name:'save',size:18})],8,Cv),e?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn export-btn',title:'Export',onClick:(0,r.withModifiers)(t=>U(e),['stop'])},[(0,r.createVNode)(E,{name:'export',size:18})],8,Sv)):(0,r.createCommentVNode)('v-if',!0),e?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'action-btn delete-btn',title:'Delete',onClick:(0,r.withModifiers)(t=>A(e.id),['stop'])},[(0,r.createVNode)(E,{name:'trash',size:18})],8,Bv)):(0,r.createCommentVNode)('v-if',!0)])],10,pv))),128))])],64)):u.value.length>0?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(' Existing Saves '),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(u.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'save-item'},[(0,r.createElementVNode)('div',xv,[e.screenshot||e.thumbnail?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.screenshot||e.thumbnail,alt:'Save'},null,8,_v)):((0,r.openBlock)(),(0,r.createElementBlock)('div',Iv,[(0,r.createVNode)(E,{name:'image',size:32})])),t[13]||(t[13]=(0,r.createElementVNode)('div',{class:'thumbnail-overlay'},null,-1)),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['slot-badge',R(e.slotType)])},(0,r.toDisplayString)(O(e.slotType,e.autoIndex)),3)]),(0,r.createElementVNode)('div',Tv,[(0,r.createElementVNode)('div',Av,[(0,r.createElementVNode)('h3',Mv,(0,r.toDisplayString)(e.title||'未命名存档'),1),(0,r.createElementVNode)('span',Dv,(0,r.toDisplayString)(P(e.timestamp)),1)]),(0,r.createElementVNode)('p',Pv,(0,r.toDisplayString)(e.eventPackName||'未知事件包'),1),p(e)?((0,r.openBlock)(),(0,r.createElementBlock)('p',Ov,(0,r.toDisplayString)(p(e)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',Rv,['load'===l.value?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn load-btn',title:'Load',onClick:t=>async function(e){n('load',e)}(e)},[(0,r.createVNode)(E,{name:'play',size:20})],8,Lv)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('button',{class:'action-btn export-btn',title:'Export',onClick:t=>U(e)},[(0,r.createVNode)(E,{name:'export',size:18})],8,$v),(0,r.createElementVNode)('button',{class:'action-btn delete-btn',title:'Delete',onClick:t=>A(e.id)},[(0,r.createVNode)(E,{name:'trash',size:18})],8,Uv)])]))),128))],64)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:3},[(0,r.createCommentVNode)(' No Saves '),(0,r.createElementVNode)('div',zv,[(0,r.createVNode)(E,{name:'info',size:48}),t[14]||(t[14]=(0,r.createElementVNode)('p',null,'暂无存档',-1)),t[15]||(t[15]=(0,r.createElementVNode)('span',null,'开始新游戏后可在此读取存档',-1))])],2112))])]),_:1}),(0,r.createCommentVNode)(' Footer '),(0,r.createElementVNode)('div',{class:'footer'},[(0,r.createElementVNode)('button',{class:'btn-secondary',onClick:L},'关闭')])]),(0,r.createCommentVNode)(' Rename / Save Dialog (TempMessage-like style) '),(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[v.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'rename-overlay',onClick:(0,r.withModifiers)(I,['self'])},[(0,r.createVNode)(S,{class:'rename-box'},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',Fv,[(0,r.createVNode)(E,{name:'save',size:'1.5em',class:'rename-icon'}),(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)('overwrite'===f.value?'覆盖存档':'新建存档'),1)]),(0,r.createElementVNode)('p',Wv,(0,r.toDisplayString)('overwrite'===f.value?'将覆盖当前存档内容（可修改标题）。':'请输入存档标题。'),1),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>g.value=e),class:'rename-input',type:'text',maxlength:'40',placeholder:'输入存档标题',onKeydown:(0,r.withKeys)((0,r.withModifiers)(T,['prevent']),['enter'])},null,40,Gv),[[r.vModelText,g.value]]),(0,r.createElementVNode)('div',{class:'rename-actions'},[(0,r.createElementVNode)('button',{class:'btn-cancel',onClick:I},'取消'),(0,r.createElementVNode)('button',{class:'btn-confirm',onClick:T},'确定')])]),_:1})])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])):(0,r.createCommentVNode)('v-if',!0)]),_:1}),(0,r.createCommentVNode)(' Delete confirm '),(0,r.createVNode)(me,{visible:k.value,'onUpdate:visible':t[4]||(t[4]=e=>k.value=e),title:'删除存档',message:'确定要删除这个存档吗？该操作无法撤销。',onConfirm:D},null,8,['visible']),(0,r.createCommentVNode)(' Temp message '),(0,r.createVNode)(M,{visible:V.value,'onUpdate:visible':t[5]||(t[5]=e=>V.value=e),message:b.value,type:w.value},null,8,['visible','message','type'])],64))}}),Jv=(0,p.A)(jv,[['__scopeId','data-v-2470003a']]),Yv='assets';function Hv(){const e=(0,r.ref)(!1),t=(0,r.ref)(''),a=()=>new Promise((t,a)=>{const n=indexedDB.open('MhjgDebugDB',2);n.onerror=()=>{console.error('IDB Error',n.error),a(n.error)},n.onsuccess=()=>{e.value=!0,t(n.result)},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(Yv)||t.createObjectStore(Yv)}});return{isReady:e,status:t,saveAsset:async(e,n,o)=>{try{const l=await a(),r=l.transaction(Yv,'readwrite').objectStore(Yv),i=`${e}:${n}`;return await new Promise((e,t)=>{const a=r.put(o,i);a.onsuccess=()=>e(),a.onerror=()=>t(a.error)}),t.value=`Saved ${e}: ${n}`,!0}catch(e){return console.error('Save failed',e),t.value='Save failed',!1}},deleteAsset:async e=>{try{const t=await a(),n=t.transaction(Yv,'readwrite').objectStore(Yv);return await new Promise((t,a)=>{const o=n.delete(e);o.onsuccess=()=>t(),o.onerror=()=>a(o.error)}),!0}catch(e){return console.error('Delete failed',e),!1}},getAllAssets:async e=>{try{const t=await a(),n=t.transaction(Yv,'readonly').objectStore(Yv);return new Promise((t,a)=>{const o=[],l=n.openCursor();l.onsuccess=a=>{const n=a.target.result;if(n){const t=n.key;if(t.includes(':')){const[a,...l]=t.split(':'),r=l.join(':');e&&a!==e||'char'!==a&&'bg'!==a||o.push({key:t,type:a,name:r,data:n.value})}n.continue()}else t(o)},l.onerror=()=>a(l.error)})}catch(e){return console.error('Get All failed',e),[]}},getAsset:async(e,t)=>{try{const n=`${e}:${t}`,o=await a();return new Promise(a=>{const l=o.transaction(Yv,'readonly').objectStore(Yv).get(n);l.onsuccess=()=>{const o=l.result;a(o?{key:n,type:e,name:t,data:o}:null)},l.onerror=()=>a(null)})}catch(e){return null}}}}const Xv={class:'settings-section'},Kv={class:'debug-card highlight-glow'},qv={class:'card-row'},Qv={class:'setting-info'},Zv={class:'flex-row'},eg={class:'card-header'},tg={key:0,class:'disabled-hint'},ag={class:'card-body'},ng={class:'action-row'},og={class:'card-header'},lg={key:0,class:'disabled-hint'},rg={class:'card-body'},ig={class:'upload-zone'},cg={class:'file-label'},sg=['disabled'],dg={key:0,class:'temp-preview'},ug=['src'],mg={class:'assets-grid custom-scrollbar'},pg=['onClick'],vg={class:'asset-img-wrapper'},gg=['src'],fg={class:'asset-info'},yg={class:'asset-name'},hg=['onClick'],kg={class:'card-header'},Ng={key:0,class:'disabled-hint'},Eg={class:'card-body'},Vg={class:'upload-zone'},bg={class:'file-label'},wg=['disabled'],Cg={key:0,class:'temp-preview char-mode'},Sg=['src'],Bg={class:'assets-grid custom-scrollbar'},xg=['onClick'],_g={class:'asset-img-wrapper'},Ig=['src'],Tg={class:'asset-info'},Ag={class:'asset-name'},Mg=['onClick'],Dg={key:0,class:'status-bar'},Pg=(0,r.defineComponent)({__name:'SettingsDebugTab',props:{settings:{}},emits:['debug:text','update:settings'],setup(e,{emit:t}){const a=e,n=t,{saveAsset:o,deleteAsset:l,getAllAssets:i}=Hv(),c=()=>{n('update:settings',{...a.settings,debugMode:!a.settings.debugMode})},s=(0,r.ref)(''),d=(0,r.ref)(''),u=(0,r.ref)(''),m=(0,r.ref)(''),p=(0,r.ref)(''),v=(0,r.ref)([]),g=(0,r.ref)([]),f=(0,r.ref)(''),y=(0,r.ref)(''),h=e=>{y.value=e,setTimeout(()=>y.value='',3e3)},k=async()=>{v.value=await i('bg'),g.value=await i('char')};(0,r.onMounted)(async()=>{await k();try{const e=await fe('lastDebugText_v1');if('string'==typeof e&&e)return void(s.value=e)}catch{}try{const e=localStorage.getItem('lastDebugText');e&&(s.value=e,await ye('lastDebugText_v1',e),localStorage.removeItem('lastDebugText'))}catch{}});const N=()=>{s.value&&(a.settings.debugMode?(ye('lastDebugText_v1',s.value),n('debug:text',s.value),h('剧情文本已应用')):h('请先开启调试模式'))},V=(e,t)=>{const a=e.target.files?.[0];if(!a)return;const n=new FileReader;n.onload=e=>{const a=e.target?.result;'bg'===t?m.value=a:p.value=a},n.readAsDataURL(a)},b=async()=>{d.value&&m.value&&(await o('bg',d.value,m.value),m.value='',d.value='',await k(),h('背景已保存'))},w=async()=>{u.value&&p.value&&(await o('char',u.value,p.value),p.value='',u.value='',await k(),h('角色立绘已保存'))},C=async e=>{confirm(`确定删除 ${e.name}?`)&&(await l(e.key),await k(),h('已删除'))};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Xv,[t[16]||(t[16]=(0,r.createElementVNode)('div',{class:'section-header'},[(0,r.createElementVNode)('h3',{class:'section-title'},'开发者工具 (Debug)'),(0,r.createElementVNode)('p',{class:'section-desc'},'管理测试资源。所有更改仅在本地保存 (IndexedDB)。')],-1)),(0,r.createCommentVNode)(' Debug Mode Toggle '),(0,r.createElementVNode)('div',Kv,[(0,r.createElementVNode)('div',qv,[(0,r.createElementVNode)('div',Qv,[(0,r.createElementVNode)('div',Zv,[(0,r.createVNode)(E,{name:'settings',size:18}),t[5]||(t[5]=(0,r.createElementVNode)('span',{class:'setting-name'},'调试模式 (Debug Mode)',-1))]),t[6]||(t[6]=(0,r.createElementVNode)('span',{class:'setting-hint'},'开启后应用调试内容 (Open to apply debug content)',-1))]),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['toggle-switch',{active:a.settings.debugMode}]),onClick:c},[...t[7]||(t[7]=[(0,r.createElementVNode)('div',{class:'toggle-knob'},null,-1)])],2)])]),(0,r.createCommentVNode)(' 1. 剧情文本调试 '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['debug-card',{disabled:!a.settings.debugMode}])},[(0,r.createElementVNode)('div',eg,[(0,r.createVNode)(E,{name:'code',class:'card-icon'}),t[8]||(t[8]=(0,r.createElementVNode)('span',{class:'card-title'},'剧情模拟 (Story Update)',-1)),a.settings.debugMode?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',tg,'需开启调试模式'))]),(0,r.createElementVNode)('div',ag,[(0,r.withDirectives)((0,r.createElementVNode)('textarea',{class:'debug-textarea','onUpdate:modelValue':t[0]||(t[0]=e=>s.value=e),placeholder:'输入剧情文本... (例如: Alice: Hello!)',rows:'3'},null,512),[[r.vModelText,s.value]]),(0,r.createElementVNode)('div',ng,[(0,r.createElementVNode)('button',{class:'action-btn',onClick:N},[(0,r.createVNode)(E,{name:'play',size:16}),t[9]||(t[9]=(0,r.createElementVNode)('span',null,'应用并运行 (Apply & Run)',-1))])])])],2),(0,r.createCommentVNode)(' 2. 背景管理 '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['debug-card',{disabled:!a.settings.debugMode}])},[(0,r.createElementVNode)('div',og,[(0,r.createVNode)(E,{name:'location',class:'card-icon'}),t[10]||(t[10]=(0,r.createElementVNode)('span',{class:'card-title'},'背景库 (Backgrounds)',-1)),a.settings.debugMode?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',lg,'需开启调试模式'))]),(0,r.createElementVNode)('div',rg,[(0,r.createCommentVNode)(' 上传区 '),(0,r.createElementVNode)('div',ig,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[1]||(t[1]=e=>d.value=e),placeholder:'地点名称 (如: Bedroom)',class:'input-text'},null,512),[[r.vModelText,d.value]]),(0,r.createElementVNode)('label',cg,[t[11]||(t[11]=(0,r.createTextVNode)(' 选择图片 ',-1)),(0,r.createElementVNode)('input',{type:'file',accept:'image/*',onChange:t[2]||(t[2]=e=>V(e,'bg')),hidden:''},null,32)]),(0,r.createElementVNode)('button',{class:'action-btn small',disabled:!d.value||!m.value,onClick:b},'保存',8,sg)]),(0,r.createCommentVNode)(' 预览待保存图片 '),m.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',dg,[(0,r.createElementVNode)('img',{src:m.value},null,8,ug),t[12]||(t[12]=(0,r.createElementVNode)('span',{class:'preview-tag'},'待保存',-1))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 列表区 '),(0,r.createElementVNode)('div',mg,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(v.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.key,class:(0,r.normalizeClass)(['asset-item',{active:f.value===e.key}]),onClick:t=>(e=>{a.settings.debugMode?(f.value=e.key,n('update:settings',{...a.settings,bgImage:e.data}),h(`背景已切换: ${e.name}`)):h('请先开启调试模式')})(e)},[(0,r.createElementVNode)('div',vg,[(0,r.createElementVNode)('img',{src:e.data,loading:'lazy'},null,8,gg)]),(0,r.createElementVNode)('div',fg,[(0,r.createElementVNode)('span',yg,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:(0,r.withModifiers)(t=>C(e),['stop'])},'×',8,hg)])],10,pg))),128))])])],2),(0,r.createCommentVNode)(' 3. 立绘管理 '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['debug-card',{disabled:!a.settings.debugMode}])},[(0,r.createElementVNode)('div',kg,[(0,r.createVNode)(E,{name:'user',class:'card-icon'}),t[13]||(t[13]=(0,r.createElementVNode)('span',{class:'card-title'},'角色立绘库 (Characters)',-1)),a.settings.debugMode?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',Ng,'需开启调试模式'))]),(0,r.createElementVNode)('div',Eg,[(0,r.createCommentVNode)(' 上传区 '),(0,r.createElementVNode)('div',Vg,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[3]||(t[3]=e=>u.value=e),placeholder:'角色名 (如: Alice)',class:'input-text'},null,512),[[r.vModelText,u.value]]),(0,r.createElementVNode)('label',bg,[t[14]||(t[14]=(0,r.createTextVNode)(' 选择图片 ',-1)),(0,r.createElementVNode)('input',{type:'file',accept:'image/*',onChange:t[4]||(t[4]=e=>V(e,'char')),hidden:''},null,32)]),(0,r.createElementVNode)('button',{class:'action-btn small',disabled:!u.value||!p.value,onClick:w},'保存',8,wg)]),(0,r.createCommentVNode)(' 预览待保存图片 '),p.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Cg,[(0,r.createElementVNode)('img',{src:p.value},null,8,Sg),t[15]||(t[15]=(0,r.createElementVNode)('span',{class:'preview-tag'},'待保存',-1))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 列表区 '),(0,r.createElementVNode)('div',Bg,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(g.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.key,class:'asset-item char-mode',onClick:t=>(e=>{a.settings.debugMode?(n('update:settings',{...a.settings,charImage:e.data}),h(`立绘已应用: ${e.name}`)):h('请先开启调试模式才能预览')})(e)},[(0,r.createElementVNode)('div',_g,[(0,r.createElementVNode)('img',{src:e.data,loading:'lazy'},null,8,Ig)]),(0,r.createElementVNode)('div',Tg,[(0,r.createElementVNode)('span',Ag,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:(0,r.withModifiers)(t=>C(e),['stop'])},'×',8,Mg)])],8,xg))),128))])])],2),y.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Dg,(0,r.toDisplayString)(y.value),1)):(0,r.createCommentVNode)('v-if',!0)]))}}),Og=(0,p.A)(Pg,[['__scopeId','data-v-5c1378ba']]),Rg=Og,Lg={class:'preview-stage-wrapper'},$g={class:'preview-stage'},Ug={class:'background-layer'},zg=['src'],Fg={key:1,class:'bg-placeholder'},Wg={class:'character-layer'},Gg=['src'],jg=['src'],Jg=(0,r.defineComponent)({__name:'PreviewStage',props:{charCount:{},bgImage:{},charImage:{},settings:{},layoutConfigs:{}},setup(e){const t=e,a=(0,r.ref)(!1),n=()=>{if('undefined'==typeof window)return;const e=window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,t=window.matchMedia?.('(orientation: landscape)')?.matches??window.innerWidth>window.innerHeight;a.value=e&&t};(0,r.onMounted)(()=>{n(),window.addEventListener('resize',n,{passive:!0}),window.addEventListener('orientationchange',n)}),(0,r.onUnmounted)(()=>{window.removeEventListener('resize',n),window.removeEventListener('orientationchange',n)});const o=(0,r.computed)(()=>({fontSize:t.settings?.fontSize??20,textSpeed:t.settings?.textSpeed??0,autoSpeed:t.settings?.autoSpeed??1e3,dialogueOpacity:t.settings?.dialogueOpacity??85,dialogueWidth:t.settings?.dialogueWidth??90,dialogueHeight:t.settings?.dialogueHeight??200,dialoguePaddingX:t.settings?.dialoguePaddingX??2.5,dialoguePaddingY:t.settings?.dialoguePaddingY??2,dialogueBottom:t.settings?.dialogueBottom??3})),l=()=>{},i=e=>{const a=t.charCount,n=t.layoutConfigs[a];if(!n||!n[e-1]){return{left:`calc(50% + ${(e-(a+1)/2)*25}%)`,transform:'translateX(-50%)',height:'60%',bottom:'0'}}const o=n[e-1];return{left:`${o.charX}%`,transform:'translateX(-50%)',bottom:`${o.charY}%`,height:`${o.charScale}%`}};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Lg,[(0,r.createCommentVNode)(' Preview Header '),t[1]||(t[1]=(0,r.createElementVNode)('div',{class:'preview-header'},[(0,r.createElementVNode)('span',{class:'preview-label'},'实时预览 (Live Preview)')],-1)),(0,r.createCommentVNode)(' Preview Stage (1:1 matches MainGame structure) '),(0,r.createElementVNode)('div',$g,[(0,r.createCommentVNode)(' 1. Background Layer '),(0,r.createElementVNode)('div',Ug,[e.bgImage?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.bgImage,alt:'Background',class:'bg-image'},null,8,zg)):((0,r.openBlock)(),(0,r.createElementBlock)('div',Fg)),t[0]||(t[0]=(0,r.createElementVNode)('div',{class:'bg-gradient'},null,-1))]),(0,r.createCommentVNode)(' 2. Character Layer (z-index: 5, under dialogue) '),(0,r.createElementVNode)('div',Wg,[a.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Mobile landscape safe mode: avoid FLIP/transform animations from transition-group '),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.charCount,t=>(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:t,src:e.charImage,class:'char-img dynamic-char',style:(0,r.normalizeStyle)(i(t))},null,12,jg)),[[r.vShow,e.charImage]])),128))],64)):((0,r.openBlock)(),(0,r.createBlock)(r.TransitionGroup,{key:0,name:'char-fade'},{default:(0,r.withCtx)(()=>[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.charCount,t=>(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:t,src:e.charImage,class:'char-img dynamic-char',style:(0,r.normalizeStyle)(i(t))},null,12,Gg)),[[r.vShow,e.charImage]])),128))]),_:1})),(0,r.createCommentVNode)(' Placeholder when no image '),e.charImage?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:2},(0,r.renderList)(e.charCount,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:'ph-'+e,class:'char-placeholder',style:(0,r.normalizeStyle)(i(e))},[(0,r.createVNode)(E,{name:'user',size:28}),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(e),1)],4))),128))]),(0,r.createCommentVNode)(' 3. HUD Layer (z-index: 20) - Uses GameHud component style '),(0,r.createVNode)(vp,{class:'preview-hud'}),(0,r.createCommentVNode)(' 4. Dialogue Box Layer (z-index: 30) - Uses real DialogueBox '),(0,r.createVNode)(Rm,{name:'角色名',text:'这是预览文本。调整设定可以实时看到效果变化。','auto-mode':!1,'skip-mode':!1,settings:o.value,onNext:l,onBack:l,onLog:l,onAuto:l,onSkip:l},null,8,['settings'])])]))}}),Yg=(0,p.A)(Jg,[['__scopeId','data-v-adbfeaec']]),Hg={class:'settings-section'},Xg={class:'sub-tabs'},Kg=['onClick'],qg={key:0,class:'debug-card preview-card'},Qg={key:1,class:'debug-card'},Zg={class:'card-header'},ef={class:'card-body'},tf={class:'controls-panel'},af={class:'control-row'},nf={class:'control-value'},of={class:'control-row'},lf={class:'control-value'},rf={class:'control-row'},cf={class:'control-value'},sf={key:2,class:'dialogue-settings'},df={class:'debug-card'},uf={class:'card-header'},mf={class:'card-body'},pf={class:'controls-panel'},vf={class:'control-row'},gf={class:'control-value'},ff={class:'control-row'},yf={class:'control-value'},hf={class:'control-row'},kf={class:'control-value'},Nf={class:'control-row'},Ef={class:'control-value'},Vf={class:'debug-card'},bf={class:'card-header'},wf={class:'card-body'},Cf={class:'controls-panel'},Sf={class:'control-row'},Bf={class:'control-value'},xf={class:'control-row'},_f={class:'control-value'},If={key:3,class:'performance-settings'},Tf={class:'debug-card highlight-card'},Af={class:'card-header-row'},Mf={class:'switch'},Df={class:'card-content-row'},Pf={class:'debug-card hint-card'},Of={class:'hint-icon'},Rf=(0,r.defineComponent)({__name:'SettingsDisplayTab',props:{settings:{}},emits:['update:settings'],setup(e,{emit:t}){const a=e,n=t,{getAllAssets:o}=Hv(),i=(0,r.ref)(!1),c=()=>{if('undefined'==typeof window)return;const e=window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,t=navigator.userAgent||'',a=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t),n=window.innerWidth<=900;i.value=a||e&&n},s=[{id:'layout',label:'立绘布局'},{id:'dialogue',label:'对话框'},{id:'performance',label:'演出效果'}],d=(0,r.ref)('layout'),u=(0,r.ref)(''),m=(0,r.ref)(''),p=(0,r.ref)(a.settings.performanceEnabled??!0),v=(0,r.reactive)({debugMode:a.settings.debugMode??!1});(0,r.watch)(()=>a.settings.performanceEnabled,e=>{'boolean'==typeof e&&(p.value=e)});const g=(0,r.reactive)({dialogueWidth:a.settings.dialogueWidth??90,dialogueOpacity:a.settings.dialogueOpacity??85,dialogueHeight:a.settings.dialogueHeight??200,dialoguePaddingX:a.settings.dialoguePaddingX??2.5,dialoguePaddingY:a.settings.dialoguePaddingY??2,dialogueBottom:a.settings.dialogueBottom??3}),f=(0,r.computed)(()=>({...a.settings,...g})),y=(0,r.reactive)(a.settings.layoutConfigs?JSON.parse(JSON.stringify(a.settings.layoutConfigs)):{1:[{charScale:80,charX:50,charY:0}],2:[{charScale:75,charX:30,charY:0},{charScale:75,charX:70,charY:0}],3:[{charScale:70,charX:20,charY:0},{charScale:75,charX:50,charY:0},{charScale:70,charX:80,charY:0}],4:[{charScale:65,charX:15,charY:0},{charScale:70,charX:38,charY:0},{charScale:70,charX:62,charY:0},{charScale:65,charX:85,charY:0}]}),h=(0,r.computed)(()=>{const e=y?.[1]?.[0];return e||{charScale:80,charX:50,charY:0}});(0,r.onMounted)(async()=>{c(),window.addEventListener('resize',c,{passive:!0}),window.addEventListener('orientationchange',c);try{const{getAllBackgroundImages:e,getAllCharacterImages:t}=await Promise.resolve().then(l.bind(l,374)),a=e(),n=t();if(a.length>0&&(u.value=a[0].imageUrl,console.log('[SettingsDisplayTab] Loaded background from gameAssets')),n.length>0&&(m.value=n[0].imageUrl,console.log('[SettingsDisplayTab] Loaded character from gameAssets')),u.value&&m.value)return}catch(e){console.warn('[SettingsDisplayTab] gameAssets not available, trying event pack')}const e=sessionStorage.getItem('current_game_event_id');if(e)try{const{idbService:t}=await Promise.resolve().then(l.bind(l,894)),a=(await t.getAllWorks()).find(t=>'EVENT'===t.type&&t.id===e);if(a?.data){const e=a.data;if(e.sceneBackgrounds?.length>0&&(u.value=e.sceneBackgrounds[0].imageUrl||e.sceneBackgrounds[0]),e.characterImages?.length>0&&(m.value=e.characterImages[0].imageUrl||e.characterImages[0]),console.log('[SettingsDisplayTab] Loaded event pack assets:',{bg:!!u.value,char:!!m.value}),u.value&&m.value)return}}catch(e){console.warn('[SettingsDisplayTab] Failed to load event pack:',e)}const t=await o('char');t.length>0&&!m.value&&(m.value=t[0].data);const a=await o('bg');a.length>0&&!u.value&&(u.value=a[0].data)}),(0,r.onUnmounted)(()=>{window.removeEventListener('resize',c),window.removeEventListener('orientationchange',c)}),(0,r.watch)(()=>a.settings,e=>{void 0!==e.debugMode&&(v.debugMode=e.debugMode),e.layoutConfigs&&Object.assign(y,JSON.parse(JSON.stringify(e.layoutConfigs))),void 0!==e.dialogueWidth&&(g.dialogueWidth=e.dialogueWidth),void 0!==e.dialogueOpacity&&(g.dialogueOpacity=e.dialogueOpacity),void 0!==e.dialogueHeight&&(g.dialogueHeight=e.dialogueHeight),void 0!==e.dialoguePaddingX&&(g.dialoguePaddingX=e.dialoguePaddingX),void 0!==e.dialoguePaddingY&&(g.dialoguePaddingY=e.dialoguePaddingY),void 0!==e.dialogueBottom&&(g.dialogueBottom=e.dialogueBottom)},{deep:!0});const k=()=>{N()},N=()=>{n('update:settings',{...a.settings,debugMode:v.debugMode,layoutConfigs:JSON.parse(JSON.stringify(y)),charScale:y[1][0].charScale,charX:y[1][0].charX,charY:y[1][0].charY,...g,performanceEnabled:!!p.value})},V=()=>{if('layout'===d.value){const e={1:[{charScale:80,charX:50,charY:0}],2:[{charScale:75,charX:30,charY:0},{charScale:75,charX:70,charY:0}],3:[{charScale:70,charX:20,charY:0},{charScale:75,charX:50,charY:0},{charScale:70,charX:80,charY:0}],4:[{charScale:65,charX:15,charY:0},{charScale:70,charX:38,charY:0},{charScale:70,charX:62,charY:0},{charScale:65,charX:85,charY:0}]};Object.assign(y,e)}else'dialogue'===d.value&&(g.dialogueWidth=90,g.dialogueOpacity=85,g.dialogueHeight=200,g.dialoguePaddingX=2.5,g.dialoguePaddingY=2,g.dialogueBottom=3);N()},b=(e,t,a)=>(e-t)/(a-t)*100;return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Hg,[t[27]||(t[27]=(0,r.createElementVNode)('div',{class:'section-header'},[(0,r.createElementVNode)('h3',{class:'section-title'},'画面表现 (Display)'),(0,r.createElementVNode)('p',{class:'section-desc'},'调整立绘大小、位置及界面元素。')],-1)),(0,r.createCommentVNode)(' Sub-tabs '),(0,r.createElementVNode)('div',Xg,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s,e=>(0,r.createElementVNode)('button',{key:e.id,class:(0,r.normalizeClass)(['sub-tab-btn',{active:d.value===e.id}]),onClick:t=>d.value=e.id},(0,r.toDisplayString)(e.label),11,Kg)),64))]),(0,r.createCommentVNode)(' 预览区域 (独立组件) '),(0,r.createCommentVNode)(' Mobile: disabled due to WebView/GPU artifacts; desktop unchanged '),i.value?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',qg,[(0,r.createVNode)(Yg,{'char-count':1,'bg-image':u.value,'char-image':m.value,settings:f.value,'layout-configs':y},null,8,['bg-image','char-image','settings','layout-configs'])])),(0,r.createCommentVNode)(' 立绘布局设置 (按人数) '),'layout'===d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Qg,[(0,r.createElementVNode)('div',Zg,[(0,r.createVNode)(E,{name:'user',class:'card-icon'}),t[10]||(t[10]=(0,r.createElementVNode)('span',{class:'card-title'},'立绘布局',-1))]),(0,r.createElementVNode)('div',ef,[(0,r.createCommentVNode)(' 当前角色的控制面板 '),(0,r.createElementVNode)('div',tf,[(0,r.createCommentVNode)(' 缩放 '),(0,r.createElementVNode)('div',af,[t[11]||(t[11]=(0,r.createElementVNode)('span',{class:'control-label'},'缩放 (Scale)',-1)),(0,r.createElementVNode)('span',nf,(0,r.toDisplayString)(h.value.charScale)+'%',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'20',max:'500',step:'5','onUpdate:modelValue':t[0]||(t[0]=e=>h.value.charScale=e),onInput:k,style:(0,r.normalizeStyle)({'--progress':b(h.value.charScale,20,500)+'%'})},null,36),[[r.vModelText,h.value.charScale,void 0,{number:!0}]]),(0,r.createCommentVNode)(' 水平位置 '),(0,r.createElementVNode)('div',of,[t[12]||(t[12]=(0,r.createElementVNode)('span',{class:'control-label'},'水平位置 (X)',-1)),(0,r.createElementVNode)('span',lf,(0,r.toDisplayString)(h.value.charX)+'%',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'0',max:'100',step:'1','onUpdate:modelValue':t[1]||(t[1]=e=>h.value.charX=e),onInput:k,style:(0,r.normalizeStyle)({'--progress':b(h.value.charX,0,100)+'%'})},null,36),[[r.vModelText,h.value.charX,void 0,{number:!0}]]),(0,r.createCommentVNode)(' 垂直偏移 '),(0,r.createElementVNode)('div',rf,[t[13]||(t[13]=(0,r.createElementVNode)('span',{class:'control-label'},'垂直偏移 (Y)',-1)),(0,r.createElementVNode)('span',cf,(0,r.toDisplayString)(h.value.charY)+'%',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'-100',max:'100',step:'1','onUpdate:modelValue':t[2]||(t[2]=e=>h.value.charY=e),onInput:k,style:(0,r.normalizeStyle)({'--progress':b(h.value.charY,-100,100)+'%'})},null,36),[[r.vModelText,h.value.charY,void 0,{number:!0}]])])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 对话框设置区块 '),'dialogue'===d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',sf,[(0,r.createCommentVNode)(' 对话框控制 '),(0,r.createElementVNode)('div',df,[(0,r.createElementVNode)('div',uf,[(0,r.createVNode)(E,{name:'message',class:'card-icon'}),t[14]||(t[14]=(0,r.createElementVNode)('span',{class:'card-title'},'尺寸与位置 (Size & Position)',-1))]),(0,r.createElementVNode)('div',mf,[(0,r.createElementVNode)('div',pf,[(0,r.createCommentVNode)(' 宽度 '),(0,r.createElementVNode)('div',vf,[t[15]||(t[15]=(0,r.createElementVNode)('span',{class:'control-label'},'宽度 (Width)',-1)),(0,r.createElementVNode)('span',gf,(0,r.toDisplayString)(g.dialogueWidth)+'%',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'30',max:'100',step:'5','onUpdate:modelValue':t[3]||(t[3]=e=>g.dialogueWidth=e),onInput:N,style:(0,r.normalizeStyle)({'--progress':b(g.dialogueWidth,30,100)+'%'})},null,36),[[r.vModelText,g.dialogueWidth,void 0,{number:!0}]]),(0,r.createCommentVNode)(' 最小高度 '),(0,r.createElementVNode)('div',ff,[t[16]||(t[16]=(0,r.createElementVNode)('span',{class:'control-label'},'最小高度 (Min Height)',-1)),(0,r.createElementVNode)('span',yf,(0,r.toDisplayString)(g.dialogueHeight)+'px',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'100',max:'400',step:'10','onUpdate:modelValue':t[4]||(t[4]=e=>g.dialogueHeight=e),onInput:N,style:(0,r.normalizeStyle)({'--progress':b(g.dialogueHeight,100,400)+'%'})},null,36),[[r.vModelText,g.dialogueHeight,void 0,{number:!0}]]),(0,r.createCommentVNode)(' 底部距离 '),(0,r.createElementVNode)('div',hf,[t[17]||(t[17]=(0,r.createElementVNode)('span',{class:'control-label'},'底部距离 (Bottom)',-1)),(0,r.createElementVNode)('span',kf,(0,r.toDisplayString)(g.dialogueBottom)+'em',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'0',max:'10',step:'0.5','onUpdate:modelValue':t[5]||(t[5]=e=>g.dialogueBottom=e),onInput:N,style:(0,r.normalizeStyle)({'--progress':b(g.dialogueBottom,0,10)+'%'})},null,36),[[r.vModelText,g.dialogueBottom,void 0,{number:!0}]]),(0,r.createCommentVNode)(' 透明度 '),(0,r.createElementVNode)('div',Nf,[t[18]||(t[18]=(0,r.createElementVNode)('span',{class:'control-label'},'透明度 (Opacity)',-1)),(0,r.createElementVNode)('span',Ef,(0,r.toDisplayString)(g.dialogueOpacity)+'%',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'30',max:'100',step:'5','onUpdate:modelValue':t[6]||(t[6]=e=>g.dialogueOpacity=e),onInput:N,style:(0,r.normalizeStyle)({'--progress':b(g.dialogueOpacity,30,100)+'%'})},null,36),[[r.vModelText,g.dialogueOpacity,void 0,{number:!0}]])])])]),(0,r.createCommentVNode)(' 内边距设置 '),(0,r.createElementVNode)('div',Vf,[(0,r.createElementVNode)('div',bf,[(0,r.createVNode)(E,{name:'compress',class:'card-icon'}),t[19]||(t[19]=(0,r.createElementVNode)('span',{class:'card-title'},'内边距 (Padding)',-1))]),(0,r.createElementVNode)('div',wf,[(0,r.createElementVNode)('div',Cf,[(0,r.createCommentVNode)(' 水平内边距 '),(0,r.createElementVNode)('div',Sf,[t[20]||(t[20]=(0,r.createElementVNode)('span',{class:'control-label'},'水平内边距 (Horizontal)',-1)),(0,r.createElementVNode)('span',Bf,(0,r.toDisplayString)(g.dialoguePaddingX)+'em',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'0.5',max:'5',step:'0.1','onUpdate:modelValue':t[7]||(t[7]=e=>g.dialoguePaddingX=e),onInput:N,style:(0,r.normalizeStyle)({'--progress':b(g.dialoguePaddingX,.5,5)+'%'})},null,36),[[r.vModelText,g.dialoguePaddingX,void 0,{number:!0}]]),(0,r.createCommentVNode)(' 垂直内边距 '),(0,r.createElementVNode)('div',xf,[t[21]||(t[21]=(0,r.createElementVNode)('span',{class:'control-label'},'垂直内边距 (Vertical)',-1)),(0,r.createElementVNode)('span',_f,(0,r.toDisplayString)(g.dialoguePaddingY)+'em',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'0.5',max:'5',step:'0.1','onUpdate:modelValue':t[8]||(t[8]=e=>g.dialoguePaddingY=e),onInput:N,style:(0,r.normalizeStyle)({'--progress':b(g.dialoguePaddingY,.5,5)+'%'})},null,36),[[r.vModelText,g.dialoguePaddingY,void 0,{number:!0}]])])])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 性能设置区块 '),'performance'===d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',If,[(0,r.createElementVNode)('div',Tf,[(0,r.createElementVNode)('div',Af,[(0,r.createVNode)(E,{name:'sparkles',class:'card-icon'}),t[23]||(t[23]=(0,r.createElementVNode)('span',{class:'card-label'},'沉浸式演出模式',-1)),t[24]||(t[24]=(0,r.createElementVNode)('div',{class:'spacer'},null,-1)),(0,r.createElementVNode)('label',Mf,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[9]||(t[9]=e=>p.value=e),onChange:N},null,544),[[r.vModelCheckbox,p.value]]),t[22]||(t[22]=(0,r.createElementVNode)('span',{class:'slider'},null,-1))])]),(0,r.createElementVNode)('div',Df,[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['status-indicator',{active:p.value}])},[t[25]||(t[25]=(0,r.createElementVNode)('div',{class:'status-dot'},null,-1)),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(p.value?'已开启 (ENABLED)':'已关闭 (DISABLED)'),1)],2)])]),(0,r.createElementVNode)('div',Pf,[(0,r.createElementVNode)('div',Of,[(0,r.createVNode)(E,{name:'info',size:20})]),t[26]||(t[26]=(0,r.createElementVNode)('div',{class:'hint-content'},[(0,r.createElementVNode)('div',{class:'hint-title'},'演出模式说明'),(0,r.createElementVNode)('div',{class:'hint-text'},[(0,r.createTextVNode)(' 开启后，系统时间、地点变更、新角色登场以及好感度变化将以特殊的视觉效果展示，增强代入感。 '),(0,r.createElementVNode)('br'),(0,r.createElementVNode)('span',{class:'sub-hint'},'关闭此选项不会影响变量的实际计算，仅跳过视觉动画。')])],-1))])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 快速操作 '),(0,r.createElementVNode)('div',{class:'quick-actions'},[(0,r.createElementVNode)('button',{class:'action-btn outline',onClick:V},'重置默认 (Reset)')])]))}}),Lf=(0,p.A)(Rf,[['__scopeId','data-v-69a21231']]),$f={class:'settings-section'},Uf={class:'sidebar-layout'},zf={class:'config-column'},Ff={class:'debug-card'},Wf={class:'card-header'},Gf={class:'card-body'},jf={key:0,class:'empty-state'},Jf={key:1,class:'widget-list'},Yf=['onClick'],Hf={class:'widget-checkbox'},Xf={class:'switch small'},Kf=['checked'],qf={class:'widget-info'},Qf={class:'widget-name'},Zf={class:'widget-desc'},ey={key:0,class:'debug-card'},ty={class:'card-header'},ay={class:'card-body'},ny={class:'order-list'},oy={class:'order-number'},ly={class:'order-name'},ry={class:'order-actions'},iy=['disabled','onClick'],cy=['disabled','onClick'],sy={class:'preview-column'},dy={class:'debug-card preview-card'},uy={class:'card-header'},my={class:'card-body no-padding'},py={class:'sidebar-preview__container'},vy={class:'sidebar-preview__viewport'},gy=(0,r.defineComponent)({__name:'SettingsSidebarTab',props:{settings:{}},emits:['update:settings'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)([]),l=(0,r.ref)(a.settings.enabledSidebarWidgets||[]);(0,r.watch)(()=>a.settings.enabledSidebarWidgets,e=>{Array.isArray(e)&&(l.value=[...e])});const i=(0,r.computed)(()=>({...a.settings,enabledSidebarWidgets:[...l.value]}));(0,r.onMounted)(()=>{const e=(0,wa.wO)();o.value=e;const t=new Set(e.map(e=>e.id));l.value=l.value.filter(e=>t.has(e)),console.log('[SettingsSidebarTab] Loaded widgets:',e.length)});const c=e=>l.value.includes(e),s=e=>{const t=o.value.find(t=>t.id===e);return t?.name||e},d=(e,t)=>{const a='up'===t?e-1:e+1;if(a<0||a>=l.value.length)return;const n=l.value.splice(e,1)[0];l.value.splice(a,0,n),p()},u=()=>{l.value=o.value.map(e=>e.id),p()},m=()=>{l.value=[],p()},p=()=>{n('update:settings',{...a.settings,enabledSidebarWidgets:[...l.value]})};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',$f,[t[6]||(t[6]=(0,r.createElementVNode)('div',{class:'section-header'},[(0,r.createElementVNode)('h3',{class:'section-title'},'右边栏 (Sidebar)'),(0,r.createElementVNode)('p',{class:'section-desc'},'配置右边栏显示哪些事件包UI组件。')],-1)),(0,r.createElementVNode)('div',Uf,[(0,r.createCommentVNode)(' Left Column: Configuration '),(0,r.createElementVNode)('div',zf,[(0,r.createCommentVNode)(' 可用组件列表 '),(0,r.createElementVNode)('div',Ff,[(0,r.createElementVNode)('div',Wf,[(0,r.createVNode)(E,{name:'hammer',class:'card-icon'}),t[0]||(t[0]=(0,r.createElementVNode)('span',{class:'card-title'},'可用组件 (Available Widgets)',-1))]),(0,r.createElementVNode)('div',Gf,[0===o.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',jf,[(0,r.createVNode)(E,{name:'info',size:32,class:'empty-icon'}),t[1]||(t[1]=(0,r.createElementVNode)('p',null,'当前事件包没有用户组件',-1)),t[2]||(t[2]=(0,r.createElementVNode)('p',{class:'empty-hint'},'在创意工坊中为事件包添加用户组件',-1))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Jf,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:(0,r.normalizeClass)(['widget-item',{active:c(e.id)}]),onClick:t=>(e=>{const t=l.value.indexOf(e);-1===t?l.value.push(e):l.value.splice(t,1),p()})(e.id)},[(0,r.createElementVNode)('div',Hf,[(0,r.createElementVNode)('label',Xf,[(0,r.createElementVNode)('input',{type:'checkbox',checked:c(e.id),readonly:''},null,8,Kf),t[3]||(t[3]=(0,r.createElementVNode)('span',{class:'slider'},null,-1))])]),(0,r.createElementVNode)('div',qf,[(0,r.createElementVNode)('div',Qf,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)('div',Zf,(0,r.toDisplayString)(e.description||'无描述'),1)])],10,Yf))),128))]))])]),(0,r.createCommentVNode)(' 显示顺序 '),l.value.length>0?((0,r.openBlock)(),(0,r.createElementBlock)('div',ey,[(0,r.createElementVNode)('div',ty,[(0,r.createVNode)(E,{name:'menu',class:'card-icon'}),t[4]||(t[4]=(0,r.createElementVNode)('span',{class:'card-title'},'显示顺序 (Display Order)',-1))]),(0,r.createElementVNode)('div',ay,[(0,r.createElementVNode)('div',ny,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e,class:'order-item'},[(0,r.createElementVNode)('div',oy,(0,r.toDisplayString)(t+1),1),(0,r.createElementVNode)('div',ly,(0,r.toDisplayString)(s(e)),1),(0,r.createElementVNode)('div',ry,[(0,r.createElementVNode)('button',{class:'order-btn',disabled:0===t,onClick:e=>d(t,'up'),title:'上移'},[(0,r.createVNode)(E,{name:'next',size:14,class:'rotate-270'})],8,iy),(0,r.createElementVNode)('button',{class:'order-btn',disabled:t===l.value.length-1,onClick:e=>d(t,'down'),title:'下移'},[(0,r.createVNode)(E,{name:'next',size:14,class:'rotate-90'})],8,cy)])]))),128))])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 快速操作 '),(0,r.createElementVNode)('div',{class:'quick-actions'},[(0,r.createElementVNode)('button',{class:'action-btn outline',onClick:u},'全部启用'),(0,r.createElementVNode)('button',{class:'action-btn outline',onClick:m},'全部禁用')])]),(0,r.createCommentVNode)(' Right Column: Live Preview '),(0,r.createElementVNode)('div',sy,[(0,r.createElementVNode)('div',dy,[(0,r.createElementVNode)('div',uy,[(0,r.createVNode)(E,{name:'eye',class:'card-icon'}),t[5]||(t[5]=(0,r.createElementVNode)('span',{class:'card-title'},'实时预览 (Live Preview)',-1))]),(0,r.createElementVNode)('div',my,[(0,r.createElementVNode)('div',py,[(0,r.createCommentVNode)(' Simulate game viewport for correct sizing '),(0,r.createElementVNode)('div',vy,[(0,r.createVNode)(jp,{settings:i.value,'force-open':!0},null,8,['settings'])])])])])])])]))}}),fy=(0,p.A)(gy,[['__scopeId','data-v-11e8c394']]),yy={class:'system-tab'},hy={class:'setting-group'},ky={class:'setting-row'},Ny={class:'switch'},Ey=['checked'],Vy=['value','disabled'],by=(0,r.defineComponent)({__name:'SettingsSystemTab',props:{settings:{}},emits:['update:settings'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.computed)(()=>{const e=Number(a.settings.autoBigSummaryInterval);return Number.isFinite(e)&&e>0?Math.floor(e):25}),l=e=>{const t=e.target.checked;n('update:settings',{...a.settings,autoBigSummaryEnabled:t})},i=e=>{const t=e.target.value,o=Number.parseInt(t,10),l=Number.isFinite(o)&&o>0?o:1;n('update:settings',{...a.settings,autoBigSummaryInterval:l})};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',yy,[t[4]||(t[4]=(0,r.createElementVNode)('h2',{class:'tab-title'},'系统 (System)',-1)),(0,r.createElementVNode)('div',hy,[(0,r.createElementVNode)('div',ky,[t[1]||(t[1]=(0,r.createElementVNode)('div',{class:'setting-info'},[(0,r.createElementVNode)('div',{class:'setting-label'},'自动大总结'),(0,r.createElementVNode)('div',{class:'setting-desc'},'开启后，达到设定的“小总结间距”会提示 AI 输出一次 <大总结>。')],-1)),(0,r.createElementVNode)('label',Ny,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!!e.settings.autoBigSummaryEnabled,onChange:l},null,40,Ey),t[0]||(t[0]=(0,r.createElementVNode)('span',{class:'slider'},null,-1))])]),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['setting-row',{disabled:!e.settings.autoBigSummaryEnabled}])},[t[2]||(t[2]=(0,r.createElementVNode)('div',{class:'setting-info'},[(0,r.createElementVNode)('div',{class:'setting-label'},'总结间距'),(0,r.createElementVNode)('div',{class:'setting-desc'},'每收到 N 次非空 <小总结>，就触发一次“请求大总结”的提示。')],-1)),(0,r.createElementVNode)('input',{class:'number-input',type:'number',min:'1',step:'1',value:o.value,disabled:!e.settings.autoBigSummaryEnabled,onInput:i},null,40,Vy)],2),t[3]||(t[3]=(0,r.createElementVNode)('div',{class:'setting-note'},' 说明：触发后会在下一次发送给 AI 的提示词里追加“请输出<大总结>…</大总结>”。 ',-1))])]))}}),wy=(0,p.A)(by,[['__scopeId','data-v-77f1bfd9']]),Cy={class:'settings-section'},Sy={class:'settings-grid'},By={class:'setting-card full-width-card'},xy={class:'setting-info'},_y={class:'setting-name'},Iy={class:'setting-value'},Ty={class:'setting-control wide-control'},Ay={class:'setting-card'},My={class:'card-group-title'},Dy={class:'control-group'},Py={class:'setting-row'},Oy={class:'setting-info-compact'},Ry={class:'setting-value'},Ly={class:'setting-control compact'},$y={class:'setting-row'},Uy={class:'setting-info-compact'},zy={class:'setting-value'},Fy={class:'setting-control compact'},Wy={class:'setting-card'},Gy={class:'card-group-title'},jy={class:'control-group'},Jy={class:'color-row'},Yy={class:'color-actions'},Hy={class:'color-row'},Xy={class:'color-actions'},Ky={class:'color-row'},qy={class:'color-actions'},Qy=(0,r.defineComponent)({__name:'SettingsTextTab',props:{settings:{}},emits:['update:settings'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.reactive)({fontSize:a.settings.fontSize??18,textSpeed:a.settings.textSpeed??30,autoSpeed:a.settings.autoSpeed??2e3,dialogueTextColor:a.settings.dialogueTextColor??'#f1f5f9',narrationTextColor:a.settings.narrationTextColor??'#f1f5f9',psychTextColor:a.settings.psychTextColor??'#a78bfa'});(0,r.watch)(()=>a.settings,e=>{void 0!==e.fontSize&&(o.fontSize=e.fontSize),void 0!==e.textSpeed&&(o.textSpeed=e.textSpeed),void 0!==e.autoSpeed&&(o.autoSpeed=e.autoSpeed),void 0!==e.dialogueTextColor&&(o.dialogueTextColor=e.dialogueTextColor),void 0!==e.narrationTextColor&&(o.narrationTextColor=e.narrationTextColor),void 0!==e.psychTextColor&&(o.psychTextColor=e.psychTextColor)},{deep:!0});const l=()=>{n('update:settings',{...a.settings,...o})},i=(e,t,a)=>(e-t)/(a-t)*100;return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Cy,[t[19]||(t[19]=(0,r.createElementVNode)('div',{class:'section-header'},[(0,r.createElementVNode)('h3',{class:'section-title'},'阅读体验 (Reading)'),(0,r.createElementVNode)('p',{class:'section-desc'},'调整文字大小与播放速度以获得最佳阅读体验。')],-1)),(0,r.createElementVNode)('div',Sy,[(0,r.createCommentVNode)(' Font Size (Full Width) '),(0,r.createElementVNode)('div',By,[(0,r.createElementVNode)('div',xy,[(0,r.createElementVNode)('span',_y,[(0,r.createVNode)(E,{name:'text',size:16,class:'setting-icon'}),t[9]||(t[9]=(0,r.createTextVNode)(' 字体大小 ',-1))]),(0,r.createElementVNode)('span',Iy,(0,r.toDisplayString)(o.fontSize)+'px',1)]),(0,r.createElementVNode)('div',Ty,[t[10]||(t[10]=(0,r.createElementVNode)('span',{class:'range-label'},'Aa',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range',min:'14',max:'32',step:'1','onUpdate:modelValue':t[0]||(t[0]=e=>o.fontSize=e),onInput:l,style:(0,r.normalizeStyle)({'--progress':i(o.fontSize,14,32)+'%'})},null,36),[[r.vModelText,o.fontSize,void 0,{number:!0}]]),t[11]||(t[11]=(0,r.createElementVNode)('span',{class:'range-label big'},'Aa',-1))])]),(0,r.createCommentVNode)(' Speed Settings '),(0,r.createElementVNode)('div',Ay,[(0,r.createElementVNode)('div',My,[(0,r.createVNode)(E,{name:'sparkles',size:16,class:'setting-icon'}),t[12]||(t[12]=(0,r.createTextVNode)(' 播放速度 ',-1))]),(0,r.createElementVNode)('div',Dy,[(0,r.createElementVNode)('div',Py,[(0,r.createElementVNode)('div',Oy,[t[13]||(t[13]=(0,r.createElementVNode)('span',{class:'setting-name'},'打字速度',-1)),(0,r.createElementVNode)('span',Ry,(0,r.toDisplayString)(0===o.textSpeed?'Instant':o.textSpeed+'ms'),1)]),(0,r.createElementVNode)('div',Ly,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range',min:'0',max:'100',step:'5','onUpdate:modelValue':t[1]||(t[1]=e=>o.textSpeed=e),onInput:l,style:(0,r.normalizeStyle)({'--progress':i(o.textSpeed,0,100)+'%'})},null,36),[[r.vModelText,o.textSpeed,void 0,{number:!0}]])])]),(0,r.createElementVNode)('div',$y,[(0,r.createElementVNode)('div',Uy,[t[14]||(t[14]=(0,r.createElementVNode)('span',{class:'setting-name'},'Auto 间隔',-1)),(0,r.createElementVNode)('span',zy,(0,r.toDisplayString)((o.autoSpeed/1e3).toFixed(1))+'s',1)]),(0,r.createElementVNode)('div',Fy,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range',min:'500',max:'5000',step:'100','onUpdate:modelValue':t[2]||(t[2]=e=>o.autoSpeed=e),onInput:l,style:(0,r.normalizeStyle)({'--progress':i(o.autoSpeed,500,5e3)+'%'})},null,36),[[r.vModelText,o.autoSpeed,void 0,{number:!0}]])])])])]),(0,r.createCommentVNode)(' Text Colors '),(0,r.createElementVNode)('div',Wy,[(0,r.createElementVNode)('div',Gy,[(0,r.createVNode)(E,{name:'palette',size:16,class:'setting-icon'}),t[15]||(t[15]=(0,r.createTextVNode)(' 文本配色 ',-1))]),(0,r.createElementVNode)('div',jy,[(0,r.createElementVNode)('div',Jy,[t[16]||(t[16]=(0,r.createElementVNode)('span',{class:'setting-name-compact'},'对话',-1)),(0,r.createElementVNode)('div',Yy,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'color','onUpdate:modelValue':t[3]||(t[3]=e=>o.dialogueTextColor=e),onInput:l},null,544),[[r.vModelText,o.dialogueTextColor]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{class:'color-input compact',type:'text','onUpdate:modelValue':t[4]||(t[4]=e=>o.dialogueTextColor=e),onInput:l},null,544),[[r.vModelText,o.dialogueTextColor]])])]),(0,r.createElementVNode)('div',Hy,[t[17]||(t[17]=(0,r.createElementVNode)('span',{class:'setting-name-compact'},'旁白',-1)),(0,r.createElementVNode)('div',Xy,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'color','onUpdate:modelValue':t[5]||(t[5]=e=>o.narrationTextColor=e),onInput:l},null,544),[[r.vModelText,o.narrationTextColor]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{class:'color-input compact',type:'text','onUpdate:modelValue':t[6]||(t[6]=e=>o.narrationTextColor=e),onInput:l},null,544),[[r.vModelText,o.narrationTextColor]])])]),(0,r.createElementVNode)('div',Ky,[t[18]||(t[18]=(0,r.createElementVNode)('span',{class:'setting-name-compact'},'心理',-1)),(0,r.createElementVNode)('div',qy,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'color','onUpdate:modelValue':t[7]||(t[7]=e=>o.psychTextColor=e),onInput:l},null,544),[[r.vModelText,o.psychTextColor]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{class:'color-input compact',type:'text','onUpdate:modelValue':t[8]||(t[8]=e=>o.psychTextColor=e),onInput:l},null,544),[[r.vModelText,o.psychTextColor]])])])])])])]))}}),Zy=(0,p.A)(Qy,[['__scopeId','data-v-3f3e5e2d']]),eh={class:'settings-modal-overlay'},th={class:'settings-modal'},ah={class:'settings-header'},nh={class:'settings-title'},oh={class:'settings-body'},lh={class:'settings-sidebar'},rh=['onClick'],ih={class:'settings-content custom-scrollbar'},ch=(0,r.defineComponent)({__name:'SettingsModal',props:{settings:{}},emits:['close','update:settings','debug:text'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.computed)(()=>[{id:'display',label:'显示 (Display)'},{id:'text',label:'文本 (Text)'},{id:'sidebar',label:'右边栏 (Sidebar)'},{id:'system',label:'系统 (System)'},{id:'debug',label:'调试 (Debug)'}]),l=(0,r.ref)('text'),i=(0,r.reactive)({...a.settings,bgImage:a.settings.bgImage||'',charImage:a.settings.charImage||'',debugMode:a.settings.debugMode??!1,performanceEnabled:a.settings.performanceEnabled??!0,autoBigSummaryEnabled:a.settings.autoBigSummaryEnabled??!1,autoBigSummaryInterval:a.settings.autoBigSummaryInterval??25,dialogueTextColor:a.settings.dialogueTextColor??'#f1f5f9',narrationTextColor:a.settings.narrationTextColor??'#f1f5f9',psychTextColor:a.settings.psychTextColor??'#a78bfa',charScale:a.settings.charScale??80,charX:a.settings.charX??50,charY:a.settings.charY??0,dialogueWidth:a.settings.dialogueWidth??90,dialogueOpacity:a.settings.dialogueOpacity??85});let c=null;const s=e=>{e&&Object.assign(i,e),null==c&&(c=window.requestAnimationFrame(()=>{c=null,n('update:settings',{...i,_ts:Date.now()})}))},d=e=>{n('debug:text',e)};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',eh,[(0,r.createElementVNode)('div',th,[(0,r.createElementVNode)('div',ah,[(0,r.createElementVNode)('div',nh,[(0,r.createVNode)(E,{name:'settings',class:'icon-violet'}),t[1]||(t[1]=(0,r.createElementVNode)('span',null,'SYSTEM SETTINGS',-1))]),(0,r.createElementVNode)('button',{onClick:t[0]||(t[0]=t=>e.$emit('close')),class:'close-btn'},[(0,r.createVNode)(E,{name:'close',size:24})])]),(0,r.createElementVNode)('div',oh,[(0,r.createCommentVNode)(' Sidebar '),(0,r.createElementVNode)('div',lh,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:e.id,class:(0,r.normalizeClass)(['settings-tab-btn',{active:l.value===e.id}]),onClick:t=>l.value=e.id},(0,r.toDisplayString)(e.label),11,rh))),128))]),(0,r.createCommentVNode)(' Content '),(0,r.createElementVNode)('div',ih,[(0,r.createCommentVNode)(' Display Tab '),'display'===l.value?((0,r.openBlock)(),(0,r.createBlock)(Lf,{key:0,settings:i,'onUpdate:settings':s},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Text Tab '),'text'===l.value?((0,r.openBlock)(),(0,r.createBlock)(Zy,{key:1,settings:i,'onUpdate:settings':s},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Sidebar Tab '),'sidebar'===l.value?((0,r.openBlock)(),(0,r.createBlock)(fy,{key:2,settings:i,'onUpdate:settings':s},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' System Tab '),'system'===l.value?((0,r.openBlock)(),(0,r.createBlock)(wy,{key:3,settings:i,'onUpdate:settings':s},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Debug Tab '),'debug'===l.value?((0,r.openBlock)(),(0,r.createBlock)(Rg,{key:4,settings:i,'onUpdate:settings':s,'onDebug:text':d},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0)])])])]))}}),sh=(0,p.A)(ch,[['__scopeId','data-v-40e66e51']]),dh={class:'gaem-dialog'},uh={class:'gaem-header'},mh={class:'gaem-title'},ph={class:'subtitle'},vh={class:'mono'},gh={key:0},fh={class:'gaem-toolbar'},yh={class:'field'},hh=['disabled'],kh={class:'select-value'},Nh=['onKeydown'],Eh={class:'select-options'},Vh=['onClick'],bh={class:'opt-name'},wh={class:'opt-id mono'},Ch={class:'actions'},Sh=['disabled'],Bh=['disabled'],xh={key:0,class:'gaem-error'},_h={class:'gaem-body'},Ih={key:0,class:'loading'},Th={key:1,class:'empty'},Ah=(0,r.defineComponent)({__name:'GameAssetEditorModal',props:{visible:{type:Boolean},currentEventPack:{}},emits:['update:visible','apply'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(!1),l=(0,r.ref)(''),i=(0,r.ref)([]),c=(0,r.computed)(()=>{try{return sessionStorage.getItem('current_game_event_id')||''}catch{return''}}),s=(0,r.computed)(()=>a.currentEventPack?.name||''),d=(0,r.ref)(''),u=(0,r.ref)(null),m=(0,r.ref)(0),p=(0,r.ref)(null),v=(0,r.ref)(null),g=(0,r.ref)(null),f=(0,r.ref)(!1),y=(0,r.ref)(''),h=(0,r.computed)(()=>{if(!d.value)return'(请选择事件包)';const e=i.value.find(e=>e.id===d.value);return e?.name||e?.id||d.value}),k=(0,r.computed)(()=>{const e=y.value.trim().toLowerCase();return e?i.value.filter(t=>{const a=(t.name||'').toLowerCase(),n=(t.id||'').toLowerCase();return a.includes(e)||n.includes(e)}):i.value});function N(){n('update:visible',!1)}function E(){f.value=!1,y.value=''}function V(){f.value?E():o.value||(f.value=!0,(0,r.nextTick)(()=>g.value?.focus()))}function b(e){d.value=e,E()}function w(e){if(!f.value)return;const t=v.value,a=e.target;t&&a&&(t.contains(a)||E())}async function C(){o.value=!0,l.value='';try{const e=await pe.idbService.getAllWorks();i.value=e.filter(e=>'EVENT'===e.type).map(e=>e.data)}catch(e){console.error('[GameAssetEditorModal] Failed to load works:',e),l.value='加载事件包列表失败：'+(e?.message||String(e)),i.value=[]}finally{o.value=!1}}function S(e){return JSON.parse(JSON.stringify(e))}function B(){l.value='';const e=d.value;if(!e)return;const t=i.value.find(t=>t.id===e);t?(u.value=S(t),m.value++):l.value='未找到所选事件包。'}function x(){l.value='';const e=d.value||c.value||'';if(!e)return void(l.value='请先选择一个事件包。');const t=p.value;let a=null;try{t?.getEventPack?a=t.getEventPack():t?.eventPack?.value&&(a=S(t.eventPack.value))}catch(e){console.warn('[GameAssetEditorModal] Failed to read editor state:',e)}a?(a.id=e,n('apply',{boundEventId:e,eventPack:a}),n('update:visible',!1)):l.value='无法读取编辑器内容，请重试。'}return(0,r.watch)(()=>a.visible,e=>{e?(d.value=c.value||a.currentEventPack?.id||'',a.currentEventPack?(u.value=S(a.currentEventPack),m.value++):u.value=null,C()):E()}),(0,r.onMounted)(()=>{document.addEventListener('mousedown',w,!0),document.addEventListener('touchstart',w,!0),C()}),(0,r.onBeforeUnmount)(()=>{document.removeEventListener('mousedown',w,!0),document.removeEventListener('touchstart',w,!0)}),(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'#ethereal-overlay-root'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'gaem-overlay',onClick:(0,r.withModifiers)(N,['self'])},[(0,r.createElementVNode)('div',dh,[(0,r.createElementVNode)('div',uh,[(0,r.createElementVNode)('div',mh,[t[4]||(t[4]=(0,r.createElementVNode)('div',{class:'title'},'事件包 / GameAsset 编辑',-1)),(0,r.createElementVNode)('div',ph,[t[3]||(t[3]=(0,r.createTextVNode)(' 当前绑定：',-1)),(0,r.createElementVNode)('span',vh,(0,r.toDisplayString)(c.value||'未绑定'),1),s.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',gh,'（'+(0,r.toDisplayString)(s.value)+'）',1)):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createElementVNode)('button',{class:'gaem-close',onClick:N},'✕')]),(0,r.createElementVNode)('div',fh,[(0,r.createElementVNode)('label',yh,[t[7]||(t[7]=(0,r.createElementVNode)('span',{class:'label'},'切换绑定',-1)),(0,r.createElementVNode)('div',{ref_key:'selectRoot',ref:v,class:(0,r.normalizeClass)(['selectbox',{disabled:o.value}])},[(0,r.createElementVNode)('button',{type:'button',class:'select-trigger',disabled:o.value,onClick:V},[(0,r.createElementVNode)('span',kh,(0,r.toDisplayString)(h.value),1),t[5]||(t[5]=(0,r.createElementVNode)('span',{class:'select-chevron'},'▾',-1))],8,hh),(0,r.createVNode)(r.Transition,{name:'dropdown'},{default:(0,r.withCtx)(()=>[f.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'select-menu',onClick:t[2]||(t[2]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.withDirectives)((0,r.createElementVNode)('input',{ref_key:'selectSearchRef',ref:g,'onUpdate:modelValue':t[0]||(t[0]=e=>y.value=e),class:'select-search',type:'text',placeholder:'搜索事件包...',onKeydown:(0,r.withKeys)((0,r.withModifiers)(E,['prevent']),['escape'])},null,40,Nh),[[r.vModelText,y.value]]),(0,r.createElementVNode)('div',Eh,[(0,r.createElementVNode)('button',{type:'button',class:(0,r.normalizeClass)(['select-option',{selected:''===d.value}]),onClick:t[1]||(t[1]=e=>b(''))},[...t[6]||(t[6]=[(0,r.createElementVNode)('span',{class:'opt-name'},'(请选择事件包)',-1)])],2),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(k.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:e.id,type:'button',class:(0,r.normalizeClass)(['select-option',{selected:d.value===e.id}]),onClick:t=>b(e.id)},[(0,r.createElementVNode)('span',bh,(0,r.toDisplayString)(e.name||e.id),1),(0,r.createElementVNode)('span',wh,(0,r.toDisplayString)(e.id),1)],10,Vh))),128))])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})],2)]),(0,r.createElementVNode)('div',Ch,[(0,r.createElementVNode)('button',{class:'btn',disabled:!d.value,onClick:B},'载入',8,Sh),(0,r.createElementVNode)('button',{class:'btn primary',disabled:!u.value,onClick:x},'应用到当前存档',8,Bh)])]),l.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',xh,(0,r.toDisplayString)(l.value),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',_h,[o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ih,'加载中...')):u.value?((0,r.openBlock)(),(0,r.createBlock)(cu,{ref_key:'editorRef',ref:p,key:m.value,'initial-data':u.value,'disable-autosave':!0},null,8,['initial-data'])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Th,[...t[8]||(t[8]=[(0,r.createElementVNode)('div',{class:'hint'},'点击“载入”将事件包载入为可编辑草稿。',-1),(0,r.createElementVNode)('div',{class:'hint'},'“应用到当前存档”会更新当前游戏使用的事件包，并影响之后的存档内容。',-1)])]))])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})]))}}),Mh=(0,p.A)(Ah,[['__scopeId','data-v-f60cc848']]),Dh={class:'node-row'},Ph={key:1,class:'toggle-placeholder'},Oh={class:'key-name'},Rh={key:2,class:'value-preview'},Lh={key:3,class:'value-preview dim'},$h={class:'node-actions'},Uh={key:0,class:'node-children'},zh={class:'edit-modal'},Fh={key:0,class:'edit-field'},Wh={class:'edit-field'},Gh={class:'edit-modal'},jh={key:0,class:'edit-field'},Jh={class:'edit-field'},Yh={class:'preset-row','aria-label':'快速类型'},Hh=(0,r.defineComponent)({__name:'VariableDataNode',props:{root:{},parent:{},nodeKey:{},depth:{}},setup(e){const t=e,a=(0,r.ref)(!0),n=(0,r.ref)(!1),o=(0,r.ref)(!1),l=(0,r.computed)(()=>null===t.nodeKey),i=(0,r.computed)(()=>l.value?t.root:t.parent?t.parent[t.nodeKey]:void 0);const c=(0,r.computed)(()=>Array.isArray(i.value)),s=(0,r.computed)(()=>{const e=i.value;return!!e&&'object'==typeof e&&!Array.isArray(e)}),d=(0,r.computed)(()=>c.value||s.value),u=(0,r.computed)(()=>l.value?'root':'number'==typeof t.nodeKey?`[${t.nodeKey}]`:String(t.nodeKey));const m=(0,r.computed)(()=>function(e){if(null===e)return{label:'null',cls:'null'};if(Array.isArray(e))return{label:'Array',cls:'array'};const t=typeof e;return'string'===t?{label:'String',cls:'string'}:'number'===t?{label:'Number',cls:'number'}:'boolean'===t?{label:'Boolean',cls:'boolean'}:'object'===t?{label:'Object',cls:'object'}:'undefined'===t?{label:'undefined',cls:'undefined'}:{label:t,cls:'other'}}(i.value)),p=(0,r.computed)(()=>m.value.label),v=(0,r.computed)(()=>m.value.cls),g=(0,r.computed)(()=>{const e=i.value;if('string'==typeof e){const t=e.length>40?e.slice(0,40)+'…':e;return JSON.stringify(t)}if('number'==typeof e||'boolean'==typeof e)return String(e);if(null===e)return'null';if(void 0===e)return'undefined';try{return JSON.stringify(e)}catch{return String(e)}}),f=(0,r.computed)(()=>{const e=i.value;return Array.isArray(e)?`(${e.length} items)`:e&&'object'==typeof e?`(${Object.keys(e).length} keys)`:''}),y=(0,r.computed)(()=>{const e=i.value,t=[];if(Array.isArray(e))for(let a=0;a<e.length;a++)t.push({key:String(a),parent:e,nodeKey:a});else if(e&&'object'==typeof e)for(const a of Object.keys(e))t.push({key:a,parent:e,nodeKey:a});return t}),h=(0,r.computed)(()=>!l.value&&!Array.isArray(t.parent)),k=(0,r.ref)('json'),N=(0,r.ref)(''),V=(0,r.ref)(''),b=(0,r.ref)(0),w=(0,r.ref)(!1),C=(0,r.ref)('');function S(){const e=i.value;if(N.value='string'==typeof t.nodeKey?t.nodeKey:'','string'==typeof e)k.value='string',V.value=e;else if('number'==typeof e)k.value='number',b.value=Number.isFinite(e)?e:0;else if('boolean'==typeof e)k.value='boolean',w.value=e;else{k.value='json';try{C.value=JSON.stringify(e,null,2)}catch{C.value=String(e)}}n.value=!0}function B(){n.value=!1}function x(e){if(l.value){if(!e||'object'!=typeof e||Array.isArray(e))return;!function(e,t){if(e&&'object'==typeof e){for(const t of Object.keys(e))delete e[t];t&&'object'==typeof t&&!Array.isArray(t)&&Object.assign(e,t)}}(t.root,e)}else t.parent&&(t.parent[t.nodeKey]=e)}function I(){if(h.value){const e=N.value.trim(),a=String(t.nodeKey);if(!e)return;e!==a&&t.parent&&'object'==typeof t.parent&&!Array.isArray(t.parent)&&(t.parent[e]=t.parent[a],delete t.parent[a])}if('string'===k.value)x(V.value);else if('number'===k.value)x('number'==typeof b.value?b.value:0);else if('boolean'===k.value)x(!!w.value);else{const e=(C.value||'').trim();try{x(e?JSON.parse(e):null)}catch{return}}n.value=!1}const T=(0,r.ref)(''),A=(0,r.ref)('null'),M=(0,r.ref)('null');function D(e){M.value=e,A.value='string'===e?JSON.stringify(''):'number'===e?'0':'boolean'===e?'true':'object'===e?'{}':'array'===e?'[]':'null'}function P(){T.value='',D('null'),o.value=!0}function O(){o.value=!1}function R(){const e=i.value;if(!e||'object'!=typeof e)return;let t=null;try{t=JSON.parse((A.value||'').trim()||'null')}catch{return}if(Array.isArray(e))e.push(t);else{const a=T.value.trim();if(!a)return;e[a]=t}o.value=!1,a.value=!0}function L(){l.value||t.parent&&(Array.isArray(t.parent)&&'number'==typeof t.nodeKey?t.parent.splice(t.nodeKey,1):t.parent&&'object'==typeof t.parent&&delete t.parent[t.nodeKey])}return(e,t)=>{const i=(0,r.resolveComponent)('VariableDataNode',!0);return(0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'variable-node',style:(0,r.normalizeStyle)({'--depth':e.depth})},[(0,r.createElementVNode)('div',Dh,[(0,r.createCommentVNode)(' Expand/Collapse '),d.value?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'toggle-btn',onClick:t[0]||(t[0]=e=>a.value=!a.value)},[(0,r.createVNode)(E,{name:a.value?'chevron-down':'chevron-right',size:'0.8em'},null,8,['name'])])):((0,r.openBlock)(),(0,r.createElementBlock)('span',Ph)),(0,r.createCommentVNode)(' Key '),(0,r.createElementVNode)('span',Oh,(0,r.toDisplayString)(u.value),1),(0,r.createCommentVNode)(' Type '),(0,r.createElementVNode)('span',{class:(0,r.normalizeClass)(['type-badge',v.value])},(0,r.toDisplayString)(p.value),3),(0,r.createCommentVNode)(' Value Preview '),d.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',Lh,(0,r.toDisplayString)(f.value),1)):((0,r.openBlock)(),(0,r.createElementBlock)('span',Rh,(0,r.toDisplayString)(g.value),1)),(0,r.createCommentVNode)(' Actions '),(0,r.createElementVNode)('div',$h,[(0,r.createElementVNode)('button',{class:'action-btn edit',onClick:S,title:'编辑'},[(0,r.createVNode)(E,{name:'edit',size:'0.75em'})]),d.value?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn add',onClick:P,title:'添加'},[(0,r.createVNode)(E,{name:'plus',size:'0.75em'})])):(0,r.createCommentVNode)('v-if',!0),l.value?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'action-btn delete',onClick:L,title:'删除'},[(0,r.createVNode)(E,{name:'delete',size:'0.75em'})]))])]),(0,r.createCommentVNode)(' Children '),a.value&&d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Uh,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(y.value,t=>((0,r.openBlock)(),(0,r.createBlock)(i,{key:t.key,root:e.root,parent:t.parent,'node-key':t.nodeKey,depth:e.depth+1},null,8,['root','parent','node-key','depth']))),128))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Edit Modal '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'#ethereal-overlay-root'},[n.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'edit-overlay',onClick:(0,r.withModifiers)(B,['self'])},[(0,r.createElementVNode)('div',zh,[t[18]||(t[18]=(0,r.createElementVNode)('h4',null,'编辑变量',-1)),h.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Fh,[t[14]||(t[14]=(0,r.createElementVNode)('label',null,'键名 (Key)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>N.value=e),type:'text',placeholder:'变量键名'},null,512),[[r.vModelText,N.value]])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',Wh,[t[16]||(t[16]=(0,r.createElementVNode)('label',null,'值 (Value)',-1)),'string'===k.value?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:0,'onUpdate:modelValue':t[2]||(t[2]=e=>V.value=e),type:'text',placeholder:'文本'},null,512)),[[r.vModelText,V.value]]):'number'===k.value?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[3]||(t[3]=e=>b.value=e),type:'number',placeholder:'0'},null,512)),[[r.vModelText,b.value,void 0,{number:!0}]]):'boolean'===k.value?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('select',{key:2,'onUpdate:modelValue':t[4]||(t[4]=e=>w.value=e)},[...t[15]||(t[15]=[(0,r.createElementVNode)('option',{value:!0},'true',-1),(0,r.createElementVNode)('option',{value:!1},'false',-1)])],512)),[[r.vModelSelect,w.value]]):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('textarea',{key:3,'onUpdate:modelValue':t[5]||(t[5]=e=>C.value=e),class:'json',spellcheck:'false',placeholder:'输入 JSON，例如：\\n\\n{\\n  "a": 1\\n}'},null,512)),[[r.vModelText,C.value]]),t[17]||(t[17]=(0,r.createElementVNode)('div',{class:'hint'},' 支持编辑任意 JSON 值（对象/数组/字符串/数字/布尔/null）。 ',-1))]),(0,r.createElementVNode)('div',{class:'edit-actions'},[(0,r.createElementVNode)('button',{class:'cancel-btn',onClick:B},'取消'),(0,r.createElementVNode)('button',{class:'save-btn',onClick:I},'保存')])])])):(0,r.createCommentVNode)('v-if',!0)])),(0,r.createCommentVNode)(' Add Modal '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'#ethereal-overlay-root'},[o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'edit-overlay',onClick:(0,r.withModifiers)(O,['self'])},[(0,r.createElementVNode)('div',Gh,[t[22]||(t[22]=(0,r.createElementVNode)('h4',null,'添加子项',-1)),s.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',jh,[t[19]||(t[19]=(0,r.createElementVNode)('label',null,'键名 (Key)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[6]||(t[6]=e=>T.value=e),type:'text',placeholder:'newKey'},null,512),[[r.vModelText,T.value]])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',Jh,[t[20]||(t[20]=(0,r.createElementVNode)('label',null,'值 (Value)',-1)),(0,r.createElementVNode)('div',Yh,[(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[7]||(t[7]=e=>D('string'))},'文本'),(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[8]||(t[8]=e=>D('number'))},'数字'),(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[9]||(t[9]=e=>D('boolean'))},'布尔'),(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[10]||(t[10]=e=>D('object'))},'对象'),(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[11]||(t[11]=e=>D('array'))},'数组'),(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[12]||(t[12]=e=>D('null'))},'null')]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[13]||(t[13]=e=>A.value=e),class:'json',spellcheck:'false',placeholder:'输入 JSON，例如：\\n\\n"text"\\n123\\ntrue\\nnull\\n{"a":1}\\n[1,2,3]'},null,512),[[r.vModelText,A.value]]),t[21]||(t[21]=(0,r.createElementVNode)('div',{class:'hint'},[(0,r.createTextVNode)('提示：点“对象”会自动填入 '),(0,r.createElementVNode)('span',{class:'mono'},'{}'),(0,r.createTextVNode)('，即可添加 Object 节点。')],-1))]),(0,r.createElementVNode)('div',{class:'edit-actions'},[(0,r.createElementVNode)('button',{class:'cancel-btn',onClick:O},'取消'),(0,r.createElementVNode)('button',{class:'save-btn',onClick:R},'添加')])])])):(0,r.createCommentVNode)('v-if',!0)]))],4)}}}),Xh=(0,p.A)(Hh,[['__scopeId','data-v-f66727c0']]),Kh={class:'vem-dialog'},qh={class:'vem-header'},Qh={class:'vem-title'},Zh={class:'subtitle'},ek={class:'mono'},tk={class:'mono'},ak={class:'vem-toolbar'},nk={class:'left'},ok=['disabled'],lk=['disabled'],rk={class:'right'},ik=['disabled'],ck={key:0,class:'vem-error'},sk={class:'vem-body'},dk={key:0,class:'loading'},uk={key:1,class:'tree-wrap'},mk={class:'tree-view'},pk={class:'json-preview'},vk={class:'preview-header'},gk=['disabled'],fk={class:'schema-code'},yk=(0,r.defineComponent)({__name:'VariableEditorModal',props:{visible:{type:Boolean},worldbookName:{},entryName:{default:'当前游戏数据'}},emits:['update:visible','applied'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(!1),l=(0,r.ref)(''),i=(0,r.reactive)({});function c(e,t){if(e&&'object'==typeof e){for(const t of Object.keys(e))delete e[t];t&&'object'==typeof t&&!Array.isArray(t)&&Object.assign(e,t)}}const s=(0,r.computed)(()=>{try{return JSON.stringify(i??{},null,2)}catch{return String(i)}});async function d(){o.value=!0,l.value='';try{const e=await ga(a.worldbookName);c(i,e??{})}catch(e){console.error('[VariableEditorModal] reload failed:',e),l.value='读取失败：'+(e?.message||String(e))}finally{o.value=!1}}function u(){l.value='';try{const e=JSON.parse(s.value||'{}');if(!e||'object'!=typeof e||Array.isArray(e))return void(l.value='内容必须是一个 JSON 对象（不能是数组/空值）。');c(i,e)}catch(e){l.value='JSON 格式错误：'+(e?.message||String(e))}}async function m(){try{await navigator.clipboard.writeText(s.value||'')}catch(e){console.warn('[VariableEditorModal] copyJson failed:',e)}}async function p(){o.value=!0,l.value='';try{const e=i;if(!e||'object'!=typeof e||Array.isArray(e))return void(l.value='内容必须是一个 JSON 对象（不能是数组/空值）。');if(!await fa(JSON.parse(JSON.stringify(e)),a.worldbookName))return void(l.value='保存失败：saveGameData 返回 false');n('applied',e),n('update:visible',!1)}catch(e){console.error('[VariableEditorModal] apply failed:',e),l.value='保存失败：'+(e?.message||String(e))}finally{o.value=!1}}function v(){n('update:visible',!1)}return(0,r.watch)(()=>a.visible,e=>{e&&d()}),(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'#ethereal-overlay-root'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'vem-overlay',onClick:(0,r.withModifiers)(v,['self'])},[(0,r.createElementVNode)('div',Kh,[(0,r.createElementVNode)('div',qh,[(0,r.createElementVNode)('div',Qh,[t[3]||(t[3]=(0,r.createElementVNode)('div',{class:'title'},'变量编辑器',-1)),(0,r.createElementVNode)('div',Zh,[t[0]||(t[0]=(0,r.createTextVNode)(' Worldbook：',-1)),(0,r.createElementVNode)('span',ek,(0,r.toDisplayString)(e.worldbookName),1),t[1]||(t[1]=(0,r.createElementVNode)('span',{class:'sep'},'·',-1)),t[2]||(t[2]=(0,r.createTextVNode)(' Entry：',-1)),(0,r.createElementVNode)('span',tk,(0,r.toDisplayString)(e.entryName),1)])]),(0,r.createElementVNode)('button',{class:'vem-close',onClick:v},'✕')]),(0,r.createElementVNode)('div',ak,[(0,r.createElementVNode)('div',nk,[(0,r.createElementVNode)('button',{class:'btn',disabled:o.value,onClick:d},'重载',8,ok),(0,r.createElementVNode)('button',{class:'btn',disabled:o.value,onClick:m},'复制 JSON',8,lk)]),(0,r.createElementVNode)('div',rk,[(0,r.createElementVNode)('button',{class:'btn primary',disabled:o.value,onClick:p},'应用',8,ik)])]),l.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',ck,(0,r.toDisplayString)(l.value),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',sk,[o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',dk,'加载中...')):((0,r.openBlock)(),(0,r.createElementBlock)('div',uk,[t[5]||(t[5]=(0,r.createElementVNode)('div',{class:'info-hint'},[(0,r.createElementVNode)('span',{class:'hint-text'},'像事件包一样的树状编辑：展开/编辑/新增/删除，最后点“应用”写回世界书。')],-1)),(0,r.createElementVNode)('div',mk,[(0,r.createVNode)(Xh,{root:i,parent:null,'node-key':null,depth:0},null,8,['root'])]),(0,r.createElementVNode)('div',pk,[(0,r.createElementVNode)('div',vk,[t[4]||(t[4]=(0,r.createElementVNode)('div',{class:'preview-title'},'JSON 预览',-1)),(0,r.createElementVNode)('button',{class:'btn',disabled:o.value,onClick:u},'格式化',8,gk)]),(0,r.createElementVNode)('pre',fk,(0,r.toDisplayString)(s.value),1)])]))])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})]))}}),hk=(0,p.A)(yk,[['__scopeId','data-v-64042a02']]);function kk(e){if(!e||!Ek(e.type)||!Ek(e.path))return null;const t=e.type.toUpperCase(),a=bk(e.path);if('系统.时间'===a||'system.time'===a){const t=Vk(e.value);return{text:t?`【时间】${t}`:'【时间】已更新',meta:{category:'time',effect:'retype-typo',apply:t?{kind:'time',value:t}:{kind:'none'}}}}if('系统.地点'===a||'system.location'===a){const t=Vk(e.value);return{text:t?`【地点】${t}`:'【地点】已更新',meta:{category:'location',effect:'retype-typo',apply:t?{kind:'location',value:t}:{kind:'none'}}}}if('CREATE'===t){const e=a.match(/^角色\.([^\.]+)$/),t=(e?.[1]||(a.includes('.')?'':a)).trim();if(t)return{text:`【新角色】新认识 ${t}`,meta:{category:'new-character',effect:'plain',apply:{kind:'none'}}}}const n=wk(a);if(n){const a=n.prop;if(('好感度'===a||'trust'===a)&&('MOD'===t||'UPDATE'===t)){const a=e.value,o='number'==typeof a?a:NaN;if('MOD'===t&&Number.isFinite(o)){const e=o>=0?'+':'';return{text:`【好感度】${n.name} ♥ ${e}${o}`,meta:{category:'affection',effect:'rise',apply:{kind:'none'}}}}const l=Vk(a);return{text:l?`【好感度】${n.name} ♥ = ${l}`:`【好感度】${n.name} 已更新`,meta:{category:'affection',effect:'rise',apply:{kind:'none'}}}}}return'UPDATE'===t?{text:`【变量】${a} 已更新`,meta:{category:'generic',effect:'plain',apply:{kind:'none'}}}:'MOD'===t?{text:`【变量】${a} 已变更`,meta:{category:'generic',effect:'plain',apply:{kind:'none'}}}:'CREATE'===t?{text:`【变量】已创建 ${a}`,meta:{category:'generic',effect:'plain',apply:{kind:'none'}}}:'REMOVE'===t?{text:`【变量】已移除 ${a}`,meta:{category:'generic',effect:'plain',apply:{kind:'none'}}}:null}function Nk(e){if(!Ek(e))return[];const t=ca(e);if(!Array.isArray(t)||0===t.length)return[];const a=[];for(const e of t){const t=kk(e);t&&a.push(t)}return a}const Ek=e=>'string'==typeof e&&e.trim().length>0,Vk=e=>{if(null==e)return'';if('string'==typeof e)return e;if('number'==typeof e||'boolean'==typeof e)return String(e);try{const t=JSON.stringify(e);return'string'==typeof t?t:''}catch{return''}},bk=e=>e.trim(),wk=e=>{let t=e.match(/^角色\.([^\.]+)\.(.+)$/);return t?{name:t[1],prop:t[2]}:(t=e.match(/^characters\.([^\.]+)\.(.+)$/),t?{name:t[1],prop:t[2]}:null)};function Ck(e){if(!Ek(e))return null;const t=Nk(e);return t.length>0?t[0]:null}const Sk='System',Bk='Summary',xk=`【${Sk}】【${Bk}】【小总结】【722】`,_k=`【${Sk}】【${Bk}】【大总结】【723】`,Ik=`【${Sk}】【${Bk}】【小总结备份】【724】`;const Tk=e=>(e??'').replace(/\r\n/g,'\n'),Ak=(e,t)=>{const a=(t??'').trim();return a?`<${e}>\n${a}\n</${e}>`:''},Mk=(e,t)=>{const a=Tk(Me(e));if(!a)return[];const n=[],o=new RegExp(`<${t}>([\\s\\S]*?)<\\/${t}>`,'gi');let l;for(;null!==(l=o.exec(a));){const e=Ak(t,l[1]??'');e&&n.push(e)}return n},Dk=e=>{const t=Mk(e,'小总结'),a=Mk(e,'大总结'),n=Mk(e,'small_summary').map(e=>e.replace(/^<small_summary>/i,'<小总结>').replace(/<\/small_summary>$/i,'</小总结>')),o=[...Mk(e,'big_summary'),...Mk(e,'big-summary')].map(e=>e.replace(/^<(big_summary|big-summary)>/i,'<大总结>').replace(/<\/(big_summary|big-summary)>$/i,'</大总结>'));return{smallBlocks:[...t,...n].map(e=>e.trim()).filter(Boolean),bigBlocks:[...a,...o].map(e=>e.trim()).filter(Boolean)}},Pk=(e,t)=>{const a=(e??'').trim(),n=t.map(e=>(e??'').trim()).filter(Boolean).join('\n\n');return n?a?`${a}\n\n${n}`:n:a};async function Ok(e){const{worldbookName:t,finalText:a,resolveUserPlaceholders:n}=e,o='function'==typeof n?n(a):a,{smallBlocks:l,bigBlocks:r}=Dk(o);if(0===l.length&&0===r.length)return{smallAdded:0,bigAdded:0};const i=window;if('function'!=typeof i.getWorldbook||'function'!=typeof i.replaceWorldbook)return console.warn('[SummaryWorldbook] Summary tags found, but worldbook APIs are unavailable'),{smallAdded:0,bigAdded:0};const c=await i.getWorldbook(t),s=(e,t,a)=>{let n=(e=>c.find(t=>t?.name===e))(e);return n||(n={uid:Date.now()+Math.floor(1e5*Math.random()),name:e,enabled:a,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:0,order:t},content:'',probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}},c.push(n)),n.enabled=a,n.position={...n.position??{},type:'after_character_definition',order:t},n},d=s(xk,722,!0),u=s(_k,723,!0),m=s(Ik,724,!1);if(m.enabled=!1,l.length>0&&(d.content=Pk(d.content,l)),r.length>0&&(u.content=Pk(u.content,r)),r.length>0){const e=Dk(d.content??'').smallBlocks.map(e=>(e??'').trim()).filter(Boolean);e.length>0&&(m.content=Pk(m.content,e)),d.content=''}return await i.replaceWorldbook(t,c,{render:'debounced'}),console.log('[SummaryWorldbook] ✓ Summary entries updated',{small:l.length,big:r.length}),{smallAdded:l.length,bigAdded:r.length}}const Rk={class:'background-layer'},Lk={class:'bg-frame'},$k=['src'],Uk={class:'character-layer'},zk=['src'],Fk={class:'log-panel'},Wk={class:'log-header'},Gk={class:'log-content'},jk=['onClick'],Jk={class:'log-item-header'},Yk={class:'log-name'},Hk={class:'log-text'},Xk={class:'exit-confirm-dialog'},Kk={class:'dialog-icon'},qk={class:'dialog-actions'},Qk='current_game_protagonist_ref',Zk='current_game_protagonist',eN='同梦',tN=(0,r.defineComponent)({__name:'MainGame',setup(e){try{window.__MYCARD_PHASE__='MainGame:setup';try{const e=window.top;e&&e!==window&&(e.__MYCARD_PHASE__=window.__MYCARD_PHASE__)}catch{}}catch{}const t=(0,r.ref)(!1),a=(0,r.ref)(!1),n=(0,r.ref)(!1),o=(0,r.ref)(!1),l=(0,r.ref)(!1),c=(0,r.ref)(!1),s=(0,r.reactive)([]),{getAsset:d}=Hv(),u=(0,i.useRouter)(),m=(0,r.ref)(!1);let p=!1;const v=(0,r.ref)(!1),g=(0,r.ref)(!1),f=(0,r.reactive)({w:0,h:0}),y=(0,r.computed)(()=>{const e=f.w,t=f.h;return{'--stable-vw':e?`${e}px`:void 0,'--stable-vh':t?`${t}px`:void 0}}),h=(e=!1)=>{const t=Math.max(0,Math.floor(window.innerWidth||0)),a=Math.max(0,Math.floor(window.innerHeight||0));if(!t||!a)return;const n=Math.abs(t-(f.w||t))>80;(e||0===f.w||0===f.h||n)&&(f.w=t,f.h=a)},k=()=>h(!1);(0,r.onUnmounted)(()=>{p=!0;try{$e&&clearTimeout($e)}catch{}try{te&&clearTimeout(te)}catch{}try{Be&&clearTimeout(Be)}catch{}try{Ne&&clearTimeout(Ne)}catch{}try{window.removeEventListener('resize',k)}catch{}});const N=(0,r.ref)(''),V=(0,r.ref)(''),b=async()=>{try{const e=sessionStorage.getItem(Qk);if(e){const t=JSON.parse(e);N.value='string'==typeof t?.name?t.name:'';const a='string'==typeof t?.runtimeId?t.runtimeId:'';if(a){const e=await pe.idbService.getRuntimeAsset(a);V.value='string'==typeof e?.imageUrl?e.imageUrl:''}return}}catch(e){console.warn('[MainGame] Failed to load protagonist ref from session:',e)}try{const e=sessionStorage.getItem(Zk);if(!e)return;const t=JSON.parse(e);t&&'object'==typeof t&&(N.value='string'==typeof t.name?t.name:'',V.value='string'==typeof t.imageUrl?t.imageUrl:'')}catch(e){console.warn('[MainGame] Failed to load protagonist legacy from session:',e)}},w=e=>{if(!e)return'';const t=N.value?.trim()||'玩家';return e.replace(/<user>/gi,t)},C=(0,r.ref)(null),S=(0,r.ref)(null),B=(0,r.ref)([]);const x=(0,r.reactive)({fontSize:18,textSpeed:30,autoSpeed:2e3,bgImage:'',charImage:'',dialogueTextColor:'#f1f5f9',narrationTextColor:'#f1f5f9',psychTextColor:'#a78bfa',performanceEnabled:!0,debugMode:!1,charScale:80,charX:50,charY:0,dialogueWidth:90,dialogueOpacity:85,dialogueHeight:200,dialoguePaddingX:2.5,dialoguePaddingY:2,dialogueBottom:3,layoutConfigs:{1:[{charScale:80,charX:50,charY:0}],2:[{charScale:75,charX:30,charY:0},{charScale:75,charX:70,charY:0}],3:[{charScale:70,charX:20,charY:0},{charScale:75,charX:50,charY:0},{charScale:70,charX:80,charY:0}],4:[{charScale:65,charX:15,charY:0},{charScale:70,charX:38,charY:0},{charScale:70,charX:62,charY:0},{charScale:65,charX:85,charY:0}]},autoBigSummaryEnabled:!1,autoBigSummaryInterval:25}),I=e=>{try{sessionStorage.setItem('auto_big_summary_need_big',e?'1':'0')}catch{}},T=(0,r.computed)(()=>x.bgImage||''),A=(0,r.ref)({bgImage:'',charImage:'',dialogueQueue:[]}),M=(0,r.ref)(1),D=(0,r.computed)(()=>{const e=x.layoutConfigs?.[M.value],t=e?.[0]||{charScale:80,charX:50,charY:0};return{left:`${t.charX}%`,transform:'translateX(-50%)',bottom:`${t.charY}%`,height:`${t.charScale}%`}}),P=(0,r.ref)(''),O=(e=250)=>{Se(JSON.parse(JSON.stringify((0,r.toRaw)(x))),e)},R=async e=>{const t=x.debugMode,a=e.debugMode??t;try{const t='auto_bg_mode';a||'string'!=typeof e?.bgImage||e.bgImage===x.bgImage||sessionStorage.setItem(t,'0')}catch{}!t&&a&&(A.value={bgImage:x.bgImage||'',charImage:x.charImage||'',dialogueQueue:[...j]}),t&&!a&&(void 0!==A.value.bgImage&&(e.bgImage=A.value.bgImage),void 0!==A.value.charImage&&(e.charImage=A.value.charImage),A.value.dialogueQueue.length>0&&(j.splice(0,j.length,...A.value.dialogueQueue),H.value=0)),(()=>{if(a)return;if('string'==typeof e.bgImage?e.bgImage:x.bgImage)return;const t=(0,wa.getAllBackgroundImages)();if(t.length>0&&t[0]?.imageUrl)return void(e.bgImage=t[0].imageUrl);const n=C.value?.sceneBackgrounds;if(Array.isArray(n)&&n.length>0){const t=n[0],a='string'==typeof t?t:t?.imageUrl||'';a&&(e.bgImage=a)}})(),Object.assign(x,e),O(),Pe(),await ze()};function L(e){try{return JSON.parse(JSON.stringify(e,(e,t)=>{if('function'!=typeof t&&'symbol'!=typeof t)return'bigint'==typeof t?t.toString():t}))}catch{return}}function U(e){const t=Array.isArray(e)?e.length:0;let a=0,n=0;for(const t of e){const e='string'==typeof t?.text?t.text.length:0;a+=e,e>n&&(n=e)}return{count:t,totalTextChars:a,maxTextChars:n}}function F(e,t){const a=Array.isArray(e?.dialogueQueue)?e.dialogueQueue:[],n=Array.isArray(e?.historyLog)?e.historyLog:[];return{...e,dialogueQueue:a.slice(Math.max(0,a.length-t)),historyLog:n.slice(Math.max(0,n.length-t)),__trimmed:!0,__keepTailCount:t}}function W(e){const t='string'==typeof e?.name?e.name:'',a='string'==typeof e?.text?e.text:'',n='string'==typeof e?.emotion?e.emotion:void 0,o='string'==typeof e?.outfit?e.outfit:void 0,l='performance'===e?.kind?'performance':'dialogue'===e?.kind?'dialogue':void 0;let r;if(e?.performance&&'object'==typeof e.performance){const t=e.performance??{};r={};for(const e of Object.keys(t)){const a=t[e];if('function'==typeof a)continue;const n=L(a);void 0!==n&&(r[e]=n)}}return{name:t,text:a,emotion:n,outfit:o,kind:l,performance:r}}function G(e){return{name:'string'==typeof e?.name?e.name:'',text:'string'==typeof e?.text?e.text:'',emotion:'string'==typeof e?.emotion?e.emotion:void 0,outfit:'string'==typeof e?.outfit?e.outfit:void 0,kind:'performance'===e?.kind?'performance':'dialogue',performance:e?.performance&&'object'==typeof e.performance?e.performance:void 0}}(0,r.onMounted)(async()=>{h(!0);try{window.addEventListener('resize',k,{passive:!0})}catch{}try{window.__MYCARD_PHASE__='MainGame:onMounted:begin'}catch{}await(async()=>{try{const e=await we();e.layoutConfigs||(e.layoutConfigs={1:[{charScale:80,charX:50,charY:0}],2:[{charScale:75,charX:30,charY:0},{charScale:75,charX:70,charY:0}],3:[{charScale:70,charX:20,charY:0},{charScale:75,charX:50,charY:0},{charScale:70,charX:80,charY:0}],4:[{charScale:65,charX:15,charY:0},{charScale:70,charX:38,charY:0},{charScale:70,charX:62,charY:0},{charScale:65,charX:85,charY:0}]}),Object.assign(x,e)}catch(e){console.error('Failed to load settings',e)}})(),await b();let e=!1;await(0,wa.An)();try{window.__MYCARD_PHASE__='MainGame:onMounted:afterHydrateAssets'}catch{}try{let t=null,a=null;const n=sessionStorage.getItem('restore_save_id');if(n)try{const e=await pe.idbService.getSave(n);a=e??null,t=e?.sessionData}finally{sessionStorage.removeItem('restore_save_id')}const o=t?null:sessionStorage.getItem('restore_save_ref');if(o)try{const e=JSON.parse(o),a='string'==typeof e?.runtimeId?e.runtimeId:'';a&&(t=await pe.idbService.getRuntimeAsset(a),await pe.idbService.deleteRuntimeAsset(a).catch(()=>{}))}finally{sessionStorage.removeItem('restore_save_ref')}if(!t){const e=sessionStorage.getItem('restore_save_data');e&&(t=JSON.parse(e),sessionStorage.removeItem('restore_save_data'))}if(t){console.log('[MainGame] Restoring save session data'),e=!0,v.value=!0;try{window.__MYCARD_PHASE__='MainGame:restore:sessionData'}catch{}try{const e=t?.lastFinalText,a='string'==typeof e&&e.trim()?e:Fe(t);if(a&&'string'==typeof a){const e=Ue(a),t=2e4;sessionStorage.setItem('last_final_text',e.length>t?e.slice(e.length-t):e)}else sessionStorage.removeItem('last_final_text')}catch{}if(t.eventPackData){try{(0,wa.w7)(t.eventPackData)}catch(e){console.warn('[MainGame] Failed to ensure game assets from saved eventPackData:',e)}try{C.value=t.eventPackData}catch{}}try{const e=sessionStorage.getItem('current_game_event_id');if(!e||!e.trim()){const e='string'==typeof a?.eventPackId&&a.eventPackId||('string'==typeof t?.eventPackData?.id?String(t.eventPackData.id):'');e&&sessionStorage.setItem('current_game_event_id',e)}}catch{}if(t.dialogueQueue){j.splice(0,j.length,...t.dialogueQueue);const e='number'==typeof t.currentLineIndex?t.currentLineIndex:0,a=Math.max(0,j.length-1);H.value=Math.min(Math.max(e,0),a)}if(t.historyLog&&K.splice(0,K.length,...t.historyLog),t.gameSettings){const e=Array.isArray(x.enabledSidebarWidgets)?[...x.enabledSidebarWidgets]:null;Object.assign(x,t.gameSettings);const a=x.enabledSidebarWidgets;!e||Array.isArray(a)&&0!==a.length||(x.enabledSidebarWidgets=e)}if(he(),ke(),t.protagonist){const e=`restore_${Date.now()}_protagonist`;await pe.idbService.setRuntimeAsset(e,{imageUrl:t.protagonist.imageUrl||''}),sessionStorage.setItem(Qk,JSON.stringify({name:t.protagonist.name||'',runtimeId:e})),await b()}}}catch(e){console.error('[MainGame] Failed to restore save data:',e)}const a=sessionStorage.getItem('new_game_start_text');let o=!!a;const r=sessionStorage.getItem('current_game_event_id'),i=sessionStorage.getItem('current_game_char_ids');try{window.__MYCARD_PHASE__='MainGame:loadContext:begin'}catch{}if(r&&!C.value)try{const e=(await pe.idbService.getAllWorks()).find(e=>'EVENT'===e.type&&e.id===r);if(e){C.value=e.data,console.log('[MainGame] Loaded Event Pack:',C.value.name);try{window.__MYCARD_PHASE__='MainGame:loadContext:afterEventPackLoaded'}catch{}try{(0,wa.w7)(C.value)}catch(e){console.warn('[MainGame] Failed to ensure game assets from loaded event pack:',e)}if(!x.debugMode&&!x.bgImage){const e=(0,wa.getAllBackgroundImages)();if(e.length>0&&e[0]?.imageUrl)x.bgImage=e[0].imageUrl,O();else{const e=C.value?.sceneBackgrounds;if(Array.isArray(e)&&e.length>0){const t=e[0],a='string'==typeof t?t:t?.imageUrl||'';a&&(x.bgImage=a,O())}}}Pe(),await Oe()}}catch(e){console.error('[MainGame] Failed to load event pack context',e)}if(a&&(console.log('[MainGame] Found start text from NewGame'),sessionStorage.removeItem('new_game_start_text'),await tt(a)),i)try{B.value=JSON.parse(i)}catch(e){console.error('[MainGame] Failed to parse char ids',e)}if(!o&&!e){const e=await X(),a=e?.mainGame,o=sessionStorage.getItem('current_game_event_id')||'',r='string'==typeof a?.eventPackId?String(a.eventPackId):'',i=!(!o||!r||o===r);if(a&&a.hasActiveGame&&!i){console.log('[MainGame] Restoring complete game state from persistence'),v.value=!0;try{const e='string'==typeof a?.eventPackOverrideRuntimeId?String(a.eventPackOverrideRuntimeId):'';if(e){const t=await pe.idbService.getRuntimeAsset(e),a='string'==typeof t?.id?t.id:'';if(!o||!a||a===o){C.value=t,S.value=e;try{(0,wa.w7)(C.value)}catch(e){console.warn('[MainGame] Failed to ensure game assets from overridden event pack:',e)}}}}catch(e){console.warn('[MainGame] Failed to restore event pack override from persistence:',e)}let e=null;try{const t=('string'==typeof a.payloadRuntimeId?a.payloadRuntimeId:'')||J;e=await pe.idbService.getRuntimeAsset(t)??null,e&&Array.isArray(e.dialogueQueue)||(e=null)}catch{e=null}if(e?.dialogueQueue&&e.dialogueQueue.length>0)try{j.splice(0,j.length,...e.dialogueQueue.map(e=>G(e))),console.log(`[MainGame] ✓ 从 IndexedDB 恢复了 ${j.length} 条对话`)}catch(e){console.warn('[MainGame] Failed to hydrate dialogueQueue from payload:',e)}if(e?.historyLog&&Array.isArray(e.historyLog)&&e.historyLog.length>0)try{K.splice(0,K.length,...e.historyLog.map(e=>G(e))),console.log(`[MainGame] ✓ 从 IndexedDB 恢复了 ${K.length} 条历史记录`)}catch(e){console.warn('[MainGame] Failed to hydrate historyLog from payload:',e)}try{window.__MYCARD_PHASE__='MainGame:restore:persistence'}catch{}if(0===j.length&&a.dialogueQueue&&a.dialogueQueue.length>0&&(j.splice(0,j.length,...a.dialogueQueue.map(e=>G(e))),console.log(`[MainGame] ✓ (fallback) 恢复了 ${j.length} 条对话`)),0===K.length&&a.historyLog&&a.historyLog.length>0&&(K.splice(0,K.length,...a.historyLog.map(e=>G(e))),console.log(`[MainGame] ✓ (fallback) 恢复了 ${K.length} 条历史记录`)),0===j.length&&K.length>0){const e=K[K.length-1];j.splice(0,j.length,{...e,kind:'dialogue'}),console.log('[MainGame] ✓ (fallback) 使用最后一条历史记录重建对话显示')}if(j.length>0){const e='number'==typeof a.dialogueIndex?a.dialogueIndex:Math.max(0,j.length-1),t=Math.max(0,j.length-1);H.value=Math.min(Math.max(e,0),t),console.log(`[MainGame] ✓ 当前索引: ${H.value}`)}a.gameSettings&&(Object.assign(x,a.gameSettings),console.log('[MainGame] ✓ 恢复了游戏设置')),await Oe(),he(),ke(),'settings'===a.activeModal?t.value=!0:'saveload'===a.activeModal?n.value=!0:'errorlog'===a.activeModal&&(l.value=!0);try{await Ge({eventPackId:a.eventPackId||sessionStorage.getItem('current_game_event_id')||void 0})}catch{}if(0===j.length&&!g.value){g.value=!0;const t=a.eventPackId||sessionStorage.getItem('current_game_event_id')||e?.eventPackId;await async function(e){try{const t=await pe.idbService.getAllSaves(),a=(Array.isArray(t)?t:[]).filter(t=>{const a=t?.sessionData?.dialogueQueue;return!(!Array.isArray(a)||0===a.length)&&('string'!=typeof e||!e.trim()||t?.eventPackId===e)}).sort((e,t)=>(t.timestamp||0)-(e.timestamp||0)),n=a[0];if(!n)return!1;const o=n.sessionData,l=Array.isArray(o?.dialogueQueue)?o.dialogueQueue.map(e=>G(e)):[],r=Array.isArray(o?.historyLog)?o.historyLog.map(e=>G(e)):[];if(0===l.length)return!1;j.splice(0,j.length,...l),K.splice(0,K.length,...r);const i='number'==typeof o?.currentLineIndex?o.currentLineIndex:Math.max(0,l.length-1),c=Math.max(0,l.length-1);return H.value=Math.min(Math.max(i,0),c),o?.gameSettings&&'object'==typeof o.gameSettings&&Object.assign(x,o.gameSettings),v.value=!0,he(),ke(),await Ge({eventPackId:n?.eventPackId||e}),!0}catch(e){return console.warn('[MainGame] tryRecoverDialogueFromLocalSaves failed:',e),!1}}('string'==typeof t&&t.trim()?t:void 0)&&xe('✓ 已从本地存档恢复对话',!0,2e3)}}try{window.__MYCARD_PHASE__='MainGame:restore:done'}catch{}}}),(0,r.watch)(()=>x.performanceEnabled,()=>{he()}),(0,r.watch)([()=>t.value,()=>n.value,()=>l.value],([e,t,a])=>{if(m.value||p)return;let n=null;e?n='settings':t?n='saveload':a&&(n='errorlog'),Z({activeModal:n})});const j=(0,r.reactive)([]),H=(0,r.ref)(0),K=(0,r.reactive)([]),Q=(0,r.ref)(!1),ee=(0,r.ref)(!1);let te=null;const ae=(0,r.ref)(!1),ne=(0,r.ref)(null),oe=(0,r.ref)(null),le=(0,r.ref)(''),re=(0,r.ref)(''),ie=(0,r.computed)(()=>j.length>0&&H.value<j.length?j[H.value]:{name:'',text:''}),ce=e=>{if(0===j.length)return null;for(let t=Math.min(Math.max(e,0),Math.max(0,j.length-1));t>=0;t--){const e=j[t];if(e&&('performance'!==e.kind&&'string'==typeof e.text&&e.text.trim()))return e}return null},se=(0,r.computed)(()=>{const e=ie.value,t='string'==typeof e?.name?e.name:'',a='string'==typeof e?.text?e.text:'';if(v.value&&0===j.length)return{name:'',text:'（对话数据未从持久化恢复。\n点击此处打开“读档”尝试修复；或返回主页重新进入。）'};if(!de(e)&&a.trim())return{name:t,text:a};if(de(e)&&me.value){const e=ce(H.value-1);return e?{name:e.name||'',text:e.text||''}:{name:'',text:''}}if(de(e)&&!me.value){if(a.trim())return{name:t||'',text:a};const e=ce(H.value-1);return e?{name:e.name||'',text:e.text||''}:{name:'',text:''}}return null}),de=e=>'performance'===e?.kind,ue=e=>!!(e&&de(e)&&e.performance)&&('time'===e.performance.category||'location'===e.performance.category),me=(0,r.computed)(()=>!!x.performanceEnabled&&(!!de(ie.value)&&(!ue(ie.value)&&!!ie.value.text))),ve=e=>!!e&&(!de(e)||!!x.performanceEnabled),ge=e=>!!e&&(!de(e)&&('string'==typeof e.text&&!!e.text.trim())),fe=e=>{if(0===j.length)return 0;const t=Math.min(Math.max(e,0),Math.max(0,j.length-1));for(let e=t;e>=0;e--)if(ge(j[e]))return e;for(let e=t+1;e<j.length;e++)if(ge(j[e]))return e;return t},ye=(e,t)=>{if(0===j.length)return 0;let a=e;for(;a>=0&&a<j.length;){if(ve(j[a]))return a;a+=t}return Math.min(Math.max(e,0),Math.max(0,j.length-1))},he=()=>{if(0===j.length)return;if(ve(ie.value))return;const e=ye(H.value,1);if(ve(j[e]))return void(H.value=e);const t=ye(H.value,-1);H.value=t},ke=()=>{if(0===j.length)return;if(ge(ie.value))return;const e=fe(H.value);e!==H.value&&(H.value=e)};let Ne=null;(0,r.watch)(()=>ie.value,e=>{Ne&&(clearTimeout(Ne),Ne=null),ue(e)&&x.performanceEnabled&&(Ne=setTimeout(()=>{m.value||p||ie.value===e&&je()},800))},{immediate:!0});const Ee=(0,r.ref)(!1),Ve=(0,r.ref)(''),be=(0,r.ref)(!0);let Be=null;const xe=(e,t=!0,a=3e3)=>{Ve.value=e,be.value=t,Ee.value=!0,Be&&clearTimeout(Be),a>0&&(Be=setTimeout(()=>{Ee.value=!1},a))},_e=()=>{s.splice(0,s.length),xe('已清空错误日志',!0,2e3)},Ie=e=>{try{return JSON.stringify(e,null,2)}catch{try{return String(e)}catch{return'[unserializable]'}}},Te=async e=>{const t=(e=>{const t=String(e??'').trim();return t?t.includes('[$$')?t:`[$$\n${t}\n$$]`:''})(e);if(t)try{const e=await ya(t);if(e.errors.length>0){const a=Array.isArray(e.errorDetails)&&e.errorDetails.length>0?e.errorDetails:[];a.length>0?a.forEach(e=>{s.push({timestamp:Date.now(),message:e.message,command:e.rawCommand,details:Ie({code:e.code,commandType:e.commandType,path:e.path,normalizedPath:e.normalizedPath,details:e.details})})}):e.errors.forEach(e=>{s.push({timestamp:Date.now(),message:e,command:t})}),xe(`⚠ 重新处理：${e.errors.length} 条指令失败`,!1,3e3)}else e.commandsExecuted>0?xe('✓ 已重新应用变量指令',!0,2e3):xe('未检测到可执行的变量指令',!1,2500);try{await Oe()}catch{}}catch(e){s.push({timestamp:Date.now(),message:'重新处理变量时发生异常',command:t,details:e?.message||String(e)}),xe('重新处理失败',!1,2500)}},Ae=e=>{const t=e.split('\n'),a=[];let n='',o='',l='',r=[],i=!1,c=!1,s=[];const d=e=>{let t=e??'';for(;t;){if(i){const e=t.indexOf('--\x3e');if(-1===e)return'';t=t.slice(e+3),i=!1;continue}const e=t.indexOf('\x3c!--');if(-1===e)return t;const a=t.indexOf('--\x3e',e+4);if(-1===a)return i=!0,t.slice(0,e);t=t.slice(0,e)+t.slice(a+3)}return t},u=()=>{r.length>0&&a.push({name:'Narrator'===n?'':n,text:r.join('\n'),emotion:o,outfit:l}),r=[]},m=()=>{const e=s.join('\n');s=[],c=!1;const t=`[$$\n${e}\n$$]`,n=Nk(t);if(n.length>0)for(const e of n){const t='time'===e?.meta?.category||'location'===e?.meta?.category;a.push({name:'',text:t?'':e.text||'【变量】已更新',kind:'performance',performance:e.meta})}else{const n=Ck(t);if(n){const e='time'===n?.meta?.category||'location'===n?.meta?.category||'time'===n?.meta?.apply?.kind||'location'===n?.meta?.apply?.kind;a.push({name:'',text:e?'':n.text||`【变量】${t}`,kind:'performance',performance:n.meta})}else a.push({name:'',text:`【变量】${e.trim()||'已更新'}`,kind:'performance'})}};for(const e of t){const t=d(e).trim();if(!t)continue;if(c){const e=t.indexOf('$$]');if(-1!==e){const a=t.slice(0,e).trim();a&&s.push(a),u(),m();continue}s.push(t);continue}if(t.startsWith('[$$')){if(-1!==t.indexOf('$$]')){u();const e=Nk(t);if(e.length>0)for(const n of e){const e='time'===n?.meta?.category||'location'===n?.meta?.category;a.push({name:'',text:e?'':n.text||`【变量】${t}`,kind:'performance',performance:n.meta})}else{const e=Ck(t),n='time'===e?.meta?.category||'location'===e?.meta?.category||'time'===e?.meta?.apply?.kind||'location'===e?.meta?.apply?.kind;a.push({name:'',text:n?'':e?.text||`【变量】${t}`,kind:'performance',performance:e?.meta})}continue}c=!0;const e=t.slice(3).trim();e&&s.push(e);continue}const i=t.replace(/^[\u201c\u201d\u2018\u2019"'“”‘’]+/,'').match(/^\[(.*?)\](.*)$/);if(i){const e=(i[1]??'').trim(),t=(i[2]??'').trim(),a=e.split('|').map(e=>e.trim()).filter(e=>e.length>0);if(a.length>=2){u(),n=a[0],o='null'===a[1]?.toLowerCase()?'':a[1]??'',l='null'===a[2]?.toLowerCase()?'':a[2]??'',t&&r.push(t);continue}}r.push(t)}return u(),a},Me=e=>{if(!e)return;j.splice(0,j.length);const t=Ae(e);t.length>0&&(j.push(...t),H.value=0)},Pe=async()=>{const e=('string'==typeof ie.value?.name?String(ie.value.name):'').trim();if(e&&!de(ie.value)){if(x.debugMode){const t=await d('char',e);return t?void(P.value=t.data):void(P.value='')}{const t=e,a=t.toLowerCase(),n=N.value.trim(),o=n&&t===n||'user'===a||'<user>'===a||'玩家'===t||'主角'===t;if(o&&V.value)return void(P.value=V.value);if(o&&x.charImage)return void(P.value=x.charImage)}if(C.value){const t=e,a=ie.value?.emotion?.trim?.()||'',n=ie.value?.outfit?.trim?.()||'';if(t){const e=Ia(C.value,t,a,n);if(e)return void(P.value=e)}}P.value=''}else P.value=''},Oe=async()=>{if(x.debugMode)return;const e='auto_bg_mode',t='auto_bg_last_url';try{const a=await ga(eN),n=('string'==typeof a?.系统?.地点?a.系统.地点:'')||('string'==typeof a?.system?.location?a.system.location:'')||'',o=Da(C.value)||(()=>{const e=(0,wa.getAllBackgroundImages)();return e.length>0&&e[0]?.imageUrl?e[0].imageUrl:''})(),l=function(e,t){const a=Ba(t);if(!e||!a)return'';const n=Array.isArray(e.backgroundImages)?e.backgroundImages:[],o=Array.isArray(e.sceneBackgrounds)?e.sceneBackgrounds:[];if(0===n.length&&0===o.length)return'';let l=0,r=[];for(const e of n){const t=Ta(e);if(!t)continue;const n=Ba(e.imageUrl);if(!n)continue;const o=(0,Ca.Ao)(t,a,'includes');o<=0||(o>l?(l=o,r=[n]):o===l&&r.push(n))}for(const e of o){const t=Ma(e);if(!t)continue;const n=Aa(e);if(!n)continue;const o=(0,Ca.Ao)(t,a,'includes');o<=0||(o>l?(l=o,r=[n]):o===l&&r.push(n))}if(l>0){if(1===r.length)return r[0];const t=`${e.id||''}|${a}|${r.join('|')}`;return r[xa(t)%r.length]}return''}(C.value,n);if(l){x.bgImage=l;try{sessionStorage.setItem(e,'1'),sessionStorage.setItem(t,l)}catch{}return}if(o&&x.bgImage!==o){x.bgImage=o;try{sessionStorage.setItem(e,'1'),sessionStorage.setItem(t,o)}catch{}}}catch(e){console.warn('[MainGame] Failed to apply background from location:',e)}};async function Re(e){try{await fa(e,eN).catch(()=>!1);const{time:a,location:n}=(t=e,{time:('string'==typeof t?.系统?.时间?t.系统.时间:'')||('string'==typeof t?.system?.time?t.system.time:'')||'',location:('string'==typeof t?.系统?.地点?t.系统.地点:'')||('string'==typeof t?.system?.location?t.system.location:'')||''});le.value=a||le.value,re.value=n||re.value,ne.value=a||null,oe.value=n||null,await Oe(),xe('变量已应用',!0,1800)}catch(e){console.warn('[MainGame] handleVariablesApplied failed:',e),xe('变量应用失败',!1,2e3)}var t}const Le=(0,r.computed)(()=>JSON.stringify(ie.value));(0,r.watch)(Le,()=>{Pe()}),(0,r.watch)(()=>x,()=>{Pe()},{deep:!0});let $e=null;const ze=async()=>{m.value||($e&&clearTimeout($e),$e=setTimeout(async()=>{try{if(0===j.length&&0===K.length)return;const e=sessionStorage.getItem('current_game_event_id'),t=sessionStorage.getItem('current_game_char_ids'),a=ge(ie.value)?H.value:fe(H.value);try{const t={eventPackId:e||void 0,savedAt:Date.now(),dialogueQueue:j.map(e=>W(e)),historyLog:K.map(e=>W(e))};try{await pe.idbService.setRuntimeAsset(J,t)}catch(e){const a=function(e){try{const t=JSON.stringify(e);return(new TextEncoder).encode(t).length}catch{return null}}(t),n=U(t.dialogueQueue),o=U(t.historyLog);if(console.warn('[MainGame] Failed to persist large state payload to IndexedDB:',e),console.warn('[MainGame] Persist payload stats:',{id:J,bytes:a,dialogue:n,history:o,errorName:e?.name,errorMessage:e?.message}),function(e){const t=e?.name,a=e?.message,n=`${t||''} ${a||''}`.toLowerCase();return n.includes('too large')||n.includes('quota')||n.includes('exceeded')}(e)){const e=[800,400,200,100];for(const a of e)try{const e=F(t,a);await pe.idbService.setRuntimeAsset(J,e),console.warn('[MainGame] Retried IDB persist with trimmed payload:',{keepTailCount:a});break}catch{}}}}catch(e){console.warn('[MainGame] Failed to persist large state payload to IndexedDB:',e)}await Z({hasActiveGame:!0,eventPackId:e||void 0,eventPackOverrideRuntimeId:S.value||void 0,characterIds:t?JSON.parse(t):void 0,payloadRuntimeId:J,dialogueQueue:void 0,dialogueIndex:a,historyLog:void 0,gameSettings:{...x}}),console.log(`[MainGame] ✓ 自动保存游戏状态 (对话: ${H.value}/${j.length})`)}catch(e){console.error('[MainGame] ✗ 自动保存失败:',e)}},300))};async function Ge(e){try{if(0===j.length&&0===K.length)return!1;const t=('string'==typeof e?.eventPackId&&e.eventPackId.trim()?e.eventPackId:void 0)||sessionStorage.getItem('current_game_event_id')||void 0,a=sessionStorage.getItem('current_game_char_ids'),n=ge(ie.value)?H.value:fe(H.value),o={eventPackId:t||void 0,savedAt:Date.now(),dialogueQueue:j.map(e=>W(e)),historyLog:K.map(e=>W(e))};return await pe.idbService.setRuntimeAsset(J,o),await Z({hasActiveGame:!0,eventPackId:t||void 0,eventPackOverrideRuntimeId:S.value||void 0,characterIds:a?JSON.parse(a):void 0,payloadRuntimeId:J,dialogueQueue:void 0,dialogueIndex:n,historyLog:void 0,gameSettings:{...x}}),!0}catch(e){return console.warn('[MainGame] persistMainGamePersistenceNow failed:',e),!1}}const je=async()=>{if(he(),H.value<j.length-1){if(ie.value.text){K.some(e=>e.queueIndex===H.value)||K.push({...ie.value,queueIndex:H.value})}const e=ye(H.value+1,1);H.value=e,await ze(),et()}else Q.value=!1,ee.value=!1,te&&clearTimeout(te)},Je=async()=>{he();let e=H.value-1;for(;e>=0;)if(de(j[e]))e--;else{if(ve(j[e]))break;e--}e>=0&&(H.value=e,await ze(),Q.value=!1,ee.value=!1,te&&clearTimeout(te))},Xe=e=>'number'==typeof e.queueIndex&&e.queueIndex>=0&&e.queueIndex<j.length,qe=()=>{v.value&&0===j.length?n.value=!0:Q.value||ee.value?(Q.value=!1,ee.value=!1,te&&clearTimeout(te)):je()},Qe=()=>{Q.value=!Q.value,ee.value=!1,Q.value?et():te&&clearTimeout(te)},Ze=()=>{ee.value=!ee.value,Q.value=!1,ee.value?et():te&&clearTimeout(te)},et=()=>{if(te&&clearTimeout(te),!Q.value&&!ee.value)return;let e=100;if(ee.value)e=100;else if(Q.value){e=(ie.value.text?.length||0)*x.textSpeed+x.autoSpeed}te=setTimeout(()=>{je()},e)};(0,r.watch)(()=>x.performanceEnabled,()=>{he()}),(0,r.watch)(()=>ie.value,e=>{let t=null,a=null;for(let e=H.value;e>=0;e--){const n=j[e];if(de(n)&&n.performance?.apply){const e=n.performance.apply;if(null===t&&'time'===e.kind&&(t=e.value),null===a&&'location'===e.kind&&(a=e.value),null!==t&&null!==a)break}}ne.value=t??(le.value||null),oe.value=a??(re.value||null)},{deep:!0,immediate:!0});const tt=async e=>{const t=Ue(e);if(!t||!t.trim())return void xe('⚠ 收到的回复长度为 0，请玩家重新发送',!1,3500);try{sessionStorage.setItem('last_final_text',t)}catch{}K.splice(0,K.length);Boolean(x.debugMode)&&(console.log('[MainGame] ========================================'),console.log('[MainGame] handleStreamEnd 被调用！'),console.log('[MainGame] finalText 长度:',t?.length),console.log('[MainGame] 完整回复内容(已规范化):\n',t),console.log('[MainGame] ========================================'));try{let e='',a='';try{const t=await ga(eN);e=('string'==typeof t?.系统?.时间?t.系统.时间:'')||('string'==typeof t?.system?.time?t.system.time:'')||'',a=('string'==typeof t?.系统?.地点?t.系统.地点:'')||('string'==typeof t?.system?.location?t.system.location:'')||'',le.value=e,re.value=a}catch{}const n=sessionStorage.getItem('current_game_event_id'),o=sessionStorage.getItem('current_game_char_ids');await Z({hasActiveGame:!0,eventPackId:n||void 0,characterIds:o?JSON.parse(o):void 0,dialogueQueue:[...j],dialogueIndex:H.value,historyLog:[...K],gameSettings:{...x}});const l=await X(),r=(e=>`${sessionStorage.getItem('current_game_event_id')||''}:${(e=>{let t=5381;for(let a=0;a<e.length;a++)t=33*t^e.charCodeAt(a);return(t>>>0).toString(16)})(e||'')}`)(t),i=l?.mainGame?.lastVariablesProcessedKey;if(i!==r)try{const e=await ya(t);if(e.commandsExecuted>0&&console.log(`[MainGame] ✓ 执行了 ${e.commandsExecuted} 个变量指令`),await Z({lastVariablesProcessedKey:r}),e.errors.length>0){console.warn('[MainGame] ⚠ 变量处理错误:',e.errors);const t=Array.isArray(e.errorDetails)&&e.errorDetails.length>0?e.errorDetails:[];t.length>0?t.forEach(e=>{s.push({timestamp:Date.now(),message:e.message,command:e.rawCommand,details:Ie({code:e.code,commandType:e.commandType,path:e.path,normalizedPath:e.normalizedPath,details:e.details})})}):e.errors.forEach(e=>{s.push({timestamp:Date.now(),message:e})});const a=200;s.length>a&&s.splice(0,s.length-a),xe(`⚠ ${e.errors.length} 个变量指令执行失败`,!1,3e3)}}catch(e){console.error('[MainGame] ✗ 变量处理出错:',e),s.push({timestamp:Date.now(),message:'变量处理系统错误',details:e.message||String(e)});const t=200;s.length>t&&s.splice(0,s.length-t),xe('变量处理失败，但继续显示内容',!1,2e3),await Z({lastVariablesProcessedKey:r})}else console.log('[MainGame] ⏭ 跳过变量处理（本次回复已处理过）');await Oe();try{const e=await Ok({worldbookName:eN,finalText:t,resolveUserPlaceholders:w}),a=Math.max(1,Number.parseInt(String(x.autoBigSummaryInterval??25),10)||25),n=Boolean(x.autoBigSummaryEnabled);if(e.bigAdded>0)I(!1);else if(e.smallAdded>0&&n)try{const e=await async function(e){try{const t=window;if('function'!=typeof t.getWorldbook)return 0;const a=await t.getWorldbook(e);if(!Array.isArray(a))return 0;const n=a.find(e=>e?.name===xk),o='string'==typeof n?.content?n.content:'';if(!o.trim())return 0;const{smallBlocks:l}=Dk(o);return Array.isArray(l)?l.length:0}catch{return 0}}(eN);e>0&&e%a===0&&I(!0)}catch{}}catch(e){console.warn('[MainGame] Failed to process summaries:',e)}const c=De(t,'content',{stripThink:!0});if(console.log('[MainGame] content 匹配结果:',!!c),null!==c){let t=c;t=w(t),t=(e=>{const t=Tk(e);return t?t.replace(/<小总结>[\s\S]*?<\/小总结>/gi,'').replace(/<大总结>[\s\S]*?<\/大总结>/gi,'').replace(/<small_summary>[\s\S]*?<\/small_summary>/gi,'').replace(/<(big_summary|big-summary)>[\s\S]*?<\/(big_summary|big-summary)>/gi,''):''})(t),console.log('[MainGame] ✓ 提取到 content 内容，长度:',t.length);const n=Ae(t);if(n.length>0){j.splice(0,j.length,...n),H.value=0,he();const t=n.some(e=>'performance'===e.kind&&('time'===e.performance?.category||'location'===e.performance?.category));x.performanceEnabled&&t?(ne.value=e||ne.value,oe.value=a||oe.value):(ne.value=null,oe.value=null),console.log('[MainGame] ✓ 对话已更新，共',n.length,'条')}else console.warn('[MainGame] ✗ 未解析到任何对话行')}else console.warn('[MainGame] ✗ 未找到 <content> 标签');try{const{updateStoryWorldbook:e,getCurrentGameTime:t}=zt(),a=await t();a&&C.value?(console.log('[MainGame] Updating plot events for time:',a),await e(C.value,a)):console.log('[MainGame] Skipping plot update (no time or pack)')}catch(e){console.warn('[MainGame] Failed to update plot events:',e)}const d=De(t,'小总结',{stripThink:!0})??De(t,'state_bar',{stripThink:!0});if(console.log('[MainGame] 小总结/状态栏 匹配结果:',!!d),null!==d){const e=d;console.log('[MainGame] ✓ 提取到 小总结/状态栏 内容，长度:',e.length)}xe('✦ 回应已接收 ✦',!0,2e3)}catch(e){console.error('[MainGame] ✗✗✗ handleStreamEnd 出错 ✗✗✗:',e),xe('处理响应时出错',!1,3e3)}try{const e=await at('auto','自动存档');await Ke(e)}catch(e){console.warn('[MainGame] Auto-save failed:',e)}console.log('[MainGame] ======== handleStreamEnd 执行完毕 ========')};!function(e){const t=(0,r.ref)(!1),a=(0,r.ref)(''),n=t=>{console.log('[useStreamListener] ===== GENERATION_ENDED 事件触发 ====='),console.log('[useStreamListener] text 长度:',t?.length),a.value=t,e&&e(t)},o=()=>{try{const e=iframe_events||tavern_events;if(console.log('[useStreamListener] 开始设置事件监听器'),console.log('[useStreamListener] iframe_events:',e),console.log('[useStreamListener] eventOn 函数:',typeof eventOn),!e)return void console.error('[useStreamListener] 无法找到 iframe_events 或 tavern_events');console.log('[useStreamListener] 可用事件:',Object.keys(e)),e.GENERATION_ENDED?(eventOn(e.GENERATION_ENDED,n),console.log('[useStreamListener] ✓ 已监听 GENERATION_ENDED 事件'),t.value=!0):console.warn('[useStreamListener] GENERATION_ENDED 事件不存在'),tavern_events?.MESSAGE_RECEIVED&&(eventOn(tavern_events.MESSAGE_RECEIVED,e=>{console.log('[useStreamListener] MESSAGE_RECEIVED 事件触发, messageId:',e)}),console.log('[useStreamListener] ✓ 已监听 MESSAGE_RECEIVED 事件'))}catch(e){console.error('[useStreamListener] 设置流结束监听器失败:',e)}},l=()=>{try{const e=iframe_events||tavern_events;e?.GENERATION_ENDED&&(eventRemoveListener(e.GENERATION_ENDED,n),console.log('[useStreamListener] ✓ 已移除 GENERATION_ENDED 事件监听'),t.value=!1)}catch(e){console.error('[useStreamListener] 移除监听器失败:',e)}};(0,r.onMounted)(()=>{o()}),(0,r.onUnmounted)(()=>{l()})}(tt);const at=async(e,t,a)=>{const n=sessionStorage.getItem('current_game_event_id')||'',o=sessionStorage.getItem('current_game_char_ids')||'[]',l=sessionStorage.getItem('last_final_text')||'',i=l.length>2e4?l.slice(l.length-2e4):l;let c;try{const e=sessionStorage.getItem(Qk);if(e){const t=JSON.parse(e),a='string'==typeof t?.runtimeId?t.runtimeId:'',n=a?await pe.idbService.getRuntimeAsset(a):void 0;c={name:'string'==typeof t?.name?t.name:N.value,imageUrl:'string'==typeof n?.imageUrl?n.imageUrl:V.value}}}catch(e){console.warn('[MainGame] Failed to prepare protagonist for save:',e)}return{slotType:e,autoIndex:a,title:t||('auto'===e?'自动存档':'手动存档'),eventPackId:n,eventPackName:C.value?.name||'未知事件包',charIds:JSON.parse(o),dialogueQueue:JSON.parse(JSON.stringify(j)),currentLineIndex:H.value,historyLog:JSON.parse(JSON.stringify(K)),gameSettings:JSON.parse(JSON.stringify((0,r.toRaw)(x))),protagonist:c,eventPackData:C.value?JSON.parse(JSON.stringify(C.value)):void 0,lastFinalText:i,firstLine:(()=>{for(const e of j){if(!e||'object'!=typeof e)continue;if('performance'===e.kind)continue;const t='string'==typeof e.text?e.text.trim():'';if(t)return t.slice(0,120)}return''})(),thumbnail:x.bgImage,screenshotSelector:'.main-game-view'}},nt=async(e,t)=>{try{xe('正在保存...',!0,0);const a=await at('manual',t||void 0,void 0);await async function(e){const t=await Ye(e);await pe.idbService.saveSave(t);const a=await pe.idbService.getAllSaves();return await He(a),t}({...a,idOverride:e}),n.value=!1,xe('✓ 存档成功',!0,2e3)}catch(e){console.error('[MainGame] Failed to save:',e),xe('存档失败: '+(e.message||e),!1,3e3)}},ot=async e=>{try{if(xe('正在读取存档...',!0,0),await async function(e){const t=window.TavernHelper;t?.getWorldbookNames&&(t.getWorldbookNames().includes(We)||await t.createWorldbook(We),await t.rebindChatWorldbook('current',We));try{const t=window,a=(Array.isArray(e.worldbookEntries)?e.worldbookEntries:[]).filter(e=>{const t='string'==typeof e?.name?e.name:'';return'剧情事件 - 开始'!==t&&'剧情事件 - 结束'!==t});if(a.length>0)if('function'==typeof t.getWorldbook&&'function'==typeof t.replaceWorldbook){const e=await t.getWorldbook(We),n=Array.isArray(e)?[...e]:[],o=new Set;for(const e of n)'number'==typeof e?.uid&&o.add(e.uid);const l=e=>n.findIndex(t=>t?.name===e);for(let e=0;e<a.length;e++){const t=a[e],r='string'==typeof t?.name?t.name:'';if(!r)continue;const i=l(r);if(-1!==i){const e=n[i]?.uid;n[i]={...n[i],...t,uid:'number'==typeof e?e:n[i]?.uid}}else{let a='number'==typeof t?.uid?t.uid:Date.now()+e;for(;o.has(a);)a++;o.add(a),n.push({...t,uid:a})}}await t.replaceWorldbook(We,n)}else'function'==typeof t.createWorldbookEntries&&await t.createWorldbookEntries(We,a)}catch{}sessionStorage.setItem('current_game_event_id',e.eventPackId),sessionStorage.setItem('current_game_char_ids',JSON.stringify(e.charIds||[]));try{const t=e.sessionData?.lastFinalText,a='string'==typeof t&&t.trim()?t:Fe(e.sessionData);if(a&&'string'==typeof a){const e=Ue(a),t=2e4;sessionStorage.setItem('last_final_text',e.length>t?e.slice(e.length-t):e)}else sessionStorage.removeItem('last_final_text')}catch{}if(sessionStorage.setItem('restore_save_id',e.id),sessionStorage.removeItem('restore_save_ref'),sessionStorage.removeItem('restore_save_data'),e.sessionData?.protagonist){const t=`save_${e.id}_protagonist`;await pe.idbService.setRuntimeAsset(t,{imageUrl:e.sessionData.protagonist?.imageUrl||''}),sessionStorage.setItem('current_game_protagonist_ref',JSON.stringify({name:e.sessionData.protagonist?.name||'',runtimeId:t}))}e.sessionData?.gameSettings&&await Ce(e.sessionData.gameSettings)}(e),e.sessionData?.eventPackData)try{(0,wa.w7)(e.sessionData.eventPackData)}catch(e){console.warn('[MainGame] Failed to ensure game assets from saved eventPackData:',e)}if(e.sessionData?.eventPackData)C.value=e.sessionData.eventPackData;else if(e.eventPackId){const t=(await pe.idbService.getAllWorks()).find(t=>'EVENT'===t.type&&t.id===e.eventPackId);t&&(C.value=t.data)}if(C.value)try{(0,wa.w7)(C.value)}catch(e){console.warn('[MainGame] Failed to ensure game assets from loaded event pack:',e)}if(e.sessionData){j.splice(0,j.length,...e.sessionData.dialogueQueue);const t='number'==typeof e.sessionData.currentLineIndex?e.sessionData.currentLineIndex:0,a=Math.max(0,j.length-1);if(H.value=Math.min(Math.max(t,0),a),K.splice(0,K.length,...e.sessionData.historyLog),e.sessionData.gameSettings){const t=Array.isArray(x.enabledSidebarWidgets)?[...x.enabledSidebarWidgets]:null;Object.assign(x,e.sessionData.gameSettings);const a=x.enabledSidebarWidgets;!t||Array.isArray(a)&&0!==a.length||(x.enabledSidebarWidgets=t)}await b(),he()}n.value=!1,xe('✓ 读档成功',!0,2e3)}catch(e){console.error('[MainGame] Failed to load:',e),xe('读档失败: '+(e.message||e),!1,3e3)}},lt=()=>{o.value=!0},rt=e=>e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),it=async e=>{try{const t='string'==typeof e?.boundEventId?e.boundEventId:'';if(t)try{sessionStorage.setItem('current_game_event_id',t)}catch{}const a=C.value?.name||'';C.value=e.eventPack,await async function(e){try{const t=JSON.parse(JSON.stringify(e));return await pe.idbService.setRuntimeAsset(Y,t),S.value=Y,!0}catch(e){return console.warn('[MainGame] Failed to persist event pack override snapshot:',e),!1}}(e.eventPack).catch(()=>!1);try{await(async(e,t)=>{const a='Local',n=eN;if('function'!=typeof window.deleteWorldbookEntries||'function'!=typeof window.createWorldbookEntries)return void console.warn('[MainGame] Worldbook APIs missing; cannot sync event pack worldbook entries');const o='string'==typeof e?.name?e.name:'',l=['string'==typeof t?t:'',o].map(e=>e.trim()).filter(Boolean),r=l.length>0?l.map(rt).join('|'):'.*?',i=new RegExp(`^【${rt(a)}】【(?:${r})】【`),c=new RegExp(`【(?:${['随机事件','条件事件','世界观','特殊规则','剧情事件','额外世界书'].map(rt).join('|')})】`);await window.deleteWorldbookEntries(n,e=>{const t='string'==typeof e?.name?e.name:'';return!!t&&!!i.test(t)&&c.test(t)});try{await window.deleteWorldbookEntries(n,e=>'变量库结构定义 - 正文'===e?.name)}catch{}const s=[],d=(e,t,n,l=!1,r=null)=>{const i='string'==typeof e?e:String(e||'');i.trim()&&s.push({name:`【${a}】【${o}】【${t}】【${String(n).padStart(3,'0')}】`,content:i,position:{type:'after_character_definition',order:n},enabled:l,probability:r,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}})};try{(Array.isArray(e.randomEvents)?e.randomEvents:[]).forEach((e,t)=>{const a='number'==typeof e?.config?.probability?e.config.probability:0;d(e?.content||'','随机事件',202+t,!0,a)})}catch{}try{(Array.isArray(e.conditionalEvents)?e.conditionalEvents:[]).forEach((e,t)=>d(e?.content||'','条件事件',402+t,!0))}catch{}try{let t=502;const a=Array.isArray(e.worldviews)?e.worldviews:[],n=Array.isArray(e.powerSystems)?e.powerSystems:[];a.forEach(e=>d(e?.content||'','世界观',t++,!0)),n.forEach(e=>d(e?.content||'','世界观',t++,!0))}catch{}try{(Array.isArray(e.specialRules)?e.specialRules:[]).forEach((e,t)=>d(e?.content||'','特殊规则',602+t,!0))}catch{}Array.isArray(e.extraWorldBooks)&&e.extraWorldBooks.length>0&&e.extraWorldBooks.forEach((e,t)=>{const n='string'==typeof e?.content?e.content:'';if(!n.trim())return;const l='number'==typeof e?.uid?String(e.uid).padStart(3,'0'):String(800+t).padStart(3,'0'),r='string'==typeof e?.name&&e.name.trim()?e.name.trim():'额外世界书';s.push({name:`【${a}】【${o}】【额外世界书】【${l}】${r}`,content:n,position:e?.position||{type:'after_character_definition',order:800+t},enabled:!1!==e?.enabled,probability:'number'==typeof e?.probability?e.probability:null,strategy:e?.strategy||{type:'selective',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},recursion:e?.recursion,effect:e?.effect})}),'string'==typeof e.extraWorldBook&&e.extraWorldBook.trim()&&s.push({name:`【${a}】【${o}】【额外世界书】【LEGACY】`,content:e.extraWorldBook.trim(),position:{type:'after_character_definition',order:799},enabled:!0,probability:null,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}}),s.length>0&&await window.createWorldbookEntries(n,s);try{const{updateStoryWorldbook:t,getCurrentGameTime:a}=zt(),n=await a().catch(()=>'');await t(e,n||'')}catch(e){console.warn('[MainGame] Failed to sync plot events via StoryManager:',e)}try{let t;t=Array.isArray(e.variableTree)&&e.variableTree.length>0?ka(e.variableTree):JSON.parse(JSON.stringify(Qt));const a={name:'变量库结构定义 - 正文',content:ba(t),position:{type:'before_character_definition',order:3},enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}};await window.createWorldbookEntries(n,[a])}catch(e){console.warn('[MainGame] Failed to sync variable schema entry:',e)}})(e.eventPack,a)}catch(e){console.warn('[MainGame] Failed to sync event pack worldbook entries:',e)}try{const t=(0,wa.zP)(e.eventPack);(0,wa.RV)(t)}catch(e){console.warn('[MainGame] Failed to update game assets after applying event pack:',e)}try{await Oe()}catch{}try{Pe()}catch{}await ze(),xe('✓ 已应用到当前存档（不会覆盖“已下载作品”中的事件包）',!0,3e3)}catch(e){console.error('[MainGame] Failed to apply game asset:',e),xe('应用失败: '+(e?.message||String(e)),!1,3e3)}},ct=async()=>{const e=e=>new Promise(t=>setTimeout(t,e)),i=async(t,a)=>{try{return await Promise.race([t,e(a).then(()=>null)])}catch{return null}};try{m.value=!0,(()=>{try{$e&&(clearTimeout($e),$e=null)}catch{}try{te&&(clearTimeout(te),te=null)}catch{}try{Be&&(clearTimeout(Be),Be=null)}catch{}try{Ne&&(clearTimeout(Ne),Ne=null)}catch{}})(),Q.value=!1,ee.value=!1,o.value=!1,t.value=!1,a.value=!1,n.value=!1,l.value=!1;try{await i(q(),1200)}catch(e){console.warn('[MainGame] Failed to reset persistence to Home:',e)}await(0,r.nextTick)();try{const e=await i(u.replace('/'),1200);e&&console.warn('[MainGame] Navigation failure:',e)}catch(e){console.warn('[MainGame] Failed to navigate to home via router:',e)}setTimeout(async()=>{try{const e=await window.getWorldbook(eN);e&&e.length>0&&await window.deleteWorldbookEntries(eN,e=>{const t='string'==typeof e?.name?e.name:'';return/^【[^】]*】【[^】]*】【[^】]*】【[^】]*】/.test(t)||'变量库结构定义 - 正文'===t||'当前游戏数据'===t})}catch(e){console.warn('[MainGame] Failed to clear worldbook:',e)}try{await async function(){try{const e=window.updateWorldbookWith;if('function'!=typeof e)return void console.warn('[DeviationPrompt] updateWorldbookWith not available');await e('同梦',e=>e.map(e=>e.name===Ft||e.name===Wt||e.name===Gt?{...e,strategy:{...e.strategy,type:'selective'}}:e)),console.log('[DeviationPrompt] Reset all deviation entries to selective')}catch(e){console.error('[DeviationPrompt] Failed to reset deviation entries:',e)}}(),console.log('[MainGame] Deviation entries reset to selective')}catch(e){console.warn('[MainGame] Failed to reset deviation entries:',e)}try{sessionStorage.removeItem('new_game_start_text'),sessionStorage.removeItem('current_game_event_id'),sessionStorage.removeItem('current_game_char_ids')}catch{}try{const e=sessionStorage.getItem(Qk);if(e){const t=JSON.parse(e);t?.runtimeId&&await pe.idbService.deleteRuntimeAsset(t.runtimeId)}}catch(e){console.warn('[MainGame] Failed to cleanup protagonist runtime asset:',e)}try{sessionStorage.removeItem(Qk),sessionStorage.removeItem(Zk)}catch{}try{(0,wa.xg)()}catch{}console.log('[MainGame] Exit cleanup finished')},0),setTimeout(()=>{if('/'!==u.currentRoute.value?.path)try{window.location.reload()}catch{}},300)}catch(e){console.error('[MainGame] Failed to exit:',e);try{p||xe('退出失败: '+(e.message||e),!1,3e3)}catch{}}};return(e,i)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'main-game-view',style:(0,r.normalizeStyle)(y.value)},[(0,r.createCommentVNode)(' 0. Settings Overlay '),(0,r.createVNode)(r.Transition,{name:'fade-scale'},{default:(0,r.withCtx)(()=>[t.value?((0,r.openBlock)(),(0,r.createBlock)(sh,{key:0,settings:x,'onUpdate:settings':R,'onDebug:text':Me,onClose:i[0]||(i[0]=e=>t.value=!1)},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0)]),_:1}),(0,r.createCommentVNode)(' 1. Background Layer '),(0,r.createElementVNode)('div',Rk,[(0,r.createElementVNode)('div',Lk,[T.value?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:T.value,alt:'Background',class:'bg-image'},null,8,$k)):(0,r.createCommentVNode)('v-if',!0),i[17]||(i[17]=(0,r.createElementVNode)('div',{class:'bg-gradient'},null,-1))])]),(0,r.createCommentVNode)(' 2. Character Layer '),(0,r.createElementVNode)('div',Uk,[(0,r.createCommentVNode)(' Dynamic Character from Settings/DB '),(0,r.createVNode)(r.Transition,{name:'fade',appear:''},{default:(0,r.withCtx)(()=>[P.value?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:P.value,class:'char-img dynamic-char',style:(0,r.normalizeStyle)(D.value)},null,12,zk)):(0,r.createCommentVNode)('v-if',!0)]),_:1})]),(0,r.createCommentVNode)(' 3. HUD Layer (Top Left) '),(0,r.createVNode)(vp,{'override-time':ne.value,'override-location':oe.value,'typing-speed-ms':x.textSpeed},null,8,['override-time','override-location','typing-speed-ms']),(0,r.createCommentVNode)(' 3.5 Performance Overlay (GAL-style) '),me.value?((0,r.openBlock)(),(0,r.createBlock)(Sp,{key:0,text:ie.value.text,effect:ie.value.performance?.effect||'plain','text-speed-ms':x.textSpeed,'skip-mode':ee.value,onDone:je},null,8,['text','effect','text-speed-ms','skip-mode'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 4. Dialogue Box Layer (Bottom) '),(0,r.createElementVNode)('div',{class:'dialogue-wrapper',onClick:qe},[se.value?((0,r.openBlock)(),(0,r.createBlock)(Rm,{key:0,name:se.value.name,text:se.value.text,'protagonist-name':N.value,effect:'plain','auto-mode':Q.value,'skip-mode':ee.value,settings:x,onNext:je,onBack:Je,onLog:i[1]||(i[1]=e=>a.value=!0),onAuto:Qe,onSkip:Ze,onOpenSettings:i[2]||(i[2]=e=>t.value=!0)},null,8,['name','text','protagonist-name','auto-mode','skip-mode','settings'])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createCommentVNode)(' 5. Left Sidebar (System Menu) '),(0,r.createVNode)(bp,{'error-count':s.length,onSaveload:i[3]||(i[3]=e=>n.value=!0),onAsset:i[4]||(i[4]=e=>c.value=!0),onVariables:i[5]||(i[5]=e=>ae.value=!0),onSettings:i[6]||(i[6]=e=>t.value=!0),onErrorlog:i[7]||(i[7]=e=>l.value=!0),onExit:lt},null,8,['error-count']),(0,r.createCommentVNode)(' 6. Right Sidebar (Widgets) '),(0,r.createVNode)(jp,{settings:x},null,8,['settings']),(0,r.createCommentVNode)(' 7. Quick Input (Floating Orb) '),(0,r.createVNode)($p),(0,r.createCommentVNode)(' 8. Temporary Message Toast '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'#ethereal-toast-root'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[Ee.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:(0,r.normalizeClass)(['temp-message',{success:be.value}])},(0,r.toDisplayString)(Ve.value),3)):(0,r.createCommentVNode)('v-if',!0)]),_:1})])),(0,r.createCommentVNode)(' 9. Log Overlay '),(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[a.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'log-overlay',onClick:i[9]||(i[9]=(0,r.withModifiers)(e=>a.value=!1,['self']))},[(0,r.createElementVNode)('div',Fk,[(0,r.createElementVNode)('div',Wk,[i[18]||(i[18]=(0,r.createElementVNode)('span',null,'History Log',-1)),(0,r.createElementVNode)('button',{class:'close-btn',onClick:i[8]||(i[8]=e=>a.value=!1)},'✕')]),(0,r.createElementVNode)('div',Gk,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(K,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:(0,r.normalizeClass)(['log-item',{clickable:Xe(e)}]),onClick:t=>Xe(e)&&(e=>{'number'==typeof e.queueIndex&&(H.value=e.queueIndex,a.value=!1,Q.value=!1,ee.value=!1,te&&clearTimeout(te),he())})(e)},[(0,r.createElementVNode)('div',Jk,[(0,r.createElementVNode)('div',Yk,(0,r.toDisplayString)(e.name||''),1)]),(0,r.createElementVNode)('div',Hk,(0,r.toDisplayString)(e.text),1)],10,jk))),128))])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1}),(0,r.createCommentVNode)(' 10. Save/Load Modal '),(0,r.createVNode)(Jv,{visible:n.value,'onUpdate:visible':i[10]||(i[10]=e=>n.value=e),mode:'both',onSave:nt,onLoad:ot},null,8,['visible']),(0,r.createCommentVNode)(' 11. Exit Confirmation Dialog '),(0,r.createVNode)(r.Transition,{name:'fade-scale'},{default:(0,r.withCtx)(()=>[o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'exit-confirm-overlay',onClick:i[12]||(i[12]=(0,r.withModifiers)(e=>o.value=!1,['self']))},[(0,r.createElementVNode)('div',Xk,[(0,r.createElementVNode)('div',Kk,[(0,r.createVNode)(E,{name:'alert',size:32})]),i[19]||(i[19]=(0,r.createElementVNode)('h3',null,'返回主页',-1)),i[20]||(i[20]=(0,r.createElementVNode)('p',null,[(0,r.createTextVNode)('确定要返回主页吗？'),(0,r.createElementVNode)('br'),(0,r.createTextVNode)('请确保已保存游戏进度，'),(0,r.createElementVNode)('br'),(0,r.createTextVNode)('返回后当前世界书数据将被清空。')],-1)),(0,r.createElementVNode)('div',qk,[(0,r.createElementVNode)('button',{class:'btn-cancel',onClick:i[11]||(i[11]=e=>o.value=!1)},'取消'),(0,r.createElementVNode)('button',{class:'btn-confirm',onClick:ct},'确认返回')])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1}),(0,r.createCommentVNode)(' 12. Error Log Modal '),(0,r.createVNode)(cp,{visible:l.value,'onUpdate:visible':i[13]||(i[13]=e=>l.value=e),errors:s,onClear:_e,onNotify:i[14]||(i[14]=e=>xe(e.text,e.success??!0,e.duration??2e3)),onReprocess:Te},null,8,['visible','errors']),(0,r.createCommentVNode)(' 13. GameAsset / Event Pack Editor '),(0,r.createVNode)(Mh,{visible:c.value,'onUpdate:visible':i[15]||(i[15]=e=>c.value=e),'current-event-pack':C.value,onApply:it},null,8,['visible','current-event-pack']),(0,r.createCommentVNode)(' 14. Variable Editor '),(0,r.createVNode)(hk,{visible:ae.value,'onUpdate:visible':i[16]||(i[16]=e=>ae.value=e),'worldbook-name':eN,onApplied:Re},null,8,['visible'])],4))}}),aN=(0,p.A)(tN,[['__scopeId','data-v-e3e15e94']]);function nN(e){try{return'string'==typeof e?e:e instanceof Error?e.message:String(e)}catch{return'[unprintable]'}}function oN(e){try{const t=window;Array.isArray(t.__MYCARD_RUNTIME_ERRORS__)||(t.__MYCARD_RUNTIME_ERRORS__=[]),t.__MYCARD_RUNTIME_ERRORS__.push(e),t.__MYCARD_RUNTIME_ERRORS__.length>50&&t.__MYCARD_RUNTIME_ERRORS__.splice(0,t.__MYCARD_RUNTIME_ERRORS__.length-50)}catch{}try{const t=window.top;t&&t!==window&&(Array.isArray(t.__MYCARD_RUNTIME_ERRORS__)||(t.__MYCARD_RUNTIME_ERRORS__=[]),t.__MYCARD_RUNTIME_ERRORS__.push(e),t.__MYCARD_RUNTIME_ERRORS__.length>50&&t.__MYCARD_RUNTIME_ERRORS__.splice(0,t.__MYCARD_RUNTIME_ERRORS__.length-50))}catch{}}const lN=(0,i.createRouter)({history:(0,i.createMemoryHistory)(),routes:[{path:'/',name:'home',component:ce},{path:'/new-game',name:'newGame',component:so},{path:'/load-game',name:'loadGame',component:Tt},{path:'/workshop',name:'workshop',component:_m},{path:'/MainGame',name:'mainGame',component:aN}]});$(()=>{(async()=>{try{window.__MYCARD_PHASE__='bootstrap:diagnostics';try{const e=window.top;e&&e!==window&&(e.__MYCARD_PHASE__=window.__MYCARD_PHASE__)}catch{}window.addEventListener('error',e=>{const t=nN(e?.message??e?.error??'unknown error'),a=e?.error?.stack?String(e.error.stack):void 0;oN({ts:Date.now(),kind:'window-error',message:t,stack:a,route:lN.currentRoute.value.fullPath})}),window.addEventListener('unhandledrejection',e=>{const t=e?.reason,a=nN(t),n=t instanceof Error?t.stack:void 0;oN({ts:Date.now(),kind:'unhandledrejection',message:a,stack:n,route:lN.currentRoute.value.fullPath})})}catch{}const e=(0,r.createApp)(k);e.config.errorHandler=(e,t,a)=>{const n=t?.type?.name||t?.type?.__name||t?.type?.__file||'unknown-component',o=nN(e),l=e instanceof Error?e.stack:void 0;oN({ts:Date.now(),kind:'vue',message:o,stack:l,info:nN(a),component:nN(n),route:lN.currentRoute.value.fullPath}),console.error('[MyCard][VueError]',{message:o,info:a,component:n,route:lN.currentRoute.value.fullPath,err:e})},e.use(lN).mount('#app');try{window.__MYCARD_PHASE__='bootstrap:afterMount';try{const e=window.top;e&&e!==window&&(e.__MYCARD_PHASE__=window.__MYCARD_PHASE__)}catch{}}catch{}try{const e=await Q();if(e){try{window.__MYCARD_PHASE__='bootstrap:restore:routerReplace';try{const e=window.top;e&&e!==window&&(e.__MYCARD_PHASE__=window.__MYCARD_PHASE__)}catch{}}catch{}await lN.replace(e)}}catch(e){console.warn('[MyCard] Startup restore failed:',e)}})()});</script><style>@import url(https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=Outfit:wght@300;400;600&display=swap);
.th-mobile-input-bar[data-v-2113ddac]{position:fixed;left:50%;width:min(80vw,720px);transform:translateX(-50%);top:calc(env(safe-area-inset-top,0px) + 10px);z-index:13000;background:rgba(10,10,12,.92);border:1px solid hsla(0,0%,100%,.14);border-radius:14px;padding:10px;box-shadow:0 10px 30px rgba(0,0,0,.35);backdrop-filter:blur(10px)}.th-mobile-input-bar__row[data-v-2113ddac]{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px}.th-mobile-input-bar__title[data-v-2113ddac]{font-size:12px;opacity:.85}.th-mobile-input-bar__close[data-v-2113ddac]{border:none;background:hsla(0,0%,100%,.08);color:hsla(0,0%,100%,.9);width:36px;height:36px;border-radius:12px;font-size:22px;line-height:1;cursor:pointer}.th-mobile-input-bar__field[data-v-2113ddac]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid hsla(0,0%,100%,.16);outline:none;background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.95);font-size:14px;resize:none}.th-mobile-input-bar__field[data-v-2113ddac]:focus{border-color:rgba(139,92,246,.65);box-shadow:0 0 0 3px rgba(139,92,246,.18)}@media (hover:none)and (pointer:coarse){.th-mobile-input-bar[data-v-2113ddac]{width:min(80vw,720px);padding:10px}}
/*! tailwindcss v4.1.12 | MIT License | https://tailwindcss.com */*{margin:0;padding:0;box-sizing:border-box}:root{--glass-100:rgba(255,255,255,0.05);--glass-200:rgba(255,255,255,0.1);--glass-300:rgba(255,255,255,0.15);--glass-border:rgba(255,255,255,0.1);--glass-highlight:rgba(255,255,255,0.08);--primary:#8b5cf6;--primary-glow:#a78bfa;--secondary:#06b6d4}body{font-family:"Outfit","Noto Sans SC",sans-serif;background-color:#050505;overflow:hidden;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:hsla(0,0%,100%,.05)}::-webkit-scrollbar-thumb{background:hsla(0,0%,100%,.2);border-radius:10px}::-webkit-scrollbar-thumb:hover{background:hsla(0,0%,100%,.4)}.ethereal-app-wrapper{width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;overflow:hidden}.ethereal-app-wrapper.is-fullscreen{position:fixed;inset:0;z-index:9998}.ethereal-app{position:relative;width:100%;height:100%;overflow:hidden;background:#000;color:#cbd5e1;font-family:"Outfit","Noto Sans SC",sans-serif;aspect-ratio:16/9}.background-layer{position:absolute;inset:0;z-index:0}.bg-orb{position:absolute;border-radius:50%;mix-blend-mode:screen}.bg-orb-violet{top:-20%;left:-10%;width:70vw;height:70vw;background:rgba(139,92,246,.2);filter:blur(120px);animation:pulse-slow 4s cubic-bezier(0.4,0,0.6,1) infinite}.bg-orb-blue{bottom:-20%;right:-10%;width:60vw;height:60vw;background:rgba(30,58,138,.1);filter:blur(100px)}.bg-orb-fuchsia{top:30%;left:40%;width:40vw;height:40vw;background:rgba(112,26,117,.1);filter:blur(80px)}html[data-th-mobile="1"]{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;text-size-adjust:100%}html[data-th-mobile="1"] *{backdrop-filter:none !important}html[data-th-mobile="1"] .bg-orb{filter:none !important;animation:none !important;opacity:.35}html[data-th-mobile="1"] .bg-orb-violet,html[data-th-mobile="1"] .bg-orb-blue,html[data-th-mobile="1"] .bg-orb-fuchsia{transform:none !important}html[data-th-mobile="1"] .bg-noise{opacity:.015}html[data-th-mobile="1"] .fullscreen-btn{backdrop-filter:none !important}html[data-th-mobile="1"] .fade-scale-enter-from,html[data-th-mobile="1"] .fade-scale-leave-to{filter:none !important}.main-content{position:relative;z-index:10;width:100%;height:100%}.ethereal-overlay-root{position:absolute;inset:0;z-index:11000;pointer-events:auto}.ethereal-overlay-root:empty{pointer-events:none}.ethereal-toast-root{position:absolute;inset:0;z-index:12000;pointer-events:none}.version-info{position:absolute;bottom:1em;right:1.5em;z-index:50;font-size:10px;color:hsla(0,0%,100%,.2);font-family:monospace;pointer-events:none}.bg-noise{position:absolute;inset:0;pointer-events:none;z-index:50;opacity:.03;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")}.fullscreen-btn{position:absolute;z-index:9999;width:40px;height:40px;border-radius:50%;background:rgba(0,0,0,.55);border:1px solid hsla(0,0%,100%,.15);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;color:hsla(0,0%,100%,.7);cursor:grab;transition:background .2s,border-color .2s,transform .15s;-webkit-user-select:none;user-select:none;touch-action:none}.fullscreen-btn:hover{background:rgba(139,92,246,.45);border-color:rgba(139,92,246,.6);color:#fff}.fullscreen-btn:active{cursor:grabbing;transform:scale(0.95)}.fullscreen-btn svg{pointer-events:none}.fade-scale-enter-active,.fade-scale-leave-active{transition:all .5s cubic-bezier(0.22,1,0.36,1)}.fade-scale-enter-from{opacity:0;transform:scale(0.95);filter:blur(10px)}.fade-scale-leave-to{opacity:0;transform:scale(1.05);filter:blur(10px)}@keyframes pulse-slow{0%,100%{opacity:1}50%{opacity:.5}}@keyframes blob{0%{transform:translate(0px,0px) scale(1)}33%{transform:translate(30px,-50px) scale(1.1)}66%{transform:translate(-20px,20px) scale(0.9)}100%{transform:translate(0px,0px) scale(1)}}@keyframes float{0%,100%{transform:translateY(0) translateX(0) scale(1)}25%{transform:translateY(-20px) translateX(10px) scale(1.02)}50%{transform:translateY(0) translateX(-10px) scale(1)}75%{transform:translateY(-10px) translateX(5px) scale(1.01)}}
.misty-sphere[data-v-7e21fa7d]{position:relative;cursor:pointer;animation:float-7e21fa7d 6s ease-in-out infinite}.misty-sphere:hover .sphere-glow[data-v-7e21fa7d]{opacity:.6}.misty-sphere:hover .sphere-content[data-v-7e21fa7d]{border-color:hsla(0,0%,100%,.3);box-shadow:0 0 80px rgba(139,92,246,.3)}.misty-sphere:hover .sphere-label[data-v-7e21fa7d]{transform:scale(1.1)}.sphere-glow[data-v-7e21fa7d]{position:absolute;inset:0;border-radius:50%;filter:blur(50px);opacity:.4;transition:opacity .7s}.sphere-glow.bg-violet[data-v-7e21fa7d]{background:#8b5cf6}.sphere-glow.bg-cyan[data-v-7e21fa7d]{background:#06b6d4}.sphere-glow.bg-fuchsia[data-v-7e21fa7d]{background:#d946ef}.sphere-mist[data-v-7e21fa7d]{position:absolute;inset:1em;border-radius:50%;filter:blur(30px);opacity:.3;mix-blend-mode:screen;background:#fff;animation:pulse-slow-7e21fa7d 4s cubic-bezier(0.4,0,0.6,1) infinite}.sphere-content[data-v-7e21fa7d]{position:relative;display:flex;align-items:center;justify-content:center;border-radius:50%;border:1px solid hsla(0,0%,100%,.1);background:hsla(0,0%,100%,.05);backdrop-filter:blur(4px);box-shadow:0 0 50px rgba(0,0,0,.2);overflow:hidden;transition:all .5s}.sphere-content.size-sm[data-v-7e21fa7d]{width:9em;height:9em;font-size:1.25em}.sphere-content.size-md[data-v-7e21fa7d]{width:13em;height:13em;font-size:1.5em}.sphere-content.size-lg[data-v-7e21fa7d]{width:16em;height:16em;font-size:2em;font-weight:bold}.sphere-swirl[data-v-7e21fa7d]{position:absolute;inset:-50%;background:linear-gradient(135deg,transparent,rgba(255,255,255,0.1),transparent);transform:rotate(45deg);animation:blob-7e21fa7d 7s infinite;opacity:.3}.sphere-label[data-v-7e21fa7d]{position:relative;z-index:10;color:#fff;letter-spacing:.2em;transition:transform .5s;text-shadow:0 0 10px hsla(0,0%,100%,.5)}@keyframes float-7e21fa7d{0%,100%{transform:translateY(0) translateX(0) scale(1)}25%{transform:translateY(-20px) translateX(10px) scale(1.02)}50%{transform:translateY(0) translateX(-10px) scale(1)}75%{transform:translateY(-10px) translateX(5px) scale(1.01)}}@keyframes pulse-slow-7e21fa7d{0%,100%{opacity:.3}50%{opacity:.15}}@keyframes blob-7e21fa7d{0%{transform:translate(0px,0px) scale(1) rotate(45deg)}33%{transform:translate(30px,-50px) scale(1.1) rotate(45deg)}66%{transform:translate(-20px,20px) scale(0.9) rotate(45deg)}100%{transform:translate(0px,0px) scale(1) rotate(45deg)}}
.glass-panel[data-v-f8670f2c]{position:relative;background:var(--glass-100);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid var(--glass-border);box-shadow:0 8px 32px 0 rgba(0,0,0,.37);border-radius:1.5em;overflow:hidden;color:#f1f5f9}@media (hover:none)and (pointer:coarse){.glass-panel[data-v-f8670f2c]{backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);background:rgba(20,20,25,.7)}}.glass-panel.full-height[data-v-f8670f2c]{height:100%}.shiny-edge-top[data-v-f8670f2c]{position:absolute;inset:0;height:1px;background:linear-gradient(to right,transparent,rgba(255,255,255,0.2),transparent);opacity:.5}.shiny-edge-left[data-v-f8670f2c]{position:absolute;top:0;left:0;width:1px;height:100%;background:linear-gradient(to bottom,transparent,rgba(255,255,255,0.1),transparent);opacity:.3}
.temp-message-overlay[data-v-747be383]{position:absolute;inset:0;width:100%;height:100%;background:rgba(0,0,0,.4);backdrop-filter:blur(2px);z-index:12000;display:flex;align-items:center;justify-content:center;pointer-events:auto}.message-box[data-v-747be383]{min-width:300px;max-width:80vw;padding:2rem;display:flex;flex-direction:column;align-items:center;gap:1.5rem;text-align:center;border:1px solid hsla(0,0%,100%,.1)}.message-body[data-v-747be383]{display:flex;flex-direction:column;align-items:center;gap:1rem}.message-text[data-v-747be383]{font-size:1.1rem;color:#fff;white-space:pre-wrap;line-height:1.5}.message-actions[data-v-747be383]{display:flex;justify-content:center;width:100%}.btn-primary[data-v-747be383]{padding:.5rem 2rem;background:hsla(0,0%,100%,.1);border:1px solid hsla(0,0%,100%,.2);color:#fff;cursor:pointer;transition:all .2s;border-radius:4px;font-size:1rem}.btn-primary[data-v-747be383]:hover{background:hsla(0,0%,100%,.2);transform:translateY(-1px)}.btn-primary[data-v-747be383]:active{transform:translateY(0)}.loading-spinner[data-v-747be383]{width:40px;height:40px;border:4px solid hsla(0,0%,100%,.1);border-radius:50%;border-top-color:#fff;animation:spin-747be383 1s ease-in-out infinite}@keyframes spin-747be383{to{transform:rotate(360deg)}}.icon-wrapper[data-v-747be383]{color:#fff}.icon-wrapper.error[data-v-747be383]{color:#ff6b6b}.icon-wrapper.success[data-v-747be383]{color:#51cf66}.icon-wrapper.warning[data-v-747be383]{color:#fcc419}.msg-fade-enter-active[data-v-747be383],.msg-fade-leave-active[data-v-747be383]{transition:opacity .3s ease}.msg-fade-enter-from[data-v-747be383],.msg-fade-leave-to[data-v-747be383]{opacity:0}
.home-view[data-v-e3e25d1c]{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;overflow:hidden;font-size:.85vw}.user-info[data-v-e3e25d1c]{position:absolute;top:2.5em;right:2.5em;display:flex;align-items:center;gap:.75em;color:hsla(0,0%,100%,.5);background:rgba(0,0,0,.2);backdrop-filter:blur(12px);padding:.5em 1em;border-radius:9999px;border:.0625em solid hsla(0,0%,100%,.05)}.user-info span[data-v-e3e25d1c]{font-size:1.5em;font-weight:300;letter-spacing:.2em}.user-avatar[data-v-e3e25d1c]{width:3em;height:3em;border-radius:50%;object-fit:cover}.title-section[data-v-e3e25d1c]{position:absolute;top:2em;left:2em;z-index:10}.main-title[data-v-e3e25d1c]{font-size:3em;font-weight:900;background:linear-gradient(to bottom right,white,rgb(221,214,254),rgba(255,255,255,0.2));-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0);background-clip:text;letter-spacing:-0.05em;filter:drop-shadow(0 0.25em 0.375em rgba(0,0,0,0.3))}.sub-title[data-v-e3e25d1c]{font-size:.5em;font-weight:300;letter-spacing:.2em;color:#c4b5fd;-webkit-text-fill-color:#c4b5fd}.description[data-v-e3e25d1c]{margin-top:1em;color:hsla(0,0%,100%,.4);max-width:20em;font-size:1em;line-height:1.625;border-left:.125em solid rgba(139,92,246,.5);padding-left:1em}.tutorial-links-fixed[data-v-e3e25d1c]{position:absolute;left:2em;bottom:2em;z-index:40;display:flex;gap:.75em;flex-wrap:wrap}.tutorial-btn[data-v-e3e25d1c]{display:inline-flex;align-items:center;gap:.5em;padding:.55em .95em;border-radius:9999px;border:.0625em solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.18);backdrop-filter:blur(12px);color:hsla(0,0%,100%,.75);text-decoration:none;font-size:1em;transition:transform .15s,border-color .15s,background .15s,color .15s}.tutorial-btn[data-v-e3e25d1c]:hover{transform:translateY(-0.06em);border-color:rgba(167,139,250,.55);background:rgba(0,0,0,.25);color:hsla(0,0%,100%,.9)}.sphere-position[data-v-e3e25d1c]{position:absolute}.sphere-start[data-v-e3e25d1c]{top:50%;left:22%;transform:translateY(-50%);z-index:20}.sphere-workshop[data-v-e3e25d1c]{top:40%;right:12%;z-index:10}.sphere-load[data-v-e3e25d1c]{bottom:15%;left:38%;z-index:30}
.confirm-overlay[data-v-f79ac350]{position:absolute;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);z-index:2000;display:flex;align-items:center;justify-content:center}.confirm-box[data-v-f79ac350]{width:90%;max-width:400px;padding:1.5em;display:flex;flex-direction:column;gap:1.25em;border:1px solid rgba(248,113,113,.3);box-shadow:0 10px 40px rgba(0,0,0,.5)}.confirm-header[data-v-f79ac350]{display:flex;align-items:center;gap:.75em}.confirm-header .warn-icon[data-v-f79ac350]{color:#fbbf24}.confirm-header h3[data-v-f79ac350]{font-size:1.25em;font-weight:bold;color:#fff;margin:0}.confirm-message[data-v-f79ac350]{color:hsla(0,0%,100%,.9);line-height:1.5;font-size:1em}.confirm-actions[data-v-f79ac350]{display:flex;justify-content:flex-end;gap:1em;margin-top:.5em}.confirm-actions button[data-v-f79ac350]{padding:.5em 1.5em;border-radius:9999px;font-size:.9em;font-weight:bold;cursor:pointer;transition:all .2s}.btn-cancel[data-v-f79ac350]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);color:hsla(0,0%,100%,.7)}.btn-cancel[data-v-f79ac350]:hover{background:hsla(0,0%,100%,.1);color:#fff}.btn-confirm[data-v-f79ac350]{background:#ef4444;border:none;color:#fff;box-shadow:0 0 15px rgba(239,68,68,.3)}.btn-confirm[data-v-f79ac350]:hover{background:#dc2626;box-shadow:0 0 20px rgba(239,68,68,.5)}.fade-enter-active[data-v-f79ac350],.fade-leave-active[data-v-f79ac350]{transition:opacity .2s}.fade-enter-from[data-v-f79ac350],.fade-leave-to[data-v-f79ac350]{opacity:0}
.load-game-view[data-v-ddadd5c2]{position:relative;width:100%;height:100%;padding:3em;display:flex;flex-direction:column;z-index:20;font-size:.85vw;box-sizing:border-box}.header[data-v-ddadd5c2]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2em}.header-left[data-v-ddadd5c2]{display:flex;align-items:center;gap:1.5em}.back-btn[data-v-ddadd5c2]{display:flex;align-items:center;gap:.5em;color:hsla(0,0%,100%,.6);background:none;border:none;cursor:pointer;transition:color .3s}.back-btn[data-v-ddadd5c2]:hover{color:#fff}.back-btn:hover .back-icon-wrapper[data-v-ddadd5c2]{background:hsla(0,0%,100%,.1)}.back-icon-wrapper[data-v-ddadd5c2]{padding:.5em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.05);transition:background .3s}.page-title[data-v-ddadd5c2]{font-size:2.25em;font-weight:300;letter-spacing:.2em;color:#fff}.import-btn[data-v-ddadd5c2]{display:flex;align-items:center;gap:.5em;padding:.5em 1.5em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);color:#f0abfc;font-size:.875em;cursor:pointer;transition:background .3s}.import-btn[data-v-ddadd5c2]:hover{background:hsla(0,0%,100%,.1)}.saves-panel[data-v-ddadd5c2]{flex:1;padding:2em}.saves-container[data-v-ddadd5c2]{display:flex;flex-direction:column;gap:1.5em;overflow-y:auto;height:100%;padding-right:1em}.section-title[data-v-ddadd5c2]{font-size:.9em;letter-spacing:.1em;color:hsla(0,0%,100%,.6);margin-top:.25em}.save-item[data-v-ddadd5c2]{position:relative;display:flex;gap:1.5em;align-items:center;padding:1em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;transition:all .3s}.save-item[data-v-ddadd5c2]:hover{background:rgba(0,0,0,.4);border-color:rgba(217,70,239,.5);transform:translateX(0.5em)}.save-item:hover .save-chapter[data-v-ddadd5c2]{color:#f0abfc}.save-item:hover .save-actions[data-v-ddadd5c2]{opacity:1}.save-thumbnail[data-v-ddadd5c2]{position:relative;width:12em;height:7em;border-radius:.5em;overflow:hidden;flex-shrink:0;border:1px solid hsla(0,0%,100%,.1)}.save-thumbnail img[data-v-ddadd5c2]{width:100%;height:100%;object-fit:cover;opacity:.7;transition:opacity .3s}.save-item:hover .save-thumbnail img[data-v-ddadd5c2]{opacity:1}.slot-badge[data-v-ddadd5c2]{position:absolute;top:.6em;left:.6em;font-size:.7em;padding:.25em .6em;border-radius:9999px;letter-spacing:.08em;background:rgba(0,0,0,.55);border:1px solid hsla(0,0%,100%,.15);color:hsla(0,0%,100%,.85)}.badge-auto[data-v-ddadd5c2]{border-color:rgba(59,130,246,.5);color:#93c5fd}.badge-cloud[data-v-ddadd5c2]{border-color:rgba(217,70,239,.5);color:#f0abfc}.badge-manual[data-v-ddadd5c2]{border-color:rgba(34,197,94,.45);color:#86efac}.thumbnail-overlay[data-v-ddadd5c2]{position:absolute;inset:0;background:linear-gradient(to right,rgba(0,0,0,0.5),transparent)}.save-info[data-v-ddadd5c2]{flex:1}.save-header[data-v-ddadd5c2]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.5em}.save-chapter[data-v-ddadd5c2]{font-size:1.25em;font-weight:bold;color:#fff;transition:color .3s}.save-date[data-v-ddadd5c2]{font-size:.75em;font-family:monospace;color:#6b7280;background:rgba(0,0,0,.3);padding:.25em .5em;border-radius:.25em}.save-summary[data-v-ddadd5c2]{font-size:.875em;color:#9ca3af}.save-firstline[data-v-ddadd5c2]{margin-top:.35em;font-size:.8em;color:hsla(0,0%,100%,.55);line-height:1.35;overflow:hidden;display:-webkit-box;line-clamp:2;-webkit-line-clamp:2;-webkit-box-orient:vertical}.save-actions[data-v-ddadd5c2]{display:flex;flex-direction:column;gap:.5em;opacity:.5;transition:opacity .3s}.action-btn[data-v-ddadd5c2]{padding:.5em;border-radius:9999px;background:none;border:none;color:#9ca3af;cursor:pointer;transition:all .3s}.action-btn.load-btn[data-v-ddadd5c2]:hover{background:#d946ef;color:#fff}.action-btn.export-btn[data-v-ddadd5c2]:hover{background:#3b82f6;color:#fff}.action-btn.delete-btn[data-v-ddadd5c2]:hover{background:#ef4444;color:#fff}.no-saves[data-v-ddadd5c2]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:4em;color:hsla(0,0%,100%,.3)}.no-saves p[data-v-ddadd5c2]{margin:0;font-size:1.25em}.no-saves span[data-v-ddadd5c2]{font-size:.875em;color:hsla(0,0%,100%,.2)}.no-saves.compact[data-v-ddadd5c2]{padding:1.5em 0}.loading-state[data-v-ddadd5c2]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:4em;color:hsla(0,0%,100%,.5)}.loading-state p[data-v-ddadd5c2]{margin:0}.loading-spinner[data-v-ddadd5c2]{width:3em;height:3em;border:.25em solid hsla(0,0%,100%,.1);border-radius:50%;border-top-color:#a78bfa;animation:spin-ddadd5c2 1s ease-in-out infinite}@keyframes spin-ddadd5c2{to{transform:rotate(360deg)}}.placeholder-thumb[data-v-ddadd5c2]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);color:hsla(0,0%,100%,.2)}
.step-container[data-v-429894f2]{height:100%;display:flex;flex-direction:column}.selection-grid[data-v-429894f2]{display:grid;grid-template-columns:1fr 1fr;gap:2em;height:100%;overflow:hidden}.selection-column[data-v-429894f2]{display:flex;flex-direction:column;height:100%;background:hsla(0,0%,100%,.02);border-radius:.75em;border:1px solid hsla(0,0%,100%,.05);overflow:hidden}.column-header[data-v-429894f2]{padding:1em 1.5em;background:rgba(0,0,0,.2);display:flex;align-items:center;gap:.75em;border-bottom:1px solid hsla(0,0%,100%,.05)}.column-header h2[data-v-429894f2]{margin:0;font-size:1.125em;font-weight:600;letter-spacing:1px;text-transform:uppercase}.column-header.event-header[data-v-429894f2]{color:#c4b5fd}.column-header.char-header[data-v-429894f2]{color:#67e8f9}.scrollable-list[data-v-429894f2],.scrollable-grid[data-v-429894f2]{flex:1;overflow-y:auto;padding:1.5em}.scrollable-list[data-v-429894f2]{display:flex;flex-direction:column;gap:1em}.scrollable-grid[data-v-429894f2]{display:grid;grid-template-columns:repeat(auto-fill,minmax(12.5em,1fr));gap:1em;align-content:start}.event-card[data-v-429894f2]{display:flex;gap:1em;padding:1em;background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;cursor:pointer;transition:all .2s;position:relative}.event-card[data-v-429894f2]:hover{background:hsla(0,0%,100%,.05);border-color:rgba(196,181,253,.3)}.event-card.selected[data-v-429894f2]{background:rgba(196,181,253,.1);border-color:#a78bfa;box-shadow:0 0 .9em rgba(167,139,250,.1)}.event-card .checked-icon[data-v-429894f2]{position:absolute;top:.625em;right:.625em;color:#a78bfa}.event-card .card-cover[data-v-429894f2]{width:10em;height:5.625em;border-radius:.375em;background-size:cover;background-position:center;background-color:#111;flex-shrink:0;display:flex;align-items:center;justify-content:center}.event-card .card-cover .placeholder[data-v-429894f2]{font-size:.7em;color:#555}.event-card .card-info[data-v-429894f2]{display:flex;flex-direction:column;gap:.375em}.event-card .card-info h3[data-v-429894f2]{margin:0;font-size:1.125em;color:#fff}.event-card .card-info p[data-v-429894f2]{margin:0;font-size:.875em;color:#94a3b8;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.event-card .card-info .pack-meta[data-v-429894f2]{margin-top:auto}.event-card .card-info .pack-meta .link-badge[data-v-429894f2]{font-size:.75em;background:rgba(139,92,246,.2);color:#c4b5fd;padding:.125em .375em;border-radius:.25em}.char-card[data-v-429894f2]{display:flex;flex-direction:column;background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;overflow:hidden;cursor:pointer;transition:all .2s}.char-card[data-v-429894f2]:hover{transform:translateY(-2px);border-color:rgba(103,232,249,.4)}.char-card.selected[data-v-429894f2]{border-color:#67e8f9;box-shadow:0 0 15px rgba(103,232,249,.2)}.char-card.selected .char-cover[data-v-429894f2]{border-bottom-color:#67e8f9}.char-card .char-cover[data-v-429894f2]{height:7em;background-size:cover;background-position:center;background-color:#111;position:relative;border-bottom:1px solid hsla(0,0%,100%,.05);aspect-ratio:16/9}.char-card .char-cover .overlay[data-v-429894f2]{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.8),transparent);opacity:.6}.char-card .char-cover .check-mark[data-v-429894f2]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#67e8f9;filter:drop-shadow(0 0 5px rgba(0,0,0,0.8))}.char-card .char-info[data-v-429894f2]{padding:.75em}.char-card .char-info h3[data-v-429894f2]{margin:0;font-size:.9375em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#e2e8f0}.char-card .char-info .preset-count[data-v-429894f2]{font-size:.75em;color:#64748b}.empty-list[data-v-429894f2]{color:#64748b;text-align:center;padding:2em;font-size:.875em;font-style:italic}
.step-container[data-v-0b0de7a9]{height:100%}.split-layout[data-v-0b0de7a9]{display:grid;grid-template-columns:1fr 1.5fr;gap:2em;height:100%}.info-column[data-v-0b0de7a9],.selection-column[data-v-0b0de7a9]{background:hsla(0,0%,100%,.02);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;display:flex;flex-direction:column;overflow:hidden}.header[data-v-0b0de7a9]{padding:1em 1.5em;background:rgba(0,0,0,.2);display:flex;align-items:center;gap:.75em;border-bottom:1px solid hsla(0,0%,100%,.05)}.header h2[data-v-0b0de7a9]{margin:0;font-size:1.125em;font-weight:600;color:#fcd34d;text-transform:uppercase}.scenario-details[data-v-0b0de7a9]{padding:2em;display:flex;flex-direction:column;gap:1.5em}.scenario-details .detail-row[data-v-0b0de7a9]{display:flex;flex-direction:column;gap:.5em}.scenario-details .detail-row label[data-v-0b0de7a9]{color:#94a3b8;font-size:.875em;text-transform:uppercase;letter-spacing:1px}.scenario-details .detail-row span[data-v-0b0de7a9],.scenario-details .detail-row p[data-v-0b0de7a9]{color:#fff;font-size:1.125em;line-height:1.6}.anchor-list[data-v-0b0de7a9]{flex:1;overflow-y:auto;padding:1.5em;display:flex;flex-direction:column;gap:1em}.anchor-card[data-v-0b0de7a9]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1.25em;cursor:pointer;transition:all .2s}.anchor-card[data-v-0b0de7a9]:hover{border-color:rgba(252,211,77,.4);background:hsla(0,0%,100%,.05)}.anchor-card.selected[data-v-0b0de7a9]{border-color:#fcd34d;background:rgba(252,211,77,.1);box-shadow:0 0 .9em rgba(252,211,77,.1)}.anchor-card .anchor-header[data-v-0b0de7a9]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5em}.anchor-card .anchor-header h3[data-v-0b0de7a9]{margin:0;font-size:1.125em;color:#fff}.anchor-card .anchor-header .badge[data-v-0b0de7a9]{font-size:.75em;background:hsla(0,0%,100%,.1);padding:.125em .375em;border-radius:.25em;color:#cbd5e1}.anchor-card .anchor-header .badge.custom[data-v-0b0de7a9]{background:rgba(252,211,77,.2);color:#fcd34d}.anchor-card .anchor-meta[data-v-0b0de7a9]{display:flex;gap:1em;color:#94a3b8;font-size:.875em;margin-bottom:.75em}.anchor-card .anchor-meta span[data-v-0b0de7a9]{display:flex;align-items:center;gap:.25em}.anchor-card .anchor-desc[data-v-0b0de7a9]{color:#cbd5e1;font-size:.9375em;line-height:1.5;margin:0;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.custom-form[data-v-0b0de7a9]{display:flex;flex-direction:column;gap:.75em;margin-top:1em}.custom-form input[data-v-0b0de7a9],.custom-form textarea[data-v-0b0de7a9]{width:100%;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);padding:.75em;border-radius:.375em;color:#fff;font-family:inherit;font-size:.875em}.custom-form input[data-v-0b0de7a9]:focus,.custom-form textarea[data-v-0b0de7a9]:focus{outline:none;border-color:#fcd34d}.empty-state[data-v-0b0de7a9]{padding:3em;text-align:center;color:#64748b;font-size:.875em}
.step-container[data-v-41af27aa]{height:100%;display:grid;grid-template-columns:25em 1fr;gap:2em}.presets-column[data-v-41af27aa],.editor-column[data-v-41af27aa]{background:hsla(0,0%,100%,.02);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;display:flex;flex-direction:column;overflow:hidden}.header[data-v-41af27aa]{padding:1em;background:rgba(0,0,0,.2);display:flex;align-items:center;gap:.75em;border-bottom:1px solid hsla(0,0%,100%,.05)}.header h2[data-v-41af27aa]{margin:0;font-size:1.125em;font-weight:600;color:#f9a8d4;text-transform:uppercase}.status-badge[data-v-41af27aa]{margin-left:auto;font-size:.8125em;padding:.25em .625em;border-radius:.25em;background:#ef4444;color:#fff}.status-badge.valid[data-v-41af27aa]{background:#10b981}.presets-list[data-v-41af27aa]{flex:1;overflow-y:auto;padding:1em;display:flex;flex-direction:column;gap:1em}.preset-card[data-v-41af27aa]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.08);border-radius:.5em;padding:.75em}.preset-card[data-v-41af27aa]:hover{border-color:hsla(0,0%,100%,.15)}.preset-card .preset-header[data-v-41af27aa]{display:flex;align-items:center;gap:.75em;margin-bottom:.625em}.preset-card .preset-cover[data-v-41af27aa]{width:2.5em;aspect-ratio:9/16;border-radius:.25em;background-size:cover;background-position:center;background-color:#222;flex-shrink:0}.preset-card .preset-info[data-v-41af27aa]{display:flex;flex-direction:column}.preset-card .preset-info .pn[data-v-41af27aa]{font-weight:bold;font-size:.875em;color:#fff}.preset-card .preset-info .origin[data-v-41af27aa]{font-size:.75em;color:#94a3b8}.preset-card .category-buttons[data-v-41af27aa]{display:flex;gap:.375em;flex-wrap:wrap;margin-bottom:.625em}.preset-card .cat-btn[data-v-41af27aa]{display:flex;align-items:center;gap:.25em;padding:.3125em .625em;background:hsla(0,0%,100%,.08);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;color:#aaa;font-size:.75em;cursor:pointer;transition:all .2s}.preset-card .cat-btn[data-v-41af27aa]:hover{background:rgba(167,139,250,.2);border-color:#a78bfa;color:#fff}.preset-card .cat-btn.selected[data-v-41af27aa]{background:rgba(167,139,250,.4);border-color:#a78bfa;color:#fff}.preset-card .preset-preview[data-v-41af27aa]{font-size:.75em;color:#666;display:flex;flex-direction:column;gap:.25em}.preset-card .preset-preview .preview-item[data-v-41af27aa]{display:flex;gap:.25em;line-height:1.4}.preset-card .preset-preview .preview-label[data-v-41af27aa]{color:#888;flex-shrink:0}.empty-list[data-v-41af27aa]{color:#666;text-align:center;padding:2em;font-size:.875em}.form-scroll[data-v-41af27aa]{flex:1;overflow-y:auto;padding:1.5em;display:flex;flex-direction:column;gap:1.5em}.form-section .section-header[data-v-41af27aa]{display:flex;align-items:center;justify-content:space-between;margin-bottom:.625em}.form-section h3[data-v-41af27aa]{font-size:1em;color:#f9a8d4;margin:0;display:flex;align-items:center;gap:.5em}.form-section .selection-count[data-v-41af27aa]{font-size:.75em;color:#a78bfa;background:rgba(167,139,250,.1);padding:.25em .5em;border-radius:.25em}.form-section textarea[data-v-41af27aa]{width:100%;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.375em;padding:.75em;color:#fff;resize:vertical;font-family:inherit;font-size:.875em;min-height:5em}.form-section textarea[data-v-41af27aa]:focus{outline:none;border-color:#f9a8d4}.input-grid[data-v-41af27aa]{display:flex;gap:1.5em}.avatar-uploader[data-v-41af27aa]{width:6.25em;aspect-ratio:9/16;border-radius:.5em;border:1px dashed hsla(0,0%,100%,.2);background-size:cover;background-position:center;position:relative;display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-uploader span[data-v-41af27aa]{font-size:.8125em;color:#666}.identity-fields[data-v-41af27aa]{flex:1;display:flex;flex-direction:column;gap:.75em}.identity-fields .field[data-v-41af27aa]{display:flex;flex-direction:column;gap:.3125em}.identity-fields .field label[data-v-41af27aa]{font-size:.8125em;color:#94a3b8}.identity-fields .field input[data-v-41af27aa]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;padding:.625em;color:#fff;font-size:.875em}.identity-fields .field input[data-v-41af27aa]:focus{border-color:#f9a8d4;outline:none}
.new-game-root[data-v-5b862732]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;font-size:.85vw}.visual-container[data-v-5b862732]{width:100%;height:100%;display:flex;flex-direction:column;padding:2em 2.5em;box-sizing:border-box}.new-game-header[data-v-5b862732]{height:5em;display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5em;flex-shrink:0}.nav-btn[data-v-5b862732]{display:flex;align-items:center;gap:.5em;padding:.9em 1.8em;background:#fff;color:#000;border:none;font-weight:bold;font-size:1em;border-radius:99em;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:1px}.nav-btn[data-v-5b862732]:hover{transform:scale(1.05);box-shadow:0 0 15px hsla(0,0%,100%,.3)}.nav-btn.disabled[data-v-5b862732]{opacity:.5;cursor:not-allowed;background:#555;color:#999}.nav-btn.next[data-v-5b862732]{background:linear-gradient(135deg,#a78bfa,#22d3ee);color:#fff}.steps-progress[data-v-5b862732]{display:flex;align-items:center;gap:.6em}.steps-progress .step-dot[data-v-5b862732]{width:2em;height:2em;border-radius:50%;background:hsla(0,0%,100%,.1);color:#666;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:1em;border:2px solid rgba(0,0,0,0)}.steps-progress .step-dot.active[data-v-5b862732]{background:#a78bfa;color:#fff}.steps-progress .step-dot.current[data-v-5b862732]{box-shadow:0 0 0 .25em rgba(167,139,250,.2)}.steps-progress .line[data-v-5b862732]{width:3em;height:2px;background:hsla(0,0%,100%,.1)}.steps-progress .line.active[data-v-5b862732]{background:#a78bfa}.step-content-wrapper[data-v-5b862732]{flex:1;background:rgba(20,20,25,.6);backdrop-filter:blur(10px);border:1px solid hsla(0,0%,100%,.05);border-radius:1.25em;padding:2em;overflow:hidden;box-shadow:0 1.25em 3em rgba(0,0,0,.5)}
.user-widget-container[data-v-79a103d6]{position:relative;min-height:50px;width:100%;display:flex;justify-content:flex-start;align-items:flex-start}.user-widget-content-outer[data-v-79a103d6]{width:100%;min-width:0;max-width:100%}.user-widget-content-inner[data-v-79a103d6]{display:inline-block;transform-origin:top left;transform:scale(var(--th-widget-scale,1))}.widget-loading[data-v-79a103d6]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2em;color:hsla(0,0%,100%,.5);gap:1em}.widget-loading .loading-spinner[data-v-79a103d6]{width:24px;height:24px;border:2px solid hsla(0,0%,100%,.1);border-top-color:rgba(139,92,246,.8);border-radius:50%;animation:spin-79a103d6 1s linear infinite}.widget-error[data-v-79a103d6]{display:flex;flex-direction:column;align-items:center;padding:2em;background:rgba(127,29,29,.2);border:1px solid rgba(239,68,68,.3);border-radius:.5em;text-align:center}.widget-error .error-icon[data-v-79a103d6]{font-size:2em;margin-bottom:.5em}.widget-error .error-title[data-v-79a103d6]{font-weight:bold;color:#f87171;margin-bottom:.5em}.widget-error .error-message[data-v-79a103d6]{color:hsla(0,0%,100%,.6);font-size:.85em;white-space:pre-wrap;max-width:100%;overflow-wrap:break-word;margin-bottom:1em}.widget-error .retry-btn[data-v-79a103d6]{padding:.5em 1.5em;background:rgba(239,68,68,.2);border:1px solid rgba(239,68,68,.4);border-radius:.25em;color:#f87171;cursor:pointer;transition:all .2s}.widget-error .retry-btn[data-v-79a103d6]:hover{background:rgba(239,68,68,.3)}.widget-warnings[data-v-79a103d6]{margin-bottom:1em}.widget-warnings .warning-item[data-v-79a103d6]{padding:.5em 1em;background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.2);border-radius:.25em;color:#fbbf24;font-size:.85em;margin-bottom:.5em}@keyframes spin-79a103d6{to{transform:rotate(360deg)}}
.gallery-card[data-v-d4b94892]{cursor:pointer;transition:border-color .3s;overflow:hidden;position:relative}.gallery-card[data-v-d4b94892]:hover{border-color:rgba(167,139,250,.5)}.gallery-card:hover .card-actions[data-v-d4b94892]{opacity:1}.gallery-card:hover .card-image img[data-v-d4b94892]{transform:scale(1.05)}.card-actions[data-v-d4b94892]{position:absolute;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);display:flex;align-items:center;justify-content:center;gap:1em;opacity:0;transition:opacity .3s;z-index:10}.card-actions button[data-v-d4b94892]{width:3em;height:3em;border-radius:50%;border:1px solid hsla(0,0%,100%,.2);background:hsla(0,0%,100%,.1);color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.card-actions button[data-v-d4b94892]:hover{transform:scale(1.1);background:hsla(0,0%,100%,.2)}.card-actions button.btn-delete[data-v-d4b94892]:hover{background:rgba(239,68,68,.5);border-color:rgba(239,68,68,.5)}.card-actions button.btn-delete-remote[data-v-d4b94892]{border-color:rgba(239,68,68,.6);background:rgba(239,68,68,.18)}.card-actions button.btn-delete-remote[data-v-d4b94892]:hover{background:rgba(239,68,68,.75);border-color:rgba(239,68,68,.95);transform:scale(1.15)}.card-actions button.btn-edit[data-v-d4b94892]:hover{background:rgba(139,92,246,.5);border-color:rgba(139,92,246,.5)}.card-actions button.btn-info[data-v-d4b94892]:hover{background:rgba(59,130,246,.45);border-color:rgba(59,130,246,.55)}.card-actions button.btn-move-mine[data-v-d4b94892]:hover{background:rgba(34,197,94,.45);border-color:rgba(34,197,94,.55)}.card-actions button.btn-file-download[data-v-d4b94892]:hover{background:rgba(14,165,233,.45);border-color:rgba(14,165,233,.55)}.card-status-badge.mine[data-v-d4b94892]{background:rgba(34,197,94,.2);border:1px solid rgba(34,197,94,.45);color:hsla(0,0%,100%,.9)}.card-image[data-v-d4b94892]{position:relative;aspect-ratio:16/10;background:rgba(0,0,0,.5);overflow:hidden}.card-image img[data-v-d4b94892]{width:100%;height:100%;object-fit:cover;transition:transform .7s}.card-type-badge[data-v-d4b94892]{position:absolute;top:.5em;left:.5em;padding:.25em .5em;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);border-radius:.25em;font-size:.825em;font-weight:bold;border:1px solid hsla(0,0%,100%,.1);color:#fff}.card-status-badge[data-v-d4b94892]{position:absolute;top:.5em;right:.5em;padding:.25em .6em;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);border-radius:9999px;font-size:.825em;font-weight:bold;border:1px solid hsla(0,0%,100%,.1);color:#fff}.card-status-badge.local[data-v-d4b94892]{border-color:rgba(14,165,233,.35)}.card-status-badge.cloud[data-v-d4b94892]{border-color:rgba(167,139,250,.35)}.card-status-badge.both[data-v-d4b94892]{border-color:rgba(34,197,94,.35)}.card-content[data-v-d4b94892]{padding:1em}.card-header[data-v-d4b94892]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.5em}.card-header h3[data-v-d4b94892]{font-weight:bold;font-size:1.125em;color:#fff;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-right:.5em}.card-header .card-metrics[data-v-d4b94892]{display:flex;align-items:center;gap:.75em;flex-shrink:0}.card-header .card-metrics .downloads[data-v-d4b94892]{display:flex;align-items:center;gap:.25em;font-size:.75em;color:hsla(0,0%,100%,.75)}.card-author[data-v-d4b94892]{display:flex;align-items:center;gap:.5em;margin-bottom:.75em}.card-author .author-avatar[data-v-d4b94892]{width:1.25em;height:1.25em;border-radius:9999px;background:linear-gradient(135deg,#8b5cf6,#06b6d4)}.card-author .author-avatar-img[data-v-d4b94892]{object-fit:cover;background:rgba(0,0,0,0)}.card-author span[data-v-d4b94892]{font-size:.75em;color:#9ca3af}.card-author.btn-download[data-v-d4b94892]:hover{background:rgba(8,145,178,.5);border-color:rgba(6,182,212,.5)}.card-author.btn-upload[data-v-d4b94892]:hover{background:rgba(34,197,94,.45);border-color:rgba(34,197,94,.45)}.card-author .verified-icon[data-v-d4b94892]{color:#3b82f6}.card-tags[data-v-d4b94892]{display:flex;gap:.5em;flex-wrap:wrap}.card-tags span[data-v-d4b94892]{font-size:.625em;padding:.25em .5em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.05);color:#9ca3af}
.image-cropper-overlay[data-v-085c99f0]{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:9999}.cropper-modal[data-v-085c99f0]{background:#1f2937;border:1px solid hsla(0,0%,100%,.1);border-radius:12px;padding:20px;width:90%;max-width:900px;display:flex;flex-direction:column;gap:16px;box-shadow:0 20px 25px -5px rgba(0,0,0,.5)}.cropper-header[data-v-085c99f0]{display:flex;justify-content:space-between;align-items:center;color:#e5e7eb}.cropper-viewport-container[data-v-085c99f0]{width:100%;padding:2em;background:#111;border-radius:8px;display:flex;justify-content:center;align-items:center;overflow:hidden}.cropper-viewport[data-v-085c99f0]{width:100%;max-height:60vh;position:relative;overflow:hidden;box-shadow:0 0 0 1px hsla(0,0%,100%,.5),0 0 0 9999px rgba(0,0,0,.7);display:block}.cropper-viewport img[data-v-085c99f0]{position:absolute;top:0;left:0;width:100%;height:auto;will-change:transform;-webkit-user-select:none;user-select:none}.cropper-footer[data-v-085c99f0]{display:flex;justify-content:flex-end;gap:12px}.btn[data-v-085c99f0]{padding:8px 16px;border-radius:6px;border:none;cursor:pointer;font-weight:500}.btn.cancel[data-v-085c99f0]{background:hsla(0,0%,100%,.1);color:#e5e7eb}.btn.confirm[data-v-085c99f0]{background:#8b5cf6;color:#fff}
.character-block[data-v-4735476a]{min-width:300px;max-width:340px;border-radius:4px;color:#e2e8f0;position:relative;-webkit-user-select:none;user-select:none;box-shadow:0 4px 15px rgba(0,0,0,.5);border:1px solid hsla(0,0%,100%,.05);background:rgba(20,20,25,.85);backdrop-filter:blur(8px);transition:transform .1s,box-shadow .2s;margin-bottom:2px;border-radius:4px}.character-block.is-dragging[data-v-4735476a]{opacity:.9;z-index:999;box-shadow:0 10px 30px rgba(0,0,0,.8);transform:scale(1.02);pointer-events:none;border-color:rgba(139,92,246,.5)}.character-block[data-v-4735476a]{border-left:2px solid hsla(0,0%,100%,.1)}.character-block.type-identity[data-v-4735476a]{border-left-color:#a78bfa}.character-block .block-header[data-v-4735476a]{background:hsla(0,0%,100%,.02);padding:8px 12px;display:flex;align-items:center;gap:10px;font-weight:600;font-size:.85em;letter-spacing:.5px;cursor:grab;border-bottom:1px solid hsla(0,0%,100%,.05)}.character-block .block-header[data-v-4735476a]:active{cursor:grabbing;background:hsla(0,0%,100%,.05)}.character-block .block-header .remove-btn[data-v-4735476a]{margin-left:auto;background:none;border:none;color:hsla(0,0%,100%,.3);cursor:pointer;opacity:.65;transition:opacity .2s,color .2s;width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;border-radius:6px}.character-block .block-header .remove-btn[data-v-4735476a]:hover{color:#ef4444;background:hsla(0,0%,100%,.06)}.character-block:hover .block-header .remove-btn[data-v-4735476a]{opacity:1}@media (hover:none)and (pointer:coarse){.character-block .block-header .remove-btn[data-v-4735476a]{opacity:1;width:36px;height:36px;color:hsla(0,0%,100%,.85);background:hsla(0,0%,100%,.06)}}.character-block .block-content[data-v-4735476a]{padding:12px}.character-block .identity-form[data-v-4735476a]{display:flex;gap:12px}.character-block .identity-form .avatar-upload[data-v-4735476a]{width:90px;height:160px;flex-shrink:0;background:rgba(0,0,0,.4);border:1px dashed hsla(0,0%,100%,.2);border-radius:4px;background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;font-size:.7em;cursor:pointer;color:#666;transition:border-color .2s}.character-block .identity-form .avatar-upload[data-v-4735476a]:hover{border-color:#a78bfa;color:#a78bfa}.character-block .identity-form .inputs[data-v-4735476a]{flex:1;display:flex;flex-direction:column;gap:8px}.character-block .identity-form .inputs input[data-v-4735476a]{width:100%;background:rgba(0,0,0,.4);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:6px 8px;border-radius:4px;font-size:.9em;transition:border-color .2s}.character-block .identity-form .inputs input[data-v-4735476a]:focus{outline:none;border-color:rgba(139,92,246,.5)}.character-block .identity-form .inputs input.tiny[data-v-4735476a]{font-size:.8em;color:#aaa}.character-block .text-content textarea[data-v-4735476a]{width:100%;background:rgba(0,0,0,.4);border:1px solid hsla(0,0%,100%,.1);resize:vertical;color:#ddd;font-size:.9em;padding:8px;border-radius:4px;font-family:"Segoe UI",sans-serif;line-height:1.4;transition:border-color .2s}.character-block .text-content textarea[data-v-4735476a]:focus{outline:none;border-color:rgba(139,92,246,.5)}.character-block .text-content textarea[data-v-4735476a]::placeholder{color:hsla(0,0%,100%,.2)}.character-block .text-content textarea .block-socket-bottom[data-v-4735476a]{position:relative}.character-block .text-content textarea .block-socket-bottom.is-snap-target[data-v-4735476a]::after{content:"";display:block;width:100%;height:4px;background:#fbbf24;border-radius:2px;box-shadow:0 0 10px #fbbf24;animation:pulse 1s infinite;margin-top:4px}
.character-palette[data-v-f260f970]{width:18em;background:rgba(0,0,0,.4);border-right:1px solid hsla(0,0%,100%,.1);padding:1.5em;display:flex;flex-direction:column;gap:1em;overflow-y:auto;flex-shrink:0;backdrop-filter:blur(10px);position:relative;z-index:10}.sidebar-spacer[data-v-f260f970]{flex:1}.metadata-form[data-v-f260f970]{display:flex;flex-direction:column;gap:12px;background:rgba(0,0,0,.2);padding:12px;border-radius:8px;border:1px solid hsla(0,0%,100%,.05)}.metadata-form .cover-upload[data-v-f260f970]{width:100%;aspect-ratio:16/9;background:rgba(0,0,0,.4);border-radius:6px;border:1px dashed hsla(0,0%,100%,.15);background-size:cover;background-position:center;cursor:pointer;position:relative;overflow:hidden}.metadata-form .cover-upload .upload-placeholder[data-v-f260f970]{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:hsla(0,0%,100%,.3);gap:5px;font-size:.8em}.metadata-form .cover-upload .upload-hover[data-v-f260f970]{position:absolute;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s;color:#fff}.metadata-form .cover-upload:hover .upload-hover[data-v-f260f970]{opacity:1}.metadata-form .inputs[data-v-f260f970]{display:flex;flex-direction:column;gap:8px}.metadata-form .inputs input[data-v-f260f970],.metadata-form .inputs textarea[data-v-f260f970]{width:100%;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:8px;border-radius:4px;font-size:.9em;transition:border-color .2s}.metadata-form .inputs input[data-v-f260f970]:focus,.metadata-form .inputs textarea[data-v-f260f970]:focus{outline:none;border-color:rgba(139,92,246,.5)}.metadata-form .inputs .title-input[data-v-f260f970]{font-weight:600;font-size:1em}.metadata-form .inputs .desc-input[data-v-f260f970]{font-size:.85em;color:#ccc;resize:vertical}.metadata-form .inputs .input-hint[data-v-f260f970]{display:flex;align-items:center;gap:.5em;padding:.5em;background:rgba(139,92,246,.1);border-radius:.375em;border:1px solid rgba(139,92,246,.2);color:rgba(196,181,253,.9);font-size:.7em;line-height:1.3;margin-top:-4px}.sidebar-group h3[data-v-f260f970]{font-size:.8em;color:hsla(0,0%,100%,.4);text-transform:uppercase;letter-spacing:.1em;margin-bottom:1em;padding-left:.5em;font-weight:600}.palette-buttons[data-v-f260f970]{display:flex;flex-direction:column;gap:.5em}.palette-btn[data-v-f260f970]{width:100%;display:flex;align-items:center;gap:.75em;padding:.85em;background:rgba(0,0,0,0);border:1px solid rgba(0,0,0,0);color:hsla(0,0%,100%,.7);border-radius:.5em;cursor:grab;touch-action:none;-webkit-user-select:none;user-select:none;transition:all .2s;text-align:left;font-size:.95em}.palette-btn[data-v-f260f970]:hover{background:hsla(0,0%,100%,.05);color:#fff;transform:translateX(2px)}.palette-btn[data-v-f260f970]:active{cursor:grabbing;background:rgba(139,92,246,.15);border-color:rgba(139,92,246,.3)}.sidebar-info[data-v-f260f970]{display:flex;flex-direction:column;gap:1.5em;border-top:1px solid hsla(0,0%,100%,.05);padding-top:1.5em}.sidebar-info .info-group h3[data-v-f260f970]{font-size:.75em;color:hsla(0,0%,100%,.3);text-transform:uppercase;margin-bottom:.5em}.sidebar-info .info-group p[data-v-f260f970]{font-size:.85em;color:hsla(0,0%,100%,.5);margin:.2em 0;line-height:1.4}
.character-pack-editor-root[data-v-420e501e]{width:100%;height:100%;background:#0f0f12;background-image:radial-gradient(rgba(255,255,255,0.1) 1px,transparent 1px);background-size:20px 20px;overflow:hidden;position:relative;display:flex;align-items:center;justify-content:center}.visual-editor-container[data-v-420e501e]{display:flex;background:rgba(0,0,0,0);color:#fff;overflow:hidden;box-shadow:0 0 100px rgba(0,0,0,.8);font-size:16px}.workspace[data-v-420e501e]{flex:1;position:relative;overflow:hidden;cursor:default;touch-action:none}.workspace[data-v-420e501e]:active{cursor:grabbing}.pan-zoom-wrapper[data-v-420e501e]{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.pan-zoom-wrapper[data-v-420e501e]>*{pointer-events:auto}.snap-hint[data-v-420e501e]{display:none}@keyframes pulse-420e501e{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}.drag-proxy[data-v-420e501e]{position:absolute;pointer-events:none;z-index:1000;opacity:.9;filter:drop-shadow(0 15px 30px rgba(0,0,0,0.6));transform-origin:0 0}
.editor-section[data-v-0d6a4e56]{animation:fadeIn .3s ease}.section-title[data-v-0d6a4e56]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-0d6a4e56]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-0d6a4e56]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-0d6a4e56]:hover{background:rgba(139,92,246,.4)}.items-list[data-v-0d6a4e56]{display:flex;flex-direction:column;gap:1em}.event-item[data-v-0d6a4e56]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em}.event-header[data-v-0d6a4e56]{display:flex;gap:1em;margin-bottom:1em;align-items:center}.event-name[data-v-0d6a4e56]{flex:1;font-weight:bold}.delete-btn[data-v-0d6a4e56]{padding:.5em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer}.delete-btn[data-v-0d6a4e56]:hover{background:rgba(239,68,68,.4)}.trigger-type-selector[data-v-0d6a4e56]{display:flex;align-items:center;gap:1em;margin-bottom:1em}.trigger-type-selector label[data-v-0d6a4e56]{color:#9ca3af;font-size:.9em}.type-toggle[data-v-0d6a4e56]{display:flex;background:rgba(0,0,0,.3);border-radius:.5em;overflow:hidden;border:1px solid hsla(0,0%,100%,.1)}.type-toggle button[data-v-0d6a4e56]{padding:.5em 1em;background:rgba(0,0,0,0);border:none;color:#9ca3af;cursor:pointer;transition:all .2s;font-size:.85em}.type-toggle button.active[data-v-0d6a4e56]{background:rgba(139,92,246,.3);color:#c4b5fd}.type-toggle button[data-v-0d6a4e56]:hover:not(.active){background:hsla(0,0%,100%,.05)}.conditions-panel[data-v-0d6a4e56]{background:rgba(0,0,0,.2);border-radius:.5em;padding:1em;margin-bottom:1em}.conditions-header[data-v-0d6a4e56]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75em}.conditions-label[data-v-0d6a4e56]{color:#9ca3af;font-size:.9em;display:flex;align-items:center;gap:.5em}.add-condition-btn[data-v-0d6a4e56]{padding:.4em .8em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.3);border-radius:.25em;cursor:pointer;font-size:.8em;display:flex;align-items:center;gap:.3em}.add-condition-btn[data-v-0d6a4e56]:hover{background:rgba(139,92,246,.4)}.conditions-list[data-v-0d6a4e56]{display:flex;flex-direction:column;gap:.5em}.condition-card[data-v-0d6a4e56]{display:grid;grid-template-columns:1fr auto 1fr auto;gap:.5em;align-items:center;background:rgba(0,0,0,.2);padding:.5em;border-radius:.25em}.condition-card .var-select[data-v-0d6a4e56],.condition-card .val-input[data-v-0d6a4e56]{flex:1;min-width:0}.condition-card .op-select[data-v-0d6a4e56]{width:3em;text-align:center}.condition-delete[data-v-0d6a4e56]{width:1.5em;height:1.5em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer;font-size:1em}.condition-delete[data-v-0d6a4e56]:hover{background:rgba(239,68,68,.4)}.no-conditions[data-v-0d6a4e56]{text-align:center;color:hsla(0,0%,100%,.3);padding:1em;border:1px dashed hsla(0,0%,100%,.1);border-radius:.25em;font-size:.85em}.natural-condition-panel[data-v-0d6a4e56]{background:rgba(0,0,0,.2);border-radius:.5em;padding:1em;margin-bottom:1em}.natural-condition-panel label[data-v-0d6a4e56]{display:flex;align-items:center;gap:.5em;color:#9ca3af;font-size:.9em;margin-bottom:.5em}.natural-input[data-v-0d6a4e56]{width:100%;min-height:4em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#e5e7eb;padding:.75em;border-radius:.25em;resize:vertical}.natural-input[data-v-0d6a4e56]:focus{border-color:#8b5cf6;outline:none}.event-content-wrapper label[data-v-0d6a4e56]{display:block;color:#9ca3af;font-size:.85em;margin-bottom:.5em}.event-content[data-v-0d6a4e56]{width:100%;min-height:5em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);color:#e5e7eb;padding:.5em;border-radius:.25em}input[data-v-0d6a4e56],select[data-v-0d6a4e56]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:.5em;border-radius:.25em}input[data-v-0d6a4e56]:focus,select[data-v-0d6a4e56]:focus{border-color:#8b5cf6;outline:none}.empty-hint[data-v-0d6a4e56]{padding:2em;text-align:center;color:hsla(0,0%,100%,.3);border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}
.editor-section[data-v-5e9fa566]{animation:fadeIn .3s ease;height:100%;display:flex;flex-direction:column}.wb-grid[data-v-5e9fa566]{display:grid;grid-template-columns:18em 1fr;gap:1.5em;flex:1;min-height:0}.wb-panel[data-v-5e9fa566]{background:rgba(0,0,0,.2);border-radius:.5em;overflow:hidden;display:flex;flex-direction:column;border:1px solid hsla(0,0%,100%,.05);min-height:0}.panel-header[data-v-5e9fa566]{display:flex;justify-content:space-between;align-items:center;padding:.75em 1em;border-bottom:1px solid hsla(0,0%,100%,.1);background:rgba(0,0,0,.2)}.panel-header h4[data-v-5e9fa566]{margin:0;font-size:.95em;display:flex;align-items:center;gap:.5em;color:#c4b5fd}.panel-content[data-v-5e9fa566]{flex:1;padding:1em;overflow-y:auto;min-height:0}.add-mini-btn[data-v-5e9fa566]{background:hsla(0,0%,100%,.1);color:#fff;border:none;width:1.8em;height:1.8em;border-radius:.25em;cursor:pointer}.add-mini-btn[data-v-5e9fa566]:hover{background:hsla(0,0%,100%,.2)}.editor-actions[data-v-5e9fa566]{display:flex;gap:.5em}.danger-btn[data-v-5e9fa566]{background:rgba(239,68,68,.18);border:1px solid rgba(239,68,68,.35);color:#fca5a5;border-radius:.4em;padding:.35em .75em;cursor:pointer;font-size:.8em}.danger-btn[data-v-5e9fa566]:hover{background:rgba(239,68,68,.3)}.danger-btn[data-v-5e9fa566]:disabled{opacity:.5;cursor:not-allowed}.entry-list[data-v-5e9fa566]{display:flex;flex-direction:column;gap:.5em}.entry-item[data-v-5e9fa566]{text-align:left;background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:.75em;cursor:pointer;color:hsla(0,0%,100%,.85);transition:.15s ease}.entry-item[data-v-5e9fa566]:hover{background:hsla(0,0%,100%,.06);border-color:hsla(0,0%,100%,.1)}.entry-item.active[data-v-5e9fa566]{background:rgba(139,92,246,.12);border-color:rgba(139,92,246,.3)}.entry-title-row[data-v-5e9fa566]{display:flex;align-items:center;justify-content:space-between;gap:.75em}.entry-title[data-v-5e9fa566]{font-weight:600;font-size:.9em;color:#fff}.entry-sub[data-v-5e9fa566]{margin-top:.25em;font-size:.75em}.dim[data-v-5e9fa566]{color:hsla(0,0%,100%,.45)}.badge[data-v-5e9fa566]{font-size:.7em;padding:.12em .45em;border-radius:99em;border:1px solid hsla(0,0%,100%,.12)}.badge.enabled[data-v-5e9fa566]{color:#c4b5fd;background:rgba(139,92,246,.14);border-color:rgba(139,92,246,.28)}.badge.disabled[data-v-5e9fa566]{color:hsla(0,0%,100%,.55);background:rgba(0,0,0,.2)}.empty-panel[data-v-5e9fa566]{text-align:center;color:hsla(0,0%,100%,.3);padding:2em;border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}.form-grid[data-v-5e9fa566]{display:grid;grid-template-columns:1fr 1fr;gap:1em}.field[data-v-5e9fa566]{display:flex;flex-direction:column;gap:.35em}.field label[data-v-5e9fa566]{font-size:.82em;color:#9ca3af}.field input[data-v-5e9fa566],.field select[data-v-5e9fa566],.field textarea[data-v-5e9fa566]{width:100%;padding:.55em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.35em;color:#fff;font-size:.9em}.field input[data-v-5e9fa566]:focus,.field select[data-v-5e9fa566]:focus,.field textarea[data-v-5e9fa566]:focus{outline:none;border-color:rgba(139,92,246,.7)}.field textarea[data-v-5e9fa566]{min-height:6em;resize:vertical}.field .content[data-v-5e9fa566]{min-height:14em}.span-2[data-v-5e9fa566]{grid-column:1/span 2}.mt[data-v-5e9fa566]{margin-top:.5em}.mono[data-v-5e9fa566]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}.hint[data-v-5e9fa566]{font-size:.75em;color:hsla(0,0%,100%,.45)}.hint.warning[data-v-5e9fa566]{color:#fca5a5}.sub-title[data-v-5e9fa566]{font-size:.85em;font-weight:600;color:hsla(0,0%,100%,.8);padding-top:.25em;border-top:1px solid hsla(0,0%,100%,.08)}.pretty-check[data-v-5e9fa566]{position:relative;display:inline-flex;align-items:center;gap:.6em;cursor:pointer;-webkit-user-select:none;user-select:none;color:hsla(0,0%,100%,.8)}.pretty-check input[data-v-5e9fa566]{position:absolute;opacity:0;pointer-events:none}.pretty-check .check-ui[data-v-5e9fa566]{width:1.15em;height:1.15em;border-radius:.3em;background:rgba(0,0,0,.25);border:1px solid hsla(0,0%,100%,.18);display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;transition:.15s ease;box-shadow:0 0 0 0 rgba(139,92,246,0)}.pretty-check .check-ui[data-v-5e9fa566]::after{content:"";width:.55em;height:.35em;border-left:2px solid rgba(0,0,0,0);border-bottom:2px solid rgba(0,0,0,0);transform:translateY(-0.05em) rotate(-45deg);opacity:0;transition:.15s ease}.pretty-check:hover .check-ui[data-v-5e9fa566]{border-color:rgba(139,92,246,.55);background:rgba(139,92,246,.08)}.pretty-check input:focus-visible+.check-ui[data-v-5e9fa566]{box-shadow:0 0 0 2px rgba(139,92,246,.35);border-color:rgba(139,92,246,.7)}.pretty-check input:checked+.check-ui[data-v-5e9fa566]{background:rgba(139,92,246,.25);border-color:rgba(139,92,246,.75)}.pretty-check input:checked+.check-ui[data-v-5e9fa566]::after{border-left-color:#c4b5fd;border-bottom-color:#c4b5fd;opacity:1}
.editor-section[data-v-6f86564c]{animation:fadeIn-6f86564c .3s ease}.section-title[data-v-6f86564c]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-6f86564c]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.metadata-grid[data-v-6f86564c]{display:grid;grid-template-columns:24em 1fr;gap:2em;background:rgba(0,0,0,.2);padding:1em;border-radius:.5em}.cover-uploader[data-v-6f86564c]{display:flex;flex-direction:column;gap:.5em}.cover-uploader label[data-v-6f86564c]{font-size:.8em;color:#9ca3af}.image-preview[data-v-6f86564c]{width:100%;aspect-ratio:16/9;background:#000;border-radius:.5em;border:2px dashed hsla(0,0%,100%,.1);background-size:contain;background-repeat:no-repeat;background-position:center;position:relative;overflow:hidden;cursor:pointer}.image-preview[data-v-6f86564c]:hover{border-color:#8b5cf6;background-color:hsla(0,0%,100%,.02)}.image-preview .placeholder[data-v-6f86564c]{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;color:hsla(0,0%,100%,.3);gap:.5em}.url-input[data-v-6f86564c]{width:100%;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);padding:.5em;border-radius:.25em;color:#eee;font-size:.8em}.url-input[data-v-6f86564c]:focus{border-color:#8b5cf6;outline:none}.info-fields[data-v-6f86564c]{display:flex;flex-direction:column;gap:1em}.form-group[data-v-6f86564c]{display:flex;flex-direction:column;gap:.5em}.form-group label[data-v-6f86564c]{font-size:.8em;color:#9ca3af}.form-group .linked-packs-selector[data-v-6f86564c]{display:flex;flex-wrap:wrap;gap:.8em;background:rgba(0,0,0,.2);padding:.8em;border-radius:.5em;border:1px solid hsla(0,0%,100%,.05);min-height:80px}.form-group .linked-packs-selector .pack-option[data-v-6f86564c]{display:flex;align-items:center;gap:.5em;padding:.4em .8em;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:4px;cursor:pointer;transition:all .2s;-webkit-user-select:none;user-select:none}.form-group .linked-packs-selector .pack-option[data-v-6f86564c]:hover{background:hsla(0,0%,100%,.1)}.form-group .linked-packs-selector .pack-option.selected[data-v-6f86564c]{background:rgba(139,92,246,.2);border-color:#8b5cf6;color:#c4b5fd}.form-group .linked-packs-selector .pack-option .pack-cover[data-v-6f86564c]{width:24px;height:24px;border-radius:2px;background-size:cover;background-position:center;background-color:#000}.form-group .linked-packs-selector .pack-option .pack-name[data-v-6f86564c]{font-size:.9em;font-weight:500}.form-group .linked-packs-selector .empty-packs[data-v-6f86564c]{color:#6b7280;font-size:.85em;padding:.5em;font-style:italic}.form-group input[data-v-6f86564c],.form-group textarea[data-v-6f86564c]{background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.1);padding:.75em;border-radius:.5em;color:#fff}.form-group input[data-v-6f86564c]:focus,.form-group textarea[data-v-6f86564c]:focus{border-color:#8b5cf6;outline:none}.form-group .disabled-input[data-v-6f86564c]{color:#6b7280;cursor:not-allowed}.full-height[data-v-6f86564c]{flex:1;display:flex;flex-direction:column}.full-height textarea[data-v-6f86564c]{flex:1;resize:none}@keyframes fadeIn-6f86564c{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.editor-section[data-v-5a9d1177]{animation:fadeIn .3s ease}.section-title[data-v-5a9d1177]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-5a9d1177]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-5a9d1177]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-5a9d1177]:hover{background:rgba(139,92,246,.4)}.items-list[data-v-5a9d1177]{display:flex;flex-direction:column;gap:1em}.event-item[data-v-5a9d1177]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em}.event-header[data-v-5a9d1177]{display:flex;gap:1em;margin-bottom:1em;align-items:center}.order-badge[data-v-5a9d1177]{background:hsla(0,0%,100%,.1);padding:.2em .5em;border-radius:4px;font-size:.8em}.event-name[data-v-5a9d1177]{flex:1;font-weight:bold;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:.5em;border-radius:.25em}.event-content[data-v-5a9d1177]{width:100%;min-height:5em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);color:#e5e7eb;padding:.5em;border-radius:.25em;resize:vertical}.delete-btn[data-v-5a9d1177]{padding:.5em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer}.delete-btn[data-v-5a9d1177]:hover{background:rgba(239,68,68,.4)}.empty-hint[data-v-5a9d1177]{padding:2em;text-align:center;color:hsla(0,0%,100%,.3);border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}
.editor-section[data-v-84947124]{animation:fadeIn .3s ease}.section-title[data-v-84947124]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-84947124]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-84947124]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-84947124]:hover{background:rgba(139,92,246,.4)}.delete-btn[data-v-84947124]{padding:.5em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer}.delete-btn[data-v-84947124]:hover{background:rgba(239,68,68,.4)}.items-list[data-v-84947124]{display:flex;flex-direction:column;gap:1em}.event-item[data-v-84947124]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em}.event-header[data-v-84947124]{display:flex;gap:1em;margin-bottom:1em;align-items:center}.event-name[data-v-84947124]{flex:1;font-weight:bold;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:.5em;border-radius:.25em}.event-content[data-v-84947124]{width:100%;min-height:5em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);color:#e5e7eb;padding:.5em;border-radius:.25em;resize:vertical}.event-config[data-v-84947124]{margin-bottom:1em;padding:.75em;background:rgba(0,0,0,.2);border-radius:.25em;font-size:.85em}.config-hint[data-v-84947124]{margin-top:.25em;color:hsla(0,0%,100%,.45);font-size:.85em}.config-row[data-v-84947124]{display:flex;align-items:center;gap:.5em;margin-bottom:.5em}.conditions-box[data-v-84947124]{background:rgba(0,0,0,.2);padding:.5em;border-radius:.25em;border:1px dashed hsla(0,0%,100%,.1)}.conditions-header[data-v-84947124]{display:flex;justify-content:space-between;margin-bottom:.5em;color:#9ca3af}.condition-row[data-v-84947124]{display:grid;grid-template-columns:2fr 1fr 2fr auto;gap:.5em;margin-bottom:.25em}input[data-v-84947124],select[data-v-84947124]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:.3em;border-radius:.25em}.add-mini-btn[data-v-84947124],.remove-mini-btn[data-v-84947124]{background:hsla(0,0%,100%,.1);color:#fff;border:none;border-radius:4px;cursor:pointer;width:1.5em;height:1.5em;display:inline-flex;justify-content:center;align-items:center}.remove-mini-btn[data-v-84947124]{background:rgba(239,68,68,.2);color:#fca5a5}.empty-hint[data-v-84947124]{padding:2em;text-align:center;color:hsla(0,0%,100%,.3);border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}
.editor-section[data-v-a75bcf42]{animation:fadeIn-a75bcf42 .3s ease;height:100%;display:flex;flex-direction:column}.world-settings-grid[data-v-a75bcf42]{display:flex;flex-direction:column;gap:1.5em;flex:1;min-height:0}.world-panel[data-v-a75bcf42]{background:rgba(0,0,0,.2);border-radius:.5em;overflow:hidden;display:flex;flex-direction:column;border:1px solid hsla(0,0%,100%,.05);flex:1}.panel-header[data-v-a75bcf42]{display:flex;justify-content:space-between;align-items:center;padding:.75em 1em;border-bottom:1px solid hsla(0,0%,100%,.1);background:rgba(0,0,0,.2)}.panel-header h4[data-v-a75bcf42]{margin:0;font-size:.95em;display:flex;align-items:center;gap:.5em}.panel-header.special h4[data-v-a75bcf42]{color:#fbbf24}.panel-content[data-v-a75bcf42]{flex:1;padding:1em;overflow-y:auto}.world-items[data-v-a75bcf42]{display:flex;flex-direction:column;gap:.75em}.world-card[data-v-a75bcf42]{background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:.75em;display:flex;flex-direction:column;gap:.5em}.card-header[data-v-a75bcf42]{display:flex;align-items:center;gap:.5em}.card-title-input[data-v-a75bcf42]{flex:1;background:rgba(0,0,0,0);border:none;color:#fff;font-weight:bold;font-size:.95em;padding:.25em;border-bottom:1px solid rgba(0,0,0,0)}.card-title-input[data-v-a75bcf42]:focus{border-bottom-color:hsla(0,0%,100%,.3);outline:none}.card-content[data-v-a75bcf42]{width:100%;min-height:4em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:.25em;color:hsla(0,0%,100%,.8);font-size:.9em;padding:.5em;resize:vertical}.card-content[data-v-a75bcf42]:focus{border-color:hsla(0,0%,100%,.15);outline:none}.add-mini-btn[data-v-a75bcf42],.mini-delete[data-v-a75bcf42]{width:1.5em;height:1.5em;display:flex;align-items:center;justify-content:center;border:none;border-radius:.25em;cursor:pointer;transition:.2s}.add-mini-btn[data-v-a75bcf42]{background:hsla(0,0%,100%,.1);color:#fff}.add-mini-btn[data-v-a75bcf42]:hover{background:hsla(0,0%,100%,.2)}.mini-delete[data-v-a75bcf42]{background:rgba(0,0,0,0);color:hsla(0,0%,100%,.3)}.mini-delete[data-v-a75bcf42]:hover{color:#ef4444;background:rgba(239,68,68,.1)}.empty-panel[data-v-a75bcf42]{text-align:center;color:hsla(0,0%,100%,.3);padding:2em;font-style:italic}@keyframes fadeIn-a75bcf42{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.editor-section[data-v-e982b446]{animation:fadeIn .3s ease;height:100%;overflow-y:auto}.section-title[data-v-e982b446]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-e982b446]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.description-text[data-v-e982b446]{font-size:.85em;color:#94a3b8;margin-bottom:1rem}.add-btn[data-v-e982b446]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-e982b446]:hover{background:rgba(139,92,246,.4)}.items-list[data-v-e982b446]{display:flex;flex-direction:column;gap:1em;padding-bottom:2em}.event-item[data-v-e982b446]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em;display:flex;flex-direction:column;gap:1em}.event-header[data-v-e982b446]{display:flex;align-items:center;gap:.8em}.event-header .order-badge[data-v-e982b446]{background:hsla(0,0%,100%,.1);padding:.2em .5em;border-radius:4px;font-size:.8em;color:#94a3b8}.event-header .event-name[data-v-e982b446]{background:rgba(0,0,0,0);border:none;color:#fff;font-size:1em;font-weight:bold;flex:1;border-bottom:1px dashed hsla(0,0%,100%,.2);padding:.2em}.event-header .event-name[data-v-e982b446]:focus{outline:none;border-bottom-color:#a78bfa}.event-header .delete-btn[data-v-e982b446]{background:none;border:none;color:#64748b;cursor:pointer;opacity:.5;transition:all .2s}.event-header .delete-btn[data-v-e982b446]:hover{opacity:1;color:#ef4444}.event-config[data-v-e982b446]{display:grid;grid-template-columns:1fr 1fr;gap:1em;background:rgba(0,0,0,.2);padding:.8em;border-radius:4px}.config-row[data-v-e982b446]{display:flex;align-items:center;gap:.8em}.config-row label[data-v-e982b446]{min-width:5em;color:#94a3b8;font-size:.9em}.config-row .input-text[data-v-e982b446]{flex:1;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:4px;color:#fff;padding:.4em .6em;font-size:.9em}.config-row .input-text[data-v-e982b446]:focus{border-color:#a78bfa;outline:none}.event-content[data-v-e982b446]{width:100%;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:4px;padding:1em;color:#e2e8f0;font-family:inherit;font-size:.95em;line-height:1.6;resize:vertical;min-height:100px}.event-content[data-v-e982b446]:focus{border-color:#a78bfa;outline:none;background:rgba(0,0,0,.3)}.event-content[data-v-e982b446]::placeholder{color:hsla(0,0%,100%,.2)}.empty-hint[data-v-e982b446]{text-align:center;color:hsla(0,0%,100%,.3);padding:3em;border:2px dashed hsla(0,0%,100%,.1);border-radius:1em}
.user-widgets-editor[data-v-003f54b4]{animation:fadeIn-003f54b4 .3s ease}.section-title[data-v-003f54b4]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-003f54b4]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-003f54b4]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-003f54b4]:hover{background:rgba(139,92,246,.4)}.security-notice[data-v-003f54b4]{display:flex;gap:.75em;padding:1em;background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.3);border-radius:.5em;margin-bottom:1em;color:#fbbf24}.security-notice .notice-content[data-v-003f54b4]{flex:1}.security-notice .notice-content strong[data-v-003f54b4]{display:block;margin-bottom:.25em}.security-notice .notice-content p[data-v-003f54b4]{margin:0;font-size:.85em;opacity:.9;line-height:1.5}.security-notice .notice-content code[data-v-003f54b4]{background:rgba(0,0,0,.3);padding:.1em .3em;border-radius:.25em;font-size:.9em}.preview-vars[data-v-003f54b4]{margin-bottom:1em;padding:1em;background:rgba(0,0,0,.18);border:1px solid hsla(0,0%,100%,.06);border-radius:.75em}.preview-vars-header[data-v-003f54b4]{display:flex;align-items:center;justify-content:space-between;gap:1em;margin-bottom:.5em}.preview-vars-title[data-v-003f54b4]{color:hsla(0,0%,100%,.85);font-size:.95em}.preview-vars-actions[data-v-003f54b4]{display:flex;gap:.5em}.preview-vars-btn[data-v-003f54b4]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.16);color:hsla(0,0%,100%,.75);font-size:.8em;padding:.4em .75em;border-radius:.5em;cursor:pointer;transition:all .2s}.preview-vars-btn[data-v-003f54b4]:hover{border-color:hsla(0,0%,100%,.3);color:hsla(0,0%,100%,.95)}.preview-vars-btn.primary[data-v-003f54b4]{border-color:rgba(139,92,246,.45);color:rgba(196,181,253,.95)}.preview-vars-hint[data-v-003f54b4]{color:hsla(0,0%,100%,.55);font-size:.8em;line-height:1.5;margin-bottom:.5em}.preview-vars-hint code[data-v-003f54b4]{background:rgba(0,0,0,.3);padding:.1em .3em;border-radius:.25em}.preview-vars-error[data-v-003f54b4]{color:#f87171;font-size:.85em;margin-bottom:.5em;white-space:pre-wrap}.preview-vars-editor[data-v-003f54b4]{width:100%;min-height:140px;resize:vertical;background:rgba(0,0,0,.35);color:hsla(0,0%,100%,.9);border:1px solid hsla(0,0%,100%,.12);border-radius:.5em;padding:.75em;font-family:"Fira Code",monospace;font-size:.8em;line-height:1.35;box-sizing:border-box}.preview-vars-editor[data-v-003f54b4]:focus{outline:none;border-color:rgba(139,92,246,.5)}.widgets-list[data-v-003f54b4]{display:flex;flex-direction:column;gap:1em}.widget-card[data-v-003f54b4]{background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;overflow:hidden}.widget-card.expanded[data-v-003f54b4]{border-color:rgba(139,92,246,.3)}.widget-header[data-v-003f54b4]{display:flex;align-items:center;justify-content:space-between;padding:.75em 1em;background:rgba(0,0,0,.2);cursor:pointer}.widget-header[data-v-003f54b4]:hover{background:rgba(0,0,0,.3)}.widget-header .header-left[data-v-003f54b4]{display:flex;align-items:center;gap:.75em}.widget-header .header-right[data-v-003f54b4]{display:flex;align-items:center;gap:.5em}.widget-header .widget-name[data-v-003f54b4]{background:rgba(0,0,0,0);border:none;color:#fff;font-size:1em;padding:.25em .5em;border-radius:.25em}.widget-header .widget-name[data-v-003f54b4]:hover,.widget-header .widget-name[data-v-003f54b4]:focus{background:hsla(0,0%,100%,.1)}.widget-header .position-badge[data-v-003f54b4]{font-size:.75em;padding:.2em .5em;background:rgba(139,92,246,.2);border-radius:.25em;color:#c4b5fd}.widget-header button[data-v-003f54b4]{padding:.4em;background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.5);cursor:pointer;border-radius:.25em}.widget-header button[data-v-003f54b4]:hover{background:hsla(0,0%,100%,.1);color:#fff}.widget-header button.delete-btn[data-v-003f54b4]:hover{color:#f87171}.widget-header button.preview-btn[data-v-003f54b4]:hover{color:#34d399}.widget-body[data-v-003f54b4]{padding:1em;display:flex;flex-direction:column;gap:1em}.form-row[data-v-003f54b4]{display:flex;gap:1em;flex-wrap:wrap}.form-group[data-v-003f54b4]{display:flex;flex-direction:column;gap:.25em}.form-group label[data-v-003f54b4]{font-size:.85em;color:hsla(0,0%,100%,.6)}.form-group.checkbox-group[data-v-003f54b4]{flex-direction:row;align-items:center;gap:.5em}.form-group.checkbox-group label[data-v-003f54b4]{display:flex;align-items:center;gap:.5em;cursor:pointer}.form-group.checkbox-group .hint[data-v-003f54b4]{font-size:.75em;color:#fbbf24}.form-input[data-v-003f54b4],.form-select[data-v-003f54b4]{padding:.5em .75em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;color:#fff;font-size:.9em}.form-input[data-v-003f54b4]:focus,.form-select[data-v-003f54b4]:focus{outline:none;border-color:rgba(139,92,246,.5)}.code-section .code-header[data-v-003f54b4]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5em}.code-section .code-header label[data-v-003f54b4]{font-size:.85em;color:hsla(0,0%,100%,.6)}.code-section .template-btn[data-v-003f54b4]{padding:.3em .6em;background:rgba(96,165,250,.2);border:1px solid rgba(96,165,250,.3);border-radius:.25em;color:#93c5fd;font-size:.75em;cursor:pointer;display:flex;align-items:center;gap:.3em}.code-section .template-btn[data-v-003f54b4]:hover{background:rgba(96,165,250,.3)}.code-editor[data-v-003f54b4]{width:100%;min-height:200px;padding:.75em;background:rgba(0,0,0,.4);border:1px solid hsla(0,0%,100%,.05);border-radius:.25em;color:#a5f3fc;font-family:"Fira Code","Consolas",monospace;font-size:.85em;line-height:1.5;resize:vertical}.code-editor[data-v-003f54b4]:focus{outline:none;border-color:rgba(139,92,246,.3)}.code-editor.css-editor[data-v-003f54b4]{min-height:120px;color:#fbbf24}.code-hint[data-v-003f54b4]{font-size:.75em;color:hsla(0,0%,100%,.4);margin-top:.25em}.code-hint code[data-v-003f54b4]{background:rgba(0,0,0,.3);padding:.1em .3em;border-radius:.2em}.linked-vars-section label[data-v-003f54b4]{display:block;font-size:.85em;color:hsla(0,0%,100%,.6);margin-bottom:.5em}.linked-vars-section .vars-container[data-v-003f54b4]{display:flex;flex-wrap:wrap;gap:.5em;padding:.5em;background:rgba(0,0,0,.2);border-radius:.25em;min-height:40px}.linked-vars-section .var-tag[data-v-003f54b4]{display:flex;align-items:center;gap:.25em;padding:.25em .5em;background:rgba(139,92,246,.2);border-radius:.25em;font-size:.85em;color:#c4b5fd}.linked-vars-section .var-tag button[data-v-003f54b4]{background:none;border:none;color:inherit;cursor:pointer;opacity:.6;font-size:1em;padding:0;line-height:1}.linked-vars-section .var-tag button[data-v-003f54b4]:hover{opacity:1}.linked-vars-section .var-input[data-v-003f54b4]{flex:1;min-width:150px;background:rgba(0,0,0,0);border:none;color:#fff;font-size:.85em}.linked-vars-section .var-input[data-v-003f54b4]:focus{outline:none}.linked-vars-section .var-input[data-v-003f54b4]::placeholder{color:hsla(0,0%,100%,.3)}.validation-result[data-v-003f54b4]{padding:.75em;border-radius:.25em}.validation-result .validation-success[data-v-003f54b4]{display:flex;align-items:center;gap:.5em;color:#34d399}.validation-result .validation-success .warning-count[data-v-003f54b4]{font-size:.85em;color:#fbbf24}.validation-result .validation-error[data-v-003f54b4]{color:#f87171}.validation-result .validation-error ul[data-v-003f54b4]{margin:.5em 0 0 1.5em;padding:0;font-size:.85em}.validation-result .validation-warnings[data-v-003f54b4]{margin-top:.5em;color:#fbbf24}.validation-result .validation-warnings ul[data-v-003f54b4]{margin:0;padding:0 0 0 1.5em;font-size:.85em}.widget-actions[data-v-003f54b4]{display:flex;gap:.75em;padding-top:.5em;border-top:1px solid hsla(0,0%,100%,.05)}.widget-actions button[data-v-003f54b4]{padding:.5em 1em;border-radius:.25em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.85em}.widget-actions .validate-btn[data-v-003f54b4]{background:rgba(251,191,36,.2);border:1px solid rgba(251,191,36,.3);color:#fbbf24}.widget-actions .validate-btn[data-v-003f54b4]:hover{background:rgba(251,191,36,.3)}.widget-actions .preview-btn[data-v-003f54b4]{background:rgba(52,211,153,.2);border:1px solid rgba(52,211,153,.3);color:#34d399}.widget-actions .preview-btn[data-v-003f54b4]:hover{background:rgba(52,211,153,.3)}.empty-hint[data-v-003f54b4]{display:flex;flex-direction:column;align-items:center;gap:1em;padding:3em;color:hsla(0,0%,100%,.3);text-align:center;border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}.empty-hint p[data-v-003f54b4]{margin:0}.empty-hint .add-first-btn[data-v-003f54b4]{padding:.75em 1.5em;background:rgba(139,92,246,.2);border:1px solid rgba(139,92,246,.4);border-radius:.5em;color:#c4b5fd;cursor:pointer}.empty-hint .add-first-btn[data-v-003f54b4]:hover{background:rgba(139,92,246,.3)}.preview-modal[data-v-003f54b4]{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000;padding:2em}.preview-container[data-v-003f54b4]{width:100%;max-width:600px;max-height:80vh;background:#1e1b2e;border-radius:.75em;border:1px solid rgba(139,92,246,.3);overflow:hidden;display:flex;flex-direction:column}.preview-header[data-v-003f54b4]{display:flex;justify-content:space-between;align-items:center;padding:1em;background:rgba(0,0,0,.3);border-bottom:1px solid hsla(0,0%,100%,.05)}.preview-header h3[data-v-003f54b4]{margin:0;font-size:1em;color:#c4b5fd}.preview-header .close-btn[data-v-003f54b4]{background:none;border:none;color:hsla(0,0%,100%,.5);font-size:1.5em;cursor:pointer;line-height:1}.preview-header .close-btn[data-v-003f54b4]:hover{color:#fff}.preview-body[data-v-003f54b4]{flex:1;padding:1em;overflow-y:auto;min-height:200px}.preview-console[data-v-003f54b4]{border-top:1px solid hsla(0,0%,100%,.05)}.preview-console .console-header[data-v-003f54b4]{padding:.5em 1em;background:rgba(0,0,0,.3);font-size:.85em;color:hsla(0,0%,100%,.5)}.preview-console .console-logs[data-v-003f54b4]{max-height:150px;overflow-y:auto;padding:.5em 1em;font-family:"Fira Code",monospace;font-size:.8em}.preview-console .log-entry[data-v-003f54b4]{padding:.25em 0}.preview-console .log-entry.info[data-v-003f54b4]{color:#93c5fd}.preview-console .log-entry.success[data-v-003f54b4]{color:#34d399}.preview-console .log-entry.warning[data-v-003f54b4]{color:#fbbf24}.preview-console .log-entry.error[data-v-003f54b4]{color:#f87171}.preview-console .no-logs[data-v-003f54b4]{color:hsla(0,0%,100%,.3);font-style:italic}@keyframes fadeIn-003f54b4{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.variable-node[data-v-f020a9ba]{--indent:calc(var(--depth,0) * 1.5em)}.node-row[data-v-f020a9ba]{display:flex;align-items:center;gap:.5em;padding:.4em .5em;padding-left:calc(var(--indent) + .5em);border-radius:.25em;transition:background .15s}.node-row[data-v-f020a9ba]:hover{background:hsla(0,0%,100%,.05)}.node-row:hover .node-actions[data-v-f020a9ba]{opacity:1}.toggle-btn[data-v-f020a9ba]{padding:.2em;background:rgba(0,0,0,0);border:none;color:#9ca3af;cursor:pointer;display:flex;align-items:center;justify-content:center}.toggle-btn[data-v-f020a9ba]:hover{color:#fff}.toggle-placeholder[data-v-f020a9ba]{width:1.2em}.key-name[data-v-f020a9ba]{color:#e0e7ff;font-family:"Fira Code",monospace;font-size:.9em}.dynamic-badge[data-v-f020a9ba]{color:#fbbf24;font-family:"Fira Code",monospace;font-size:.9em;font-weight:bold}.type-badge[data-v-f020a9ba]{padding:.15em .4em;border-radius:.2em;font-size:.7em;font-weight:bold;margin-left:.25em}.type-badge.string[data-v-f020a9ba]{background:rgba(96,165,250,.2);color:#60a5fa}.type-badge.int[data-v-f020a9ba]{background:rgba(52,211,153,.2);color:#34d399}.type-badge.boolean[data-v-f020a9ba]{background:rgba(251,191,36,.2);color:#fbbf24}.type-badge.stringlist[data-v-f020a9ba]{background:rgba(244,114,182,.2);color:#f472b6}.comment[data-v-f020a9ba]{color:#6b7280;font-size:.8em;font-style:italic;margin-left:auto;padding-right:1em}.node-actions[data-v-f020a9ba]{display:flex;gap:.25em;opacity:0;transition:opacity .15s;margin-left:auto}.action-btn[data-v-f020a9ba]{padding:.25em;background:rgba(0,0,0,0);border:none;color:#6b7280;cursor:pointer;border-radius:.2em;display:flex;align-items:center;justify-content:center}.action-btn[data-v-f020a9ba]:hover{background:hsla(0,0%,100%,.1)}.action-btn.edit[data-v-f020a9ba]:hover{color:#60a5fa}.action-btn.add[data-v-f020a9ba]:hover{color:#34d399}.action-btn.delete[data-v-f020a9ba]:hover{color:#f87171}.node-children[data-v-f020a9ba]{border-left:1px dashed hsla(0,0%,100%,.1);margin-left:calc(var(--indent) + .75em)}.edit-overlay[data-v-f020a9ba]{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:1000}.edit-modal[data-v-f020a9ba]{background:#1f2937;border:1px solid hsla(0,0%,100%,.1);border-radius:.75em;padding:1.5em;width:90%;max-width:400px}.edit-modal h4[data-v-f020a9ba]{margin:0 0 1em;color:#c4b5fd;font-size:1.1em}.edit-field[data-v-f020a9ba]{margin-bottom:1em}.edit-field label[data-v-f020a9ba]{display:block;font-size:.85em;color:#9ca3af;margin-bottom:.25em}.edit-field input[type=text][data-v-f020a9ba],.edit-field select[data-v-f020a9ba]{width:100%;padding:.5em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;color:#fff;font-size:.9em}.edit-field input[type=text][data-v-f020a9ba]:focus,.edit-field select[data-v-f020a9ba]:focus{outline:none;border-color:#8b5cf6}.edit-field.checkbox-field label[data-v-f020a9ba]{display:flex;align-items:center;gap:.5em;cursor:pointer}.edit-field.checkbox-field label input[type=checkbox][data-v-f020a9ba]{width:auto}.edit-field.checkbox-field label input[type=checkbox][data-v-f020a9ba]:disabled{opacity:.5;cursor:not-allowed}.edit-field.checkbox-field .hint[data-v-f020a9ba]{display:block;font-size:.75em;color:#fbbf24;margin-top:.25em}.edit-field.checkbox-field .hint.warning[data-v-f020a9ba]{color:#f87171}.edit-actions[data-v-f020a9ba]{display:flex;justify-content:flex-end;gap:.5em;margin-top:1.5em}.edit-actions button[data-v-f020a9ba]{padding:.5em 1em;border-radius:.25em;font-size:.9em;cursor:pointer}.edit-actions .cancel-btn[data-v-f020a9ba]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);color:#9ca3af}.edit-actions .cancel-btn[data-v-f020a9ba]:hover{background:hsla(0,0%,100%,.05)}.edit-actions .save-btn[data-v-f020a9ba]{background:#8b5cf6;border:none;color:#fff}.edit-actions .save-btn[data-v-f020a9ba]:hover{background:#7c3aed}
.variables-editor[data-v-3c13ed4d]{animation:fadeIn-3c13ed4d .3s ease}.section-title[data-v-3c13ed4d]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-3c13ed4d]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-3c13ed4d]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-3c13ed4d]:hover{background:rgba(139,92,246,.4)}.info-hint[data-v-3c13ed4d]{display:flex;align-items:flex-start;gap:.5em;padding:.75em 1em;background:rgba(96,165,250,.1);border:1px solid rgba(96,165,250,.2);border-radius:.5em;margin-bottom:1em;font-size:.85em;color:#93c5fd}.info-hint strong[data-v-3c13ed4d]{color:#fbbf24}.variable-tree[data-v-3c13ed4d]{background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em;margin-bottom:1em}.empty-hint[data-v-3c13ed4d]{padding:2em;text-align:center;color:hsla(0,0%,100%,.3);border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em;margin-bottom:1em}.schema-preview[data-v-3c13ed4d]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;overflow:hidden}.schema-preview .preview-header[data-v-3c13ed4d]{display:flex;justify-content:space-between;align-items:center;padding:.5em 1em;background:rgba(0,0,0,.2)}.schema-preview .preview-header h5[data-v-3c13ed4d]{margin:0;font-size:.85em;color:#9ca3af}.schema-preview .copy-btn[data-v-3c13ed4d]{padding:.25em .5em;background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;color:#9ca3af;font-size:.75em;cursor:pointer;display:flex;align-items:center;gap:.25em}.schema-preview .copy-btn[data-v-3c13ed4d]:hover{background:hsla(0,0%,100%,.1);color:#fff}.schema-preview .error-message[data-v-3c13ed4d]{padding:1em;color:#f87171;background:rgba(127,29,29,.2);border-bottom:1px solid hsla(0,0%,100%,.05);white-space:pre-wrap;font-size:.85em}.schema-preview .schema-code[data-v-3c13ed4d]{margin:0;padding:1em;font-family:"Fira Code","Consolas",monospace;font-size:.8em;color:#a5f3fc;white-space:pre-wrap;word-break:break-all;max-height:300px;overflow-y:auto}@keyframes fadeIn-3c13ed4d{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.editor-section[data-v-68371988]{animation:fadeIn .3s ease}.section-title[data-v-68371988]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-68371988]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-68371988]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-68371988]:hover{background:rgba(139,92,246,.4)}.visual-grid[data-v-68371988]{display:grid;grid-template-columns:repeat(auto-fill,minmax(16em,1fr));gap:1.5em}.char-image-item[data-v-68371988],.bg-image-item[data-v-68371988]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em;display:flex;flex-direction:column;gap:.75em;transition:all .3s}.char-image-item[data-v-68371988]:hover,.bg-image-item[data-v-68371988]:hover{background:hsla(0,0%,100%,.06);border-color:hsla(0,0%,100%,.1)}.image-preview[data-v-68371988]{aspect-ratio:16/9;background:#000;border-radius:.25em;overflow:hidden;cursor:pointer;position:relative;border:1px dashed hsla(0,0%,100%,.2)}.image-preview img[data-v-68371988]{width:100%;height:100%;object-fit:cover;transition:transform .3s}.image-preview:hover img[data-v-68371988]{transform:scale(1.05)}.image-preview .no-image[data-v-68371988]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:hsla(0,0%,100%,.2);gap:.5em;transition:color .3s}.image-preview .no-image span[data-v-68371988]{font-size:.8em}.image-preview:hover .no-image[data-v-68371988]{color:hsla(0,0%,100%,.5)}.image-preview.char-preview[data-v-68371988]{aspect-ratio:9/16}.image-preview.bg-preview[data-v-68371988]{aspect-ratio:16/9}.diff-row[data-v-68371988]{display:grid;grid-template-columns:1fr 1fr;gap:.5em}.fallback-row[data-v-68371988]{display:flex;align-items:center;justify-content:space-between;gap:.75em}.fallback-check[data-v-68371988]{display:flex;align-items:center;gap:.5em;font-size:.8em;color:hsla(0,0%,100%,.75)}.pretty-check[data-v-68371988]{position:relative;cursor:pointer;-webkit-user-select:none;user-select:none}.pretty-check input[data-v-68371988]{position:absolute;opacity:0;pointer-events:none}.pretty-check .check-ui[data-v-68371988]{width:1.15em;height:1.15em;border-radius:.3em;background:rgba(0,0,0,.25);border:1px solid hsla(0,0%,100%,.18);display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;transition:.15s ease;box-shadow:0 0 0 0 rgba(139,92,246,0)}.pretty-check .check-ui[data-v-68371988]::after{content:"";width:.55em;height:.35em;border-left:2px solid rgba(0,0,0,0);border-bottom:2px solid rgba(0,0,0,0);transform:translateY(-0.05em) rotate(-45deg);opacity:0;transition:.15s ease}.pretty-check:hover .check-ui[data-v-68371988]{border-color:rgba(139,92,246,.55);background:rgba(139,92,246,.08)}.pretty-check input:focus-visible+.check-ui[data-v-68371988]{box-shadow:0 0 0 2px rgba(139,92,246,.35);border-color:rgba(139,92,246,.7)}.pretty-check input:checked+.check-ui[data-v-68371988]{background:rgba(139,92,246,.25);border-color:rgba(139,92,246,.75)}.pretty-check input:checked+.check-ui[data-v-68371988]::after{border-left-color:#c4b5fd;border-bottom-color:#c4b5fd;opacity:1}.image-meta[data-v-68371988]{display:flex;flex-direction:column;gap:.5em}.image-meta input[data-v-68371988]{width:100%;padding:.5em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;color:#fff;font-size:.85em}.image-meta input[data-v-68371988]:focus{border-color:#8b5cf6;outline:none}.url-input-group[data-v-68371988]{display:flex;gap:.5em}.url-input-group input[data-v-68371988]{flex:1}.hint-badge[data-v-68371988]{font-size:.75em;color:hsla(0,0%,100%,.5);display:flex;align-items:center;gap:.5em;padding:0 .25em;margin-top:-0.25em}.icon-btn[data-v-68371988]{padding:.5em;background:hsla(0,0%,100%,.1);border:none;border-radius:.25em;color:#c4b5fd;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.icon-btn[data-v-68371988]:hover{background:rgba(139,92,246,.3)}.delete-btn[data-v-68371988]{padding:.5em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer;font-size:.75em;text-align:center}.delete-btn.full[data-v-68371988]{width:100%;margin-top:.2em}.delete-btn[data-v-68371988]:hover{background:rgba(239,68,68,.4)}.empty-hint[data-v-68371988]{padding:2em;text-align:center;color:hsla(0,0%,100%,.3);border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}
.editor-section[data-v-7e9125f9]{animation:fadeIn .3s ease;height:100%;display:flex;flex-direction:column}.world-settings-grid[data-v-7e9125f9]{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr;gap:1.5em;flex:1;min-height:0}.world-panel[data-v-7e9125f9]{background:rgba(0,0,0,.2);border-radius:.5em;overflow:hidden;display:flex;flex-direction:column;border:1px solid hsla(0,0%,100%,.05)}.panel-header[data-v-7e9125f9]{display:flex;justify-content:space-between;align-items:center;padding:.75em 1em;border-bottom:1px solid hsla(0,0%,100%,.1);background:rgba(0,0,0,.2)}.panel-header h4[data-v-7e9125f9]{margin:0;font-size:.95em;display:flex;align-items:center;gap:.5em}.panel-header.worldview h4[data-v-7e9125f9]{color:#60a5fa}.panel-header.power h4[data-v-7e9125f9]{color:#f472b6}.panel-header.special h4[data-v-7e9125f9]{color:#fbbf24}.panel-content[data-v-7e9125f9]{flex:1;padding:1em;overflow-y:auto}.world-items[data-v-7e9125f9]{display:flex;flex-direction:column;gap:.75em}.world-card[data-v-7e9125f9]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:.75em}.card-header[data-v-7e9125f9]{display:flex;gap:.5em;margin-bottom:.5em}.card-title-input[data-v-7e9125f9]{flex:1;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:.4em;border-radius:.25em;font-weight:bold}.card-content[data-v-7e9125f9]{width:100%;min-height:6em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);color:#e5e7eb;padding:.5em;border-radius:.25em;resize:vertical}.empty-panel[data-v-7e9125f9]{text-align:center;color:hsla(0,0%,100%,.3);padding:2em;border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}.add-mini-btn[data-v-7e9125f9]{background:hsla(0,0%,100%,.1);color:#fff;border:none;width:1.8em;height:1.8em;border-radius:.25em;cursor:pointer}.add-mini-btn[data-v-7e9125f9]:hover{background:hsla(0,0%,100%,.2)}.mini-delete[data-v-7e9125f9]{width:1.8em;height:1.8em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer}.mini-delete[data-v-7e9125f9]:hover{background:rgba(239,68,68,.4)}
.event-pack-editor[data-v-9062f2fa]{display:flex;height:100%;gap:1em;font-size:.9em;overflow:hidden}.editor-sidebar[data-v-9062f2fa]{width:16em;background:rgba(0,0,0,.3);border-right:1px solid hsla(0,0%,100%,.1);padding:1em;display:flex;flex-direction:column;gap:1.5em;overflow-y:auto;flex-shrink:0}.sidebar-group h3[data-v-9062f2fa]{font-size:.75em;color:hsla(0,0%,100%,.4);text-transform:uppercase;letter-spacing:.1em;margin-bottom:.5em;padding-left:.5em}.sidebar-group button[data-v-9062f2fa]{width:100%;display:flex;align-items:center;gap:.75em;padding:.75em;margin-bottom:.25em;background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.7);border-radius:.5em;cursor:pointer;transition:.2s;text-align:left}.sidebar-group button[data-v-9062f2fa]:hover{background:hsla(0,0%,100%,.05);color:#fff}.sidebar-group button.active[data-v-9062f2fa]{background:rgba(139,92,246,.25);color:#c4b5fd}.count-badge[data-v-9062f2fa]{margin-left:auto;background:rgba(0,0,0,.3);padding:.1em .4em;border-radius:99em;font-size:.8em}.editor-main[data-v-9062f2fa]{flex:1;overflow-y:auto;padding-right:.5em;display:flex;flex-direction:column}
.visual-preview[data-v-651a8ef6]{position:relative;width:100%;height:100%;overflow:hidden;background:#0a0a0f;border-radius:.5em}.background-layer[data-v-651a8ef6]{position:absolute;inset:0;z-index:0}.background-layer .bg-image[data-v-651a8ef6]{width:100%;height:100%;object-fit:cover}.background-layer .bg-gradient[data-v-651a8ef6]{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.8) 0%,rgba(0,0,0,0.3) 30%,transparent 60%)}.character-layer[data-v-651a8ef6]{position:absolute;inset:0;z-index:10;pointer-events:none}.character-layer .char-img[data-v-651a8ef6]{position:absolute;height:80%;width:auto;object-fit:contain;filter:drop-shadow(0 0 20px rgba(0,0,0,0.5))}.hud-layer[data-v-651a8ef6]{position:absolute;top:1em;left:1em;z-index:20}.location-pill[data-v-651a8ef6]{display:flex;align-items:center;gap:.5em;padding:.5em .75em;background:rgba(0,0,0,.6);backdrop-filter:blur(8px);border-radius:9999px;border:1px solid hsla(0,0%,100%,.1);color:#fff}.location-text[data-v-651a8ef6]{display:flex;flex-direction:column;line-height:1.2}.location-text .location-name[data-v-651a8ef6]{font-size:.75em;font-weight:bold;letter-spacing:.1em}.location-text .location-time[data-v-651a8ef6]{font-size:.5em;color:hsla(0,0%,100%,.6)}.dialogue-wrapper[data-v-651a8ef6]{position:absolute;bottom:0;left:0;right:0;z-index:30;padding:1em}.dialogue-box[data-v-651a8ef6]{background:linear-gradient(135deg,rgba(20,20,35,0.95) 0%,rgba(30,30,50,0.9) 100%);backdrop-filter:blur(12px);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;padding:1em;box-shadow:0 -5px 30px rgba(0,0,0,.3)}.speaker-name[data-v-651a8ef6]{font-size:.75em;font-weight:bold;color:#67e8f9;margin-bottom:.5em;padding-bottom:.25em;border-bottom:1px solid rgba(103,232,249,.3)}.dialogue-content p[data-v-651a8ef6]{font-size:.875em;color:hsla(0,0%,100%,.9);line-height:1.6;margin:0}.preview-info[data-v-651a8ef6]{position:absolute;top:1em;right:1em;z-index:40;display:flex;flex-direction:column;gap:.25em;align-items:flex-end}.info-badge[data-v-651a8ef6]{display:flex;align-items:center;gap:.25em;padding:.25em .5em;background:rgba(139,92,246,.8);backdrop-filter:blur(4px);border-radius:.25em;font-size:.625em;color:#fff}.info-badge .diff-name[data-v-651a8ef6]{opacity:.7}.fade-enter-active[data-v-651a8ef6],.fade-leave-active[data-v-651a8ef6]{transition:opacity .3s ease}.fade-enter-from[data-v-651a8ef6],.fade-leave-to[data-v-651a8ef6]{opacity:0}
.workshop-view[data-v-b9e39c94]{position:relative;width:100%;height:100%;padding:1.5em;display:flex;flex-direction:column;z-index:20;overflow:hidden;font-size:.85vw}.hidden-file-input[data-v-b9e39c94]{display:none}.editor-backdrop[data-v-b9e39c94]{position:absolute;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:0}.workshop-header[data-v-b9e39c94]{position:relative;z-index:10;display:flex;align-items:center;gap:1em;margin-bottom:1em}.back-btn[data-v-b9e39c94]{padding:.5em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.05);color:hsla(0,0%,100%,.7);cursor:pointer;transition:all .3s}.back-btn[data-v-b9e39c94]:hover{background:hsla(0,0%,100%,.1)}.title-group[data-v-b9e39c94]{display:flex;align-items:center;gap:.5em}.title-group .title-icon[data-v-b9e39c94]{color:#a78bfa}.title-group h1[data-v-b9e39c94]{font-size:1.25em;font-weight:bold;letter-spacing:.2em;color:#fff}.editor-badge[data-v-b9e39c94]{font-size:.75em;padding:.25em .5em;border-radius:.25em;background:rgba(139,92,246,.5);border:1px solid rgba(167,139,250,.3);color:#c4b5fd}.main-panel[data-v-b9e39c94]{position:relative;z-index:10;flex:1;padding:1.5em;overflow:hidden}.intro-overlay[data-v-b9e39c94]{position:fixed;inset:0;z-index:4000;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;padding:2em}.intro-panel[data-v-b9e39c94]{width:min(720px,92vw);max-height:80vh;overflow:auto;background:rgba(20,25,35,.95);border:1px solid hsla(0,0%,100%,.12);border-radius:12px;box-shadow:0 25px 60px rgba(0,0,0,.7);padding:1.25em 1.25em 1em}.intro-header[data-v-b9e39c94]{display:flex;justify-content:space-between;align-items:center;gap:1em;margin-bottom:.25em}.intro-title[data-v-b9e39c94]{font-size:1.1em;font-weight:700;color:#fff}.intro-close[data-v-b9e39c94]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.15);color:hsla(0,0%,100%,.7);border-radius:8px;padding:.25em .6em;cursor:pointer}.intro-close[data-v-b9e39c94]:hover{color:#fff;border-color:hsla(0,0%,100%,.3)}.intro-sub[data-v-b9e39c94]{color:hsla(0,0%,100%,.65);font-size:.9em;margin-bottom:1em}.intro-content[data-v-b9e39c94]{white-space:pre-wrap;line-height:1.6;color:hsla(0,0%,100%,.85);font-size:.95em}.gallery-view[data-v-b9e39c94]{display:flex;flex-direction:column;height:100%}.gallery-header[data-v-b9e39c94]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5em;flex-wrap:wrap;gap:1em}.header-left[data-v-b9e39c94]{display:flex;align-items:center;gap:1em;flex:1;min-width:0;flex-wrap:wrap}.search-box[data-v-b9e39c94]{position:relative;flex:1;min-width:0;max-width:20em}.search-box .search-icon[data-v-b9e39c94]{position:absolute;left:.75em;top:50%;transform:translateY(-50%);color:hsla(0,0%,100%,.4)}.search-box input[data-v-b9e39c94]{background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:9999px;padding:.5em 1em .5em 2.5em;font-size:.875em;color:#fff;width:100%;outline:none;transition:border-color .3s}.search-box input[data-v-b9e39c94]:focus{border-color:#8b5cf6}.search-box input[data-v-b9e39c94]::placeholder{color:hsla(0,0%,100%,.3)}.filter-tabs[data-v-b9e39c94]{display:flex;gap:.25em;background:rgba(0,0,0,.2);padding:.25em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.05)}.filter-tabs button[data-v-b9e39c94]{padding:.375em 1em;border-radius:9999px;font-size:.75em;font-weight:bold;border:none;background:rgba(0,0,0,0);color:hsla(0,0%,100%,.5);cursor:pointer;transition:all .3s}.filter-tabs button[data-v-b9e39c94]:hover{color:#fff}.filter-tabs button.active[data-v-b9e39c94]{background:#fff;color:#000}.header-right[data-v-b9e39c94]{display:flex;align-items:center;gap:.5em;flex-wrap:wrap}.my-works-toolbar[data-v-b9e39c94]{display:flex;justify-content:flex-end;margin:-0.5em 0 1em}.my-works-btn[data-v-b9e39c94],.downloaded-btn[data-v-b9e39c94]{display:flex;align-items:center;gap:.5em;padding:.5em 1em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.1);background:rgba(0,0,0,0);font-size:.875em;color:hsla(0,0%,100%,.7);cursor:pointer;transition:all .3s}.my-works-btn[data-v-b9e39c94]:hover,.downloaded-btn[data-v-b9e39c94]:hover{background:hsla(0,0%,100%,.05)}.my-works-btn.active[data-v-b9e39c94],.downloaded-btn.active[data-v-b9e39c94]{background:#7c3aed;border-color:#8b5cf6;color:#fff}.downloaded-btn.active[data-v-b9e39c94]{background:#0891b2;border-color:#06b6d4}.upload-dropdown[data-v-b9e39c94]{position:relative}.upload-btn[data-v-b9e39c94]{display:flex;align-items:center;gap:.5em;padding:.5em 1.5em;border-radius:9999px;border:none;background:#fff;color:#000;font-weight:bold;cursor:pointer;box-shadow:0 0 20px hsla(0,0%,100%,.2);transition:all .3s}.upload-btn[data-v-b9e39c94]:hover{background:#e5e7eb}.import-btn[data-v-b9e39c94]{display:flex;align-items:center;gap:.5em;padding:.5em 1.25em;border-radius:9999px;border:1px solid rgba(6,182,212,.6);background:rgba(8,145,178,.12);color:rgba(103,232,249,.95);font-weight:600;cursor:pointer;box-shadow:none;transition:all .25s}.import-btn[data-v-b9e39c94]:hover{background:rgba(8,145,178,.22);border-color:rgba(6,182,212,.9);color:#fff}.dropdown-menu[data-v-b9e39c94]{position:absolute;top:100%;right:0;margin-top:.5em;min-width:10em;background:rgba(30,30,50,.95);backdrop-filter:blur(12px);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;overflow:hidden;z-index:100}.dropdown-menu button[data-v-b9e39c94]{display:flex;align-items:center;gap:.5em;width:100%;padding:.75em 1em;border:none;background:rgba(0,0,0,0);color:#fff;font-size:.875em;cursor:pointer;transition:background .2s}.dropdown-menu button[data-v-b9e39c94]:hover{background:rgba(139,92,246,.3)}.dropdown-menu button[data-v-b9e39c94]:not(:last-child){border-bottom:1px solid hsla(0,0%,100%,.05)}.gallery-grid[data-v-b9e39c94]{flex:1;overflow-y:auto;display:grid;grid-template-columns:repeat(4,1fr);align-content:start;gap:1.5em;padding-bottom:2em;padding-right:.5em}.empty-state[data-v-b9e39c94]{grid-column:1/-1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:4em;color:#6b7280}.empty-state p[data-v-b9e39c94]{font-size:.875em}.editor-view[data-v-b9e39c94]{display:flex;flex-direction:column;height:100%}.editor-container[data-v-b9e39c94]{flex:1;border:2px solid hsla(0,0%,100%,.1);border-radius:.75em;background:rgba(0,0,0,.2);backdrop-filter:blur(12px);display:flex;flex-direction:column;overflow:hidden}.editor-content[data-v-b9e39c94]{flex:1;overflow-y:auto;padding:1.5em}.editor-actions[data-v-b9e39c94]{display:flex;justify-content:center;gap:1em;padding:1em;background:rgba(0,0,0,.4);backdrop-filter:blur(4px);border-top:1px solid hsla(0,0%,100%,.1);flex-wrap:wrap}.editor-actions button[data-v-b9e39c94]{padding:.5em 1.5em;border-radius:9999px;font-size:.75em;cursor:pointer;transition:all .3s}.action-reset[data-v-b9e39c94]{border:1px solid hsla(0,0%,100%,.1);background:rgba(0,0,0,0);color:hsla(0,0%,100%,.5)}.action-reset[data-v-b9e39c94]:hover{background:hsla(0,0%,100%,.05)}.action-submit[data-v-b9e39c94]{background:linear-gradient(135deg,#0891b2 0%,#8b5cf6 100%);border:none;color:#fff;font-weight:bold;box-shadow:0 0 20px rgba(139,92,246,.3)}.action-submit[data-v-b9e39c94]:hover{box-shadow:0 0 30px rgba(139,92,246,.5)}.preview-overlay[data-v-b9e39c94]{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:1000;display:flex;align-items:center;justify-content:center}.preview-modal[data-v-b9e39c94]{position:relative;width:70%;height:70%;border-radius:.75em;overflow:hidden;box-shadow:0 0 50px rgba(0,0,0,.5)}.close-btn[data-v-b9e39c94]{position:absolute;top:1em;right:1em;width:2.5em;height:2.5em;background:rgba(0,0,0,.6);border:1px solid hsla(0,0%,100%,.2);border-radius:50%;color:#fff;font-size:1.25em;cursor:pointer;z-index:10;transition:all .2s}.close-btn[data-v-b9e39c94]:hover{background:rgba(248,113,113,.8)}.autosave-toast[data-v-b9e39c94]{position:absolute;top:5em;left:50%;transform:translateX(-50%);background:rgba(16,185,129,.9);color:#fff;padding:.5em 1em;border-radius:9999px;font-size:.8em;display:flex;align-items:center;gap:.5em;z-index:100;box-shadow:0 4px 6px rgba(0,0,0,.1);pointer-events:none}.upload-overlay[data-v-b9e39c94]{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(4px);z-index:3000;display:flex;align-items:center;justify-content:center;padding:1.5em}.upload-box[data-v-b9e39c94]{width:92%;max-width:440px;padding:1.25em 1.25em 1em;display:flex;flex-direction:column;gap:.9em;border:1px solid rgba(139,92,246,.25)}.upload-header[data-v-b9e39c94]{display:flex;align-items:center;gap:.75em}.upload-header h3[data-v-b9e39c94]{margin:0;font-size:1.05em;color:hsla(0,0%,100%,.95)}.upload-icon[data-v-b9e39c94]{color:rgba(196,181,253,.95)}.upload-stage[data-v-b9e39c94]{color:hsla(0,0%,100%,.8);font-size:.9em;line-height:1.4}.upload-progress[data-v-b9e39c94]{width:100%;height:10px;border-radius:9999px;background:hsla(0,0%,100%,.08);overflow:hidden;border:1px solid hsla(0,0%,100%,.08)}.upload-progress-bar[data-v-b9e39c94]{height:100%;width:0%;background:linear-gradient(90deg,#0891b2 0%,#8b5cf6 60%,#22c55e 100%);transition:width .2s ease}.upload-progress-bar.indeterminate[data-v-b9e39c94]{width:40%;animation:upload-indeterminate-b9e39c94 1.1s ease-in-out infinite}@keyframes upload-indeterminate-b9e39c94{0%{transform:translateX(-120%)}100%{transform:translateX(280%)}}.upload-meta[data-v-b9e39c94]{color:hsla(0,0%,100%,.6);font-size:.8em}.upload-actions[data-v-b9e39c94]{display:flex;justify-content:flex-end}.upload-actions .btn-cancel[data-v-b9e39c94]{padding:.45em 1.1em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.2);background:rgba(0,0,0,0);color:hsla(0,0%,100%,.75);cursor:pointer;transition:all .2s}.upload-actions .btn-cancel[data-v-b9e39c94]:hover:not(:disabled){background:hsla(0,0%,100%,.1);color:#fff}.upload-actions .btn-cancel[data-v-b9e39c94]:disabled{opacity:.5;cursor:not-allowed}.fade-enter-active[data-v-b9e39c94],.fade-leave-active[data-v-b9e39c94]{transition:all .3s ease}.fade-enter-from[data-v-b9e39c94]{opacity:0;transform:translateY(10px)}.fade-leave-to[data-v-b9e39c94]{opacity:0;transform:translateY(-10px)}.dropdown-enter-active[data-v-b9e39c94],.dropdown-leave-active[data-v-b9e39c94]{transition:all .2s ease}.dropdown-enter-from[data-v-b9e39c94],.dropdown-leave-to[data-v-b9e39c94]{opacity:0;transform:translateY(-10px)}.widget-preview-overlay[data-v-b9e39c94]{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:9999;padding:2em}.widget-preview-modal[data-v-b9e39c94]{width:100%;max-width:600px;max-height:80vh;background:#1e1b2e;border-radius:.75em;border:1px solid rgba(139,92,246,.3);overflow:hidden;display:flex;flex-direction:column}.widget-preview-header[data-v-b9e39c94]{display:flex;justify-content:space-between;align-items:center;padding:1em;background:rgba(0,0,0,.3);border-bottom:1px solid hsla(0,0%,100%,.05)}.widget-preview-header h3[data-v-b9e39c94]{margin:0;font-size:1em;color:#c4b5fd}.widget-preview-header .close-btn[data-v-b9e39c94]{background:none;border:none;color:hsla(0,0%,100%,.5);font-size:1.5em;cursor:pointer;line-height:1}.widget-preview-header .close-btn[data-v-b9e39c94]:hover{color:#fff}.widget-preview-body[data-v-b9e39c94]{flex:1;padding:2em;overflow-y:auto;min-height:300px;background:rgba(0,0,0,.3);display:flex;flex-direction:column;align-items:stretch;justify-content:flex-start;gap:1em}.widget-preview-vars[data-v-b9e39c94]{border:1px solid hsla(0,0%,100%,.08);background:rgba(0,0,0,.25);border-radius:.75em;padding:1em}.vars-header[data-v-b9e39c94]{display:flex;align-items:center;justify-content:space-between;gap:1em;margin-bottom:.75em}.vars-title[data-v-b9e39c94]{color:hsla(0,0%,100%,.85);font-size:.9em}.vars-actions[data-v-b9e39c94]{display:flex;gap:.5em}.vars-btn[data-v-b9e39c94]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.18);color:hsla(0,0%,100%,.75);font-size:.8em;padding:.4em .75em;border-radius:.5em;cursor:pointer;transition:all .2s}.vars-btn[data-v-b9e39c94]:hover{border-color:hsla(0,0%,100%,.3);color:hsla(0,0%,100%,.95)}.vars-btn.primary[data-v-b9e39c94]{border-color:rgba(139,92,246,.45);color:rgba(196,181,253,.95)}.vars-error[data-v-b9e39c94]{color:#f87171;font-size:.85em;margin-bottom:.5em;white-space:pre-wrap}.vars-textarea[data-v-b9e39c94]{width:100%;min-height:180px;resize:vertical;background:rgba(0,0,0,.35);color:hsla(0,0%,100%,.9);border:1px solid hsla(0,0%,100%,.12);border-radius:.5em;padding:.75em;font-family:"Fira Code",monospace;font-size:.8em;line-height:1.35;box-sizing:border-box}.vars-textarea[data-v-b9e39c94]:focus{outline:none;border-color:rgba(139,92,246,.5)}.widget-preview-render[data-v-b9e39c94]{flex:1;min-height:0;display:flex;align-items:flex-start;justify-content:center}.widget-error[data-v-b9e39c94]{display:flex;flex-direction:column;align-items:center;gap:1em;padding:2em;color:#f87171;text-align:center}.widget-error pre[data-v-b9e39c94]{margin:0;white-space:pre-wrap;font-size:.85em;text-align:left;max-width:100%}.widget-preview-console[data-v-b9e39c94]{border-top:1px solid hsla(0,0%,100%,.05)}.widget-preview-console .console-header[data-v-b9e39c94]{padding:.5em 1em;background:rgba(0,0,0,.3);font-size:.85em;color:hsla(0,0%,100%,.5)}.widget-preview-console .console-logs[data-v-b9e39c94]{max-height:150px;overflow-y:auto;padding:.5em 1em;font-family:"Fira Code",monospace;font-size:.8em}.widget-preview-console .log-entry[data-v-b9e39c94]{padding:.25em 0}.widget-preview-console .log-entry.info[data-v-b9e39c94]{color:#93c5fd}.widget-preview-console .log-entry.success[data-v-b9e39c94]{color:#34d399}.widget-preview-console .log-entry.warning[data-v-b9e39c94]{color:#fbbf24}.widget-preview-console .log-entry.error[data-v-b9e39c94]{color:#f87171}.widget-preview-console .no-logs[data-v-b9e39c94]{color:hsla(0,0%,100%,.3);font-style:italic}
.dialogue-layer[data-v-21001e54]{position:absolute;left:0;right:0;z-index:30;display:flex;justify-content:center;padding:0 2em;cursor:pointer;transform:translateZ(0);will-change:transform}.dialogue-panel[data-v-21001e54]{position:relative;display:flex;flex-direction:column;background-color:rgba(0,0,0,.6);backdrop-filter:blur(24px);border:1px solid hsla(0,0%,100%,.1);box-shadow:0 20px 50px rgba(0,0,0,.5);border-radius:2em;overflow:visible !important}.char-name-container[data-v-21001e54]{position:absolute;top:-1.5em;left:2.5em;display:flex;align-items:flex-end;gap:.75em}.char-name-box[data-v-21001e54]{background:rgba(0,0,0,.8);border:1px solid hsla(0,0%,100%,.2);padding:.25em 1em;border-radius:.5em;backdrop-filter:blur(10px)}.char-name[data-v-21001e54]{font-size:1.5em;font-weight:bold;color:#fff;letter-spacing:.05em;font-family:"Noto Sans SC",sans-serif}.name-deco-line[data-v-21001e54]{width:3em;height:.25em;background-color:#8b5cf6;margin-bottom:.5em;border-radius:9999px;box-shadow:0 0 10px rgba(139,92,246,.8)}.dialogue-text-wrapper[data-v-21001e54]{flex:1;overflow-y:auto;overflow-x:hidden;margin-bottom:2em}.dialogue-text-wrapper[data-v-21001e54]::-webkit-scrollbar{width:.5em}.dialogue-text-wrapper[data-v-21001e54]::-webkit-scrollbar-track{background:hsla(0,0%,100%,.05);border-radius:.25em}.dialogue-text-wrapper[data-v-21001e54]::-webkit-scrollbar-thumb{background:hsla(0,0%,100%,.2);border-radius:.25em}.dialogue-text-wrapper[data-v-21001e54]::-webkit-scrollbar-thumb:hover{background:hsla(0,0%,100%,.3)}.dialogue-text[data-v-21001e54]{font-size:1.5em;line-height:1.625;color:#f1f5f9;font-weight:500;text-shadow:0 4px 6px -1px rgba(0,0,0,.1);font-family:"Noto Sans SC",sans-serif;margin:0}.seg-psych[data-v-21001e54]{font-style:italic;opacity:.95}.dialogue-controls[data-v-21001e54]{position:absolute;bottom:1em;right:1.5em;display:flex;gap:1em;color:hsla(0,0%,100%,.4)}.control-btn[data-v-21001e54]{background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:.25em;font-size:.75em;text-transform:uppercase;font-weight:bold;letter-spacing:.05em;color:inherit;transition:color .2s}.control-btn.hover-violet[data-v-21001e54]:hover{color:#a78bfa}.control-btn.hover-cyan[data-v-21001e54]:hover{color:#22d3ee}.control-btn.hover-pink[data-v-21001e54]:hover{color:#f472b6}.control-btn.active[data-v-21001e54]{color:#fbbf24;text-shadow:0 0 8px rgba(251,191,36,.5)}.rotate-90[data-v-21001e54]{transform:rotate(90deg)}.rotate-180[data-v-21001e54]{transform:rotate(180deg)}.back-indicator[data-v-21001e54]{position:absolute;bottom:1em;left:1.5em;color:hsla(0,0%,100%,.6);cursor:pointer;transition:color .2s}.back-indicator[data-v-21001e54]:hover{color:#fff}
.error-log-overlay[data-v-1628de53]{position:absolute;inset:0;z-index:2500;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);display:flex;justify-content:center;align-items:center;padding:2em}.error-log-panel[data-v-1628de53]{width:100%;max-width:900px;height:85%;background:rgba(25,25,35,.98);border:1px solid rgba(255,100,100,.2);border-radius:16px;display:flex;flex-direction:column;box-shadow:0 25px 50px rgba(0,0,0,.8);overflow:hidden}.log-header[data-v-1628de53]{padding:1.5em 2em;border-bottom:1px solid rgba(255,100,100,.15);display:flex;justify-content:space-between;align-items:center;background:rgba(239,68,68,.05)}.header-left[data-v-1628de53]{display:flex;align-items:center;gap:1em}.icon-wrapper[data-v-1628de53]{display:flex;align-items:center;justify-content:center;color:#fbbf24}.title[data-v-1628de53]{font-size:1.25em;font-weight:600;color:#fff}.count-badge[data-v-1628de53]{padding:.25em .75em;background:rgba(239,68,68,.2);border:1px solid rgba(239,68,68,.3);border-radius:12px;font-size:.875em;font-weight:600;color:#fca5a5}.close-btn[data-v-1628de53]{background:none;border:none;color:hsla(0,0%,100%,.5);font-size:1.75em;cursor:pointer;transition:color .2s;width:2em;height:2em;display:flex;align-items:center;justify-content:center;border-radius:8px}.close-btn[data-v-1628de53]:hover{color:#fff;background:hsla(0,0%,100%,.05)}.empty-state[data-v-1628de53]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;color:hsla(0,0%,100%,.4)}.empty-state svg[data-v-1628de53]{color:#22c55e;opacity:.6}.empty-state p[data-v-1628de53]{font-size:1.25em;font-weight:500;margin:0}.empty-state .sub-text[data-v-1628de53]{font-size:.875em;opacity:.7}.log-content[data-v-1628de53]{flex:1;overflow-y:auto;padding:1.5em 2em;display:flex;flex-direction:column;gap:1.25em}.error-item[data-v-1628de53]{background:rgba(239,68,68,.03);border:1px solid rgba(239,68,68,.15);border-radius:12px;padding:1.25em;display:flex;flex-direction:column;gap:.75em;transition:all .2s}.error-item[data-v-1628de53]:hover{background:rgba(239,68,68,.06);border-color:rgba(239,68,68,.25)}.error-header[data-v-1628de53]{display:flex;justify-content:space-between;align-items:center;font-size:.875em}.error-index[data-v-1628de53]{padding:.25em .75em;background:rgba(239,68,68,.15);border-radius:6px;font-weight:600;color:#fca5a5;font-family:"Courier New",monospace}.error-time[data-v-1628de53]{color:hsla(0,0%,100%,.5)}.error-message[data-v-1628de53]{color:#fca5a5;font-size:1em;font-weight:500;line-height:1.5}.error-command[data-v-1628de53],.error-details[data-v-1628de53]{display:flex;flex-direction:column;gap:.5em;font-size:.875em}.command-actions[data-v-1628de53]{display:flex;gap:.5em}.mini-btn[data-v-1628de53]{display:inline-flex;align-items:center;gap:.4em;padding:.4em .65em;border-radius:8px;border:1px solid hsla(0,0%,100%,.12);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.85);cursor:pointer;font-size:.8em;transition:all .2s}.mini-btn[data-v-1628de53]:hover{background:hsla(0,0%,100%,.1)}.mini-btn[data-v-1628de53]:disabled{opacity:.45;cursor:not-allowed}.mini-btn.primary[data-v-1628de53]{border-color:rgba(139,92,246,.55);background:rgba(139,92,246,.18)}.mini-btn.primary[data-v-1628de53]:hover{background:rgba(139,92,246,.28)}.reprocess-panel[data-v-1628de53]{padding:1.25em 2em;border-top:1px solid rgba(255,100,100,.12);background:hsla(0,0%,100%,.02);display:flex;flex-direction:column;gap:.75em}.reprocess-title[data-v-1628de53]{display:flex;align-items:center;gap:.5em;color:hsla(0,0%,100%,.9);font-weight:600}.reprocess-desc[data-v-1628de53]{color:hsla(0,0%,100%,.55);font-size:.875em;line-height:1.35}.reprocess-input[data-v-1628de53]{width:100%;min-height:7.5em;resize:vertical;border-radius:12px;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.3);color:hsla(0,0%,100%,.86);padding:.75em;font-family:"Courier New",monospace;font-size:.9em;outline:none}.reprocess-input[data-v-1628de53]:focus{border-color:rgba(139,92,246,.65);box-shadow:0 0 0 3px rgba(139,92,246,.15)}.reprocess-actions[data-v-1628de53]{display:flex;justify-content:flex-end;gap:.6em}.command-label[data-v-1628de53],.details-label[data-v-1628de53]{color:hsla(0,0%,100%,.5);font-size:.875em;font-weight:500}code[data-v-1628de53]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;padding:.75em;color:#a78bfa;font-family:"Courier New",monospace;font-size:.95em;overflow-x:auto;white-space:pre-wrap;word-break:break-all}pre[data-v-1628de53]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;padding:.75em;color:hsla(0,0%,100%,.7);font-family:"Courier New",monospace;font-size:.9em;overflow-x:auto;white-space:pre-wrap;word-break:break-all;margin:0}.log-footer[data-v-1628de53]{padding:1.25em 2em;border-top:1px solid rgba(255,100,100,.15);display:flex;justify-content:space-between;align-items:center;background:rgba(239,68,68,.03)}.btn-clear[data-v-1628de53]{display:flex;align-items:center;gap:.5em;padding:.75em 1.25em;background:rgba(239,68,68,.15);border:1px solid rgba(239,68,68,.25);border-radius:8px;color:#fca5a5;font-size:.875em;font-weight:500;cursor:pointer;transition:all .2s}.btn-clear[data-v-1628de53]:hover{background:rgba(239,68,68,.25);border-color:rgba(239,68,68,.4)}.footer-info[data-v-1628de53]{color:hsla(0,0%,100%,.5);font-size:.875em}.fade-enter-active[data-v-1628de53],.fade-leave-active[data-v-1628de53]{transition:opacity .3s ease}.fade-enter-from[data-v-1628de53],.fade-leave-to[data-v-1628de53]{opacity:0}
.hud-layer[data-v-83a8506e]{position:absolute;top:2.5em;left:2.5em;z-index:20;display:flex;gap:1em;align-items:center}.location-icon-wrapper[data-v-83a8506e]{width:3em;height:3em;border-radius:50%;border:1px solid hsla(0,0%,100%,.2);display:flex;align-items:center;justify-content:center;background-color:rgba(0,0,0,.2);backdrop-filter:blur(4px);color:hsla(0,0%,100%,.5);transition:color .3s,border-color .3s}.group:hover .location-icon-wrapper[data-v-83a8506e]{color:#a78bfa;border-color:#8b5cf6}.location-text[data-v-83a8506e]{font-size:1.875em;font-weight:100;color:#fff;letter-spacing:.2em;text-shadow:0 10px 15px -3px rgba(0,0,0,.1);font-family:"Outfit",sans-serif}.time-text[data-v-83a8506e]{font-size:1em;font-family:monospace;color:#c4b5fd;letter-spacing:.1em;opacity:.8}
.left-sidebar[data-v-3a4a3550]{position:absolute;top:0;left:0;bottom:0;z-index:40;width:2.5em;transition:width .3s ease-out;display:flex;flex-direction:column;justify-content:center;pointer-events:none}.left-sidebar[data-v-3a4a3550]:hover{width:6em}.left-sidebar.open[data-v-3a4a3550]{width:6em}.trigger-area[data-v-3a4a3550]{position:absolute;inset:0;width:3.5em;background:rgba(0,0,0,0);z-index:10;pointer-events:auto}.sidebar-content[data-v-3a4a3550]{height:auto;padding:2em 0;width:5em;transform:translateX(-100%);transition:transform .3s;background-color:rgba(0,0,0,.8);backdrop-filter:blur(24px);border:1px solid hsla(0,0%,100%,.1);border-radius:1em;display:flex;flex-direction:column;gap:1.5em;align-items:center;box-shadow:0 25px 50px -12px rgba(0,0,0,.25);z-index:40;pointer-events:auto}.left-sidebar:hover .sidebar-content[data-v-3a4a3550]{transform:translateX(1em)}.left-sidebar.open .sidebar-content[data-v-3a4a3550]{transform:translateX(1em)}.sidebar-btn[data-v-3a4a3550]{display:flex;flex-direction:column;align-items:center;gap:.25em;width:100%;background:none;border:none;cursor:pointer;color:#9ca3af;transition:color .2s}.sidebar-btn[data-v-3a4a3550]:hover{color:#fff}.sidebar-btn.danger[data-v-3a4a3550]{color:#f87171}.sidebar-btn.danger[data-v-3a4a3550]:hover{color:#fca5a5}.btn-icon-wrapper[data-v-3a4a3550]{padding:.75em;border-radius:.75em;background-color:hsla(0,0%,100%,.05);transition:all .2s;position:relative}.sidebar-btn:hover .btn-icon-wrapper[data-v-3a4a3550]{background-color:#7c3aed;box-shadow:0 0 15px rgba(139,92,246,.5)}.btn-icon-wrapper.danger-bg[data-v-3a4a3550]{background-color:rgba(239,68,68,.1)}.sidebar-btn:hover .btn-icon-wrapper.danger-bg[data-v-3a4a3550]{background-color:rgba(239,68,68,.2);box-shadow:none}.btn-icon-wrapper.error-bg[data-v-3a4a3550]{background-color:rgba(251,191,36,.1)}.sidebar-btn:hover .btn-icon-wrapper.error-bg[data-v-3a4a3550]{background-color:rgba(251,191,36,.2);box-shadow:0 0 15px rgba(251,191,36,.3)}.error-badge[data-v-3a4a3550]{position:absolute;top:-0.25em;right:-0.25em;background:#ef4444;color:#fff;font-size:.625em;font-weight:bold;padding:.2em .4em;border-radius:.5em;min-width:1.5em;text-align:center;box-shadow:0 2px 4px rgba(0,0,0,.3)}.sidebar-btn.has-errors[data-v-3a4a3550]{color:#fbbf24}.sidebar-btn.has-errors[data-v-3a4a3550]:hover{color:#fcd34d}.btn-label[data-v-3a4a3550]{font-size:.625em;font-weight:bold;letter-spacing:.1em}.sidebar-divider[data-v-3a4a3550]{width:2em;height:1px;background-color:hsla(0,0%,100%,.1)}
.perf-overlay[data-v-0bf7f76c]{position:absolute;inset:0;z-index:60;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);backdrop-filter:none;pointer-events:none}.perf-panel[data-v-0bf7f76c]{min-width:22em;max-width:min(48em,92vw);border-radius:16px;padding:1.25em 1.5em;border:1px solid hsla(0,0%,100%,.18);background:rgba(20,20,30,.55);box-shadow:0 20px 60px rgba(0,0,0,.35);color:hsla(0,0%,100%,.92);pointer-events:auto}.perf-text[data-v-0bf7f76c]{font-size:1.1em;line-height:1.7;letter-spacing:.03em;white-space:pre-wrap}.perf-hint[data-v-0bf7f76c]{margin-top:.8em;font-size:.9em;opacity:.65}.effect-rise[data-v-0bf7f76c]{animation:riseIn-0bf7f76c 260ms ease-out}@keyframes riseIn-0bf7f76c{from{transform:translateY(8px);opacity:.6}to{transform:translateY(0);opacity:1}}
.quick-input-orb[data-v-72cea2e8]{position:absolute;right:2em;bottom:2em;z-index:5000;width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,rgba(139,92,246,0.85),rgba(59,130,246,0.75));backdrop-filter:blur(10px);box-shadow:0 4px 20px rgba(0,0,0,.4),0 0 30px rgba(139,92,246,.22);cursor:pointer;transition:width .3s ease,height .3s ease,border-radius .3s ease,background .3s ease,transform .2s ease,box-shadow .2s ease;-webkit-user-select:none;user-select:none;touch-action:none;will-change:transform}.quick-input-orb[data-v-72cea2e8]:hover:not(.expanded){transform:scale(1.1);box-shadow:0 6px 25px rgba(0,0,0,.5),0 0 40px rgba(100,150,255,.5)}.quick-input-orb.dragging[data-v-72cea2e8]{opacity:.8}.quick-input-orb.expanded[data-v-72cea2e8]{width:380px;height:auto;border-radius:12px;background:rgba(18,16,28,.92);border:1px solid hsla(0,0%,100%,.08);box-shadow:0 12px 50px rgba(0,0,0,.65),0 0 0 1px rgba(139,92,246,.12) inset;cursor:default}.orb-icon[data-v-72cea2e8]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.5em;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.3);pointer-events:none}.input-panel[data-v-72cea2e8]{display:flex;flex-direction:column;padding:0;transform-origin:right bottom}.quick-input-panel-enter-active[data-v-72cea2e8],.quick-input-panel-leave-active[data-v-72cea2e8]{transition:opacity .16s ease,transform .18s ease}.quick-input-panel-enter-from[data-v-72cea2e8],.quick-input-panel-leave-to[data-v-72cea2e8]{opacity:0;transform:translateY(10px) scale(0.98)}.quick-input-panel-enter-to[data-v-72cea2e8],.quick-input-panel-leave-from[data-v-72cea2e8]{opacity:1;transform:translateY(0) scale(1)}.panel-header[data-v-72cea2e8]{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;border-bottom:1px solid hsla(0,0%,100%,.1);touch-action:none}.panel-title[data-v-72cea2e8]{font-size:.9em;font-weight:bold;color:hsla(0,0%,100%,.9);letter-spacing:.05em}.panel-drag-handle[data-v-72cea2e8]{cursor:move;-webkit-user-select:none;user-select:none}.panel-close[data-v-72cea2e8]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;color:hsla(0,0%,100%,.5);cursor:pointer;border-radius:4px;background:rgba(0,0,0,0);border:none;padding:0;transition:background .2s,color .2s}.panel-close[data-v-72cea2e8]:hover{background:hsla(0,0%,100%,.1);color:hsla(0,0%,100%,.9)}.textarea-wrapper[data-v-72cea2e8]{padding:10px 15px}.textarea-wrapper textarea[data-v-72cea2e8]{width:100%;min-height:80px;max-height:280px;padding:10px;border:1px solid hsla(0,0%,100%,.15);border-radius:8px;background:rgba(0,0,0,.3);color:#fff;font-size:.9em;resize:none;outline:none;transition:border-color .2s}.textarea-wrapper textarea[data-v-72cea2e8]:focus{border-color:rgba(139,92,246,.55);box-shadow:0 0 0 3px rgba(139,92,246,.14)}.textarea-wrapper textarea[data-v-72cea2e8]::placeholder{color:hsla(0,0%,100%,.4)}.btn-group[data-v-72cea2e8]{display:flex;gap:10px;padding:0 15px 12px}.orb-btn[data-v-72cea2e8]{flex:1;padding:8px 0;text-align:center;font-size:.85em;color:hsla(0,0%,100%,.8);background:hsla(0,0%,100%,.1);border-radius:6px;cursor:pointer;transition:background .2s,color .2s}.orb-btn[data-v-72cea2e8]:hover{background:hsla(0,0%,100%,.2);color:#fff}.orb-btn.primary[data-v-72cea2e8]{background:linear-gradient(135deg,rgba(139,92,246,0.85),rgba(59,130,246,0.8));color:#fff}.orb-btn.primary[data-v-72cea2e8]:hover{background:linear-gradient(135deg,rgba(167,139,250,0.92),rgba(96,165,250,0.9))}.orb-btn.primary.disabled[data-v-72cea2e8]{opacity:.5;cursor:not-allowed;pointer-events:none}.history-list[data-v-72cea2e8]{max-height:200px;overflow-y:auto;border-top:1px solid hsla(0,0%,100%,.1);margin:0 15px 12px;border-radius:0 0 8px 8px}.history-empty[data-v-72cea2e8]{padding:15px;text-align:center;color:hsla(0,0%,100%,.4);font-size:.85em}.history-item[data-v-72cea2e8]{display:flex;align-items:flex-start;gap:10px;padding:10px;border-bottom:1px solid hsla(0,0%,100%,.05);cursor:pointer;transition:background .2s}.history-item[data-v-72cea2e8]:hover{background:hsla(0,0%,100%,.05)}.history-item[data-v-72cea2e8]:last-child{border-bottom:none}.history-time[data-v-72cea2e8]{font-size:.75em;color:hsla(0,0%,100%,.4);white-space:nowrap}.history-content[data-v-72cea2e8]{flex:1;font-size:.85em;color:hsla(0,0%,100%,.8);overflow:hidden;text-overflow:ellipsis;display:-webkit-box;line-clamp:2;-webkit-line-clamp:2;-webkit-box-orient:vertical}.history-delete[data-v-72cea2e8]{width:20px;height:20px;display:flex;align-items:center;justify-content:center;color:hsla(0,0%,100%,.3);cursor:pointer;border-radius:4px;transition:background .2s,color .2s}.history-delete[data-v-72cea2e8]:hover{background:rgba(255,100,100,.2);color:rgba(255,100,100,.9)}
.right-sidebar[data-v-c5ebd980]{position:absolute;top:0;right:0;bottom:0;z-index:40;width:.5em;transition:width .3s ease-out}.right-sidebar[data-v-c5ebd980]:hover{width:var(--open-width)}.right-sidebar.open[data-v-c5ebd980]{width:var(--open-width)}.right-sidebar.measuring[data-v-c5ebd980]{width:var(--open-width)}.trigger-area[data-v-c5ebd980]{position:absolute;top:0;bottom:0;right:0;width:100px;background:rgba(0,0,0,0);z-index:50;pointer-events:auto}.right-sidebar:hover .trigger-area[data-v-c5ebd980],.right-sidebar.open .trigger-area[data-v-c5ebd980],.right-sidebar.measuring .trigger-area[data-v-c5ebd980]{pointer-events:none}.widgets-panel[data-v-c5ebd980]{height:100%;width:max-content;max-width:90vw;transform:translateX(100%);transition:transform .3s;background-color:rgba(0,0,0,.9);backdrop-filter:blur(24px);border-left:1px solid hsla(0,0%,100%,.1);display:flex;flex-direction:column;padding:2em;box-shadow:0 25px 50px -12px rgba(0,0,0,.25);box-sizing:border-box;overflow:hidden}.right-sidebar:hover .widgets-panel[data-v-c5ebd980]{transform:translateX(0)}.right-sidebar.open .widgets-panel[data-v-c5ebd980]{transform:translateX(0)}.right-sidebar.measuring .widgets-panel[data-v-c5ebd980]{transform:translateX(0);opacity:0;pointer-events:none}.widgets-header-row[data-v-c5ebd980]{display:flex;justify-content:space-between;align-items:center;gap:1em;margin-bottom:2em;border-bottom:1px solid hsla(0,0%,100%,.1);padding-bottom:1em}.widgets-header-title[data-v-c5ebd980]{font-size:1.125em;font-weight:bold;color:#fff;letter-spacing:.1em;text-align:right;font-family:"Outfit",sans-serif}.refresh-btn[data-v-c5ebd980]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);color:hsla(0,0%,100%,.8);font-size:.75em;padding:.35em .75em;border-radius:.5em;cursor:pointer;transition:all .2s}.refresh-btn[data-v-c5ebd980]:hover{border-color:hsla(0,0%,100%,.35);color:#fff}.widgets-container[data-v-c5ebd980]{display:flex;flex-direction:column;gap:1.5em;flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;overscroll-behavior:contain}.widget-host[data-v-c5ebd980]{background-color:hsla(0,0%,100%,.05);border-radius:.75em;padding:1em;border:1px solid hsla(0,0%,100%,.1);max-width:100%;min-width:0;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch}.empty-state[data-v-c5ebd980],.missing-state[data-v-c5ebd980]{color:hsla(0,0%,100%,.6);font-size:.85em}
.saveload-overlay[data-v-2470003a]{position:absolute;inset:0;z-index:2000;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:flex;justify-content:center;align-items:center;font-size:.85vw}.saveload-container[data-v-2470003a]{width:90em;height:54em;padding:1.75em;display:flex;flex-direction:column;background:rgba(15,15,25,.95);border:1px solid hsla(0,0%,100%,.1);border-radius:1em;overflow:hidden;box-shadow:0 25px 50px rgba(0,0,0,.5)}.header[data-v-2470003a]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.25em}.header-left[data-v-2470003a]{display:flex;align-items:center;gap:1.25em}.page-title[data-v-2470003a]{margin:0;font-size:1.65em;font-weight:300;letter-spacing:.2em;color:#fff}.mode-switch[data-v-2470003a]{display:flex;gap:.5em;padding:.25em;border-radius:9999px;background:hsla(0,0%,100%,.04);border:1px solid hsla(0,0%,100%,.08)}.mode-btn[data-v-2470003a]{padding:.45em 1.15em;border-radius:9999px;background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.6);cursor:pointer;transition:all .25s}.mode-btn.active[data-v-2470003a]{background:rgba(217,70,239,.18);border:1px solid rgba(217,70,239,.35);color:#f0abfc}.header-actions[data-v-2470003a]{display:flex;align-items:center;gap:.75em}.import-btn[data-v-2470003a]{display:flex;align-items:center;gap:.5em;padding:.5em 1.25em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);color:#f0abfc;font-size:.875em;cursor:pointer;transition:background .3s}.import-btn[data-v-2470003a]:hover{background:hsla(0,0%,100%,.1)}.import-btn.primary[data-v-2470003a]{color:#fff;border-color:rgba(217,70,239,.35);background:rgba(217,70,239,.12)}.close-x[data-v-2470003a]{width:2.2em;height:2.2em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.08);color:hsla(0,0%,100%,.7);cursor:pointer;transition:all .25s}.close-x[data-v-2470003a]:hover{background:hsla(0,0%,100%,.1);color:#fff}.saves-panel[data-v-2470003a]{flex:1;padding:1.75em}.saves-container[data-v-2470003a]{display:flex;flex-direction:column;gap:1.25em;overflow-y:auto;height:100%;padding-right:.75em}.section-title[data-v-2470003a]{margin:.25em 0 .25em;font-size:.95em;letter-spacing:.12em;color:hsla(0,0%,100%,.55)}.system-saves[data-v-2470003a]{display:flex;flex-direction:column;gap:1em;padding-bottom:.25em}.system-save[data-v-2470003a]{opacity:.85}.system-save[data-v-2470003a]:hover{transform:none;border-color:hsla(0,0%,100%,.08);background:rgba(0,0,0,.25)}.slots-col[data-v-2470003a]{display:flex;flex-direction:column;gap:1.1em}.save-slot.empty[data-v-2470003a]{border-style:dashed;border-color:hsla(0,0%,100%,.12)}.slot-index-badge[data-v-2470003a]{position:absolute;right:.6em;bottom:.6em;font-size:.75em;padding:.2em .55em;border-radius:9999px;background:rgba(0,0,0,.35);border:1px solid hsla(0,0%,100%,.12);color:hsla(0,0%,100%,.75);backdrop-filter:blur(6px)}.rename-overlay[data-v-2470003a]{position:absolute;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(3px);z-index:2100;display:flex;align-items:center;justify-content:center}.rename-box[data-v-2470003a]{width:90%;max-width:35em;padding:1.5em;display:flex;flex-direction:column;gap:1em;border:1px solid hsla(0,0%,100%,.12)}.rename-header[data-v-2470003a]{display:flex;align-items:center;gap:.75em}.rename-header h3[data-v-2470003a]{margin:0;color:#fff;font-size:1.2em}.rename-icon[data-v-2470003a]{color:#f0abfc}.rename-desc[data-v-2470003a]{margin:0;color:hsla(0,0%,100%,.75);line-height:1.4}.rename-input[data-v-2470003a]{width:100%;padding:.75em .9em;border-radius:.75em;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.25);color:#fff;outline:none}.rename-input[data-v-2470003a]:focus{border-color:rgba(217,70,239,.5);box-shadow:0 0 0 3px rgba(217,70,239,.15)}.rename-actions[data-v-2470003a]{display:flex;justify-content:flex-end;gap:.75em}.btn-cancel[data-v-2470003a]{padding:.55em 1.25em;border-radius:9999px;background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);color:hsla(0,0%,100%,.75);cursor:pointer}.btn-cancel[data-v-2470003a]:hover{background:hsla(0,0%,100%,.08);color:#fff}.btn-confirm[data-v-2470003a]{padding:.55em 1.25em;border-radius:9999px;background:rgba(217,70,239,.25);border:1px solid rgba(217,70,239,.4);color:#fff;cursor:pointer}.btn-confirm[data-v-2470003a]:hover{background:rgba(217,70,239,.35)}.save-item[data-v-2470003a]{position:relative;display:flex;gap:1.25em;align-items:center;padding:1em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;transition:all .3s}.save-item[data-v-2470003a]:hover{background:rgba(0,0,0,.4);border-color:rgba(217,70,239,.5);transform:translateX(0.5em)}.save-item:hover .save-chapter[data-v-2470003a]{color:#f0abfc}.save-item:hover .save-actions[data-v-2470003a]{opacity:1}.save-thumbnail[data-v-2470003a]{position:relative;width:12em;height:7em;border-radius:.5em;overflow:hidden;flex-shrink:0;border:1px solid hsla(0,0%,100%,.1)}.save-thumbnail img[data-v-2470003a]{width:100%;height:100%;object-fit:cover;opacity:.7;transition:opacity .3s}.save-item:hover .save-thumbnail img[data-v-2470003a]{opacity:1}.thumbnail-overlay[data-v-2470003a]{position:absolute;inset:0;background:linear-gradient(to right,rgba(0,0,0,0.5),transparent)}.slot-badge[data-v-2470003a]{position:absolute;left:.6em;top:.6em;font-size:.75em;padding:.2em .6em;border-radius:9999px;letter-spacing:.08em;backdrop-filter:blur(6px);border:1px solid hsla(0,0%,100%,.12);color:#fff;background:rgba(0,0,0,.35)}.slot-badge.badge-auto[data-v-2470003a]{border-color:rgba(59,130,246,.35);background:rgba(59,130,246,.18)}.slot-badge.badge-cloud[data-v-2470003a]{border-color:rgba(34,197,94,.35);background:rgba(34,197,94,.16)}.slot-badge.badge-manual[data-v-2470003a]{border-color:rgba(217,70,239,.35);background:rgba(217,70,239,.16)}.save-info[data-v-2470003a]{flex:1;min-width:0}.save-header[data-v-2470003a]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.5em;gap:1em}.save-chapter[data-v-2470003a]{font-size:1.15em;font-weight:bold;color:#fff;transition:color .3s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.save-date[data-v-2470003a]{flex-shrink:0;font-size:.75em;font-family:monospace;color:#6b7280;background:rgba(0,0,0,.3);padding:.25em .5em;border-radius:.25em}.save-summary[data-v-2470003a]{font-size:.875em;color:#9ca3af}.save-firstline[data-v-2470003a]{margin:.35em 0 0;font-size:.85em;color:hsla(0,0%,100%,.45);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.save-actions[data-v-2470003a]{display:flex;flex-direction:column;gap:.5em;opacity:.55;transition:opacity .3s}.action-btn[data-v-2470003a]{padding:.5em;border-radius:9999px;background:none;border:none;color:#9ca3af;cursor:pointer;transition:all .3s}.action-btn[data-v-2470003a]:disabled{opacity:.35;cursor:not-allowed}.action-btn.load-btn[data-v-2470003a]:hover{background:#d946ef;color:#fff}.action-btn.overwrite-btn[data-v-2470003a]:hover{background:#a78bfa;color:#fff}.action-btn.export-btn[data-v-2470003a]:hover{background:#3b82f6;color:#fff}.action-btn.delete-btn[data-v-2470003a]:hover{background:#ef4444;color:#fff}.no-saves[data-v-2470003a]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:4em;color:hsla(0,0%,100%,.3)}.no-saves p[data-v-2470003a]{margin:0;font-size:1.25em}.no-saves span[data-v-2470003a]{font-size:.875em;color:hsla(0,0%,100%,.2);text-align:center}.loading-state[data-v-2470003a]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:4em;color:hsla(0,0%,100%,.5)}.loading-state p[data-v-2470003a]{margin:0}.loading-spinner[data-v-2470003a]{width:3em;height:3em;border:.2em solid hsla(0,0%,100%,.1);border-radius:50%;border-top-color:#a78bfa;animation:spin-2470003a 1s ease-in-out infinite}@keyframes spin-2470003a{to{transform:rotate(360deg)}}.placeholder-thumb[data-v-2470003a]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);color:hsla(0,0%,100%,.2)}.footer[data-v-2470003a]{display:flex;justify-content:flex-end;margin-top:1em}.btn-secondary[data-v-2470003a]{padding:.55em 1.25em;border-radius:.75em;background:hsla(0,0%,100%,.06);border:1px solid hsla(0,0%,100%,.1);color:hsla(0,0%,100%,.75);cursor:pointer;transition:background .25s}.btn-secondary[data-v-2470003a]:hover{background:hsla(0,0%,100%,.1);color:#fff}.tabs[data-v-2470003a]{display:flex;gap:.5em;padding:1em 1.5em;border-bottom:1px solid hsla(0,0%,100%,.05)}.tab-btn[data-v-2470003a]{display:flex;align-items:center;gap:.5em;padding:.75em 1.5em;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;color:hsla(0,0%,100%,.6);font-size:.875em;cursor:pointer;transition:all .2s}.tab-btn[data-v-2470003a]:hover{background:hsla(0,0%,100%,.1);color:#fff}.tab-btn.active[data-v-2470003a]{background:rgba(167,139,250,.2);border-color:rgba(167,139,250,.5);color:#c4b5fd}.slots-container[data-v-2470003a]{flex:1;overflow-y:auto;padding:1em 1.5em;display:grid;grid-template-columns:repeat(auto-fill,minmax(20em,1fr));gap:1em;align-content:start}.save-slot[data-v-2470003a]{display:flex;gap:1em;align-items:center;padding:1em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;cursor:pointer;transition:all .2s}.save-slot[data-v-2470003a]:hover{background:rgba(0,0,0,.5);border-color:rgba(167,139,250,.3);transform:translateY(-2px)}.save-slot:hover .slot-actions[data-v-2470003a]{opacity:1}.save-slot.is-selected[data-v-2470003a]{border-color:rgba(167,139,250,.5);background:rgba(167,139,250,.1)}.save-slot.quick-save[data-v-2470003a]{background:linear-gradient(135deg,rgba(34,211,238,0.1),rgba(167,139,250,0.1));border-color:rgba(34,211,238,.3)}.save-slot.quick-save[data-v-2470003a]:hover{border-color:rgba(34,211,238,.5)}.save-slot.empty-slot[data-v-2470003a]{border-style:dashed;border-color:hsla(0,0%,100%,.1)}.save-slot.empty-slot[data-v-2470003a]:hover{border-color:hsla(0,0%,100%,.3)}.slot-icon[data-v-2470003a]{width:3em;height:3em;display:flex;align-items:center;justify-content:center;background:rgba(167,139,250,.2);border-radius:.5em;color:#c4b5fd;flex-shrink:0}.slot-icon.empty[data-v-2470003a]{background:hsla(0,0%,100%,.05);color:hsla(0,0%,100%,.3)}.slot-thumbnail[data-v-2470003a]{position:relative;width:5em;height:3em;border-radius:.375em;overflow:hidden;flex-shrink:0;border:1px solid hsla(0,0%,100%,.1)}.slot-thumbnail img[data-v-2470003a]{width:100%;height:100%;object-fit:cover}.slot-thumbnail .placeholder-thumb[data-v-2470003a]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);color:hsla(0,0%,100%,.2)}.thumbnail-overlay[data-v-2470003a]{position:absolute;inset:0;background:linear-gradient(to right,rgba(0,0,0,0.3),transparent)}.slot-badge[data-v-2470003a]{position:absolute;top:4px;left:4px;padding:2px 6px;border-radius:6px;font-size:.65em;font-weight:600;letter-spacing:.05em;color:#fff;background:rgba(0,0,0,.55)}.badge-auto[data-v-2470003a]{background:linear-gradient(135deg,#22d3ee,#0ea5e9)}.badge-cloud[data-v-2470003a]{background:linear-gradient(135deg,#c084fc,#6366f1)}.badge-manual[data-v-2470003a]{background:linear-gradient(135deg,#f472b6,#f97316)}.slot-info[data-v-2470003a]{flex:1;min-width:0}.slot-info h3[data-v-2470003a]{margin:0 0 .25em 0;font-size:1em;font-weight:500;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.slot-info p[data-v-2470003a]{margin:0;font-size:.75em;color:hsla(0,0%,100%,.5);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.slot-header[data-v-2470003a]{display:flex;justify-content:space-between;align-items:center;gap:.5em}.slot-date[data-v-2470003a]{font-size:.625em;font-family:monospace;color:hsla(0,0%,100%,.4);background:rgba(0,0,0,.3);padding:.25em .5em;border-radius:.25em;flex-shrink:0}.slot-summary[data-v-2470003a]{margin-top:.25em !important}.slot-firstline[data-v-2470003a]{margin-top:.2em !important;color:hsla(0,0%,100%,.55);font-size:.7em;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.slot-actions[data-v-2470003a]{display:flex;gap:.5em;opacity:0;transition:opacity .2s}.action-btn[data-v-2470003a]{padding:.5em;border-radius:.375em;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);color:hsla(0,0%,100%,.6);cursor:pointer;transition:all .2s}.action-btn[data-v-2470003a]:hover{transform:scale(1.1)}.action-btn.load-btn[data-v-2470003a]:hover,.action-btn.overwrite-btn[data-v-2470003a]:hover{background:rgba(167,139,250,.3);border-color:rgba(167,139,250,.5);color:#c4b5fd}.action-btn.delete-btn[data-v-2470003a]:hover{background:rgba(239,68,68,.3);border-color:rgba(239,68,68,.5);color:#fca5a5}.no-saves[data-v-2470003a]{grid-column:1/-1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:3em;color:hsla(0,0%,100%,.3)}.no-saves p[data-v-2470003a]{margin:0;font-size:1.125em}.modal-footer[data-v-2470003a]{display:flex;justify-content:flex-end;gap:1em;padding:1em 1.5em;border-top:1px solid hsla(0,0%,100%,.05);background:rgba(0,0,0,.2)}.btn-secondary[data-v-2470003a]{padding:.75em 1.5em;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;color:hsla(0,0%,100%,.7);font-size:.875em;cursor:pointer;transition:all .2s}.btn-secondary[data-v-2470003a]:hover{background:hsla(0,0%,100%,.1);color:#fff}.fade-scale-enter-active[data-v-2470003a],.fade-scale-leave-active[data-v-2470003a]{transition:all .3s ease}.fade-scale-enter-from[data-v-2470003a],.fade-scale-leave-to[data-v-2470003a]{opacity:0}.fade-scale-enter-from .saveload-container[data-v-2470003a],.fade-scale-leave-to .saveload-container[data-v-2470003a]{transform:scale(0.95)}
.debug-card[data-v-5c1378ba]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;padding:1em;display:flex;flex-direction:column;gap:1em;margin-bottom:2em;transition:opacity .2s}.debug-card.disabled[data-v-5c1378ba]{opacity:.5;pointer-events:none}.debug-card.disabled .card-body[data-v-5c1378ba]{filter:grayscale(0.5)}.disabled-hint[data-v-5c1378ba]{margin-left:auto;font-size:.75em;color:#ef4444;background:rgba(239,68,68,.1);padding:.2em .5em;border-radius:.25em}.card-header[data-v-5c1378ba]{display:flex;align-items:center;gap:.5em;color:#a78bfa;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.5em}.card-title[data-v-5c1378ba]{font-weight:600;font-size:.95em}.card-body[data-v-5c1378ba]{display:flex;flex-direction:column;gap:1em}.debug-textarea[data-v-5c1378ba]{width:100%;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#e5e7eb;padding:.75em;border-radius:.5em;font-family:inherit;resize:vertical}.debug-textarea[data-v-5c1378ba]:focus{outline:1px solid #8b5cf6}.upload-zone[data-v-5c1378ba]{display:flex;gap:.5em;align-items:center;background:rgba(0,0,0,.2);padding:.5em;border-radius:.5em}.input-text[data-v-5c1378ba]{flex:1;background:rgba(0,0,0,0);border:none;color:#fff;padding:.5em;border-bottom:1px solid hsla(0,0%,100%,.2)}.input-text[data-v-5c1378ba]:focus{outline:none;border-color:#8b5cf6}.file-label[data-v-5c1378ba]{cursor:pointer;background:hsla(0,0%,100%,.1);padding:.4em .8em;border-radius:.4em;font-size:.85em;transition:background .2s;white-space:nowrap}.file-label[data-v-5c1378ba]:hover{background:hsla(0,0%,100%,.2)}.action-btn[data-v-5c1378ba]{display:flex;align-items:center;gap:.5em;background:#8b5cf6;color:#fff;border:none;padding:.5em 1em;border-radius:.5em;cursor:pointer;font-weight:500;transition:background .2s}.action-btn[data-v-5c1378ba]:hover:not(:disabled){background:#7c3aed}.action-btn[data-v-5c1378ba]:disabled{opacity:.5;cursor:not-allowed;background:#4b5563}.action-btn.small[data-v-5c1378ba]{padding:.4em .8em;font-size:.85em}.temp-preview[data-v-5c1378ba]{position:relative;width:100px;height:60px;border:1px dashed #8b5cf6;border-radius:4px;overflow:hidden}.temp-preview img[data-v-5c1378ba]{width:100%;height:100%;object-fit:cover}.temp-preview.char-mode[data-v-5c1378ba]{width:60px;height:80px}.temp-preview.char-mode img[data-v-5c1378ba]{object-fit:contain}.preview-tag[data-v-5c1378ba]{position:absolute;bottom:0;right:0;background:#8b5cf6;font-size:8px;padding:1px 3px;color:#fff}.assets-grid[data-v-5c1378ba]{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:.75em;max-height:250px;overflow-y:auto;padding-right:.5em}.asset-item[data-v-5c1378ba]{background:rgba(0,0,0,.2);border-radius:.5em;overflow:hidden;cursor:pointer;transition:transform .2s,box-shadow .2s;border:1px solid rgba(0,0,0,0);position:relative}.asset-item[data-v-5c1378ba]:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.3);border-color:rgba(139,92,246,.3)}.asset-item.active[data-v-5c1378ba]{border-color:#8b5cf6;box-shadow:0 0 0 1px #8b5cf6}.asset-item.char-mode .asset-img-wrapper[data-v-5c1378ba]{aspect-ratio:3/4}.asset-item.char-mode .asset-img-wrapper img[data-v-5c1378ba]{object-fit:contain}.asset-img-wrapper[data-v-5c1378ba]{width:100%;aspect-ratio:16/9;background:#1a1a1a}.asset-img-wrapper img[data-v-5c1378ba]{width:100%;height:100%;object-fit:cover}.asset-info[data-v-5c1378ba]{padding:.4em;display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,.4)}.asset-name[data-v-5c1378ba]{font-size:.75em;color:#cbd5e1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:80%}.delete-btn[data-v-5c1378ba]{background:none;border:none;color:#ef4444;cursor:pointer;font-size:1.1em;line-height:1;padding:0 .2em}.delete-btn[data-v-5c1378ba]:hover{color:#f87171;background:hsla(0,0%,100%,.1);border-radius:2px}.status-bar[data-v-5c1378ba]{position:sticky;bottom:-1em;margin:0 -1em -1em -1em;background:#059669;color:#fff;padding:.5em;text-align:center;font-size:.85em;animation:slideUp-5c1378ba .3s ease}@keyframes slideUp-5c1378ba{from{transform:translateY(100%)}to{transform:translateY(0)}}.section-desc[data-v-5c1378ba]{color:#9ca3af;font-size:.85em;margin-bottom:1em}.highlight-glow[data-v-5c1378ba]{border-color:rgba(139,92,246,.4);background:rgba(139,92,246,.1);margin-bottom:2em}.card-row[data-v-5c1378ba]{display:flex;justify-content:space-between;align-items:center}.setting-info[data-v-5c1378ba]{display:flex;flex-direction:column;gap:.25em}.flex-row[data-v-5c1378ba]{display:flex;align-items:center;gap:.5em;color:#a78bfa;font-weight:600}.setting-hint[data-v-5c1378ba]{font-size:.8em;color:#9ca3af}.toggle-switch[data-v-5c1378ba]{width:44px;height:24px;background:hsla(0,0%,100%,.1);border-radius:12px;padding:2px;cursor:pointer;transition:background .2s;position:relative}.toggle-switch.active[data-v-5c1378ba]{background:#8b5cf6}.toggle-switch.active .toggle-knob[data-v-5c1378ba]{transform:translateX(20px);background:#fff}.toggle-switch .toggle-knob[data-v-5c1378ba]{width:20px;height:20px;background:hsla(0,0%,100%,.5);border-radius:50%;transition:transform .2s,background .2s}.toggle-switch:hover .toggle-knob[data-v-5c1378ba]{background:#fff}
.preview-stage-wrapper[data-v-adbfeaec]{display:flex;flex-direction:column;gap:.75em}.preview-header[data-v-adbfeaec]{display:flex;justify-content:space-between;align-items:center}.preview-label[data-v-adbfeaec]{font-size:.9em;color:#a78bfa;font-weight:500}.preview-stage[data-v-adbfeaec]{position:relative;width:100%;aspect-ratio:16/9;min-height:280px;border-radius:.5em;overflow:hidden;background:#000;border:1px solid hsla(0,0%,100%,.1);isolation:isolate;contain:layout paint}.background-layer[data-v-adbfeaec]{position:absolute;inset:0;z-index:0}.bg-image[data-v-adbfeaec],.bg-placeholder[data-v-adbfeaec]{width:100%;height:100%;object-fit:cover;opacity:.6}.bg-placeholder[data-v-adbfeaec]{background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);opacity:1}.bg-gradient[data-v-adbfeaec]{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.9),transparent,rgba(0,0,0,0.3))}.character-layer[data-v-adbfeaec]{position:absolute;inset:0;z-index:5;pointer-events:none;bottom:15%;transform:translateZ(0)}.char-img[data-v-adbfeaec]{position:absolute;object-fit:contain;object-position:bottom center;filter:drop-shadow(0 5px 20px rgba(0,0,0,0.6)) drop-shadow(0 15px 40px rgba(0,0,0,0.4));transition:left .4s cubic-bezier(0.4,0,0.2,1),bottom .4s cubic-bezier(0.4,0,0.2,1),height .4s cubic-bezier(0.4,0,0.2,1),transform .4s cubic-bezier(0.4,0,0.2,1),opacity .3s ease;will-change:left,bottom,height,transform,opacity}.dynamic-char[data-v-adbfeaec]{left:50%;bottom:0;transform:translateX(-50%);height:60%;animation:char-breathe-adbfeaec 4s ease-in-out infinite}@keyframes char-breathe-adbfeaec{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(-0.5%)}}.char-placeholder[data-v-adbfeaec]{position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;padding-bottom:10%;color:hsla(0,0%,100%,.3);font-size:.7em;gap:.3em}.char-fade-enter-active[data-v-adbfeaec],.char-fade-leave-active[data-v-adbfeaec]{transition:opacity .3s,transform .3s}.char-fade-enter-from[data-v-adbfeaec],.char-fade-leave-to[data-v-adbfeaec]{opacity:0;transform:translateX(-50%) translateY(10px)}.preview-hud[data-v-adbfeaec]{transform:scale(0.6);transform-origin:top left}@media (hover:none)and (pointer:coarse){.preview-stage[data-v-adbfeaec]{backface-visibility:hidden}.char-img[data-v-adbfeaec]{filter:none;transition:none;will-change:auto}.dynamic-char[data-v-adbfeaec]{animation:none}.char-fade-enter-active[data-v-adbfeaec],.char-fade-leave-active[data-v-adbfeaec]{transition:none}[data-v-adbfeaec] .dialogue-layer{transform:none !important;will-change:auto !important}[data-v-adbfeaec] .dialogue-panel,[data-v-adbfeaec] .char-name-box,[data-v-adbfeaec] .location-icon-wrapper{backdrop-filter:none !important}[data-v-adbfeaec] .dialogue-panel{box-shadow:none !important}}@media (hover:none)and (pointer:coarse)and (orientation:landscape){.preview-stage[data-v-adbfeaec]{transform:none}.character-layer[data-v-adbfeaec]{transform:none}}
.settings-section[data-v-69a21231]{display:flex;flex-direction:column;gap:1.5em}@media (hover:none)and (pointer:coarse)and (max-width:900px){.preview-card[data-v-69a21231]{display:none !important}}.section-header[data-v-69a21231]{margin-bottom:.5em}.section-title[data-v-69a21231]{font-size:1.1em;font-weight:600;color:#fff;margin:0 0 .25em 0}.section-desc[data-v-69a21231]{font-size:.85em;color:#9ca3af;margin:0}.sub-tabs[data-v-69a21231]{display:flex;gap:.5em;margin-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.5em}.sub-tab-btn[data-v-69a21231]{background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.5);padding:.5em 1em;border-radius:.5em .5em 0 0;cursor:pointer;font-size:.9em;transition:all .2s;border-bottom:2px solid rgba(0,0,0,0)}.sub-tab-btn[data-v-69a21231]:hover{color:hsla(0,0%,100%,.8);background:hsla(0,0%,100%,.03)}.sub-tab-btn.active[data-v-69a21231]{color:#a78bfa;background:rgba(167,139,250,.1);border-bottom-color:#a78bfa}.debug-card[data-v-69a21231]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;padding:1em;display:flex;flex-direction:column;gap:1em}.preview-card[data-v-69a21231]{padding:1.25em}.card-header[data-v-69a21231]{display:flex;align-items:center;gap:.5em;color:#a78bfa;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.5em}.card-icon[data-v-69a21231]{flex-shrink:0}.card-title[data-v-69a21231]{font-weight:600;font-size:.95em}.card-body[data-v-69a21231]{display:flex;flex-direction:column;gap:1em}.char-selector[data-v-69a21231]{display:flex;align-items:center;gap:1em;padding:.75em;background:rgba(0,0,0,.2);border-radius:.5em}.selector-label[data-v-69a21231]{font-size:.85em;color:#9ca3af}.selector-buttons[data-v-69a21231]{display:flex;gap:.5em}.selector-btn[data-v-69a21231]{background:hsla(0,0%,100%,.1);border:1px solid rgba(0,0,0,0);color:hsla(0,0%,100%,.6);padding:.4em .8em;border-radius:.4em;cursor:pointer;font-size:.8em;transition:all .2s}.selector-btn[data-v-69a21231]:hover{background:hsla(0,0%,100%,.15);color:#fff}.selector-btn.active[data-v-69a21231]{background:#8b5cf6;color:#fff;border-color:#a78bfa}.controls-panel[data-v-69a21231]{display:flex;flex-direction:column;gap:.75em}.control-group-title[data-v-69a21231]{font-size:.8em;color:#a78bfa;font-weight:500;margin-bottom:.25em}.control-row[data-v-69a21231]{display:flex;justify-content:space-between;align-items:center}.control-label[data-v-69a21231]{font-size:.85em;color:#9ca3af}.control-value[data-v-69a21231]{font-size:.85em;color:#a78bfa;font-family:monospace;background:rgba(167,139,250,.1);padding:.1em .4em;border-radius:.25em}.styled-range[data-v-69a21231]{-webkit-appearance:none;appearance:none;width:100%;height:4px;background:hsla(0,0%,100%,.1);border-radius:2px;outline:none;background-image:linear-gradient(#8b5cf6,#8b5cf6);background-size:var(--progress) 100%;background-repeat:no-repeat;cursor:pointer}.styled-range.full[data-v-69a21231]{margin-bottom:.5em}.styled-range[data-v-69a21231]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;height:14px;width:14px;border-radius:50%;background:#fff;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.3);-webkit-transition:transform .1s,box-shadow .1s;transition:transform .1s,box-shadow .1s}.styled-range[data-v-69a21231]:hover::-webkit-slider-thumb{box-shadow:0 0 0 4px rgba(139,92,246,.2)}.dialogue-settings[data-v-69a21231]{display:flex;flex-direction:column;gap:1.5em}.quick-actions[data-v-69a21231]{display:flex;justify-content:flex-end;gap:1em;padding-top:1em;border-top:1px solid hsla(0,0%,100%,.05)}.action-btn[data-v-69a21231]{background:#8b5cf6;color:#fff;border:none;padding:.5em 1em;border-radius:.5em;cursor:pointer;font-size:.9em;transition:background .2s}.action-btn[data-v-69a21231]:hover{background:#7c3aed}.action-btn.outline[data-v-69a21231]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);color:#9ca3af}.action-btn.outline[data-v-69a21231]:hover{background:hsla(0,0%,100%,.05);color:#fff}.highlight-card[data-v-69a21231]{background:linear-gradient(135deg,rgba(255,255,255,0.03) 0%,rgba(139,92,246,0.05) 100%);border:1px solid rgba(139,92,246,.2)}.highlight-card[data-v-69a21231]:hover{border-color:rgba(139,92,246,.4);box-shadow:0 4px 20px rgba(139,92,246,.1)}.hint-card[data-v-69a21231]{display:flex;gap:1em;background:rgba(0,0,0,.2);border:1px dashed hsla(0,0%,100%,.1);padding:1em}.hint-icon[data-v-69a21231]{color:#6b7280;padding-top:.2em}.hint-title[data-v-69a21231]{font-size:.9em;font-weight:600;color:#e5e7eb;margin-bottom:.25em}.hint-text[data-v-69a21231]{font-size:.85em;color:#9ca3af;line-height:1.6}.sub-hint[data-v-69a21231]{display:block;margin-top:.5em;font-style:italic;opacity:.8}.card-header-row[data-v-69a21231]{display:flex;align-items:center;margin-bottom:1em}.spacer[data-v-69a21231]{flex:1}.status-indicator[data-v-69a21231]{display:flex;align-items:center;gap:.5em;font-family:monospace;font-size:.9em;color:#6b7280;transition:color .2s}.status-indicator .status-dot[data-v-69a21231]{width:.5em;height:.5em;border-radius:50%;background-color:#4b5563;transition:background-color .2s,box-shadow .2s}.status-indicator.active[data-v-69a21231]{color:#a78bfa}.status-indicator.active .status-dot[data-v-69a21231]{background-color:#a78bfa;box-shadow:0 0 8px rgba(167,139,250,.6)}.switch[data-v-69a21231]{position:relative;display:inline-block;width:52px;height:28px}.switch input[data-v-69a21231]{opacity:0;width:0;height:0}.slider[data-v-69a21231]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.4);transition:.3s;border-radius:9999px;border:1px solid hsla(0,0%,100%,.1)}.slider[data-v-69a21231]:before{position:absolute;content:"";height:20px;width:20px;left:3px;top:3px;background-color:#9ca3af;transition:.3s cubic-bezier(0.4,0,0.2,1);border-radius:50%}input:checked+.slider[data-v-69a21231]{background-color:rgba(139,92,246,.2);border-color:rgba(139,92,246,.5)}input:checked+.slider[data-v-69a21231]:before{transform:translateX(24px);background-color:#a78bfa;box-shadow:0 0 10px rgba(167,139,250,.5)}
.settings-section[data-v-11e8c394]{padding:0 .5em}.section-header[data-v-11e8c394]{margin-bottom:2em}.section-title[data-v-11e8c394]{font-size:1.5em;font-weight:600;color:#fff;margin-bottom:.5em}.section-desc[data-v-11e8c394]{color:#9ca3af;font-size:.875em;line-height:1.5}.sidebar-layout[data-v-11e8c394]{display:flex;gap:2em;height:calc(100% - 6em);min-height:500px}.config-column[data-v-11e8c394]{flex:1;display:flex;flex-direction:column;gap:1.5em;overflow-y:auto;padding-right:1em}.preview-column[data-v-11e8c394]{flex:1;display:flex;flex-direction:column}.preview-card[data-v-11e8c394]{flex:1;display:flex;flex-direction:column}.card-body.no-padding[data-v-11e8c394]{padding:0;flex:1;position:relative;background:#000}.sidebar-preview__container[data-v-11e8c394]{width:100%;height:100%;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;background-image:radial-gradient(circle at 50% 50%,#2a2a2e 1px,transparent 1px);background-size:20px 20px}.sidebar-preview__viewport[data-v-11e8c394]{width:100%;height:100%;position:relative;overflow:hidden;background:rgba(0,0,0,.5)}.debug-card[data-v-11e8c394]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.75em;overflow:hidden;flex-shrink:0}.card-header[data-v-11e8c394]{display:flex;align-items:center;gap:.75em;padding:1.25em;background:rgba(0,0,0,.3);border-bottom:1px solid hsla(0,0%,100%,.05)}.card-icon[data-v-11e8c394]{color:#a78bfa}.card-title[data-v-11e8c394]{font-size:.875em;font-weight:600;color:#fff}.card-body[data-v-11e8c394]{padding:1.25em}.empty-state[data-v-11e8c394]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2em;color:#9ca3af;text-align:center}.empty-icon[data-v-11e8c394]{margin-bottom:1em;opacity:.5}.empty-hint[data-v-11e8c394]{font-size:.875em;margin-top:.5em}.widget-list[data-v-11e8c394]{display:flex;flex-direction:column;gap:.75em}.widget-item[data-v-11e8c394]{display:flex;align-items:center;gap:1em;padding:1em;background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;cursor:pointer;transition:all .2s}.widget-item[data-v-11e8c394]:hover{background:hsla(0,0%,100%,.06);border-color:hsla(0,0%,100%,.1)}.widget-item.active[data-v-11e8c394]{background:rgba(139,92,246,.1);border-color:rgba(139,92,246,.3)}.widget-checkbox input[type=checkbox][data-v-11e8c394]{width:1.25em;height:1.25em;cursor:pointer}.widget-info[data-v-11e8c394]{flex:1}.widget-name[data-v-11e8c394]{font-size:.9em;font-weight:500;color:#fff;margin-bottom:.25em}.widget-desc[data-v-11e8c394]{font-size:.75em;color:#9ca3af}.order-list[data-v-11e8c394]{display:flex;flex-direction:column;gap:.5em}.order-item[data-v-11e8c394]{display:flex;align-items:center;gap:1em;padding:.75em;background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em}.order-number[data-v-11e8c394]{width:2em;height:2em;display:flex;align-items:center;justify-content:center;background:rgba(139,92,246,.2);border-radius:50%;font-size:.875em;font-weight:bold;color:#a78bfa}.order-name[data-v-11e8c394]{flex:1;font-size:.875em;color:#fff}.order-actions[data-v-11e8c394]{display:flex;gap:.5em}.order-btn[data-v-11e8c394]{width:2em;height:2em;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;cursor:pointer;color:#fff;transition:all .2s}.order-btn[data-v-11e8c394]:hover:not(:disabled){background:hsla(0,0%,100%,.1)}.order-btn[data-v-11e8c394]:disabled{opacity:.3;cursor:not-allowed}.rotate-90[data-v-11e8c394]{transform:rotate(90deg)}.rotate-270[data-v-11e8c394]{transform:rotate(270deg)}.quick-actions[data-v-11e8c394]{display:flex;gap:1em;justify-content:flex-end}.action-btn[data-v-11e8c394]{padding:.75em 1.5em;background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);border-radius:.5em;color:#fff;font-size:.875em;font-weight:500;cursor:pointer;transition:all .2s}.action-btn[data-v-11e8c394]:hover{background:hsla(0,0%,100%,.05);border-color:hsla(0,0%,100%,.3)}.action-btn.outline[data-v-11e8c394]{color:#a78bfa;border-color:#a78bfa}.action-btn.outline[data-v-11e8c394]:hover{background:rgba(167,139,250,.1)}.switch[data-v-11e8c394]{position:relative;display:inline-block;width:52px;height:28px;pointer-events:none}.switch input[data-v-11e8c394]{opacity:0;width:0;height:0}.slider[data-v-11e8c394]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.4);transition:.3s;border-radius:9999px;border:1px solid hsla(0,0%,100%,.1)}.slider[data-v-11e8c394]:before{position:absolute;content:"";height:20px;width:20px;left:3px;top:3px;background-color:#9ca3af;transition:.3s cubic-bezier(0.4,0,0.2,1);border-radius:50%}input:checked+.slider[data-v-11e8c394]{background-color:rgba(139,92,246,.2);border-color:rgba(139,92,246,.5)}input:checked+.slider[data-v-11e8c394]:before{transform:translateX(24px);background-color:#a78bfa;box-shadow:0 0 10px rgba(167,139,250,.5)}.switch.small[data-v-11e8c394]{width:40px;height:22px}.switch.small .slider[data-v-11e8c394]:before{height:16px;width:16px;left:2px;top:2px}.switch.small input:checked+.slider[data-v-11e8c394]:before{transform:translateX(18px)}
.system-tab[data-v-77f1bfd9]{padding:.5em .25em}.tab-title[data-v-77f1bfd9]{margin:0 0 1em 0;font-size:1.1em;font-weight:600;color:#e5e7eb}.setting-group[data-v-77f1bfd9]{display:flex;flex-direction:column;gap:1em}.setting-row[data-v-77f1bfd9]{display:flex;align-items:center;justify-content:space-between;gap:1.25em;padding:1em 1em;border-radius:.75em;border:1px solid hsla(0,0%,100%,.06);background:rgba(0,0,0,.18)}.setting-row.disabled[data-v-77f1bfd9]{opacity:.6}.setting-info[data-v-77f1bfd9]{display:flex;flex-direction:column;gap:.25em}.setting-label[data-v-77f1bfd9]{font-size:.95em;font-weight:600;color:#f3f4f6}.setting-desc[data-v-77f1bfd9]{font-size:.85em;color:hsla(0,0%,100%,.62);line-height:1.35}.number-input[data-v-77f1bfd9]{width:7em;padding:.5em .75em;border-radius:.6em;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.35);color:#e5e7eb;outline:none}.setting-note[data-v-77f1bfd9]{padding:.75em 1em;border-radius:.75em;border:1px dashed hsla(0,0%,100%,.12);color:hsla(0,0%,100%,.6);font-size:.85em;background:rgba(0,0,0,.12)}.switch[data-v-77f1bfd9]{position:relative;display:inline-block;width:44px;height:24px}.switch input[data-v-77f1bfd9]{opacity:0;width:0;height:0}.slider[data-v-77f1bfd9]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,100%,.12);transition:.2s;border-radius:999px}.slider[data-v-77f1bfd9]:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:#c7d2fe;transition:.2s;border-radius:50%}.switch input:checked+.slider[data-v-77f1bfd9]{background-color:rgba(167,139,250,.35)}.switch input:checked+.slider[data-v-77f1bfd9]:before{transform:translateX(20px)}
.settings-section[data-v-3f3e5e2d]{display:flex;flex-direction:column;gap:1.5em}.section-header[data-v-3f3e5e2d]{margin-bottom:.5em}.section-title[data-v-3f3e5e2d]{font-size:1.1em;font-weight:600;color:#fff;margin:0 0 .25em 0}.section-desc[data-v-3f3e5e2d]{font-size:.85em;color:#9ca3af;margin:0}.settings-grid[data-v-3f3e5e2d]{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1.5em;align-items:start}.setting-card[data-v-3f3e5e2d]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;padding:1.25em;display:flex;flex-direction:column;gap:1em;transition:background .2s}.setting-card[data-v-3f3e5e2d]:hover{background:hsla(0,0%,100%,.05)}.full-width-card[data-v-3f3e5e2d]{grid-column:1/-1}.setting-info[data-v-3f3e5e2d]{display:flex;justify-content:space-between;align-items:center}.setting-name[data-v-3f3e5e2d]{color:#e5e7eb;font-size:.95em;font-weight:500;display:flex;align-items:center;gap:.5em}.setting-value[data-v-3f3e5e2d]{color:#a78bfa;font-family:monospace;font-size:.9em;background:rgba(167,139,250,.1);padding:.2em .5em;border-radius:.25em}.setting-control[data-v-3f3e5e2d]{display:flex;align-items:center;gap:1em}.setting-control.wide-control[data-v-3f3e5e2d]{flex:1;width:100%}.range-label[data-v-3f3e5e2d]{font-size:.75em;color:#6b7280;min-width:2em;text-align:center}.range-label.big[data-v-3f3e5e2d]{font-size:1.1em;font-weight:bold;color:#9ca3af}.card-group-title[data-v-3f3e5e2d]{display:flex;align-items:center;gap:.5em;font-weight:600;color:#fff;margin-bottom:.5em;font-size:1em;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.75em}.control-group[data-v-3f3e5e2d]{display:flex;flex-direction:column;gap:1.25em}.setting-row[data-v-3f3e5e2d]{display:flex;flex-direction:column;gap:.5em}.setting-info-compact[data-v-3f3e5e2d]{display:flex;justify-content:space-between;align-items:center}.setting-control.compact[data-v-3f3e5e2d]{gap:0;width:100%}.color-row[data-v-3f3e5e2d]{display:flex;align-items:center;justify-content:space-between}.color-actions[data-v-3f3e5e2d]{display:flex;align-items:center;gap:.5em}.setting-name-compact[data-v-3f3e5e2d]{color:#e5e7eb;font-size:.9em}.color-input.compact[data-v-3f3e5e2d]{width:6em;padding:.25em .5em;font-size:.85em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.12);border-radius:.5em;color:hsla(0,0%,100%,.9);font-family:monospace}.setting-icon[data-v-3f3e5e2d]{color:#a78bfa}.styled-range[data-v-3f3e5e2d]{-webkit-appearance:none;appearance:none;flex:1;height:4px;background:hsla(0,0%,100%,.1);border-radius:2px;outline:none;background-image:linear-gradient(#8b5cf6,#8b5cf6);background-size:var(--progress) 100%;background-repeat:no-repeat;cursor:pointer;margin:0;padding:0;vertical-align:middle}.styled-range[data-v-3f3e5e2d]::-webkit-slider-thumb{-webkit-appearance:none;height:16px;width:16px;border-radius:50%;background:#fff;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.3);-webkit-transition:transform .1s,box-shadow .1s;transition:transform .1s,box-shadow .1s}.styled-range[data-v-3f3e5e2d]:hover::-webkit-slider-thumb{box-shadow:0 0 0 4px rgba(139,92,246,.2)}.styled-range[data-v-3f3e5e2d]:active::-webkit-slider-thumb{transform:scale(1.1);box-shadow:0 0 0 6px rgba(139,92,246,.3)}
.settings-modal-overlay[data-v-40e66e51]{position:absolute;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;background-color:rgba(0,0,0,.8);backdrop-filter:blur(4px)}@media (hover:none)and (pointer:coarse){.settings-modal-overlay[data-v-40e66e51]{backdrop-filter:none}}.settings-modal[data-v-40e66e51]{width:110em;height:60em;background:rgba(30,30,35,.95);border:1px solid hsla(0,0%,100%,.1);border-radius:1em;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 25px 50px -12px rgba(0,0,0,.5)}.settings-header[data-v-40e66e51]{display:flex;justify-content:space-between;align-items:center;padding:1.5em 2em;border-bottom:1px solid hsla(0,0%,100%,.05);background:rgba(0,0,0,.2)}.settings-title[data-v-40e66e51]{display:flex;align-items:center;gap:.75em;font-size:1.1em;font-weight:600;letter-spacing:.1em;color:#fff}.icon-violet[data-v-40e66e51]{color:#a78bfa}.close-btn[data-v-40e66e51]{color:hsla(0,0%,100%,.5);background:none;border:none;cursor:pointer;transition:color .2s}.close-btn[data-v-40e66e51]:hover{color:#fff}.settings-body[data-v-40e66e51]{display:flex;flex:1;overflow:hidden}.settings-sidebar[data-v-40e66e51]{width:14em;border-right:1px solid hsla(0,0%,100%,.05);padding:1.5em 1em;display:flex;flex-direction:column;gap:.5em;background:rgba(0,0,0,.1)}.settings-tab-btn[data-v-40e66e51]{width:100%;text-align:left;padding:.875em 1.25em;border-radius:.5em;font-size:.9em;transition:all .2s;background:none;border:none;cursor:pointer;color:#9ca3af;font-weight:500}.settings-tab-btn[data-v-40e66e51]:hover{background-color:hsla(0,0%,100%,.05);color:#e5e7eb}.settings-tab-btn.active[data-v-40e66e51]{background-color:rgba(139,92,246,.15);color:#c4b5fd;border-left:3px solid #8b5cf6;border-radius:0 .5em .5em 0}.settings-content[data-v-40e66e51]{flex:1;padding:2em 3em;display:flex;flex-direction:column;gap:2em;overflow-y:auto}.settings-section[data-v-40e66e51]{display:flex;flex-direction:column;gap:1.5em}.section-header[data-v-40e66e51]{margin-bottom:.5em}.section-title[data-v-40e66e51]{font-size:1.1em;font-weight:600;color:#fff;margin:0 0 .25em 0}.section-desc[data-v-40e66e51]{font-size:.85em;color:#9ca3af;margin:0}.settings-grid[data-v-40e66e51]{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1.5em;align-items:start}.setting-card[data-v-40e66e51]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;padding:1.25em;display:flex;flex-direction:column;gap:1em;transition:background .2s}.setting-card[data-v-40e66e51]:hover{background:hsla(0,0%,100%,.05)}.full-width-card[data-v-40e66e51]{grid-column:1/-1}.setting-info[data-v-40e66e51]{display:flex;justify-content:space-between;align-items:center}.setting-name[data-v-40e66e51]{color:#e5e7eb;font-size:.95em;font-weight:500;display:flex;align-items:center;gap:.5em}.setting-value[data-v-40e66e51]{color:#a78bfa;font-family:monospace;font-size:.9em;background:rgba(167,139,250,.1);padding:.2em .5em;border-radius:.25em}.setting-control[data-v-40e66e51]{display:flex;align-items:center;gap:1em}.setting-control.wide-control[data-v-40e66e51]{flex:1;width:100%}.range-label[data-v-40e66e51]{font-size:.75em;color:#6b7280;min-width:2em;text-align:center}.range-label.big[data-v-40e66e51]{font-size:1.1em;font-weight:bold;color:#9ca3af}.card-group-title[data-v-40e66e51]{display:flex;align-items:center;gap:.5em;font-weight:600;color:#fff;margin-bottom:.5em;font-size:1em;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.75em}.control-group[data-v-40e66e51]{display:flex;flex-direction:column;gap:1.25em}.setting-row[data-v-40e66e51]{display:flex;flex-direction:column;gap:.5em}.setting-info-compact[data-v-40e66e51]{display:flex;justify-content:space-between;align-items:center}.setting-control.compact[data-v-40e66e51]{gap:0;width:100%}.color-row[data-v-40e66e51]{display:flex;align-items:center;justify-content:space-between}.color-actions[data-v-40e66e51]{display:flex;align-items:center;gap:.5em}.setting-name-compact[data-v-40e66e51]{color:#e5e7eb;font-size:.9em}.color-input.compact[data-v-40e66e51]{width:6em;padding:.25em .5em;font-size:.85em}.setting-icon[data-v-40e66e51]{color:#a78bfa}.styled-range[data-v-40e66e51]{-webkit-appearance:none;appearance:none;flex:1;height:4px;background:hsla(0,0%,100%,.1);border-radius:2px;outline:none;background-image:linear-gradient(#8b5cf6,#8b5cf6);background-size:var(--progress) 100%;background-repeat:no-repeat;cursor:pointer}.styled-range[data-v-40e66e51]::-webkit-slider-thumb{-webkit-appearance:none;height:16px;width:16px;border-radius:50%;background:#fff;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.3);margin-top:-6px;-webkit-transition:transform .1s,box-shadow .1s;transition:transform .1s,box-shadow .1s}.styled-range[data-v-40e66e51]:hover::-webkit-slider-thumb{box-shadow:0 0 0 4px rgba(139,92,246,.2)}.styled-range[data-v-40e66e51]:active::-webkit-slider-thumb{transform:scale(1.1);box-shadow:0 0 0 6px rgba(139,92,246,.3)}.color-input[data-v-40e66e51]{width:9em;padding:.35em .6em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.12);border-radius:.5em;color:hsla(0,0%,100%,.9);font-family:monospace;font-size:.9em}.toggle-switch[data-v-40e66e51]{width:3em;height:1.5em;background-color:#4b5563;border-radius:9999px;position:relative;cursor:pointer;transition:background .2s}.toggle-knob[data-v-40e66e51]{position:absolute;left:.25em;top:.25em;width:1em;height:1em;background-color:#fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2);transition:transform .2s}.debug-panel[data-v-40e66e51]{padding:1em;background-color:rgba(0,0,0,.3);border-radius:.5em;border:1px solid hsla(0,0%,100%,.05);font-family:monospace;font-size:.75em;color:#4ade80}.debug-row[data-v-40e66e51]{display:flex;justify-content:space-between;margin-bottom:.5em}.debug-row[data-v-40e66e51]:last-child{margin-bottom:0}.debug-label[data-v-40e66e51]{color:#6b7280}.debug-controls[data-v-40e66e51]{display:flex;gap:1em;width:100%;flex-wrap:wrap}.debug-textarea[data-v-40e66e51]{flex:1;width:100%;padding:.5em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;color:#fff;resize:vertical;min-height:4em;font-family:inherit}.action-btn[data-v-40e66e51]{background:#8b5cf6;color:#fff;border:none;padding:.5em 1em;border-radius:.5em;cursor:pointer;font-size:.9em;display:flex;align-items:center;justify-content:center}.action-btn[data-v-40e66e51]:hover{background:#7c3aed}.action-btn.outline[data-v-40e66e51]{background:rgba(0,0,0,0);border:1px solid #8b5cf6;color:#a78bfa}.action-btn.outline[data-v-40e66e51]:hover{background:rgba(139,92,246,.1)}.debug-input-text[data-v-40e66e51]{padding:.5em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;color:#fff;width:150px}.preview-label[data-v-40e66e51]{font-size:.8em;color:#9ca3af;margin-bottom:.5em}.file-input[data-v-40e66e51]{color:#a78bfa;font-size:.9em}.preview-box[data-v-40e66e51]{margin-top:1em;width:100%;padding:.5em;background:rgba(0,0,0,.2);border-radius:.5em;text-align:center}.preview-img[data-v-40e66e51]{max-width:100%;max-height:150px;border-radius:.25em}.char-preview[data-v-40e66e51]{max-height:200px;object-fit:contain}
.gaem-overlay[data-v-f60cc848]{position:absolute;inset:0;z-index:120;background:rgba(0,0,0,.55);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;padding:1.5em}.gaem-dialog[data-v-f60cc848]{width:min(94%,1400px);max-height:94%;aspect-ratio:16/9;height:auto;font-size:clamp(12px,.95vw,16px);background:rgba(10,10,15,.92);border:1px solid hsla(0,0%,100%,.12);border-radius:1em;overflow:hidden;box-shadow:0 30px 80px rgba(0,0,0,.45);display:flex;flex-direction:column}.gaem-header[data-v-f60cc848]{display:flex;align-items:center;justify-content:space-between;padding:.9em 1.1em;border-bottom:1px solid hsla(0,0%,100%,.08)}.gaem-title .title[data-v-f60cc848]{font-size:1.05em;color:hsla(0,0%,100%,.92)}.gaem-title .subtitle[data-v-f60cc848]{margin-top:.2em;font-size:.85em;color:hsla(0,0%,100%,.6)}.mono[data-v-f60cc848]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}.gaem-close[data-v-f60cc848]{background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.75);font-size:1.1em;cursor:pointer;padding:.2em .5em}.gaem-toolbar[data-v-f60cc848]{display:flex;gap:1em;align-items:end;padding:.9em 1.1em;border-bottom:1px solid hsla(0,0%,100%,.08)}.field[data-v-f60cc848]{display:flex;flex-direction:column;gap:.35em;flex:1}.label[data-v-f60cc848]{font-size:.8em;color:hsla(0,0%,100%,.65)}.selectbox[data-v-f60cc848]{position:relative}.select-trigger[data-v-f60cc848]{width:100%;height:2.4em;border-radius:.6em;background:hsla(0,0%,100%,.06);border:1px solid hsla(0,0%,100%,.12);color:hsla(0,0%,100%,.9);padding:0 .6em;outline:none;display:flex;align-items:center;justify-content:space-between;gap:.6em;cursor:pointer}.selectbox.disabled .select-trigger[data-v-f60cc848]{opacity:.55;cursor:not-allowed}.select-value[data-v-f60cc848]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.select-chevron[data-v-f60cc848]{opacity:.7;font-size:.95em}.select-menu[data-v-f60cc848]{position:absolute;top:calc(100% + .45em);left:0;right:0;z-index:10;background:rgba(12,12,18,.98);border:1px solid hsla(0,0%,100%,.12);border-radius:.8em;box-shadow:0 20px 60px rgba(0,0,0,.55);padding:.6em}.select-search[data-v-f60cc848]{width:100%;height:2.2em;border-radius:.6em;background:hsla(0,0%,100%,.06);border:1px solid hsla(0,0%,100%,.12);color:hsla(0,0%,100%,.9);padding:0 .6em;outline:none}.select-options[data-v-f60cc848]{margin-top:.55em;max-height:18em;overflow:auto;display:flex;flex-direction:column;gap:.25em}.select-option[data-v-f60cc848]{text-align:left;padding:.55em .6em;border-radius:.6em;border:1px solid rgba(0,0,0,0);background:rgba(0,0,0,0);color:hsla(0,0%,100%,.88);cursor:pointer;display:flex;align-items:baseline;justify-content:space-between;gap:.6em}.select-option[data-v-f60cc848]:hover{background:hsla(0,0%,100%,.08)}.select-option.selected[data-v-f60cc848]{border-color:rgba(139,92,246,.55);background:rgba(139,92,246,.18)}.opt-id[data-v-f60cc848]{font-size:.75em;color:hsla(0,0%,100%,.5);white-space:nowrap}.dropdown-enter-active[data-v-f60cc848],.dropdown-leave-active[data-v-f60cc848]{transition:opacity .12s ease,transform .12s ease}.dropdown-enter-from[data-v-f60cc848],.dropdown-leave-to[data-v-f60cc848]{opacity:0;transform:translateY(-4px)}.actions[data-v-f60cc848]{display:flex;gap:.6em}.btn[data-v-f60cc848]{height:2.4em;padding:0 .9em;border-radius:.7em;border:1px solid hsla(0,0%,100%,.14);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.9);cursor:pointer}.btn[data-v-f60cc848]:disabled{opacity:.45;cursor:not-allowed}.btn.primary[data-v-f60cc848]{border-color:rgba(139,92,246,.55);background:rgba(139,92,246,.22)}.gaem-error[data-v-f60cc848]{padding:.6em 1.1em;color:#fca5a5;font-size:.9em}.gaem-body[data-v-f60cc848]{flex:1;overflow:hidden}.loading[data-v-f60cc848],.empty[data-v-f60cc848]{padding:1.1em;color:hsla(0,0%,100%,.75)}.hint[data-v-f60cc848]{margin-top:.4em;color:hsla(0,0%,100%,.6);font-size:.9em}
.variable-node[data-v-f66727c0]{--indent:calc(var(--depth,0) * 1.5em)}.node-row[data-v-f66727c0]{display:flex;align-items:center;gap:.5em;padding:.4em .5em;padding-left:calc(var(--indent) + .5em);border-radius:.25em;transition:background .15s}.node-row[data-v-f66727c0]:hover{background:hsla(0,0%,100%,.05)}.node-row:hover .node-actions[data-v-f66727c0]{opacity:1}.toggle-btn[data-v-f66727c0]{padding:.2em;background:rgba(0,0,0,0);border:none;color:#9ca3af;cursor:pointer;display:flex;align-items:center;justify-content:center}.toggle-btn[data-v-f66727c0]:hover{color:#fff}.toggle-placeholder[data-v-f66727c0]{width:1.2em}.key-name[data-v-f66727c0]{color:#e0e7ff;font-family:"Fira Code",monospace;font-size:.9em}.type-badge[data-v-f66727c0]{padding:.15em .5em;border-radius:9999px;font-size:.72em;font-weight:600;background:hsla(0,0%,100%,.08);color:hsla(0,0%,100%,.75)}.type-badge.string[data-v-f66727c0]{background:rgba(59,130,246,.15);color:#93c5fd}.type-badge.number[data-v-f66727c0]{background:rgba(16,185,129,.15);color:#6ee7b7}.type-badge.boolean[data-v-f66727c0]{background:rgba(245,158,11,.15);color:#fcd34d}.type-badge.object[data-v-f66727c0],.type-badge.array[data-v-f66727c0]{background:rgba(139,92,246,.15);color:#c4b5fd}.type-badge.null[data-v-f66727c0],.type-badge.undefined[data-v-f66727c0]{background:rgba(239,68,68,.12);color:#fca5a5}.value-preview[data-v-f66727c0]{margin-left:.25em;color:hsla(0,0%,100%,.55);font-size:.85em;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.value-preview.dim[data-v-f66727c0]{color:hsla(0,0%,100%,.35)}.node-actions[data-v-f66727c0]{margin-left:auto;display:flex;gap:.35em;opacity:0;transition:opacity .15s}.action-btn[data-v-f66727c0]{width:1.8em;height:1.8em;border-radius:.5em;border:1px solid hsla(0,0%,100%,.1);background:hsla(0,0%,100%,.04);color:hsla(0,0%,100%,.8);cursor:pointer;display:flex;align-items:center;justify-content:center}.action-btn[data-v-f66727c0]:hover{background:hsla(0,0%,100%,.08)}.action-btn.delete[data-v-f66727c0]{border-color:rgba(239,68,68,.25);color:rgba(252,165,165,.95)}.action-btn.delete[data-v-f66727c0]:hover{background:rgba(239,68,68,.12)}.node-children[data-v-f66727c0]{margin-left:0}.edit-overlay[data-v-f66727c0]{position:absolute;inset:0;z-index:12010;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;padding:2em}.edit-modal[data-v-f66727c0]{width:min(560px,92vw);background:rgba(15,15,25,.94);border:1px solid hsla(0,0%,100%,.12);border-radius:14px;padding:1em 1.25em;color:hsla(0,0%,100%,.9)}.edit-modal h4[data-v-f66727c0]{margin:0 0 .75em;font-size:1.05em}.edit-field[data-v-f66727c0]{display:flex;flex-direction:column;gap:.4em;margin-bottom:.85em}.edit-field label[data-v-f66727c0]{font-size:.85em;color:hsla(0,0%,100%,.6)}.edit-field input[data-v-f66727c0],.edit-field select[data-v-f66727c0],.edit-field textarea[data-v-f66727c0]{border-radius:10px;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.35);color:hsla(0,0%,100%,.9);padding:.65em .75em;font-family:"Fira Code",monospace;font-size:.9em}.edit-field input[data-v-f66727c0]:focus,.edit-field select[data-v-f66727c0]:focus,.edit-field textarea[data-v-f66727c0]:focus{outline:none;border-color:rgba(139,92,246,.65);box-shadow:0 0 0 3px rgba(139,92,246,.15)}.edit-field textarea.json[data-v-f66727c0]{min-height:160px;resize:vertical;font-family:"Fira Code",monospace}.edit-field .hint[data-v-f66727c0]{font-size:.8em;color:hsla(0,0%,100%,.45)}.preset-row[data-v-f66727c0]{display:flex;flex-wrap:wrap;gap:.45em;margin-bottom:.1em}.preset-btn[data-v-f66727c0]{padding:.35em .75em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.12);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.85);cursor:pointer;font-size:.85em}.preset-btn[data-v-f66727c0]:hover{background:hsla(0,0%,100%,.1)}.mono[data-v-f66727c0]{font-family:"Fira Code",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}.edit-actions[data-v-f66727c0]{display:flex;justify-content:flex-end;gap:.75em}.edit-actions button[data-v-f66727c0]{padding:.55em 1em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.12);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.9);cursor:pointer}.edit-actions button[data-v-f66727c0]:hover{background:hsla(0,0%,100%,.1)}.edit-actions .save-btn[data-v-f66727c0]{border-color:rgba(139,92,246,.6);background:rgba(139,92,246,.2)}.edit-actions .save-btn[data-v-f66727c0]:hover{background:rgba(139,92,246,.28)}.edit-actions .cancel-btn[data-v-f66727c0]{color:hsla(0,0%,100%,.75)}
.vem-overlay[data-v-64042a02]{position:absolute;inset:0;z-index:9999;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;padding:2em}.vem-dialog[data-v-64042a02]{position:relative;width:min(94%,1400px);max-height:94%;aspect-ratio:16/9;height:auto;font-size:clamp(12px,.95vw,16px);background:rgba(15,15,25,.92);border:1px solid hsla(0,0%,100%,.12);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.55);display:flex;flex-direction:column;overflow:hidden}.vem-header[data-v-64042a02]{display:flex;align-items:center;justify-content:space-between;padding:1em 1.25em;border-bottom:1px solid hsla(0,0%,100%,.08)}.vem-title .title[data-v-64042a02]{font-size:1.1em;font-weight:700;color:hsla(0,0%,100%,.92)}.vem-title .subtitle[data-v-64042a02]{margin-top:.25em;font-size:.9em;color:hsla(0,0%,100%,.55)}.vem-title .subtitle .sep[data-v-64042a02]{margin:0 .5em}.mono[data-v-64042a02]{font-family:"Fira Code",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}.vem-close[data-v-64042a02]{width:2.25em;height:2.25em;border-radius:.6em;border:1px solid hsla(0,0%,100%,.12);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.85);cursor:pointer}.vem-close[data-v-64042a02]:hover{background:hsla(0,0%,100%,.1)}.vem-toolbar[data-v-64042a02]{display:flex;justify-content:space-between;align-items:center;padding:.75em 1.25em;gap:1em;border-bottom:1px solid hsla(0,0%,100%,.06)}.vem-toolbar .left[data-v-64042a02],.vem-toolbar .right[data-v-64042a02]{display:flex;gap:.5em;align-items:center}.btn[data-v-64042a02]{padding:.55em .9em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.12);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.9);cursor:pointer;transition:all .2s}.btn[data-v-64042a02]:hover{background:hsla(0,0%,100%,.1)}.btn[data-v-64042a02]:disabled{opacity:.5;cursor:not-allowed}.btn.primary[data-v-64042a02]{border-color:rgba(139,92,246,.6);background:rgba(139,92,246,.2)}.btn.primary[data-v-64042a02]:hover{background:rgba(139,92,246,.28)}.vem-error[data-v-64042a02]{padding:.75em 1.25em;color:#fca5a5;border-bottom:1px solid hsla(0,0%,100%,.06);background:rgba(239,68,68,.08)}.vem-body[data-v-64042a02]{flex:1;min-height:0;display:flex;padding:1em 1.25em 1.25em}.loading[data-v-64042a02]{color:hsla(0,0%,100%,.7)}.tree-wrap[data-v-64042a02]{flex:1;min-height:0;display:grid;grid-template-columns:1fr .9fr;gap:1em}.info-hint[data-v-64042a02]{grid-column:1/-1;padding:.75em .9em;border:1px solid hsla(0,0%,100%,.08);border-radius:12px;background:hsla(0,0%,100%,.04);color:hsla(0,0%,100%,.7);font-size:.9em}.tree-view[data-v-64042a02]{min-height:0;overflow:auto;border-radius:12px;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.25);padding:.5em .25em}.json-preview[data-v-64042a02]{min-height:0;overflow:auto;border-radius:12px;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.25);padding:.75em}.preview-header[data-v-64042a02]{display:flex;align-items:center;justify-content:space-between;gap:.75em;margin-bottom:.5em}.preview-title[data-v-64042a02]{font-size:.95em;font-weight:700;color:hsla(0,0%,100%,.85)}.schema-code[data-v-64042a02]{margin:0;white-space:pre-wrap;word-break:break-word;font-family:"Fira Code",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:.85em;line-height:1.35;color:hsla(0,0%,100%,.8)}.fade-enter-active[data-v-64042a02],.fade-leave-active[data-v-64042a02]{transition:opacity .18s ease}.fade-enter-from[data-v-64042a02],.fade-leave-to[data-v-64042a02]{opacity:0}
.main-game-view[data-v-e3e15e94]{position:absolute;inset:0;width:var(--stable-vw,100%);height:var(--stable-vh,100%);overflow:hidden;background-color:#000;-webkit-user-select:none;user-select:none;font-family:sans-serif;font-size:.85vw;color:#fff;line-height:normal}[data-v-e3e15e94] input,[data-v-e3e15e94] textarea,[data-v-e3e15e94] button{font-family:inherit;font-size:inherit}.background-layer[data-v-e3e15e94]{position:absolute;inset:0;z-index:0;display:flex;align-items:center;justify-content:center;background-color:#000;overflow:hidden}.bg-frame[data-v-e3e15e94]{position:relative;width:100%;height:100%;aspect-ratio:16/9;max-width:calc(var(--stable-vh,100vh)*16/9);max-height:56.25vw;overflow:hidden}.bg-image[data-v-e3e15e94]{width:100%;height:100%;object-fit:cover;object-position:center;opacity:.6;transition:transform 20s linear;transform:scale(1.05)}.bg-image[data-v-e3e15e94]:hover{transform:scale(1)}.bg-gradient[data-v-e3e15e94]{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.9),transparent,rgba(0,0,0,0.3))}.character-layer[data-v-e3e15e94]{position:absolute;inset:0;z-index:5;pointer-events:none;bottom:15%;transform:translateZ(0)}.char-img[data-v-e3e15e94]{position:absolute;object-fit:contain;object-position:bottom center;filter:drop-shadow(0 5px 20px rgba(0,0,0,0.6)) drop-shadow(0 15px 40px rgba(0,0,0,0.4));transition:left .4s cubic-bezier(0.4,0,0.2,1),bottom .4s cubic-bezier(0.4,0,0.2,1),height .4s cubic-bezier(0.4,0,0.2,1),transform .4s cubic-bezier(0.4,0,0.2,1),opacity .3s ease}.dynamic-char[data-v-e3e15e94]{left:50%;bottom:0;transform:translateX(-50%);height:75%;animation:char-breathe-e3e15e94 4s ease-in-out infinite}@keyframes char-breathe-e3e15e94{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(-0.5%)}}@media (hover:none)and (pointer:coarse)and (max-width:1024px){.bg-image[data-v-e3e15e94]{transition:none !important;transform:none !important}.dynamic-char[data-v-e3e15e94]{animation:none !important}.char-img[data-v-e3e15e94]{filter:drop-shadow(0 4px 14px rgba(0,0,0,0.45)) !important}}.big-guy[data-v-e3e15e94]{left:10%;height:calc(var(--stable-vh,100vh)*.8);filter:brightness(0.75) drop-shadow(0 10px 30px rgba(0,0,0,0.8))}.anime-girl[data-v-e3e15e94]{right:15%;height:calc(var(--stable-vh,100vh)*.85)}.fade-scale-enter-active[data-v-e3e15e94],.fade-scale-leave-active[data-v-e3e15e94]{transition:opacity .3s,transform .3s}.fade-scale-enter-from[data-v-e3e15e94],.fade-scale-leave-to[data-v-e3e15e94]{opacity:0;transform:scale(0.95)}.slide-left-enter-active[data-v-e3e15e94],.slide-left-leave-active[data-v-e3e15e94]{transition:opacity 1s,transform 1s}.slide-left-enter-from[data-v-e3e15e94]{opacity:0;transform:translateX(-50px)}.slide-right-enter-active[data-v-e3e15e94],.slide-right-leave-active[data-v-e3e15e94]{transition:opacity 1s,transform 1s;transition-delay:.2s}.slide-right-enter-from[data-v-e3e15e94]{opacity:0;transform:translateX(50px)}.fade-enter-active[data-v-e3e15e94],.fade-leave-active[data-v-e3e15e94]{transition:opacity .3s ease}.fade-enter-from[data-v-e3e15e94],.fade-leave-to[data-v-e3e15e94]{opacity:0}.temp-message[data-v-e3e15e94]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:12050;padding:1em 2em;border-radius:12px;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);color:hsla(0,0%,100%,.9);font-size:1em;font-weight:500;letter-spacing:.05em;box-shadow:0 8px 32px rgba(0,0,0,.4);border:1px solid hsla(0,0%,100%,.1);pointer-events:none}.temp-message.success[data-v-e3e15e94]{border-color:rgba(100,200,150,.3);background:rgba(20,40,30,.9)}.log-overlay[data-v-e3e15e94]{position:absolute;inset:0;z-index:2000;background:rgba(0,0,0,.7);backdrop-filter:blur(5px);display:flex;justify-content:center;align-items:center}.log-panel[data-v-e3e15e94]{width:80%;max-width:800px;height:80%;background:rgba(20,25,35,.95);border:1px solid hsla(0,0%,100%,.1);border-radius:12px;display:flex;flex-direction:column;box-shadow:0 20px 50px rgba(0,0,0,.8)}.log-header[data-v-e3e15e94]{padding:15px 20px;border-bottom:1px solid hsla(0,0%,100%,.1);display:flex;justify-content:space-between;align-items:center;font-size:1.2em;font-weight:bold;color:#fff}.close-btn[data-v-e3e15e94]{background:none;border:none;color:hsla(0,0%,100%,.5);font-size:1.5em;cursor:pointer;transition:color .2s}.close-btn[data-v-e3e15e94]:hover{color:#fff}.log-content[data-v-e3e15e94]{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:15px}.log-item[data-v-e3e15e94]{display:flex;flex-direction:column;gap:5px;padding:10px;border-bottom:1px solid hsla(0,0%,100%,.05);border-radius:6px;transition:background .2s}.log-item.clickable[data-v-e3e15e94]{cursor:pointer}.log-item.clickable[data-v-e3e15e94]:hover{background:hsla(0,0%,100%,.05)}.log-item[data-v-e3e15e94]:last-child{border-bottom:none}.log-item-header[data-v-e3e15e94]{display:flex;justify-content:space-between;align-items:center}.log-jump-btn[data-v-e3e15e94]{display:flex;align-items:center;gap:.4em;background:rgba(139,92,246,.1);border:1px solid rgba(139,92,246,.3);color:#a78bfa;font-size:.75em;padding:.25em .6em;border-radius:.3em;cursor:pointer;opacity:.7;transition:all .2s}.log-jump-btn[data-v-e3e15e94]:hover{opacity:1;background:rgba(139,92,246,.2);transform:translateY(-1px)}.log-name[data-v-e3e15e94]{font-size:.9em;color:#a78bfa;font-weight:bold}.log-text[data-v-e3e15e94]{font-size:1em;color:hsla(0,0%,100%,.9);line-height:1.5;white-space:pre-wrap}.exit-confirm-overlay[data-v-e3e15e94]{position:absolute;inset:0;z-index:3000;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:flex;justify-content:center;align-items:center}.exit-confirm-dialog[data-v-e3e15e94]{background:rgba(20,25,35,.95);border:1px solid hsla(0,0%,100%,.1);border-radius:1em;padding:2em;text-align:center;max-width:400px;box-shadow:0 25px 50px rgba(0,0,0,.5)}.exit-confirm-dialog .dialog-icon[data-v-e3e15e94]{color:#fbbf24;margin-bottom:1em}.exit-confirm-dialog h3[data-v-e3e15e94]{margin:0 0 .75em 0;font-size:1.25em;font-weight:500;color:#fff}.exit-confirm-dialog p[data-v-e3e15e94]{margin:0 0 1.5em 0;font-size:.9em;color:hsla(0,0%,100%,.7);line-height:1.6}.dialog-actions[data-v-e3e15e94]{display:flex;gap:1em;justify-content:center}.dialog-actions button[data-v-e3e15e94]{padding:.75em 1.5em;border-radius:.5em;font-size:.875em;cursor:pointer;transition:all .2s}.dialog-actions .btn-cancel[data-v-e3e15e94]{background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);color:hsla(0,0%,100%,.7)}.dialog-actions .btn-cancel[data-v-e3e15e94]:hover{background:hsla(0,0%,100%,.1);color:#fff}.dialog-actions .btn-confirm[data-v-e3e15e94]{background:rgba(239,68,68,.2);border:1px solid rgba(239,68,68,.3);color:#fca5a5}.dialog-actions .btn-confirm[data-v-e3e15e94]:hover{background:rgba(239,68,68,.3);border-color:rgba(239,68,68,.5)}
</style></head><body><div id="app"></div></body>