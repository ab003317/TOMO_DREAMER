<head><script>if(window.opener&&window.location.search.includes("code=")){const o=new URLSearchParams(window.location.search).get("code");o&&(window.opener.postMessage({type:"discord-auth-code",code:o},"*"),window.close(),document.write("Authentication successful. Closing window..."),window.stop())}</script><script type="module">import{default as e}from'https://testingcf.jsdelivr.net/npm/html2canvas/+esm';import{default as t}from'https://testingcf.jsdelivr.net/npm/axios/+esm';import{compile as a}from'https://testingcf.jsdelivr.net/npm/@vue/compiler-dom/+esm';var n={374:(e,t,a)=>{a.d(t,{An:()=>v,RV:()=>f,WC:()=>N,getAllBackgroundImages:()=>h,getAllCharacterImages:()=>k,w7:()=>c,wO:()=>E,xg:()=>y,zP:()=>i});var n=a(894);a(514);function o(e){return'string'==typeof e?e:''}function l(e){return{eventPackId:o(e?.eventPackId),eventPackName:o(e?.eventPackName),backgroundImages:Array.isArray(e?.backgroundImages)?e.backgroundImages.map((e,t)=>({id:o(e?.id)||`bg_${t}`,name:o(e?.name),imageUrl:o(e?.imageUrl)})).filter(e=>!!e.imageUrl):[],characterImages:Array.isArray(e?.characterImages)?e.characterImages.map((e,t)=>({id:o(e?.id)||`char_${t}`,characterName:o(e?.characterName),imageUrl:o(e?.imageUrl),expression:o(e?.expression),outfit:o(e?.outfit),isFallback:!!e?.isFallback})).filter(e=>!!e.imageUrl&&!!e.characterName):[],userWidgets:Array.isArray(e?.userWidgets)?e.userWidgets.map((e,t)=>({id:o(e?.id)||`widget_${t}`,name:o(e?.name),code:o(e?.code)||void 0,vueCode:o(e?.vueCode)||void 0,cssCode:o(e?.cssCode)||void 0,css:o(e?.css)||void 0,description:o(e?.description)||void 0})).filter(e=>!!e.id):[]}}function r(e){if(!e||'object'!=typeof e)return null;const t=l({eventPackId:o(e.eventPackId??e.id),eventPackName:o(e.eventPackName??e.name),backgroundImages:Array.isArray(e.backgroundImages)?e.backgroundImages:[],characterImages:Array.isArray(e.characterImages)?e.characterImages:[],userWidgets:Array.isArray(e.userWidgets)?e.userWidgets:[]});return t.eventPackId||t.eventPackName?t:null}function i(e){const t=e??{},a=Array.isArray(t.backgroundImages)?t.backgroundImages:[],n=Array.isArray(t.sceneBackgrounds)?t.sceneBackgrounds:[],l=a.length>0?a:n;return{backgroundImages:Array.isArray(l)?l.map((e,t)=>'string'==typeof e?{id:`bg_${t}`,name:'',imageUrl:e}:{id:e?.id||`bg_${t}`,name:e?.name||e?.title||e?.linkedVariable||e?.condition||e?.trigger||'',imageUrl:e?.imageUrl||e?.url||e?.src||''}).filter(e=>!!e?.imageUrl):[],characterImages:Array.isArray(t.characterImages)?t.characterImages.map(e=>({id:e?.id,characterName:e?.characterName,imageUrl:e?.imageUrl,expression:e?.expression||e?.diffName||'',outfit:e?.outfit||'',isFallback:!!e?.isFallback})):[],userWidgets:Array.isArray(t.userWidgets)?t.userWidgets.map((e,t)=>({id:o(e?.id)||`widget_${t}`,name:o(e?.name),code:o(e?.code)||void 0,vueCode:o(e?.vueCode)||void 0,cssCode:o(e?.cssCode)||void 0,css:o(e?.css)||void 0,description:o(e?.description)||void 0})):[],eventPackName:'string'==typeof t.name?t.name:'',eventPackId:'string'==typeof t.id?t.id:''}}function c(e){const t=g(),a=i(e);a.eventPackId&&(t?.eventPackId===a.eventPackId&&Array.isArray(t?.userWidgets)||f(a))}const s='current_game_assets',d='current_game_assets_v1';let u=null;function m(e){return e&&'object'==typeof e&&'idb_runtime_asset'===e.__ref&&'string'==typeof e.runtimeId}function p(e){u=e;try{window.__CURRENT_GAME_ASSETS__=e}catch{}}async function v(){if(u)return u;try{const e=sessionStorage.getItem(s);if(!e)return null;const t=JSON.parse(e);if(!t)return null;if(m(t)){const e=r(await n.idbService.getRuntimeAsset(t.runtimeId));return e?(p(e),e):null}const a=r(t);return a?(p(a),a):null}catch(e){return console.error('[GameAssets] Failed to hydrate game assets:',e),null}}function g(){if(u)return u;try{const e=window.__CURRENT_GAME_ASSETS__;if(e)return u=e,e}catch{}try{const e=sessionStorage.getItem(s);if(!e)return null;const t=JSON.parse(e);return m(t)?null:(u=t,t)}catch(e){return console.error('[GameAssets] Failed to parse game assets:',e),null}}function f(e){p(e);try{sessionStorage.setItem(s,JSON.stringify(e)),console.log('[GameAssets] Saved game assets:',e.eventPackName)}catch(t){if(function(e){const t=e;return!!t&&('QuotaExceededError'===t?.name||'NS_ERROR_DOM_QUOTA_REACHED'===t?.name||'string'==typeof t?.message&&/quota/i.test(t.message))}(t)){console.warn('[GameAssets] sessionStorage quota exceeded; falling back to IndexedDB runtime asset');const t=l(e);n.idbService.setRuntimeAsset(d,t).catch(e=>{console.warn('[GameAssets] Failed to persist assets to IndexedDB:',e)});const a={__ref:'idb_runtime_asset',runtimeId:d,eventPackId:e.eventPackId,eventPackName:e.eventPackName};try{sessionStorage.setItem(s,JSON.stringify(a))}catch(e){console.error('[GameAssets] Failed to save even the reference:',e)}return}console.error('[GameAssets] Failed to save game assets:',t)}}function y(){p(null);try{const e=sessionStorage.getItem(s);if(e){const t=JSON.parse(e);m(t)&&n.idbService.deleteRuntimeAsset(t.runtimeId).catch(()=>{})}}catch{}sessionStorage.removeItem(s),console.log('[GameAssets] Cleared game assets')}function h(){const e=g();return e?.backgroundImages||[]}function k(){const e=g();return e?.characterImages||[]}function N(e){const t=g();return t?.userWidgets.find(t=>t.id===e)}function E(){const e=g();return e?.userWidgets||[]}},514:(e,t,a)=>{a.d(t,{Ao:()=>r,V_:()=>o,uF:()=>l});const n=e=>(e??'').trim().toLowerCase();function o(e){return e?e.split(/[Ôºå,„ÄÅ;Ôºõ|\n\r\t]/g).map(e=>e.trim()).filter(Boolean):[]}function l(e,t,a='equals'){const l=n(t);if(!l)return!1;const r=o(e).map(n).filter(Boolean);return 0!==r.length&&('includes'===a?r.some(e=>l.includes(e)||e.includes(l)):r.includes(l))}function r(e,t,a='equals'){const l=n(t);if(!l)return 0;const r=o(e).map(n).filter(Boolean);if(0===r.length)return 0;if('includes'===a){let e=0;for(const t of r)t&&(l.includes(t)||t.includes(l))&&(e=Math.max(e,Math.min(t.length,l.length)));return e}return r.includes(l)?1:0}},772:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a}},823:()=>{$(()=>{console.log('Ethereal Echoes: ÁïåÈù¢Â∑≤Âä†ËΩΩ')}),$(window).on('pagehide',()=>{console.log('Ethereal Echoes: ÁïåÈù¢Â∑≤Âç∏ËΩΩ')})},894:(e,t,a)=>{a.d(t,{idbService:()=>i});const n='works',o='saves',l='runtime_assets',r='kv';const i=new class{db=null;async open(){return this.db?this.db:new Promise((e,t)=>{const a=indexedDB.open('WorkshopDB',5);a.onerror=e=>{console.error('IDB open error:',e),t('Failed to open database')},a.onsuccess=t=>{this.db=t.target.result,e(this.db)},a.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(n)||t.createObjectStore(n,{keyPath:'id'}),t.objectStoreNames.contains(o)||t.createObjectStore(o,{keyPath:'id'}),t.objectStoreNames.contains(l)||t.createObjectStore(l,{keyPath:'id'}),t.objectStoreNames.contains(r)||t.createObjectStore(r,{keyPath:'key'})}})}async getAllWorks(){const e=await this.open();return new Promise((t,a)=>{const o=e.transaction(n,'readonly').objectStore(n).getAll();o.onsuccess=()=>{t(o.result)},o.onerror=()=>{a('Failed to fetch works')}})}async saveWork(e){const t=await this.open();return new Promise((a,o)=>{const l=t.transaction(n,'readwrite').objectStore(n).put(e);l.onsuccess=()=>{a()},l.onerror=()=>{o('Failed to save work')}})}async deleteWork(e){const t=await this.open();return new Promise((a,o)=>{const l=t.transaction(n,'readwrite').objectStore(n).delete(e.toString());l.onsuccess=()=>{a()},l.onerror=()=>{o('Failed to delete work')}})}async getAllSaves(){const e=await this.open();return new Promise((t,a)=>{const n=e.transaction(o,'readonly').objectStore(o).getAll();n.onsuccess=()=>{t(n.result)},n.onerror=()=>{a('Failed to fetch saves')}})}async getSave(e){const t=await this.open();return new Promise((a,n)=>{const l=t.transaction(o,'readonly').objectStore(o).get(e);l.onsuccess=()=>{a(l.result)},l.onerror=()=>{n('Failed to get save')}})}async saveSave(e){const t=await this.open();return new Promise((a,n)=>{const l=t.transaction(o,'readwrite').objectStore(o).put(e);l.onsuccess=()=>{a()},l.onerror=()=>{n('Failed to save game')}})}async deleteSave(e){const t=await this.open();return new Promise((a,n)=>{const l=t.transaction(o,'readwrite').objectStore(o).delete(e);l.onsuccess=()=>{a()},l.onerror=()=>{n('Failed to delete save')}})}async setRuntimeAsset(e,t){const a=await this.open();return new Promise((n,o)=>{const r=a.transaction(l,'readwrite').objectStore(l),i={id:e,value:t,updatedAt:Date.now()};try{const e=r.put(i);e.onsuccess=()=>n(),e.onerror=()=>o(e.error??new Error('Failed to save runtime asset'))}catch(e){o(e)}})}async getRuntimeAsset(e){const t=await this.open();return new Promise((a,n)=>{const o=t.transaction(l,'readonly').objectStore(l).get(e);o.onsuccess=()=>{const e=o.result;a(e?.value)},o.onerror=()=>n('Failed to get runtime asset')})}async deleteRuntimeAsset(e){const t=await this.open();return new Promise((a,n)=>{const o=t.transaction(l,'readwrite').objectStore(l).delete(e);o.onsuccess=()=>a(),o.onerror=()=>n('Failed to delete runtime asset')})}async setKV(e,t){const a=await this.open();return new Promise((n,o)=>{const l=a.transaction(r,'readwrite').objectStore(r),i={key:e,value:t,updatedAt:Date.now()},c=l.put(i);c.onsuccess=()=>n(),c.onerror=()=>o('Failed to save kv')})}async getKV(e){const t=await this.open();return new Promise((a,n)=>{const o=t.transaction(r,'readonly').objectStore(r).get(e);o.onsuccess=()=>{const e=o.result;a(e?.value)},o.onerror=()=>n('Failed to get kv')})}async deleteKV(e){const t=await this.open();return new Promise((a,n)=>{const o=t.transaction(r,'readwrite').objectStore(r).delete(e);o.onsuccess=()=>a(),o.onerror=()=>n('Failed to delete kv')})}}}},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var a=o[e]={exports:{}};return n[e](a,a.exports,l),a.exports}l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);l(823);const r=Vue,i=VueRouter,c=['title'],s={key:0,xmlns:'http://www.w3.org/2000/svg',width:'18',height:'18',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2','stroke-linecap':'round','stroke-linejoin':'round'},d={key:1,xmlns:'http://www.w3.org/2000/svg',width:'18',height:'18',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2','stroke-linecap':'round','stroke-linejoin':'round'},u='ethereal_fs_btn_pos',m=(0,r.defineComponent)({__name:'App',setup(e){const t=(0,r.ref)(null),a=(0,r.ref)(null),n=(0,r.ref)(!1),o=(0,r.ref)(!1),l=(0,r.computed)(()=>n.value||o.value),i=(0,r.reactive)({width:0,height:0,rotateDeg:0,scale:1});function m(){try{const e=document.documentElement;(function(){if('undefined'==typeof window)return!1;const e=navigator.userAgent||'',t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),a=window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,n=window.innerWidth<=1024;return t||a&&n})()?(e.dataset.thMobile='1',e.dataset.thPerf='low'):(delete e.dataset.thMobile,delete e.dataset.thPerf)}catch{}}const p=(0,r.computed)(()=>{if(!l.value)return;const e=i.width||0,t=i.height||0;return{position:'absolute',left:'50%',top:'50%',width:e?`${e}px`:'100%',height:t?`${t}px`:'100%',transform:`translate(-50%, -50%) rotate(${i.rotateDeg||0}deg) scale(${i.scale||1}) translateZ(0)`,transformOrigin:'center center',backfaceVisibility:'hidden',perspective:'1000px'}}),v=(0,r.reactive)({x:20,y:20});let g=!1,f=!1,y=0,h=0,k=0,N=0,E=null,V=null;function b(){const e=t.value,n=a.value;if(!e||!n)return;const o=e.getBoundingClientRect(),l=n.offsetWidth||40,r=n.offsetHeight||40;v.x=Math.max(0,Math.min(o.width-l,v.x)),v.y=Math.max(0,Math.min(o.height-r,v.y))}function w(e){if('mouse'===e.pointerType&&0!==e.button)return;const t=a.value;if(t){E=e.pointerId,V=e.pointerType,g=!0,f=!1,y=e.clientX,h=e.clientY,k=v.x,N=v.y;try{t.setPointerCapture(e.pointerId)}catch{}document.addEventListener('pointermove',C,{passive:!1}),document.addEventListener('pointerup',S),document.addEventListener('pointercancel',S)}}function C(e){if(!g)return;if(null!=E&&e.pointerId!==E)return;const t=e.clientX-y,a=e.clientY-h;(Math.abs(t)>3||Math.abs(a)>3)&&(f=!0),v.x=k+t,v.y=N+a,b(),'touch'===V&&e.preventDefault()}async function S(e){null!=E&&e.pointerId!==E||(g=!1,E=null,V=null,document.removeEventListener('pointermove',C),document.removeEventListener('pointerup',S),document.removeEventListener('pointercancel',S),function(){try{localStorage.setItem(u,JSON.stringify({x:v.x,y:v.y}))}catch{}}(),f||await async function(){const e=t.value;if(!e)return;if(o.value)return o.value=!1,void B();if('function'==typeof e.requestFullscreen&&'function'==typeof document.exitFullscreen)try{return void(document.fullscreenElement?await document.exitFullscreen():await e.requestFullscreen())}catch(e){console.warn('[Fullscreen] native failed, fallback to pseudo:',e)}o.value=!0,B(),await async function(){try{const e=screen;e.orientation?.lock&&await e.orientation.lock('landscape')}catch{}}()}())}function B(){if(m(),!l.value)return i.width=0,i.height=0,i.rotateDeg=0,i.scale=1,void requestAnimationFrame(()=>b());const e=Math.max(1,window.innerWidth),t=Math.max(1,window.innerHeight);if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){const a=1920,n=1080,o=t>e,l=Math.max(e,t),r=Math.min(e,t),c=Math.min(l/a,r/n);i.width=a,i.height=n,i.rotateDeg=o?90:0,i.scale=c}else{const a=t>e,n=a?t:e,o=a?e:t,l=4,r=Math.max(1,n-l),c=Math.max(1,o-l),s=Math.min(r,16*c/9),d=Math.min(c,9*r/16);i.width=Math.round(s),i.height=Math.round(d),i.rotateDeg=a?90:0,i.scale=1}requestAnimationFrame(()=>b())}function x(){n.value=!!document.fullscreenElement,B()}return(0,r.onMounted)(()=>{!function(){try{const e=localStorage.getItem(u);if(e){const t=JSON.parse(e);'number'==typeof t.x&&'number'==typeof t.y&&(v.x=t.x,v.y=t.y)}}catch{}}(),document.addEventListener('fullscreenchange',x),window.addEventListener('resize',B),window.addEventListener('orientationchange',B),m(),B()}),(0,r.onUnmounted)(()=>{document.removeEventListener('fullscreenchange',x),window.removeEventListener('resize',B),window.removeEventListener('orientationchange',B)}),(0,r.watch)(l,()=>{B()}),(e,n)=>{const o=(0,r.resolveComponent)('RouterView');return(0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['ethereal-app-wrapper',{'is-fullscreen':l.value}])},[(0,r.createElementVNode)('div',{ref_key:'gameContainer',ref:t,class:'ethereal-app',style:(0,r.normalizeStyle)(p.value)},[(0,r.createCommentVNode)(' Background Layer - Deep Space Gradients '),n[2]||(n[2]=(0,r.createElementVNode)('div',{class:'background-layer'},[(0,r.createElementVNode)('div',{class:'bg-orb bg-orb-violet'}),(0,r.createElementVNode)('div',{class:'bg-orb bg-orb-blue'}),(0,r.createElementVNode)('div',{class:'bg-orb bg-orb-fuchsia'})],-1)),(0,r.createCommentVNode)(' Main Content Render '),(0,r.createVNode)(r.Transition,{name:'fade-scale',mode:'out-in'},{default:(0,r.withCtx)(()=>[(0,r.createVNode)(o,{class:'main-content'})]),_:1}),(0,r.createCommentVNode)(' Overlay root (must be inside fullscreen element) '),n[3]||(n[3]=(0,r.createElementVNode)('div',{id:'ethereal-overlay-root',class:'ethereal-overlay-root'},null,-1)),n[4]||(n[4]=(0,r.createElementVNode)('div',{id:'ethereal-toast-root',class:'ethereal-toast-root'},null,-1)),(0,r.createCommentVNode)(' Global UI overlay (Version info etc) '),n[5]||(n[5]=(0,r.createElementVNode)('div',{class:'version-info'},'VER v1.0.1 BETA // TOMO / DREAMER',-1)),(0,r.createCommentVNode)(' Noise texture overlay '),n[6]||(n[6]=(0,r.createElementVNode)('div',{class:'bg-noise'},null,-1)),(0,r.createCommentVNode)(' Draggable Fullscreen Button '),(0,r.createElementVNode)('div',{ref_key:'fsBtn',ref:a,class:'fullscreen-btn',style:(0,r.normalizeStyle)({left:v.x+'px',top:v.y+'px'}),onPointerdown:w,title:l.value?'ÈÄÄÂá∫ÂÖ®Â±è':'ËøõÂÖ•ÂÖ®Â±è (16:9)'},[l.value?((0,r.openBlock)(),(0,r.createElementBlock)('svg',d,[...n[1]||(n[1]=[(0,r.createElementVNode)('polyline',{points:'4 14 10 14 10 20'},null,-1),(0,r.createElementVNode)('polyline',{points:'20 10 14 10 14 4'},null,-1),(0,r.createElementVNode)('line',{x1:'14',y1:'10',x2:'21',y2:'3'},null,-1),(0,r.createElementVNode)('line',{x1:'3',y1:'21',x2:'10',y2:'14'},null,-1)])])):((0,r.openBlock)(),(0,r.createElementBlock)('svg',s,[...n[0]||(n[0]=[(0,r.createElementVNode)('polyline',{points:'15 3 21 3 21 9'},null,-1),(0,r.createElementVNode)('polyline',{points:'9 21 3 21 3 15'},null,-1),(0,r.createElementVNode)('line',{x1:'21',y1:'3',x2:'14',y2:'10'},null,-1),(0,r.createElementVNode)('line',{x1:'3',y1:'21',x2:'10',y2:'14'},null,-1)])]))],44,c)],4)],2)}}}),p=['width','height','stroke'],v=(0,r.defineComponent)({__name:'Icons',props:{name:{},size:{default:24},stroke:{default:'currentColor'}},setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('svg',{xmlns:'http://www.w3.org/2000/svg',width:e.size,height:e.size,viewBox:'0 0 24 24',fill:'none',stroke:e.stroke,'stroke-width':'2','stroke-linecap':'round','stroke-linejoin':'round'},[(0,r.createCommentVNode)(' Menu '),'menu'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[t[0]||(t[0]=(0,r.createElementVNode)('line',{x1:'3',y1:'12',x2:'21',y2:'12'},null,-1)),t[1]||(t[1]=(0,r.createElementVNode)('line',{x1:'3',y1:'6',x2:'21',y2:'6'},null,-1)),t[2]||(t[2]=(0,r.createElementVNode)('line',{x1:'3',y1:'18',x2:'21',y2:'18'},null,-1))],64)):'play'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Play '),t[3]||(t[3]=(0,r.createElementVNode)('polygon',{points:'5 3 19 12 5 21 5 3'},null,-1))],64)):'save'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(' Save '),t[4]||(t[4]=(0,r.createElementVNode)('path',{d:'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z'},null,-1)),t[5]||(t[5]=(0,r.createElementVNode)('polyline',{points:'17 21 17 13 7 13 7 21'},null,-1)),t[6]||(t[6]=(0,r.createElementVNode)('polyline',{points:'7 3 7 8 15 8'},null,-1))],64)):'hammer'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:3},[(0,r.createCommentVNode)(' Hammer '),t[7]||(t[7]=(0,r.createElementVNode)('path',{d:'m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9'},null,-1)),t[8]||(t[8]=(0,r.createElementVNode)('path',{d:'M17.64 15 22 10.64'},null,-1)),t[9]||(t[9]=(0,r.createElementVNode)('path',{d:'m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91'},null,-1))],64)):'arrow-left'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:4},[(0,r.createCommentVNode)(' ArrowLeft (Back alias) '),t[10]||(t[10]=(0,r.createElementVNode)('line',{x1:'19',y1:'12',x2:'5',y2:'12'},null,-1)),t[11]||(t[11]=(0,r.createElementVNode)('polyline',{points:'12 19 5 12 12 5'},null,-1))],64)):'map-pin'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:5},[(0,r.createCommentVNode)(' MapPin '),t[12]||(t[12]=(0,r.createElementVNode)('path',{d:'M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z'},null,-1)),t[13]||(t[13]=(0,r.createElementVNode)('circle',{cx:'12',cy:'10',r:'3'},null,-1))],64)):'back'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:6},[(0,r.createCommentVNode)(' ArrowLeft (Back) '),t[14]||(t[14]=(0,r.createElementVNode)('line',{x1:'19',y1:'12',x2:'5',y2:'12'},null,-1)),t[15]||(t[15]=(0,r.createElementVNode)('polyline',{points:'12 19 5 12 12 5'},null,-1))],64)):'next'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:7},[(0,r.createCommentVNode)(' ArrowRight (Next) '),t[16]||(t[16]=(0,r.createElementVNode)('line',{x1:'5',y1:'12',x2:'19',y2:'12'},null,-1)),t[17]||(t[17]=(0,r.createElementVNode)('polyline',{points:'12 5 19 12 12 19'},null,-1))],64)):'search'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:8},[(0,r.createCommentVNode)(' Search '),t[18]||(t[18]=(0,r.createElementVNode)('circle',{cx:'11',cy:'11',r:'8'},null,-1)),t[19]||(t[19]=(0,r.createElementVNode)('line',{x1:'21',y1:'21',x2:'16.65',y2:'16.65'},null,-1))],64)):'zoom'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:9},[(0,r.createCommentVNode)(' Zoom (Maximize2) '),t[20]||(t[20]=(0,r.createElementVNode)('polyline',{points:'15 3 21 3 21 9'},null,-1)),t[21]||(t[21]=(0,r.createElementVNode)('polyline',{points:'9 21 3 21 3 15'},null,-1)),t[22]||(t[22]=(0,r.createElementVNode)('line',{x1:'21',y1:'3',x2:'14',y2:'10'},null,-1)),t[23]||(t[23]=(0,r.createElementVNode)('line',{x1:'3',y1:'21',x2:'10',y2:'14'},null,-1))],64)):'import'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:10},[(0,r.createCommentVNode)(' Download (Import) '),t[24]||(t[24]=(0,r.createElementVNode)('path',{d:'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'},null,-1)),t[25]||(t[25]=(0,r.createElementVNode)('polyline',{points:'7 10 12 15 17 10'},null,-1)),t[26]||(t[26]=(0,r.createElementVNode)('line',{x1:'12',y1:'15',x2:'12',y2:'3'},null,-1))],64)):'export'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:11},[(0,r.createCommentVNode)(' Upload (Export) '),t[27]||(t[27]=(0,r.createElementVNode)('path',{d:'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'},null,-1)),t[28]||(t[28]=(0,r.createElementVNode)('polyline',{points:'17 8 12 3 7 8'},null,-1)),t[29]||(t[29]=(0,r.createElementVNode)('line',{x1:'12',y1:'3',x2:'12',y2:'15'},null,-1))],64)):'user'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:12},[(0,r.createCommentVNode)(' User '),t[30]||(t[30]=(0,r.createElementVNode)('path',{d:'M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'},null,-1)),t[31]||(t[31]=(0,r.createElementVNode)('circle',{cx:'12',cy:'7',r:'4'},null,-1))],64)):'location'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:13},[(0,r.createCommentVNode)(' MapPin (Location) '),t[32]||(t[32]=(0,r.createElementVNode)('path',{d:'M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z'},null,-1)),t[33]||(t[33]=(0,r.createElementVNode)('circle',{cx:'12',cy:'10',r:'3'},null,-1))],64)):'time'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:14},[(0,r.createCommentVNode)(' Clock (Time) '),t[34]||(t[34]=(0,r.createElementVNode)('circle',{cx:'12',cy:'12',r:'10'},null,-1)),t[35]||(t[35]=(0,r.createElementVNode)('polyline',{points:'12 6 12 12 16 14'},null,-1))],64)):'event'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:15},[(0,r.createCommentVNode)(' Sparkles (Event) '),t[36]||(t[36]=(0,r.createStaticVNode)('<path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path>',5))],64)):'close'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:16},[(0,r.createCommentVNode)(' X (Close) '),t[37]||(t[37]=(0,r.createElementVNode)('line',{x1:'18',y1:'6',x2:'6',y2:'18'},null,-1)),t[38]||(t[38]=(0,r.createElementVNode)('line',{x1:'6',y1:'6',x2:'18',y2:'18'},null,-1))],64)):'star'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:17},[(0,r.createCommentVNode)(' Star '),t[39]||(t[39]=(0,r.createElementVNode)('polygon',{points:'12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2'},null,-1))],64)):'verified'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:18},[(0,r.createCommentVNode)(' Verified (BadgeCheck) '),t[40]||(t[40]=(0,r.createElementVNode)('path',{d:'M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z'},null,-1)),t[41]||(t[41]=(0,r.createElementVNode)('path',{d:'m9 12 2 2 4-4'},null,-1))],64)):'upload-cloud'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:19},[(0,r.createCommentVNode)(' UploadCloud '),t[42]||(t[42]=(0,r.createElementVNode)('path',{d:'M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242'},null,-1)),t[43]||(t[43]=(0,r.createElementVNode)('path',{d:'M12 12v9'},null,-1)),t[44]||(t[44]=(0,r.createElementVNode)('path',{d:'m16 16-4-4-4 4'},null,-1))],64)):'cloud-delete'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:20},[(0,r.createCommentVNode)(' CloudDelete (cloud with X) '),t[45]||(t[45]=(0,r.createElementVNode)('path',{d:'M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242'},null,-1)),t[46]||(t[46]=(0,r.createElementVNode)('line',{x1:'9',y1:'14',x2:'15',y2:'20'},null,-1)),t[47]||(t[47]=(0,r.createElementVNode)('line',{x1:'15',y1:'14',x2:'9',y2:'20'},null,-1))],64)):'sparkles'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:21},[(0,r.createCommentVNode)(' Sparkles '),t[48]||(t[48]=(0,r.createElementVNode)('path',{d:'m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z'},null,-1))],64)):'palette'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:22},[(0,r.createCommentVNode)(' Palette '),t[49]||(t[49]=(0,r.createStaticVNode)('<circle cx="13.5" cy="6.5" r=".5" fill="currentColor"></circle><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"></circle><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"></circle><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"></circle><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"></path>',5))],64)):'text'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:23},[(0,r.createCommentVNode)(' Text '),t[50]||(t[50]=(0,r.createElementVNode)('path',{d:'M17 6.1H3'},null,-1)),t[51]||(t[51]=(0,r.createElementVNode)('path',{d:'M21 12.1H3'},null,-1)),t[52]||(t[52]=(0,r.createElementVNode)('path',{d:'M15.1 18H3'},null,-1))],64)):'link'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:24},[(0,r.createCommentVNode)(' Link '),t[53]||(t[53]=(0,r.createElementVNode)('path',{d:'M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'},null,-1)),t[54]||(t[54]=(0,r.createElementVNode)('path',{d:'M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'},null,-1))],64)):'settings'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:25},[(0,r.createCommentVNode)(' Settings '),t[55]||(t[55]=(0,r.createElementVNode)('path',{d:'M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z'},null,-1)),t[56]||(t[56]=(0,r.createElementVNode)('circle',{cx:'12',cy:'12',r:'3'},null,-1))],64)):'delete'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:26},[(0,r.createCommentVNode)(' Delete (Trash2) '),t[57]||(t[57]=(0,r.createStaticVNode)('<path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line>',5))],64)):'plus'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:27},[(0,r.createCommentVNode)(' Plus '),t[58]||(t[58]=(0,r.createElementVNode)('line',{x1:'12',y1:'5',x2:'12',y2:'19'},null,-1)),t[59]||(t[59]=(0,r.createElementVNode)('line',{x1:'5',y1:'12',x2:'19',y2:'12'},null,-1))],64)):'brain'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:28},[(0,r.createCommentVNode)(' Brain '),t[60]||(t[60]=(0,r.createElementVNode)('path',{d:'M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-1.54'},null,-1)),t[61]||(t[61]=(0,r.createElementVNode)('path',{d:'M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-1.54'},null,-1))],64)):'compress'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:29},[(0,r.createCommentVNode)(' Compress (Minimize2) '),t[62]||(t[62]=(0,r.createElementVNode)('polyline',{points:'4 14 10 14 10 20'},null,-1)),t[63]||(t[63]=(0,r.createElementVNode)('polyline',{points:'20 10 14 10 14 4'},null,-1)),t[64]||(t[64]=(0,r.createElementVNode)('line',{x1:'14',y1:'10',x2:'21',y2:'3'},null,-1)),t[65]||(t[65]=(0,r.createElementVNode)('line',{x1:'3',y1:'21',x2:'10',y2:'14'},null,-1))],64)):'file'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:30},[(0,r.createCommentVNode)(' File '),t[66]||(t[66]=(0,r.createElementVNode)('path',{d:'M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z'},null,-1)),t[67]||(t[67]=(0,r.createElementVNode)('polyline',{points:'14 2 14 8 20 8'},null,-1))],64)):'edit'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:31},[(0,r.createCommentVNode)(' Edit (PenTool) '),t[68]||(t[68]=(0,r.createElementVNode)('path',{d:'M12 19l7-7 3 3-7 7-3-3z'},null,-1)),t[69]||(t[69]=(0,r.createElementVNode)('path',{d:'M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z'},null,-1)),t[70]||(t[70]=(0,r.createElementVNode)('path',{d:'M2 2l7.586 7.586'},null,-1)),t[71]||(t[71]=(0,r.createElementVNode)('circle',{cx:'11',cy:'11',r:'2'},null,-1))],64)):'download'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:32},[(0,r.createCommentVNode)(' Download '),t[72]||(t[72]=(0,r.createElementVNode)('path',{d:'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'},null,-1)),t[73]||(t[73]=(0,r.createElementVNode)('polyline',{points:'7 10 12 15 17 10'},null,-1)),t[74]||(t[74]=(0,r.createElementVNode)('line',{x1:'12',y1:'15',x2:'12',y2:'3'},null,-1))],64)):'external-link'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:33},[(0,r.createCommentVNode)(' External Link '),t[75]||(t[75]=(0,r.createElementVNode)('path',{d:'M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6'},null,-1)),t[76]||(t[76]=(0,r.createElementVNode)('polyline',{points:'15 3 21 3 21 9'},null,-1)),t[77]||(t[77]=(0,r.createElementVNode)('line',{x1:'10',y1:'14',x2:'21',y2:'3'},null,-1))],64)):'code'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:34},[(0,r.createCommentVNode)(' Code '),t[78]||(t[78]=(0,r.createElementVNode)('polyline',{points:'16 18 22 12 16 6'},null,-1)),t[79]||(t[79]=(0,r.createElementVNode)('polyline',{points:'8 6 2 12 8 18'},null,-1))],64)):'trash'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:35},[(0,r.createCommentVNode)(' Trash '),t[80]||(t[80]=(0,r.createElementVNode)('path',{d:'M3 6h18'},null,-1)),t[81]||(t[81]=(0,r.createElementVNode)('path',{d:'M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6'},null,-1)),t[82]||(t[82]=(0,r.createElementVNode)('path',{d:'M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2'},null,-1))],64)):'x'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:36},[(0,r.createCommentVNode)(' X (Close alternative) '),t[83]||(t[83]=(0,r.createElementVNode)('line',{x1:'18',y1:'6',x2:'6',y2:'18'},null,-1)),t[84]||(t[84]=(0,r.createElementVNode)('line',{x1:'6',y1:'6',x2:'18',y2:'18'},null,-1))],64)):'message'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:37},[(0,r.createCommentVNode)(' Message '),t[85]||(t[85]=(0,r.createElementVNode)('path',{d:'M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z'},null,-1))],64)):'chat'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:38},[(0,r.createCommentVNode)(' Chat '),t[86]||(t[86]=(0,r.createElementVNode)('path',{d:'M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z'},null,-1))],64)):'home'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:39},[(0,r.createCommentVNode)(' Home '),t[87]||(t[87]=(0,r.createElementVNode)('path',{d:'M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z'},null,-1)),t[88]||(t[88]=(0,r.createElementVNode)('polyline',{points:'9 22 9 12 15 12 15 22'},null,-1))],64)):'eye'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:40},[(0,r.createCommentVNode)(' Eye '),t[89]||(t[89]=(0,r.createElementVNode)('path',{d:'M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z'},null,-1)),t[90]||(t[90]=(0,r.createElementVNode)('circle',{cx:'12',cy:'12',r:'3'},null,-1))],64)):'image'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:41},[(0,r.createCommentVNode)(' Image '),t[91]||(t[91]=(0,r.createElementVNode)('rect',{width:'18',height:'18',x:'3',y:'3',rx:'2',ry:'2'},null,-1)),t[92]||(t[92]=(0,r.createElementVNode)('circle',{cx:'9',cy:'9',r:'2'},null,-1)),t[93]||(t[93]=(0,r.createElementVNode)('path',{d:'m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21'},null,-1))],64)):'book'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:42},[(0,r.createCommentVNode)(' Book '),t[94]||(t[94]=(0,r.createElementVNode)('path',{d:'M4 19.5A2.5 2.5 0 0 1 6.5 17H20'},null,-1)),t[95]||(t[95]=(0,r.createElementVNode)('path',{d:'M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z'},null,-1))],64)):'folder'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:43},[(0,r.createCommentVNode)(' Folder '),t[96]||(t[96]=(0,r.createElementVNode)('path',{d:'M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z'},null,-1))],64)):'world'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:44},[(0,r.createCommentVNode)(' World '),t[97]||(t[97]=(0,r.createElementVNode)('circle',{cx:'12',cy:'12',r:'10'},null,-1)),t[98]||(t[98]=(0,r.createElementVNode)('line',{x1:'2',y1:'12',x2:'22',y2:'12'},null,-1)),t[99]||(t[99]=(0,r.createElementVNode)('path',{d:'M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z'},null,-1))],64)):'lightning'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:45},[(0,r.createCommentVNode)(' Lightning '),t[100]||(t[100]=(0,r.createElementVNode)('polygon',{points:'13 2 3 14 12 14 11 22 21 10 12 10 13 2'},null,-1))],64)):'info'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:46},[(0,r.createCommentVNode)(' Info '),t[101]||(t[101]=(0,r.createElementVNode)('circle',{cx:'12',cy:'12',r:'10'},null,-1)),t[102]||(t[102]=(0,r.createElementVNode)('line',{x1:'12',y1:'16',x2:'12',y2:'12'},null,-1)),t[103]||(t[103]=(0,r.createElementVNode)('line',{x1:'12',y1:'8',x2:'12.01',y2:'8'},null,-1))],64)):'check'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:47},[(0,r.createCommentVNode)(' Check '),t[104]||(t[104]=(0,r.createElementVNode)('polyline',{points:'20 6 9 17 4 12'},null,-1))],64)):'alert'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:48},[(0,r.createCommentVNode)(' Alert '),t[105]||(t[105]=(0,r.createElementVNode)('path',{d:'M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z'},null,-1)),t[106]||(t[106]=(0,r.createElementVNode)('line',{x1:'12',y1:'9',x2:'12',y2:'13'},null,-1)),t[107]||(t[107]=(0,r.createElementVNode)('line',{x1:'12',y1:'17',x2:'12.01',y2:'17'},null,-1))],64)):'copy'===e.name?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:49},[(0,r.createCommentVNode)(' Copy '),t[108]||(t[108]=(0,r.createElementVNode)('rect',{x:'9',y:'9',width:'13',height:'13',rx:'2',ry:'2'},null,-1)),t[109]||(t[109]=(0,r.createElementVNode)('path',{d:'M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1'},null,-1))],64)):(0,r.createCommentVNode)('v-if',!0)],8,p))}),g={class:'sphere-label'},f=(0,r.defineComponent)({__name:'MistySphere',props:{label:{},size:{},color:{},delay:{}},emits:['click'],setup(e){const t=e,a=(0,r.computed)(()=>`size-${t.size}`),n=(0,r.computed)(()=>t.color||'bg-violet');return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['misty-sphere',[a.value]]),style:(0,r.normalizeStyle)({animationDelay:`${e.delay}s`}),onClick:t[0]||(t[0]=t=>e.$emit('click'))},[(0,r.createCommentVNode)(' Core Sphere - The "Gas" Effect '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['sphere-glow',n.value])},null,2),(0,r.createCommentVNode)(' Secondary Layer - Texture/Mist '),t[2]||(t[2]=(0,r.createElementVNode)('div',{class:'sphere-mist'},null,-1)),(0,r.createCommentVNode)(' Container for content '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['sphere-content',[a.value]])},[(0,r.createCommentVNode)(' Inner swirling mist animation '),t[1]||(t[1]=(0,r.createElementVNode)('div',{class:'sphere-swirl'},null,-1)),(0,r.createElementVNode)('span',g,(0,r.toDisplayString)(e.label),1)],2)],6))}});var y=l(772);const h=(0,y.A)(f,[['__scopeId','data-v-7e21fa7d']]),k=(0,r.defineComponent)({__name:'GlassPanel',props:{fullHeight:{type:Boolean}},setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['glass-panel',{'full-height':e.fullHeight}])},[(0,r.createCommentVNode)(' Shiny edge effect '),t[0]||(t[0]=(0,r.createElementVNode)('div',{class:'shiny-edge-top'},null,-1)),t[1]||(t[1]=(0,r.createElementVNode)('div',{class:'shiny-edge-left'},null,-1)),(0,r.renderSlot)(e.$slots,'default')],2))}),N=(0,y.A)(k,[['__scopeId','data-v-f8670f2c']]),E={class:'message-body'},V={key:0,class:'loading-spinner'},b={class:'message-text'},w={key:0,class:'message-actions'},C=(0,r.defineComponent)({__name:'TempMessage',props:{visible:{type:Boolean},message:{},type:{default:'info'},blocking:{type:Boolean,default:!1}},emits:['update:visible','close'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.computed)(()=>({'is-loading':'loading'===a.type,'is-blocking':a.blocking||'loading'===a.type}));function l(){n('update:visible',!1),n('close')}function i(){'loading'===a.type||a.blocking||l()}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createCommentVNode)(' No Teleport: render in-place so it stays inside fullscreen container '),(0,r.createVNode)(r.Transition,{name:'msg-fade'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:(0,r.normalizeClass)(['temp-message-overlay',o.value]),onClick:(0,r.withModifiers)(i,['self'])},[(0,r.createVNode)(N,{class:(0,r.normalizeClass)(['message-box',e.type])},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',E,[(0,r.createCommentVNode)(' Loading Spinner '),'loading'===e.type?((0,r.openBlock)(),(0,r.createElementBlock)('div',V)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Standard Icons '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['icon-wrapper',e.type])},['error'===e.type?((0,r.openBlock)(),(0,r.createBlock)(v,{key:0,name:'alert',size:'2em'})):'success'===e.type?((0,r.openBlock)(),(0,r.createBlock)(v,{key:1,name:'check',size:'2em'})):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(' Assuming check exists or fallback '),(0,r.createVNode)(v,{name:'info',size:'2em'})],2112)),(0,r.createCommentVNode)(' Assuming info exists or fallback ')],2)],2112)),(0,r.createElementVNode)('div',b,(0,r.toDisplayString)(e.message),1)]),'loading'!==e.type?((0,r.openBlock)(),(0,r.createElementBlock)('div',w,[(0,r.createElementVNode)('button',{class:'btn-primary',onClick:l},'OK')])):(0,r.createCommentVNode)('v-if',!0)]),_:1},8,['class'])],2)):(0,r.createCommentVNode)('v-if',!0)]),_:1})],2112))}}),S=(0,y.A)(C,[['__scopeId','data-v-525d84fb']]),B={accessToken:null},x={setAccessToken(e){B.accessToken=e||null},getAccessToken:()=>B.accessToken,isAuthenticated:()=>!!B.accessToken,clear(){B.accessToken=null}},I='workshop_user',T='workshop_local_login_expires_at';function A(e,t=6048e5){const a=Date.now()+t;localStorage.setItem(I,JSON.stringify(e)),localStorage.setItem(T,String(a))}function D(){localStorage.removeItem(I),localStorage.removeItem(T)}function M(){const e=function(e){if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null}(localStorage.getItem(T)),t=localStorage.getItem(I);let a=null;if(t)try{const e=JSON.parse(t);e&&'object'==typeof e&&(a={username:'string'==typeof e.username?e.username:'ÁÇπÂáªÁôªÂΩï',avatar:'string'==typeof e.avatar?e.avatar:'',id:'string'==typeof e.id?e.id:''})}catch{a=null}const n=!!a&&'number'==typeof e&&Date.now()<e;return{user:n?a:null,expiresAt:e,isValid:n}}function P(){return M().isValid}const O='ÂêåÊ¢¶',R='Ê∏∏ÊàèÊåÅ‰πÖÂåñÊï∞ÊçÆ',L='persistence_main_game_payload_v1',U='persistence_main_game_event_pack_override_v1',F={currentPage:'Home',lastSaveTime:0};async function W(){try{const e=(await getWorldbook(O)).find(e=>e.name===R);if(!e?.content)return F;try{return{...F,...JSON.parse(e.content)}}catch{return console.warn('[Persistence] Failed to parse data, using default'),F}}catch(e){return console.error('[Persistence] Failed to get data:',e),F}}async function j(e){try{const t=await getWorldbook(O),a=t.findIndex(e=>e.name===R);let n=F;if(-1!==a&&t[a].content)try{n={...F,...JSON.parse(t[a].content)}}catch{}const o={...n,...e,lastSaveTime:Date.now()};e.mainGame&&(o.mainGame={...n.mainGame,...e.mainGame}),e.workshop&&(o.workshop={...n.workshop,...e.workshop}),e.newGame&&(o.newGame={...n.newGame,...e.newGame});const l=JSON.stringify(o,null,2);return-1===a?t.push({uid:Date.now(),name:R,enabled:!1,content:l,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:0,order:900},probability:0,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}}):(t[a].content=l,t[a].enabled=!1,t[a].probability=0),await replaceWorldbook(O,t),!0}catch(e){return console.error('[Persistence] Failed to save:',e),!1}}async function G(){return j({currentPage:'Home',mainGame:void 0,workshop:void 0,newGame:void 0})}async function J(){const e=await W();if('Home'===e.currentPage)return null;if('MainGame'===e.currentPage){const t=e.mainGame;if(!t?.hasActiveGame)return null;const a='string'==typeof t.payloadRuntimeId&&t.payloadRuntimeId.trim().length>0,n=Array.isArray(t.dialogueQueue)&&t.dialogueQueue.length>0,o=Array.isArray(t.historyLog)&&t.historyLog.length>0;return a||n||o?'/MainGame':'/load-game'}return{Workshop:'/workshop',NewGame:'/new-game',LoadGame:'/load-game'}[e.currentPage]||null}async function Y(e){return j({currentPage:'MainGame',mainGame:e})}async function H(e){return j({currentPage:'NewGame',newGame:e})}const X={class:'home-view'},K=['src'],Q={class:'sphere-position sphere-start'},q={class:'sphere-position sphere-workshop'},Z={class:'sphere-position sphere-load'},ee=(0,r.defineComponent)({__name:'Home',setup(e){const t=(0,i.useRouter)(),a=(0,r.ref)(!1),n=(0,r.ref)({username:'ÁÇπÂáªÁôªÂΩï',avatar:'',id:''}),o=(0,r.ref)('idle'),l=(0,r.ref)(!1),c=(0,r.ref)(''),s=(0,r.ref)('info');function d(e,t='info'){c.value=e,s.value=t,l.value=!0}const u=(0,r.ref)(!1);let m=null;let p=null;const g=()=>{a.value=!1,o.value='idle',n.value={username:'ÁÇπÂáªÁôªÂΩï',avatar:'',id:''},D(),x.clear()},f=()=>{if(a.value)return u.value?void y():(u.value=!0,d('ÂÜçÁÇπ‰∏ÄÊ¨°Âç≥ÂèØÈÄÄÂá∫ÁôªÂΩï','warning'),m&&window.clearTimeout(m),void(m=window.setTimeout(()=>{u.value=!1,m=null},2500)));const e=(()=>{const e=new Uint32Array(4);return window.crypto.getRandomValues(e),Array.from(e,e=>e.toString(36)).join('')})();console.log('„ÄêË∞ÉËØï„ÄëÁîüÊàêÁöÑ‰ø°ÁÆ± ID (state):',e),o.value='pending';const t=(window.screen.width-500)/2,l=(window.screen.height-800)/2,r=`https://discord.com/api/oauth2/authorize?client_id=1456699602181820426&redirect_uri=${encodeURIComponent('https://workshop.ab003317.dpdns.org/api/auth/discord/callback')}&response_type=code&scope=identify&state=${e}`;console.log('„ÄêË∞ÉËØï„ÄëÂç≥Â∞ÜÊâìÂºÄÂºπÁ™ó URL:',r);const i=window.open(r,'DiscordLogin',`width=500,height=800,top=${l},left=${t}`);console.log('„ÄêË∞ÉËØï„ÄëÂºÄÂßãËΩÆËØ¢ÂêéÁ´Ø...');const c=setInterval(async()=>{try{const t=`https://workshop.ab003317.dpdns.org/api/auth/check?socketId=${e}`,l=await fetch(t,{credentials:'include'});if(!l.ok)return void console.error('„ÄêË∞ÉËØï„ÄëÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•ÔºåÁä∂ÊÄÅÁ†Å:',l.status);const r=await l.json();if('success'===r.status){console.log('üéâ„ÄêË∞ÉËØï„ÄëÊãøÂà∞Êï∞ÊçÆ‰∫ÜÔºÅÔºÅÔºÅ',r.data),clearInterval(c),o.value='idle';const e=r.data.user||r.data,t=r.data&&r.data.accessToken||e&&e.accessToken;x.setAccessToken('string'==typeof t&&t?t:null);const l=e.avatar&&!e.avatar.startsWith('http')?`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.png`:e.avatar||'',s={username:e.username,avatar:l,id:e.id};console.log('„ÄêË∞ÉËØï„ÄëÊõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ:',s),n.value=s,a.value=!0,A(s),p&&window.clearTimeout(p);const{expiresAt:d}=M();if('number'==typeof d){const e=Math.max(0,d-Date.now());p=window.setTimeout(()=>{g()},e)}i&&!i.closed&&i.close()}i&&i.closed}catch(e){console.error('‚ùå„ÄêË∞ÉËØï„ÄëËΩÆËØ¢ÂèëÁîü‰∏•ÈáçÈîôËØØ:',e),o.value='error'}},1e3);setTimeout(()=>{clearInterval(c),'pending'===o.value&&(o.value='timeout',d('ÁôªÂΩïË∂ÖÊó∂ÔºåËØ∑ÈáçËØï','warning'))},12e4)},y=()=>{a.value=!1,o.value='idle',n.value={username:'ÁÇπÂáªÁôªÂΩï',avatar:'',id:''},p&&window.clearTimeout(p),p=null,D(),x.clear(),fetch('https://workshop.ab003317.dpdns.org/api/auth/logout',{method:'POST',credentials:'include',headers:{'X-Requested-With':'XMLHttpRequest'}}).catch(()=>{}),u.value=!1,m&&window.clearTimeout(m),m=null,d('Â∑≤ÈÄÄÂá∫ÁôªÂΩï','success')};(0,r.onMounted)(async()=>{try{const e=await J();if(e)return console.log(`[Home] Restoring to ${e}`),void t.replace(e)}catch(e){console.warn('[Home] Failed to check persistence:',e)}const e=M();if(e.isValid&&e.user){if(n.value=e.user,a.value=!0,p&&window.clearTimeout(p),'number'==typeof e.expiresAt){const t=Math.max(0,e.expiresAt-Date.now());p=window.setTimeout(()=>{g()},t)}}else g()});const k=t.afterEach(e=>{'/'===e.path&&sessionStorage.removeItem('home_checked_restore')});return(0,r.onBeforeUnmount)(()=>{k(),p&&window.clearTimeout(p),p=null,m&&window.clearTimeout(m),m=null}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',X,[(0,r.createCommentVNode)(' User Info '),(0,r.createElementVNode)('div',{class:'user-info',onClick:f,style:{cursor:'pointer'}},[a.value&&n.value.avatar?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:n.value.avatar,class:'user-avatar',alt:'User Avatar'},null,8,K)):((0,r.openBlock)(),(0,r.createBlock)(v,{key:1,name:'user',size:18})),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(n.value.username),1)]),(0,r.createCommentVNode)(' Title Section '),t[4]||(t[4]=(0,r.createElementVNode)('div',{class:'title-section'},[(0,r.createElementVNode)('h1',{class:'main-title'},[(0,r.createTextVNode)(' ÂêåÊ¢¶ '),(0,r.createElementVNode)('br'),(0,r.createElementVNode)('span',{class:'sub-title'},'TOMO / DREAMER')]),(0,r.createElementVNode)('p',{class:'description'},[(0,r.createTextVNode)(' ÊâìÁ†¥Ê¨°ÂÖÉÔºåÂú®Ê≠§ÂêåÊ¢¶, Êó†Â∞ΩÁª¥Â∫¶ÁöÑAIÂêå‰∫∫ÂÆáÂÆô„ÄÇ '),(0,r.createElementVNode)('br'),(0,r.createTextVNode)(' Immerse in the dreams we weave together. ')])],-1)),(0,r.createCommentVNode)(' Floating Spheres Layout '),(0,r.createCommentVNode)(' 1. Start Game - Center Left-ish '),(0,r.createElementVNode)('div',Q,[(0,r.createVNode)(h,{label:'ÂºÄÂ±Ä',size:'md',color:'bg-cyan',delay:0,onClick:t[0]||(t[0]=t=>e.$router.push('/new-game'))})]),(0,r.createCommentVNode)(' 2. Workshop - Center Right, Large '),(0,r.createElementVNode)('div',q,[(0,r.createVNode)(h,{label:'ÂàõÊÑèÂ∑•Âùä',size:'lg',color:'bg-violet',delay:1,onClick:t[1]||(t[1]=t=>e.$router.push('/workshop'))})]),(0,r.createCommentVNode)(' 3. Load Game - Bottom Center-Left, Small '),(0,r.createElementVNode)('div',Z,[(0,r.createVNode)(h,{label:'ËØªÊ°£',size:'sm',color:'bg-fuchsia',delay:2,onClick:t[2]||(t[2]=t=>e.$router.push('/load-game'))})]),(0,r.createVNode)(S,{visible:l.value,'onUpdate:visible':t[3]||(t[3]=e=>l.value=e),message:c.value,type:s.value},null,8,['visible','message','type'])]))}}),te=(0,y.A)(ee,[['__scopeId','data-v-8e0e978a']]),ae={class:'confirm-header'},ne={class:'confirm-message'},oe=(0,r.defineComponent)({__name:'ConfirmModal',props:{visible:{type:Boolean},title:{},message:{}},emits:['update:visible','confirm','cancel'],setup(e,{emit:t}){const a=t;function n(){a('update:visible',!1),a('cancel')}function o(){a('update:visible',!1),a('confirm')}return(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'body'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'confirm-overlay',onClick:(0,r.withModifiers)(n,['self'])},[(0,r.createVNode)(N,{class:'confirm-box'},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',ae,[(0,r.createVNode)(v,{name:'alert',size:'1.5em',class:'warn-icon'}),(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(e.title||'Á°ÆËÆ§Êìç‰Ωú'),1)]),(0,r.createElementVNode)('p',ne,(0,r.toDisplayString)(e.message),1),(0,r.createElementVNode)('div',{class:'confirm-actions'},[(0,r.createElementVNode)('button',{class:'btn-cancel',onClick:n},'ÂèñÊ∂à'),(0,r.createElementVNode)('button',{class:'btn-confirm',onClick:o},'Á°ÆÂÆö')])]),_:1})])):(0,r.createCommentVNode)('v-if',!0)]),_:1})]))}}),le=(0,y.A)(oe,[['__scopeId','data-v-7f68815a']]);var re=l(894);const ie=new Map;function ce(e){try{if('function'==typeof globalThis.structuredClone)return globalThis.structuredClone(e)}catch{}return JSON.parse(JSON.stringify(e))}async function se(e){return await re.idbService.getKV(e)}async function de(e,t){await re.idbService.setKV(e,ce(t))}function ue(e,t,a=250){const n=ie.get(e);'number'==typeof n&&window.clearTimeout(n);const o=window.setTimeout(()=>{ie.delete(e),re.idbService.setKV(e,ce(t))},Math.max(0,a));ie.set(e,o)}const me='gameSettings',pe='gameSettings_v1';let ve=null,ge=null;function fe(e){return e&&'object'==typeof e?e:{}}async function ye(){return ve?fe(ve):ge||(ge=(async()=>{const e=await se(pe);if(e&&'object'==typeof e)return ve=e,fe(ve);try{const e=localStorage.getItem(me);if(e){const t=JSON.parse(e);return ve=fe(t),await de(pe,ve),localStorage.removeItem(me),fe(ve)}}catch{}return ve={},fe(ve)})().finally(()=>{ge=null}),ge)}async function he(e){ve=fe(e),await de(pe,ve)}function ke(e,t=250){ve=fe(e),ue(pe,ve,t)}const Ne=e=>(e??'').toLowerCase(),Ee=e=>{if(!e)return'';if(!e.includes('&'))return e;let t=e.replace(/&lt;/gi,'<').replace(/&gt;/gi,'>').replace(/&amp;/gi,'&').replace(/&quot;/gi,'"').replace(/&#39;/gi,'\'');return t=t.replace(/&#60;/g,'<').replace(/&#62;/g,'>').replace(/&#x3c;/gi,'<').replace(/&#x3e;/gi,'>'),t},Ve=(e,t,a)=>{const n=`<${t}`;return e.lastIndexOf(n,Math.max(0,a))},be=(e,t,a)=>{const n=`</${t}>`;return e.indexOf(n,Math.max(0,a))},we=(e,t='content')=>{const a=new RegExp(`<${t}\\b`,'gi');let n,o=-1;for(;null!==(n=a.exec(e));)o=n.index;return o};function Ce(e,t='content',a=['think','analysis']){let n=String(e??'');if(!n)return'';const o=Ne(n);if(we(o,t)<0)return n;for(const e of a){const a=Ne(n),o=be(a,e,0),l=a.includes(`<${e}`);o>=0&&!l&&(n=n.slice(0,o)+`<${e}>`+n.slice(o));const r=Ne(n),i=we(r,t);if(i<0)continue;const c=Ve(r,e,i);if(c<0)continue;const s=be(r,e,c+1);(s<0||s>i)&&(n=n.slice(0,i)+`</${e}>`+n.slice(i))}return n}function Se(e){return function(e,t=['think','analysis']){let a=Ce(Ee(String(e??'')),'content',t);if(!a)return'';for(const e of t){const t=new RegExp(`<${e}\\b[^>]*>[\\s\\S]*?<\\/${e}>`,'gi');for(a=a.replace(t,'');;){const t=Ne(a),n=t.indexOf(`<${e}`);if(n<0)break;const o=t.indexOf(`</${e}>`,n+1);if(o<0){a=a.slice(0,n);break}a=a.slice(0,n)+a.slice(o+`</${e}>`.length)}}return a}(e,['think','analysis'])}function Be(e,t,a={}){const{stripThink:n=!0}=a,o=Ee(String(e??''));if(!o)return null;const l=n?Se(o):o,r=new RegExp(`<${t}\\b[^>]*>([\\s\\S]*?)<\\/${t}>`,'gi');let i,c=null;for(;null!==(i=r.exec(l));)c='string'==typeof i[1]?i[1]:'';return null===c?null:c}const xe=e=>(e??'').toLowerCase(),_e=(e,t)=>{let a=-1;for(const n of t){const t=e.indexOf(n);t>=0&&(a<0||t<a)&&(a=t)}return a},Ie=(e,t,a)=>{const n=Math.max(0,Math.min(t,e.length));return e.slice(0,n)+a+e.slice(n)},Te=e=>(e??'').replace(/\r\n/g,'\n'),Ae=(e,t)=>{const a=Te(String(e??''));if(!a)return null;const n=new RegExp(`<${t}\\b[^>]*>([\\s\\S]*?)<\\/${t}>`,'gi');let o,l=null;for(;null!==(o=n.exec(a));)l='string'==typeof o[1]?o[1]:'';return l};function De(e){let t=(e=>{if(!e)return'';if(!e.includes('&'))return e;let t=e.replace(/&lt;/gi,'<').replace(/&gt;/gi,'>').replace(/&amp;/gi,'&').replace(/&quot;/gi,'"').replace(/&#39;/gi,'\'');return t=t.replace(/&#60;/g,'<').replace(/&#62;/g,'>').replace(/&#x3c;/gi,'<').replace(/&#x3e;/gi,'>'),t})(String(e??''));if(!t)return'';if(!(/<(think|analysis|content|Â∞èÊÄªÁªì|Â§ßÊÄªÁªì|small_summary|big_summary|big-summary)\b/i.test(t)||/<\/think>/i.test(t))){const e=String(t).trim();return e?`<think></think><content>\n${e}\n</content><Â∞èÊÄªÁªì></Â∞èÊÄªÁªì>`:''}t=t.replace(/<analysis\b[^>]*>/gi,'<think>').replace(/<\/analysis>/gi,'</think>'),t=t.replace(/<\s*state_bar\b[^>]*>/gi,'<Â∞èÊÄªÁªì>').replace(/<\s*\/\s*state_bar\s*>/gi,'</Â∞èÊÄªÁªì>').replace(/<\s*small_summary\b[^>]*>/gi,'<Â∞èÊÄªÁªì>').replace(/<\s*\/\s*small_summary\s*>/gi,'</Â∞èÊÄªÁªì>').replace(/<\s*big_summary\b[^>]*>/gi,'<Â§ßÊÄªÁªì>').replace(/<\s*\/\s*big_summary\s*>/gi,'</Â§ßÊÄªÁªì>').replace(/<\s*big-summary\b[^>]*>/gi,'<Â§ßÊÄªÁªì>').replace(/<\s*\/\s*big-summary\s*>/gi,'</Â§ßÊÄªÁªì>'),t=t.replace(/<think\b[^>]*>/gi,'<think>').replace(/<content\b[^>]*>/gi,'<content>').replace(/<Â∞èÊÄªÁªì\b[^>]*>/gi,'<Â∞èÊÄªÁªì>').replace(/<Â§ßÊÄªÁªì\b[^>]*>/gi,'<Â§ßÊÄªÁªì>');const a=t.replace(/^\s+/,'');xe(a).startsWith('<think')||(t='<think>\n'+t),t=Ce(t,'content',['think']);const n=['<Â∞èÊÄªÁªì>','<Â§ßÊÄªÁªì>'],o=xe(t);if(o.includes('<think')&&!o.includes('</think>')){const e=[o.indexOf('<content'),_e(o,n.map(e=>e.toLowerCase()))].filter(e=>'number'==typeof e&&e>=0),a=e.length>0?Math.min(...e):t.length;t=Ie(t,a,'</think>')}t=function(e){const t=String(e??'');return t?t.replace(/<think\b[^>]*>([\s\S]*?)<\/think>/gi,(e,t)=>{const a=(e=>e?e.replace(/<\/?\s*(content|state_bar|Â∞èÊÄªÁªì|Â§ßÊÄªÁªì|small_summary|big_summary|big-summary)\b[^>]*>/gi,''):'')(String(t??''));return e.replace(t,a)}):''}(t);const l=xe(t).indexOf('</think>');if(l>=0){const e=l+8;t=t.replace(/<\/think>\s*<content\b/gi,'</think><content');xe(t).includes('<content')||(t=Ie(t,e,'<content>'))}else t='<think>\n</think>'+t;const r=xe(t),i=r.indexOf('<content'),c=r.indexOf('</content>'),s=xe(t),d=_e(s,n.map(e=>e.toLowerCase()));i>=0&&(c<0?d>=0?t=Ie(t,d,'</content>'):t+='</content>':t=t.replace(/<\/content>\s*<Â∞èÊÄªÁªì>/g,'</content><Â∞èÊÄªÁªì>'));if(!xe(t).includes('<Â∞èÊÄªÁªì>')){const e=d>=0?d:t.length;t=Ie(t,e,'<Â∞èÊÄªÁªì>\n</Â∞èÊÄªÁªì>'),t=t.replace(/<\/content>\s*<Â∞èÊÄªÁªì>/g,'</content><Â∞èÊÄªÁªì>')}t=t.replace(/<\/think>\s*<content\b/gi,'</think><content');const u=Ae(t,'think')??'';let m=Ae(t,'content')??'';const p=Ae(t,'Â∞èÊÄªÁªì')??'',v=Ae(t,'Â§ßÊÄªÁªì')??'';if(!m.trim()){const e=(e=>{const t=Te(String(e??''));return t?t.replace(/<think\b[^>]*>[\s\S]*?<\/think>/gi,'').replace(/<content\b[^>]*>[\s\S]*?<\/content>/gi,'').replace(/<Â∞èÊÄªÁªì\b[^>]*>[\s\S]*?<\/Â∞èÊÄªÁªì>/gi,'').replace(/<Â§ßÊÄªÁªì\b[^>]*>[\s\S]*?<\/Â§ßÊÄªÁªì>/gi,'').trim():''})(t);e&&(m=e)}return((e,t,a,n)=>{const o=(e??'').trim(),l=(t??'').trim(),r=(a??'').trim(),i=(n??'').trim();let c=`<think>\n${o}\n</think><content>\n${l}\n</content><Â∞èÊÄªÁªì>\n${r}\n</Â∞èÊÄªÁªì>`;return i&&(c+=`<Â§ßÊÄªÁªì>\n${i}\n</Â§ßÊÄªÁªì>`),c})(u,m,p,v)}const Me=e=>{const t=(e=>{if(!e||'object'!=typeof e)return'';if('performance'===e.kind)return'';const t=[e.text,e.content,e.message,e.rawText,e.raw];for(const e of t){const t='string'==typeof e?e.trim():'';if(t)return t}return''})(e);if(!t)return'';const a='string'==typeof e?.name?e.name.trim():'',n='string'==typeof e?.emotion?e.emotion.trim():'',o='string'==typeof e?.outfit?e.outfit.trim():'';if(!(Boolean(a)&&(Boolean(n)||Boolean(o))))return t;return`[${[a,n||'null',o||'null'].join(' | ')}]\n${t}`};function Pe(e,t=2e4){try{const a=Array.isArray(e?.dialogueQueue)?e.dialogueQueue:[],n=Array.isArray(e?.historyLog)?e.historyLog:[],o=a.length>0?a:n;if(0===o.length)return'';const l=[],r=24;for(let e=o.length-1;e>=0&&l.length<r;e--){const t=Me(o[e]);t&&l.push(t)}const i=l.reverse().join('\n\n').trim();if(!i)return'';const c=De(`<think></think><content>\n${i}\n</content><Â∞èÊÄªÁªì></Â∞èÊÄªÁªì>`);return c.length>t?c.slice(c.length-t):c}catch{return''}}const Oe='ÂêåÊ¢¶',Re='‰∫ëÂ≠òÊ°£',$e=e=>'string'==typeof e&&e.trim().length>0;async function Le(){try{const e=await async function(){try{const e=window;if('function'!=typeof e.getWorldbook)return null;const t=await e.getWorldbook(Oe);if(!Array.isArray(t))return null;const a=t.find(e=>e?.name===Re),n='string'==typeof a?.content?a.content:'';if(!n.trim())return null;const o=JSON.parse(n);return o&&'object'==typeof o?{id:'cloud',slotType:'cloud',autoIndex:void 0,isCloud:!0,timestamp:'number'==typeof o.timestamp?o.timestamp:Date.now(),title:'string'==typeof o.title&&o.title.trim()?o.title:'‰∫ëÂ≠òÊ°£',thumbnail:'string'==typeof o.thumbnail?o.thumbnail:void 0,screenshot:'string'==typeof o.screenshot?o.screenshot:void 0,eventPackId:'string'==typeof o.eventPackId?o.eventPackId:'',eventPackName:'string'==typeof o.eventPackName?o.eventPackName:'',charIds:Array.isArray(o.charIds)?o.charIds.map(String):[],firstLine:'string'==typeof o.firstLine?o.firstLine:void 0,worldbookEntries:Array.isArray(o.worldbookEntries)?o.worldbookEntries:[],sessionData:o.sessionData&&'object'==typeof o.sessionData?o.sessionData:{dialogueQueue:[],currentLineIndex:0,historyLog:[],gameSettings:{}}}:null}catch(e){return console.warn('[saveSystem] readCloudSaveFromWorldbook failed:',e),null}}();return e?(await re.idbService.saveSave(e),e):null}catch(e){return console.warn('[saveSystem] syncCloudSaveFromWorldbook failed:',e),null}}async function Ue(t){const a=t.screenshotDataUrl||(t.screenshotSelector?await async function(t){const a=e=>new Promise(t=>setTimeout(t,e)),n=()=>new Promise(e=>requestAnimationFrame(()=>e())),o=document.querySelector(t);if(o){await(async(e,t=6)=>{for(let o=0;o<t;o++){const t=e.getBoundingClientRect();if(t.width>0&&t.height>0)return!0;await n(),await a(16)}return!1})(o);for(let t=0;t<3;t++)try{await n(),await n();const t=await e(o,{logging:!1,useCORS:!0,scale:1.2,ignoreElements:e=>{if(e instanceof HTMLCanvasElement){const t=e.width||e.clientWidth||0,a=e.height||e.clientHeight||0;if(t<=0||a<=0)return!0}return!1}});if(!t||t.width<=0||t.height<=0){await a(30);continue}return t.toDataURL('image/jpeg',.8)}catch(e){if(t<2){await a(50);continue}return void console.warn('[saveSystem] captureScreenshot failed:',e)}}}(t.screenshotSelector):void 0),n=await async function(){try{const e=await window.getWorldbook(Oe);if(!Array.isArray(e))return[];const t=e.filter(e=>{const t=e?.name||'';return'ÂèòÈáèÂ∫ìÁªìÊûÑÂÆö‰πâ - Ê≠£Êñá'===t||'ÂΩìÂâçÊ∏∏ÊàèÊï∞ÊçÆ'===t||!!/^„Äê[^„Äë]*„Äë„Äê[^„Äë]*„Äë„Äê[^„Äë]*„Äë„Äê[^„Äë]*„Äë/.test(t)||!!(t.includes('Â§ßÊÄªÁªì')||t.includes('Â∞èÊÄªÁªì')||t.includes('Â∞èÊÄªÁªìÂ§á‰ªΩ'))||'Áé©ÂÆ∂Ê°£Ê°à'===t});return JSON.parse(JSON.stringify(t))}catch(e){return console.warn('[saveSystem] collectWorldbookSnapshot failed:',e),[]}}(),o=t.firstLine||(t.dialogueQueue?.[0]?.text?String(t.dialogueQueue[0].text).slice(0,120):''),l=t.protagonist&&($e(t.protagonist.name)||$e(t.protagonist.imageUrl))?{name:$e(t.protagonist.name)?t.protagonist.name:'',imageUrl:$e(t.protagonist.imageUrl)?t.protagonist.imageUrl:''}:void 0;return{id:$e(t.idOverride)?t.idOverride:'auto'===t.slotType?`auto_${t.autoIndex||1}_${Date.now()}`:'cloud'===t.slotType?`cloud_${Date.now()}`:`manual_${Date.now()}`,slotType:t.slotType,autoIndex:'auto'===t.slotType?t.autoIndex||1:void 0,isCloud:'cloud'===t.slotType,timestamp:Date.now(),title:t.title||('auto'===t.slotType?'Ëá™Âä®Â≠òÊ°£':'ÊâãÂä®Â≠òÊ°£'),thumbnail:t.thumbnail,screenshot:a,eventPackId:t.eventPackId,eventPackName:t.eventPackName,charIds:t.charIds||[],firstLine:o,worldbookEntries:n,sessionData:{dialogueQueue:t.dialogueQueue||[],currentLineIndex:t.currentLineIndex||0,historyLog:t.historyLog||[],gameSettings:t.gameSettings||{},protagonist:l,eventPackData:t.eventPackData,lastFinalText:'string'==typeof t.lastFinalText?t.lastFinalText.length>2e4?t.lastFinalText.slice(t.lastFinalText.length-2e4):t.lastFinalText:void 0}}}async function ze(e){const t=e.filter(e=>'auto'===e.slotType).sort((e,t)=>t.timestamp-e.timestamp),a=e.filter(e=>'manual'===e.slotType).sort((e,t)=>t.timestamp-e.timestamp),n=e.filter(e=>'cloud'===e.slotType).sort((e,t)=>t.timestamp-e.timestamp),o=t.slice(2),l=a.slice(7),r=n.slice(0,1),i=n.slice(1);for(const e of[...o,...l,...i])await re.idbService.deleteSave(e.id).catch(()=>{});if(r.length>0&&n.length>1)for(const e of i)await re.idbService.deleteSave(e.id).catch(()=>{})}function Fe(e,t){return e.filter(t).sort((e,t)=>t.timestamp-e.timestamp)[0]}async function We(e){const t=await re.idbService.getAllSaves(),a=Fe(t,e=>'cloud'===e.slotType||!0===e.isCloud),n=Fe(t,e=>'auto'===e.slotType&&1===e.autoIndex),o=await Ue({...e,slotType:'cloud',autoIndex:void 0,title:'‰∫ëÂ≠òÊ°£',idOverride:'cloud'});if(o.isCloud=!0,await re.idbService.saveSave(o),await async function(e){try{const t=JSON.stringify(e,null,2),a=await window.getWorldbook(Oe),n=a.findIndex(e=>e.name===Re),o={uid:Date.now(),name:Re,enabled:!1,content:t,probability:0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:0,order:901},recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}};-1===n?a.push(o):a[n]={...a[n],...o,uid:a[n].uid||o.uid},await window.replaceWorldbook(Oe,a)}catch(e){console.warn('[saveSystem] writeCloudEntry failed:',e)}}(o),a){const e={...a,id:'auto_1',slotType:'auto',autoIndex:1,isCloud:!1,title:'Ëá™Âä®Â≠òÊ°£ 1'};await re.idbService.saveSave(e)}if(n){const e={...n,id:'auto_2',slotType:'auto',autoIndex:2,isCloud:!1,title:'Ëá™Âä®Â≠òÊ°£ 2'};await re.idbService.saveSave(e)}const l=await re.idbService.getAllSaves();for(const e of l)'auto'===e.slotType&&'auto_1'!==e.id&&'auto_2'!==e.id&&await re.idbService.deleteSave(e.id).catch(()=>{}),'cloud'===e.slotType&&'cloud'!==e.id&&await re.idbService.deleteSave(e.id).catch(()=>{});await ze(await re.idbService.getAllSaves())}const je={class:'load-game-view'},Ge={class:'header'},Je={class:'header-left'},Ye={class:'back-icon-wrapper'},He={class:'saves-container'},Xe={key:0,class:'loading-state'},Ke={class:'save-thumbnail'},Qe=['src'],qe={key:1,class:'placeholder-thumb'},Ze={class:'save-info'},et={class:'save-header'},tt={class:'save-chapter'},at={key:0,class:'save-date'},nt={class:'save-summary'},ot={key:0,class:'save-firstline'},lt={class:'save-actions'},rt=['onClick'],it=['onClick'],ct={key:0,class:'no-saves compact'},st={class:'save-thumbnail'},dt=['src'],ut={key:1,class:'placeholder-thumb'},mt={class:'save-info'},pt={class:'save-header'},vt={class:'save-chapter'},gt={class:'save-date'},ft={class:'save-summary'},yt={key:0,class:'save-firstline'},ht={class:'save-actions'},kt=['onClick'],Nt=['onClick'],Et=['onClick'],Vt={class:'no-saves'},bt=(0,r.defineComponent)({__name:'LoadGame',setup(e){const t=(0,i.useRouter)(),a=(0,r.ref)([]),n=(0,r.ref)(!0),o=(0,r.ref)(!1),l=(0,r.ref)([{key:'cloud',slotType:'cloud',fallbackTitle:'‰∫ëÂ≠òÊ°£',save:null},{key:'auto1',slotType:'auto',autoIndex:1,fallbackTitle:'Ëá™Âä®Â≠òÊ°£ 1',save:null},{key:'auto2',slotType:'auto',autoIndex:2,fallbackTitle:'Ëá™Âä®Â≠òÊ°£ 2',save:null}]),c=(0,r.ref)([]),s=(0,r.ref)(!1),d=(0,r.ref)(null),u=(0,r.ref)(!1),m=(0,r.ref)(''),p=(0,r.ref)('info');function g(e,t='info'){m.value=e,p.value=t,u.value=!0}async function f(){await G(),t.push('/')}async function y(){n.value=!0;try{await Le(),a.value=await re.idbService.getAllSaves(),a.value.sort((e,t)=>t.timestamp-e.timestamp),o.value=a.value.length>0;const e=a.value.find(e=>'cloud'===e.slotType||'cloud'===e.id)||null,t=a.value.find(e=>'auto'===e.slotType&&(1===e.autoIndex||'auto_1'===e.id))||null,n=a.value.find(e=>'auto'===e.slotType&&(2===e.autoIndex||'auto_2'===e.id))||null;l.value=[{key:'cloud',slotType:'cloud',fallbackTitle:'‰∫ëÂ≠òÊ°£',save:e},{key:'auto1',slotType:'auto',autoIndex:1,fallbackTitle:'Ëá™Âä®Â≠òÊ°£ 1',save:t},{key:'auto2',slotType:'auto',autoIndex:2,fallbackTitle:'Ëá™Âä®Â≠òÊ°£ 2',save:n}],c.value=a.value.filter(e=>'manual'===e.slotType).sort((e,t)=>t.timestamp-e.timestamp)}catch(e){console.error('[LoadGame] Failed to load saves:',e),a.value=[],o.value=!1,l.value=[{key:'cloud',slotType:'cloud',fallbackTitle:'‰∫ëÂ≠òÊ°£',save:null},{key:'auto1',slotType:'auto',autoIndex:1,fallbackTitle:'Ëá™Âä®Â≠òÊ°£ 1',save:null},{key:'auto2',slotType:'auto',autoIndex:2,fallbackTitle:'Ëá™Âä®Â≠òÊ°£ 2',save:null}],c.value=[]}finally{n.value=!1}}(0,r.onMounted)(async()=>{await async function(){return j({currentPage:'LoadGame'})}(),await y()});const h=(e,t)=>'auto'===e?`AUTO${t||''}`:'cloud'===e?'CLOUD':'MANUAL',k=e=>'auto'===e?'badge-auto':'cloud'===e?'badge-cloud':'badge-manual',E=e=>{if(!e)return'';const t='string'==typeof e.firstLine?e.firstLine.trim():'';if(t)return t;const a=e=>{if(!e||'object'!=typeof e)return'';if('performance'===e.kind)return'';const t=[e.text,e.content,e.message,e.rawText,e.raw];for(const e of t){const t='string'==typeof e?e.trim():'';if(t)return t.slice(0,120)}return''},n=e=>{if(!Array.isArray(e))return'';for(const t of e){const e=a(t);if(e)return e}return''},o=e?.sessionData;return n(o?.dialogueQueue)||n(o?.historyLog)||n(e?.historyLog)||''};function V(e){return new Date(e).toLocaleString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})}async function b(e){try{g('Ê≠£Âú®Âä†ËΩΩÂ≠òÊ°£...','loading');const a='ÂêåÊ¢¶',n=window.TavernHelper;n.getWorldbookNames().includes(a)||await n.createWorldbook(a),await n.rebindChatWorldbook('current',a);try{const t=window,n=(Array.isArray(e.worldbookEntries)?e.worldbookEntries:[]).filter(e=>{const t='string'==typeof e?.name?e.name:'';return'ÂâßÊÉÖ‰∫ã‰ª∂ - ÂºÄÂßã'!==t&&'ÂâßÊÉÖ‰∫ã‰ª∂ - ÁªìÊùü'!==t});if('function'==typeof t.getWorldbook&&'function'==typeof t.replaceWorldbook){const e=await t.getWorldbook(a),o=Array.isArray(e)?[...e]:[],l=new Set;for(const e of o)'number'==typeof e?.uid&&l.add(e.uid);const r=e=>o.findIndex(t=>t?.name===e);for(let e=0;e<n.length;e++){const t=n[e],a='string'==typeof t?.name?t.name:'';if(!a)continue;const i=r(a);if(-1!==i){const e=o[i]?.uid;o[i]={...o[i],...t,uid:'number'==typeof e?e:o[i]?.uid}}else{let a='number'==typeof t?.uid?t.uid:Date.now()+e;for(;l.has(a);)a++;l.add(a),o.push({...t,uid:a})}}await t.replaceWorldbook(a,o)}else n.length>0&&'function'==typeof t.createWorldbookEntries&&await t.createWorldbookEntries(a,n)}catch(e){console.warn('[LoadGame] Failed to restore worldbook entries:',e)}sessionStorage.setItem('current_game_event_id',e.eventPackId),sessionStorage.setItem('current_game_char_ids',JSON.stringify(e.charIds));try{const t=e.sessionData?.lastFinalText,a='string'==typeof t&&t.trim()?t:Pe(e.sessionData);if(a&&'string'==typeof a){const e=De(a),t=2e4;sessionStorage.setItem('last_final_text',e.length>t?e.slice(e.length-t):e)}else sessionStorage.removeItem('last_final_text')}catch{}if(sessionStorage.setItem('restore_save_id',e.id),sessionStorage.removeItem('restore_save_ref'),sessionStorage.removeItem('restore_save_data'),e.sessionData?.protagonist){const t=e.sessionData.protagonist,a=`save_${e.id}_protagonist`;await re.idbService.setRuntimeAsset(a,{imageUrl:t.imageUrl||''}),sessionStorage.setItem('current_game_protagonist_ref',JSON.stringify({name:t.name||'',runtimeId:a}))}e.sessionData?.gameSettings&&await he(e.sessionData.gameSettings),await Y({hasActiveGame:!0,variablesProcessed:!1,eventPackId:e.eventPackId,characterIds:e.charIds||[]}),t.push('/MainGame')}catch(e){console.error('[LoadGame] Failed to load:',e),g('ËØªÊ°£Â§±Ë¥•: '+(e.message||e),'error')}}async function w(){const e=d.value;if(d.value=null,e)try{await re.idbService.deleteSave(e),await y(),g('Â≠òÊ°£Â∑≤Âà†Èô§','success')}catch(e){console.error('[LoadGame] Failed to delete:',e),g('Âà†Èô§Â§±Ë¥•: '+(e.message||e),'error')}}function C(e){try{const t=JSON.stringify(e,null,2),a=new Blob([t],{type:'application/json'}),n=URL.createObjectURL(a),o=document.createElement('a');o.href=n,o.download=`save_${e.id}_${Date.now()}.json`,o.click(),URL.revokeObjectURL(n),g('ÂØºÂá∫ÊàêÂäü','success')}catch(e){console.error('[LoadGame] Failed to export:',e),g('ÂØºÂá∫Â§±Ë¥•: '+(e.message||e),'error')}}function B(){const e=document.createElement('input');e.type='file',e.accept='.json',e.onchange=async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.text(),a=JSON.parse(e);a.id=`imported_${Date.now()}`,a.timestamp=Date.now(),await re.idbService.saveSave(a),await y(),g('ÂØºÂÖ•ÊàêÂäü','success')}catch(e){console.error('[LoadGame] Failed to import:',e),g('ÂØºÂÖ•Â§±Ë¥•: '+(e.message||e),'error')}},e.click()}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',je,[(0,r.createCommentVNode)(' Header '),(0,r.createElementVNode)('div',Ge,[(0,r.createElementVNode)('div',Je,[(0,r.createElementVNode)('button',{class:'back-btn',onClick:f},[(0,r.createElementVNode)('div',Ye,[(0,r.createVNode)(v,{name:'back',size:20})])]),t[3]||(t[3]=(0,r.createElementVNode)('h1',{class:'page-title'},'ËÆ∞ÂøÜÂõûÊ∫Ø',-1))]),(0,r.createElementVNode)('button',{class:'import-btn',onClick:B},[(0,r.createVNode)(v,{name:'import',size:16}),t[4]||(t[4]=(0,r.createElementVNode)('span',null,'ÂØºÂÖ•Â≠òÊ°£ (Import)',-1))])]),(0,r.createCommentVNode)(' Save Slots Panel '),(0,r.createVNode)(N,{class:'saves-panel',fullHeight:!0},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',He,[(0,r.createCommentVNode)(' Loading State '),n.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Xe,[...t[5]||(t[5]=[(0,r.createElementVNode)('div',{class:'loading-spinner'},null,-1),(0,r.createElementVNode)('p',null,'Âä†ËΩΩ‰∏≠...',-1)])])):o.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Existing Saves '),t[9]||(t[9]=(0,r.createElementVNode)('div',{class:'section-title'},'Ëá™Âä® / ‰∫ëÂ≠òÊ°£',-1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.key,class:'save-item system-save',onClick:t[0]||(t[0]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.createElementVNode)('div',Ke,[e.save&&(e.save.screenshot||e.save.thumbnail)?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.save.screenshot||e.save.thumbnail,alt:'Save'},null,8,Qe)):((0,r.openBlock)(),(0,r.createElementBlock)('div',qe,[(0,r.createVNode)(v,{name:'image',size:32})])),t[6]||(t[6]=(0,r.createElementVNode)('div',{class:'thumbnail-overlay'},null,-1)),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['slot-badge',k(e.slotType)])},(0,r.toDisplayString)(h(e.slotType,e.autoIndex)),3)]),(0,r.createElementVNode)('div',Ze,[(0,r.createElementVNode)('div',et,[(0,r.createElementVNode)('h3',tt,(0,r.toDisplayString)(e.save?.title||e.fallbackTitle),1),e.save?((0,r.openBlock)(),(0,r.createElementBlock)('span',at,(0,r.toDisplayString)(V(e.save.timestamp)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('p',nt,(0,r.toDisplayString)(e.save?.eventPackName||'ÊöÇÊó†Â≠òÊ°£'),1),E(e.save)?((0,r.openBlock)(),(0,r.createElementBlock)('p',ot,(0,r.toDisplayString)(E(e.save)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',lt,[e.save?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn load-btn',title:'Load',onClick:(0,r.withModifiers)(t=>b(e.save),['stop'])},[(0,r.createVNode)(v,{name:'play',size:20})],8,rt)):(0,r.createCommentVNode)('v-if',!0),e.save?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'action-btn export-btn',title:'Export',onClick:(0,r.withModifiers)(t=>C(e.save),['stop'])},[(0,r.createVNode)(v,{name:'export',size:18})],8,it)):(0,r.createCommentVNode)('v-if',!0)])]))),128)),t[10]||(t[10]=(0,r.createElementVNode)('div',{class:'section-title'},'ÊâãÂä®Â≠òÊ°£',-1)),0===c.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',ct,[...t[7]||(t[7]=[(0,r.createElementVNode)('p',null,'ÊöÇÊó†ÊâãÂä®Â≠òÊ°£',-1),(0,r.createElementVNode)('span',null,'‰Ω†‰ªçÂèØËØªÂèñ‰∏äÊñπËá™Âä®/‰∫ëÂ≠òÊ°£ÔºàÂ¶ÇÊûúÊúâÔºâ',-1)])])):(0,r.createCommentVNode)('v-if',!0),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(c.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'save-item'},[(0,r.createElementVNode)('div',st,[e.screenshot||e.thumbnail?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.screenshot||e.thumbnail,alt:'Save'},null,8,dt)):((0,r.openBlock)(),(0,r.createElementBlock)('div',ut,[(0,r.createVNode)(v,{name:'image',size:32})])),t[8]||(t[8]=(0,r.createElementVNode)('div',{class:'thumbnail-overlay'},null,-1)),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['slot-badge',k(e.slotType)])},(0,r.toDisplayString)(h(e.slotType,e.autoIndex)),3)]),(0,r.createElementVNode)('div',mt,[(0,r.createElementVNode)('div',pt,[(0,r.createElementVNode)('h3',vt,(0,r.toDisplayString)(e.title||'Êú™ÂëΩÂêçÂ≠òÊ°£'),1),(0,r.createElementVNode)('span',gt,(0,r.toDisplayString)(V(e.timestamp)),1)]),(0,r.createElementVNode)('p',ft,(0,r.toDisplayString)(e.eventPackName||'Êú™Áü•‰∫ã‰ª∂ÂåÖ'),1),E(e)?((0,r.openBlock)(),(0,r.createElementBlock)('p',yt,(0,r.toDisplayString)(E(e)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',ht,[(0,r.createElementVNode)('button',{class:'action-btn load-btn',title:'Load',onClick:t=>b(e)},[(0,r.createVNode)(v,{name:'play',size:20})],8,kt),(0,r.createElementVNode)('button',{class:'action-btn export-btn',title:'Export',onClick:t=>C(e)},[(0,r.createVNode)(v,{name:'export',size:18})],8,Nt),(0,r.createElementVNode)('button',{class:'action-btn delete-btn',title:'Delete',onClick:t=>{return a=e.id,d.value=a,void(s.value=!0);var a}},[(0,r.createVNode)(v,{name:'trash',size:18})],8,Et)])]))),128))],64)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(' No Saves '),(0,r.createElementVNode)('div',Vt,[(0,r.createVNode)(v,{name:'info',size:48}),t[11]||(t[11]=(0,r.createElementVNode)('p',null,'ÊöÇÊó†Â≠òÊ°£',-1)),t[12]||(t[12]=(0,r.createElementVNode)('span',null,'ÂºÄÂßãÊñ∞Ê∏∏ÊàèÂêéÂèØÂú®Ê≠§ËØªÂèñÂ≠òÊ°£',-1))])],2112))])]),_:1}),(0,r.createCommentVNode)(' Temp Message '),(0,r.createVNode)(S,{visible:u.value,'onUpdate:visible':t[1]||(t[1]=e=>u.value=e),message:m.value,type:p.value},null,8,['visible','message','type']),(0,r.createCommentVNode)(' Delete Confirm '),(0,r.createVNode)(le,{visible:s.value,'onUpdate:visible':t[2]||(t[2]=e=>s.value=e),title:'Âà†Èô§Â≠òÊ°£',message:'Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Â≠òÊ°£ÂêóÔºüËØ•Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ',onConfirm:w},null,8,['visible'])]))}}),wt=(0,y.A)(bt,[['__scopeId','data-v-ddadd5c2']]),Ct='ÂêåÊ¢¶',St='ÂΩìÂâçÊ∏∏ÊàèÊï∞ÊçÆ',Bt={time:'Êó∂Èó¥',location:'Âú∞ÁÇπ',deviation:'ÂÅèÁßªÂ∫¶',personality:'ÊÄßÊ†º',background:'ËÉåÊôØ',trust:'Â•ΩÊÑüÂ∫¶',states:'Ë°®ÊÉÖ',outfits:'ÊúçË£Ö'};function xt(e){const t=(e||'').trim();if(!t)return t;const a=t.split('.').filter(Boolean);if(0===a.length)return t;'system'===a[0]&&(a[0]='Á≥ªÁªü'),'characters'===a[0]&&(a[0]='ËßíËâ≤');for(let e=0;e<a.length;e++){const t=Bt[a[e]];t&&(a[e]=t)}return a.join('.')}function _t(){const e=(e,t)=>{if(!e||'object'!=typeof e||!t||'object'!=typeof t)return 0;const a=Object.keys(t).filter(e=>!e.startsWith('<'));if(0===a.length)return 0;let n=0;for(const t of a)t in e&&n++;return n/a.length},t=async e=>{try{const t=(await window.getWorldbook(Ct)).find(e=>e.name===St);if(!t||!t.content)return console.warn('[VariableReader] Data entry not found'),null;let a;try{a=JSON.parse(t.content)}catch{return console.warn('[VariableReader] Failed to parse data entry as JSON'),null}const n=e=>{const t=e.split('.').filter(Boolean);let n=a;for(const e of t){if(null==n)return null;n=n[e]}return n},o=n(xt(e));return null!=o?o:n(e)}catch(t){return console.error('[VariableReader] Failed to read variable:',e,t),null}};return{readVariable:t,readAllData:async()=>{try{const e=(await window.getWorldbook(Ct)).find(e=>e.name===St);if(!e||!e.content)return console.warn('[VariableReader] Data entry not found'),null;try{return JSON.parse(e.content)}catch{return console.warn('[VariableReader] Failed to parse data entry as JSON'),null}}catch(e){return console.error('[VariableReader] Failed to read all data:',e),null}},getCurrentTime:async()=>await t('Á≥ªÁªü.Êó∂Èó¥')||'',getCurrentLocation:async()=>await t('Á≥ªÁªü.Âú∞ÁÇπ')||'',getCharacterData:async e=>await t(`ËßíËâ≤.${e}`),variableExists:async e=>{const a=await t(e);return null!=a},getDynamicKeys:async a=>{try{const n=xt(a),o=await t(n);if(!o||'object'!=typeof o)return console.warn(`[VariableReader] Container not found or invalid: ${n}`),[];const l=await(async()=>{try{const e=(await window.getWorldbook(Ct)).find(e=>'ÂèòÈáèÂ∫ìÁªìÊûÑÂÆö‰πâ - Ê≠£Êñá'===e.name);if(!e||!e.content)return console.warn('[VariableReader] Template definition entry not found'),null;try{const t=e.content.replace(/\/\/.*$/gm,'');return JSON.parse(t)}catch{return console.warn('[VariableReader] Failed to parse template definition as JSON'),null}}catch(e){return console.error('[VariableReader] Failed to read template definition:',e),null}})();if(!l)return console.warn('[VariableReader] Cannot read template definition'),[];const r=n.split('.');let i=l;for(const e of r){if(!i||'object'!=typeof i)return console.warn(`[VariableReader] Cannot find template path: ${n}`),[];i=i[e]}if(!i||'object'!=typeof i)return console.warn(`[VariableReader] Template not found at path: ${n}`),[];const c=Object.keys(i).find(e=>e.startsWith('<')&&e.endsWith('>'));if(!c)return console.warn(`[VariableReader] No dynamic template found in container: ${n}`),[];const s=i[c],d=.7,u=[];for(const t of Object.keys(o)){if(t.startsWith('//'))continue;const a=o[t];if('object'==typeof a&&null!==a&&!Array.isArray(a)){e(a,s)>=d&&u.push(t)}}return u}catch(e){return console.error('[VariableReader] Failed to get dynamic keys:',a,e),[]}},getDynamicInstance:async(e,a,n)=>{const o=xt(e),l=n?xt(n):void 0,r=l?`${o}.${a}.${l}`:`${o}.${a}`;return await t(r)}}}const It='ÂêåÊ¢¶',Tt='ÂΩìÂâçÊ∏∏ÊàèÊï∞ÊçÆ';function At(e){if(!e)return-1;const t=new Date(e);if(!isNaN(t.getTime()))return t.getTime();const a=e.match(/\d+/g);if(a&&a.length>0){if(1===a.length&&4===a[0].length)return new Date(`${a[0]}/01/01`).getTime();if(a.length>=3)return new Date(`${a[0]}/${a[1]}/${a[2]}`).getTime()}return-1}function Dt(e){const t=e.split('\n'),a=[];let n=[],o=-1;for(const e of t){const t=e.match(/(?:Ëß¶ÂèëÊó∂Èó¥|Trigger Time)[Ôºö:]\s*(\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}\s+\d{1,2}:\d{1,2})/i);t?(n.length>0&&a.push({time:o,text:n.join('\n').trim()}),o=At(t[1]),n=[e]):n.push(e)}return n.length>0&&a.push({time:o,text:n.join('\n').trim()}),a.filter(e=>-1!==e.time&&e.text)}function Mt(){return{updateStoryWorldbook:async(e,t)=>{if(!e.plotEvents||0===e.plotEvents.length)return;const a=At(t);-1===a&&console.warn('[StoryManager] Invalid reference time:',t);const n=[];for(const t of e.plotEvents){const e=Dt(t.content);n.push(...e)}if(console.log(`[StoryManager] Total sub-events extracted: ${n.length}`),0===n.length)return void console.warn('[StoryManager] No valid sub-events found');const o=n.filter(e=>e.time<=a),l=n.filter(e=>e.time>a);o.sort((e,t)=>t.time-e.time),l.sort((e,t)=>e.time-t.time);const r=[...o.slice(0,5),...l.slice(0,5)];r.sort((e,t)=>e.time-t.time);const i=[...o.slice(5),...l.slice(5)];i.sort((e,t)=>e.time-t.time);const c=[],s='Local',d=(t,a,n,o)=>({name:`„Äê${s}„Äë„Äê${e.name}„Äë„ÄêÂâßÊÉÖ‰∫ã‰ª∂„Äë„Äê${t}„Äë`,content:a,position:{type:'after_character_definition',order:n},enabled:o,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}});if(r.length>0){const e=r.map(e=>e.text).join('\n\n');c.push(d('current',e,302,!0))}for(let e=0;e<i.length;e+=10){const t=i.slice(e,e+10).map(e=>e.text).join('\n\n'),a=String(Math.floor(e/10)+1).padStart(3,'0');c.push(d(a,t,303+Math.floor(e/10),!1))}const u=new RegExp(`^„Äê${s}„Äë„Äê${e.name}„Äë„ÄêÂâßÊÉÖ‰∫ã‰ª∂„Äë„Äê.*?„Äë$`);window.deleteWorldbookEntries&&await window.deleteWorldbookEntries(It,e=>u.test(e.name)),c.length>0&&window.createWorldbookEntries&&await window.createWorldbookEntries(It,c),console.log(`[StoryManager] Updated plot events. Active: ${r.length}, Inactive: ${i.length}`)},cleanGameDataEntry:async()=>{try{window.deleteWorldbookEntries&&(await window.deleteWorldbookEntries(It,e=>e.name===Tt||e.name.includes(Tt)),console.log('[StoryManager] Cleaned up game data entry:',Tt))}catch(e){console.warn('[StoryManager] Failed to clean game data:',e)}},getCurrentGameTime:async()=>{const{getCurrentTime:e}=_t();return await e()}}}const Pt='üü¢ÈíàÂØπ„Äê‰ΩéÂÅèÁ¶ªÂ∫¶„ÄëÁöÑÊåá‰ª§',Ot='üü°ÈíàÂØπ„Äê‰∏≠ÂÅèÁ¶ªÂ∫¶„ÄëÁöÑÊåá‰ª§',Rt='üî¥ÈíàÂØπ„ÄêÈ´òÂÅèÁ¶ªÂ∫¶„ÄëÁöÑÊåá‰ª§';async function $t(e){try{const t=window.updateWorldbookWith;if('function'!=typeof t)return void console.warn('[DeviationPrompt] updateWorldbookWith not available');await t('ÂêåÊ¢¶',t=>t.map(t=>t.name===Pt?{...t,strategy:{...t.strategy,type:'low'===e?'constant':'selective'}}:t.name===Ot?{...t,strategy:{...t.strategy,type:'mid'===e?'constant':'selective'}}:t.name===Rt?{...t,strategy:{...t.strategy,type:'high'===e?'constant':'selective'}}:t)),console.log(`[DeviationPrompt] Set active level to: ${e}`)}catch(e){console.error('[DeviationPrompt] Failed to update deviation entries:',e)}}async function Lt(e){const t=function(e){try{const t=e?.Á≥ªÁªü?.ÂÅèÁßªÂ∫¶;if('string'==typeof t){const e=t.toLowerCase();return e.includes('È´ò')||'high'===e?'high':e.includes('‰∏≠')||'mid'===e||'medium'===e?'mid':'low'}return'number'==typeof t?t>=67?'high':t>=34?'mid':'low':'low'}catch(e){return console.warn('[DeviationPrompt] Failed to parse deviation from game data:',e),'low'}}(e);await $t(t)}const Ut=t.create({baseURL:'https://workshop.ab003317.dpdns.org',withCredentials:!0,timeout:15e3}),zt=12e4;Ut.interceptors.request.use(e=>{const t=(e.method||'get').toLowerCase(),a='get'!==t&&'head'!==t&&'options'!==t;try{e.headers=e.headers||{},e.headers['X-Client-Request-Id']||(e.headers['X-Client-Request-Id']=crypto.randomUUID())}catch{}const n=x.getAccessToken();return n&&(e.headers=e.headers||{},e.headers.Authorization=`Bearer ${n}`),a&&(e.headers=e.headers||{},e.headers['X-Requested-With']='XMLHttpRequest'),e});const Ft={listPublicItems:async(e,t)=>(await Ut.get('/api/workshop/items',{params:e,...'number'==typeof t?.timeoutMs?{timeout:t.timeoutMs}:null})).data,getItem:async(e,t)=>(await Ut.get(`/api/workshop/items/${encodeURIComponent(e)}`,'number'==typeof t?.timeoutMs?{timeout:t.timeoutMs}:void 0)).data,listMyItems:async(e,t)=>(await Ut.get('/api/workshop/my-items',{params:e,...'number'==typeof t?.timeoutMs?{timeout:t.timeoutMs}:null})).data,getMyItemByClientId:async(e,t)=>(await Ut.get(`/api/workshop/my-items/by-client-id/${encodeURIComponent(e)}`,{...'number'==typeof t?.timeoutMs?{timeout:t.timeoutMs}:null,...t?.signal?{signal:t.signal}:null})).data,getUserUsage:async()=>(await Ut.get('/api/workshop/user/usage')).data,createItem:async(e,t)=>(await Ut.post('/api/workshop/items',e,{timeout:'number'==typeof t?.timeoutMs?t.timeoutMs:zt,headers:{...t?.requestId?{'X-Client-Request-Id':t.requestId}:null,...t?.clientContentSha256?{'X-Client-Content-Sha256':t.clientContentSha256}:null},...t?.onUploadProgress?{onUploadProgress:t.onUploadProgress}:null,...t?.signal?{signal:t.signal}:null})).data,upsertItemByClientId:async(e,t,a)=>(await Ut.put(`/api/workshop/items/by-client-id/${encodeURIComponent(e)}`,t,{timeout:'number'==typeof a?.timeoutMs?a.timeoutMs:zt,params:a?.async?{async:1}:void 0,headers:{...a?.requestId?{'X-Client-Request-Id':a.requestId}:null,...a?.clientContentSha256?{'X-Client-Content-Sha256':a.clientContentSha256}:null,...a?.preferRespondAsync?{Prefer:'respond-async'}:null},...a?.onUploadProgress?{onUploadProgress:a.onUploadProgress}:null,...a?.signal?{signal:a.signal}:null})).data,getOperation:async(e,t)=>(await Ut.get(`/api/workshop/operations/${encodeURIComponent(e)}`,{...'number'==typeof t?.timeoutMs?{timeout:t.timeoutMs}:null,...t?.signal?{signal:t.signal}:null})).data,updateItem:async(e,t,a)=>(await Ut.put(`/api/workshop/items/${encodeURIComponent(e)}`,t,{timeout:'number'==typeof a?.timeoutMs?a.timeoutMs:zt,...a?.signal?{signal:a.signal}:null})).data,deleteItem:async(e,t)=>(await Ut.delete(`/api/workshop/items/${encodeURIComponent(e)}`,{timeout:'number'==typeof t?.timeoutMs?t.timeoutMs:zt,...t?.signal?{signal:t.signal}:null})).data,recordDownload:async e=>(await Ut.post(`/api/workshop/items/${encodeURIComponent(e)}/download`)).data},Wt='ÂêåÊ¢¶',jt='ÂΩìÂâçÊ∏∏ÊàèÊï∞ÊçÆ',Gt=JSON.parse('{"Á≥ªÁªü":{"Êó∂Èó¥":"String","//Êó∂Èó¥":"Format: YYYY/MM/DD HH:MM","Âú∞ÁÇπ":"String","//Âú∞ÁÇπ":"ËØ¶ÁªÜÂú∞ÁÇπ","ÂÅèÁßªÂ∫¶":"String","//ÂÅèÁßªÂ∫¶":"Format: ‰Ωé/‰∏≠/È´ò"},"ËßíËâ≤":{"<ÂêçÂ≠ó>":{"Â§ñË≤å":"String","//Â§ñË≤å":"50Â≠óÂ§ñË≤åÊèèËø∞","ÊÄßÊ†º":"String","//ÊÄßÊ†º":"50Â≠óÊÄßÊ†º","ËÉåÊôØ":"String","//ËÉåÊôØ":"100Â≠óËÉåÊôØ","Â•ΩÊÑüÂ∫¶":"Int","//Â•ΩÊÑüÂ∫¶":"Â•ΩÊÑüÂ∫¶0-100","Ë°®ÊÉÖ":["String"],"//Ë°®ÊÉÖ":"Á´ãÁªòË°®ÊÉÖÂ∑ÆÂàÜ,‰æãÂ¶Ç: ÂºÄÂøÉ,ÊÇ≤‰º§„ÄÇreadOnly,Áî±Áé©ÂÆ∂Ëá™Ë°åÁÆ°ÁêÜ","ÊúçË£Ö":["String"],"//ÊúçË£Ö":"Á´ãÁªòÊúçË£ÖÂ∑ÆÂàÜ,‰æãÂ¶Ç: Ê†°Êúç,‰æøÊúç„ÄÇreadOnly,Áî±Áé©ÂÆ∂Ëá™Ë°åÁÆ°ÁêÜ"},"//<ÂêçÂ≠ó>":"ËøôÈáåÁöÑ <ÂêçÂ≠ó> ‰ª£Ë°®‰∫∫Áâ©ÁöÑÂêçÂ≠óÔºåÂ¶Ç \\"Áî∞‰∏≠\\"„ÄÅ\\"‰ΩêËó§\\" Á≠â"}}');let Jt=null;function Yt(e,t=''){Jt||(Jt={containerPaths:[],dynamicContainers:new Map});for(const a of Object.keys(e)){if(a.startsWith('//'))continue;const n=t?`${t}.${a}`:a,o=e[a];if('object'==typeof o&&!Array.isArray(o)&&null!==o){const e=Object.keys(o).find(e=>e.startsWith('<')&&e.endsWith('>'));if(e){Jt.containerPaths.push(n);const t=o[e];if('object'==typeof t&&!Array.isArray(t)){const e=Object.keys(t).filter(e=>!e.startsWith('//'));Jt.dynamicContainers.set(n,e)}}else Yt(o,n)}}}function Ht(){return Object.keys(Gt).filter(e=>!(e.startsWith('//')||e.startsWith('<')&&e.endsWith('>')))}Yt(Gt);const Xt={time:'Êó∂Èó¥',location:'Âú∞ÁÇπ',deviation:'ÂÅèÁßªÂ∫¶',personality:'ÊÄßÊ†º',background:'ËÉåÊôØ',trust:'Â•ΩÊÑüÂ∫¶',states:'Ë°®ÊÉÖ',outfits:'ÊúçË£Ö'};function Kt(e){const t=(e||'').trim();if(!t)return t;const a=t.split('.').filter(Boolean);if(0===a.length)return t;const n=Object.prototype.hasOwnProperty.call(Gt,'Á≥ªÁªü'),o=Object.prototype.hasOwnProperty.call(Gt,'ËßíËâ≤');n&&'system'===a[0]&&(a[0]='Á≥ªÁªü'),o&&'characters'===a[0]&&(a[0]='ËßíËâ≤');for(let e=0;e<a.length;e++){const t=Xt[a[e]];t&&(a[e]=t)}return a.join('.')}function Qt(e){const t=(e||'').trim();if(!t)return t;const a=Kt(t);if(la(a))return a;Jt||Yt(Gt);const n=new Set(Ht()),o=a.split('.').filter(Boolean);if(o.length<2)return a;if(n.has(o[0]))return a;const l=[];for(const[e,t]of Jt.dynamicContainers.entries()){const n=o[o.length-1];if(!t.includes(n))continue;const r=e.split('.').pop()||'';let i=a;o[0]===r&&(i=o.slice(1).join('.')),i.startsWith(e+'.')||l.push({containerPath:e,normalized:`${e}.${i}`})}return 0===l.length?a:(l.sort((e,t)=>t.containerPath.length-e.containerPath.length),l[0].normalized)}function qt(e){if(!e||'object'!=typeof e)return;Jt||Yt(Gt);const t=new Set(Ht()),a=t.has('ËßíËâ≤')?'ËßíËâ≤':'characters',n=Jt?.dynamicContainers.get(a)||[];if(0!==n.length){e[a]&&'object'==typeof e[a]||(e[a]={});for(const o of Object.keys(e)){if(o.startsWith('//'))continue;if(t.has(o))continue;const l=e[o];if(!l||'object'!=typeof l||Array.isArray(l))continue;if(n.reduce((e,t)=>e+(t in l?1:0),0)<2)continue;const r=e[a][o];if(r){if(r&&'object'==typeof r&&!Array.isArray(r))for(const e of Object.keys(l))e.startsWith('//')||void 0===r[e]&&(r[e]=l[e])}else e[a][o]=l;delete e[o]}}}function Zt(e){if(!e||'object'!=typeof e)return;const t=new Set(Ht()),a=t.has('Á≥ªÁªü'),n=t.has('ËßíËâ≤');if(a&&e.system&&'object'==typeof e.system&&!e.Á≥ªÁªü){const t=e.system;e.Á≥ªÁªü={Êó∂Èó¥:'string'==typeof t.time?t.time:'',Âú∞ÁÇπ:'string'==typeof t.location?t.location:'',ÂÅèÁßªÂ∫¶:'string'==typeof t.deviation?t.deviation:'‰Ωé'};for(const a of Object.keys(t))'time'!==a&&'location'!==a&&'deviation'!==a&&(e.Á≥ªÁªü[a]=t[a]);delete e.system}if(n&&e.characters&&'object'==typeof e.characters&&!e.ËßíËâ≤){const t=e.characters;e.ËßíËâ≤={};for(const a of Object.keys(t)){const n=t[a];if(n&&'object'==typeof n){e.ËßíËâ≤[a]={ÊÄßÊ†º:'string'==typeof n.personality?n.personality:'',ËÉåÊôØ:'string'==typeof n.background?n.background:'',Â•ΩÊÑüÂ∫¶:'number'==typeof n.trust?n.trust:50,Ë°®ÊÉÖ:Array.isArray(n.states)?n.states:[],ÊúçË£Ö:Array.isArray(n.outfits)?n.outfits:[]};for(const t of Object.keys(n))'personality'!==t&&'background'!==t&&'trust'!==t&&'states'!==t&&'outfits'!==t&&(e.ËßíËâ≤[a][t]=n[t])}}delete e.characters}}function ea(e){let t=0;function a(){for(;t<e.length&&/\s/.test(e[t]);)t++}function n(a){t++;let n='';for(;t<e.length;){const o=e[t];if('\\'===o&&t+1<e.length){t++;const a=e[t];n+='n'===a?'\n':'t'===a?'\t':'r'===a?'\r':a,t++}else{if(o===a)return t++,n;n+=o,t++}}return n}const o=e=>/[A-Za-z0-9_$\p{L}\p{N}]/u.test(e);function l(){const a=t,n=e[t]??'';if(!n||!/[A-Za-z_$\p{L}]/u.test(n))return'';for(t++;t<e.length&&o(e[t]);)t++;return e.substring(a,t)}function r(){const a=t;for(;t<e.length;){const a=e[t];if(':'===a)break;if('}'===a||','===a||'\n'===a||'\r'===a)break;t++}return e.substring(a,t).trim()}function i(){if(a(),t>=e.length)return;const o=e[t];if('"'===o||'\''===o)return n(o);if('['===o)return function(){t++;const n=[];for(a();t<e.length&&']'!==e[t];)n.push(i()),a(),','===e[t]&&(t++,a());return t<e.length&&t++,n}();if('{'===o)return function(){t++;const o={};for(a();t<e.length&&'}'!==e[t];){let c;if('"'===e[t]||'\''===e[t]?c=n(e[t]):(c=l(),c||(c=r())),a(),':'!==e[t])throw new Error('Invalid object literal: missing ":" after key');t++,a(),o[c]=i(),a(),','===e[t]&&(t++,a())}return t<e.length&&t++,o}();if('-'===o||/\d/.test(o))return function(){const a=t;for('-'===e[t]&&t++;t<e.length&&/\d/.test(e[t]);)t++;if(t<e.length&&'.'===e[t])for(t++;t<e.length&&/\d/.test(e[t]);)t++;return parseFloat(e.substring(a,t))}();const c=l();return'true'===c||'false'!==c&&('null'===c?null:c)}return i()}function ta(e){const t=[],a=(e,a,n)=>{let o;for(;null!==(o=a.exec(e));){const a=o[1].toUpperCase();let l=o.index+o[0].length;for(;l<e.length&&'\''!==e[l];)l++;if(l>=e.length)continue;const r=l+1;for(l++;l<e.length&&'\''!==e[l];)l++;if(l>=e.length)continue;const i=e.substring(r,l);for(l++;l<e.length&&/[\s,]/.test(e[l]);)l++;let c;if(l<e.length&&')'!==e[l]){const t=l;let a=0,n=!1,o='';for(;l<e.length;){const t=e[l];if(n)t===o&&'\\'!==e[l-1]&&(n=!1);else if('\''===t||'"'===t)n=!0,o=t;else if('('===t||'['===t||'{'===t)a++;else if(')'===t||']'===t||'}'===t){if(')'===t&&0===a)break;a--}l++}const r=e.substring(t,l).trim();try{c=ea(r),console.log('[VariableProcessor] Parsed value:',c)}catch(e){console.error('[VariableProcessor] Failed to parse value:',r,e),c=r}}const s=l,d=e.substring(o.index,Math.min(e.length,s+1)).trim(),u=n?`[$$ ${d} $$]`:d;t.push({type:a,path:i,value:c,rawCommand:u})}},n='[$$';let o=0,l=!1;for(;o<e.length;){const t=e.indexOf(n,o);if(-1===t)break;const r=e.indexOf('$$]',t+3);if(-1===r)break;a(e.substring(t+3,r),/\b(UPDATE|MOD|CREATE|REMOVE)\s*\(/gi,!0),l=!0,o=r+3}if(l)return t;return a(e,/\[\$\$\s*(UPDATE|MOD|CREATE|REMOVE)\s*\(/gi,!1),t}function aa(e,t){const a=t.split('.');let n=e;for(const e of a){if(null==n)return;n=n[e]}return n}function na(e,t,a){const n=t.split('.');let o=e;for(let e=0;e<n.length-1;e++){const t=n[e];void 0!==o[t]&&null!==o[t]||(o[t]={}),o=o[t]}o[n[n.length-1]]=a}function oa(e,t){const a=t.split('.').filter(Boolean);if(0===a.length)return!1;let n=e;for(const e of a){if(null==n)return!1;if('object'!=typeof n)return!1;if(!Object.prototype.hasOwnProperty.call(n,e))return!1;n=n[e]}return!0}function la(e){Jt||Yt(Gt);const t=Kt(e).split('.');return function e(t,a,n){if(n>=a.length)return!1;const o=a[n],l=n===a.length-1;if(Object.prototype.hasOwnProperty.call(t,o)){if(l)return!0;const r=t[o];return!('object'==typeof r&&!Array.isArray(r)&&null!==r)||e(r,a,n+1)}const r=Object.keys(t).find(e=>e.startsWith('<')&&e.endsWith('>'));if(r){const o=t[r];if('object'==typeof o&&!Array.isArray(o)&&!l)return e(o,a,n+1)}return!1}(Gt,t,0)}function ra(e,t){const{type:a,value:n}=t;let o=Qt(t.path);const l=(e,n,l)=>({code:e,commandType:a,path:t.path,normalizedPath:o,message:n,rawCommand:t.rawCommand,details:l}),r=e=>Array.isArray(e)?'array':null===e?'null':typeof e;switch(a){case'UPDATE':{if(!oa(e,o))return{success:!1,error:l('path_not_found',`UPDATE failed: path not found (UPDATE does not create new nodes): ${o}`)};const t=aa(e,o);if(null!=t){const e=r(t),a=r(n);if(e!==a)return{success:!1,error:l('type_mismatch',`UPDATE failed: type mismatch at ${o} (${e} -> ${a})`,{currentType:e,nextType:a})};if('number'===e){const e=n;if('number'!=typeof e||!Number.isFinite(e))return{success:!1,error:l('invalid_value',`UPDATE failed: value must be a finite number: ${o}`)}}}return na(e,o,n),console.log(`[VariableProcessor] UPDATE '${o}' = `,n),{success:!0}}case'MOD':{if(!oa(e,o))return{success:!1,error:l('path_not_found',`MOD failed: path not found (MOD does not create new nodes): ${o}`)};const t=n,a='number'==typeof t?t:'string'==typeof t?Number(t):Number.NaN;if(!Number.isFinite(a))return{success:!1,error:l('invalid_value',`MOD failed: delta must be a number (got ${typeof t}): ${o}`)};const r=aa(e,o);if('number'!=typeof r||!Number.isFinite(r))return{success:!1,error:l('type_mismatch',`MOD failed: target is not a number: ${o}`)};const i=r+a;return na(e,o,i),console.log(`[VariableProcessor] MOD '${o}': ${r} + ${a} = ${i}`),{success:!0}}case'CREATE':try{if(!o.includes('.')&&n&&'object'==typeof n&&!Array.isArray(n)){const e=new Set(Ht()).has('ËßíËâ≤')?'ËßíËâ≤':'characters',t=Jt?.dynamicContainers.get(e)||[];if(t.length>0){t.reduce((e,t)=>e+(t in n?1:0),0)>=2&&(o=`${e}.${o}`)}}}catch{}if(la(o)){Jt||Yt(Gt);if(!!Jt?.dynamicContainers.get(o)&&n&&'object'==typeof n&&!Array.isArray(n))try{for(const t of Object.keys(n))t&&!t.startsWith('//')&&na(e,`${o}.${t}`,n[t]);return console.log(`[VariableProcessor] CREATE '${o}' bulk instances = `,n),{success:!0}}catch(e){return console.error(`[VariableProcessor] CREATE '${o}' bulk failed:`,e),{success:!1,error:l('unknown',`CREATE failed: ${e.message||e}`)}}if(n&&'object'==typeof n&&!Array.isArray(n))try{for(const t of Object.keys(n))t&&!t.startsWith('//')&&na(e,`${o}.${t}`,n[t]);return console.log(`[VariableProcessor] CREATE '${o}' treated as UPDATE children = `,n),{success:!0}}catch(e){return console.error(`[VariableProcessor] CREATE '${o}' merge-as-update failed:`,e),{success:!1,error:l('unknown',`CREATE failed: ${e.message||e}`)}}return console.warn(`[VariableProcessor] CREATE failed: '${o}' is a fixed path`),{success:!1,error:l('fixed_path',`Cannot CREATE on fixed path: ${o}`)}}try{return na(e,o,n),console.log(`[VariableProcessor] CREATE '${o}' = `,n),{success:!0}}catch(e){return console.error(`[VariableProcessor] CREATE '${o}' failed:`,e),{success:!1,error:l('unknown',`CREATE failed: ${e.message||e}`)}}case'REMOVE':{if(la(o))return console.warn(`[VariableProcessor] REMOVE failed: '${o}' is a fixed path`),{success:!1,error:l('fixed_path',`Cannot REMOVE fixed path: ${o}`)};const t=function(e,t){const a=t.split('.');let n=e;for(let e=0;e<a.length-1;e++){const t=a[e];if(void 0===n[t]||null===n[t])return!1;n=n[t]}const o=a[a.length-1];return!!Object.prototype.hasOwnProperty.call(n,o)&&(delete n[o],!0)}(e,o);return t?console.log(`[VariableProcessor] REMOVE '${o}' success`):console.log(`[VariableProcessor] REMOVE '${o}' - path not found`),{success:!0}}default:return{success:!1,error:l('unknown',`Unknown command type: ${a}`)}}}function ia(e){if('object'==typeof e&&null!==e&&!Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,'__type')){if(Object.prototype.hasOwnProperty.call(e,'__default'))try{return structuredClone(e.__default)}catch{return JSON.parse(JSON.stringify(e.__default))}const t=e.__type;if(Array.isArray(t))return[];if('string'==typeof t)return'Int'===t||t.includes('Int')?0:'Boolean'!==t&&!t.includes('Boolean')&&''}if(Array.isArray(e)){if(!(1===e.length&&'String'===e[0])&&e.every(e=>'string'==typeof e))try{return structuredClone(e)}catch{return JSON.parse(JSON.stringify(e))}return[]}if('number'==typeof e&&Number.isFinite(e))return Math.trunc(e);if('boolean'==typeof e)return e;if('string'==typeof e)return'Int'===e||e.includes('Int')?0:'Boolean'!==e&&!e.includes('Boolean')&&('String'===e?'':e);if('object'!=typeof e||null===e)return e;const t={};for(const a of Object.keys(e))a.startsWith('//')||'__type'!==a&&'__default'!==a&&(a.startsWith('<')&&a.endsWith('>')||(t[a]=ia(e[a])));return t}async function ca(e=Wt){try{const t=await getWorldbook(e),a=t.findIndex(e=>e.name===jt),n=a>=0?t[a]:null;if(n&&(!0!==n.enabled||100!==n.probability))try{n.enabled=!0,n.probability=100,await replaceWorldbook(e,t)}catch{}if(n&&n.content)try{const e=n.content.replace(/\/\/[^\n]*/g,''),t=JSON.parse(e);return Zt(t),qt(t),t}catch{console.warn('[VariableProcessor] Failed to parse game data JSON')}const o=await async function(e=Wt){try{const t=(await getWorldbook(e)).find(e=>'ÂèòÈáèÂ∫ìÁªìÊûÑÂÆö‰πâ - Ê≠£Êñá'===e.name);if(t&&t.content)try{const e=t.content.replace(/\/\/[^\n]*/g,'');return JSON.parse(e)}catch{return console.warn('[VariableProcessor] Failed to parse schema JSON, using default from structure.json'),Gt}return Gt}catch(e){return console.error('[VariableProcessor] Failed to get schema, using default from structure.json:',e),Gt}}(e);return ia(o)}catch(e){return console.error('[VariableProcessor] Failed to get worldbook:',e),ia(Gt)}}async function sa(e,t=Wt){try{const a=await getWorldbook(t),n=a.findIndex(e=>e.name===jt),o=JSON.stringify(e,null,2);if(-1===n){const e={uid:Date.now(),name:jt,enabled:!0,content:o,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:0,order:800},probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}};a.push(e)}else{const e=a[n];e.content=o,e.enabled=!0,e.probability=100,e.strategy={...e.strategy??{},type:'constant',keys:Array.isArray(e.strategy?.keys)?e.strategy.keys:[],keys_secondary:e.strategy?.keys_secondary&&'object'==typeof e.strategy.keys_secondary?e.strategy.keys_secondary:{logic:'and_any',keys:[]},scan_depth:e.strategy?.scan_depth??'same_as_global'},e.position={...e.position??{},type:e.position?.type??'at_depth',role:e.position?.role??'system',depth:'number'==typeof e.position?.depth?e.position.depth:0,order:'number'==typeof e.position?.order?e.position.order:800}}return await replaceWorldbook(t,a),console.log('[VariableProcessor] Game data saved successfully'),!0}catch(e){return console.error('[VariableProcessor] Failed to save game data:',e),!1}}async function da(e,t=Wt){const a=ta(e);if(0===a.length)return{success:!0,commandsExecuted:0,errors:[],errorDetails:[],updatedData:null};console.log(`[VariableProcessor] Found ${a.length} commands to process`);const n=await ca(t);Zt(n);const o=[],l=[];let r=0;for(const e of a)try{const t=ra(n,e);if(t.success)r++;else if(t.error){l.push(t.error);const e=t.error.rawCommand?`${t.error.message} | Êåá‰ª§: ${t.error.rawCommand}`:t.error.message;o.push(e),console.error('[VariableProcessor] Command failed:',t.error)}}catch(t){const a=`Unexpected error: ${t.message||t} | Êåá‰ª§: ${e.rawCommand||'unknown'}`;o.push(a),l.push({code:'unknown',commandType:e.type,path:e.path,normalizedPath:Qt(e.path),message:`Unexpected error: ${t.message||t}`,rawCommand:e.rawCommand}),console.error('[VariableProcessor] Unexpected error executing command:',t)}if(qt(n),r>0){console.log(`[VariableProcessor] Saving data with ${r} successful changes...`);await sa(n,t)?console.log('[VariableProcessor] Data saved successfully'):o.push('Failed to save game data to worldbook')}else console.warn('[VariableProcessor] No commands executed successfully, skipping save');return console.log(`[VariableProcessor] Executed ${r}/${a.length} commands`),{success:0===o.length,commandsExecuted:r,errors:o,errorDetails:l,updatedData:n}}function ua(e){const t={};for(const a of e){const e=a.isDynamic?`<${a.key}>`:a.key;if(a.children&&a.children.length>0)t[e]=ua(a.children);else{const n='StringList'===a.valueType?['String']:a.valueType;void 0!==a.defaultValue?'StringList'===a.valueType&&Array.isArray(a.defaultValue)?t[e]=a.defaultValue:'Int'===a.valueType&&'number'==typeof a.defaultValue&&Number.isFinite(a.defaultValue)?t[e]=Math.trunc(a.defaultValue):'Boolean'===a.valueType&&'boolean'==typeof a.defaultValue?t[e]=a.defaultValue:'String'===a.valueType&&'string'==typeof a.defaultValue?'Int'===a.defaultValue||'Boolean'===a.defaultValue||'String'===a.defaultValue?t[e]={__type:n,__default:a.defaultValue}:t[e]=a.defaultValue:t[e]={__type:n,__default:a.defaultValue}:t[e]=n}a.comment&&(t[`//${e}`]=a.comment)}return t}function ma(e){const t=ua(e);return va(JSON.parse(JSON.stringify(Gt)),t)}function pa(e,t){return function(e,t){const a=(t?.dynamicKeySample||'Example').trim()||'Example',n=e=>{try{return structuredClone(e)}catch{return JSON.parse(JSON.stringify(e))}},o=(e,t)=>void 0!==t?n(t):Array.isArray(e)?[]:'Int'===e?0:'Boolean'!==e&&('String'===e?'':null),l=e=>{if(null==e)return null;if('object'==typeof e&&!Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,'__type')){const t=e.__type,a=Object.prototype.hasOwnProperty.call(e,'__default')?e.__default:void 0;return o(t,a)}if('string'==typeof e)return'Int'===e||'Boolean'===e||'String'===e?o(e):e;if('number'==typeof e||'boolean'==typeof e)return e;if(Array.isArray(e))return 1===e.length&&'String'===e[0]?[]:n(e);if('object'==typeof e){const t={};for(const n of Object.keys(e))n.startsWith('//')||(n.startsWith('<')&&n.endsWith('>')?t[a]=l(e[n]):t[n]=l(e[n]));return t}return null};return l(e)||{}}(ma(Array.isArray(e)?e:[]),t)}function va(e,t){for(const a of Object.keys(t))t[a]&&'object'==typeof t[a]&&!Array.isArray(t[a])?(('object'!=typeof e[a]||null===e[a]||Array.isArray(e[a]))&&(e[a]={}),va(e[a],t[a])):e[a]=t[a];return e}function ga(e,t=''){const a=[],n={};for(const t of Object.keys(e))t.startsWith('//')&&(n[t.substring(2)]=e[t]);for(const o of Object.keys(e)){if(o.startsWith('//'))continue;const l=e[o],r=o.startsWith('<')&&o.endsWith('>'),i=r?o.slice(1,-1):o,c={id:t?`${t}.${i}`:i,key:i,isDynamic:r,valueType:'String',comment:n[o]};if('object'==typeof l&&null!==l&&!Array.isArray(l)&&Object.prototype.hasOwnProperty.call(l,'__type')){const e=l.__type;Object.prototype.hasOwnProperty.call(l,'__default')&&(c.defaultValue=l.__default),Array.isArray(e)?c.valueType='StringList':'string'==typeof e&&('Int'===e||e.includes('Int')?c.valueType='Int':'Boolean'===e||e.includes('Boolean')?c.valueType='Boolean':c.valueType='String')}else if(Array.isArray(l)){const e=1===l.length&&'String'===l[0];c.valueType='StringList',!e&&l.every(e=>'string'==typeof e)&&(c.defaultValue=l)}else if('object'==typeof l&&null!==l){const e={};for(const t of Object.keys(l))'__type'!==t&&'__default'!==t&&(e[t]=l[t]);c.children=ga(e,c.id),c.valueType='String'}else'number'==typeof l&&Number.isFinite(l)?(c.valueType='Int',c.defaultValue=Math.trunc(l)):'boolean'==typeof l?(c.valueType='Boolean',c.defaultValue=l):'string'==typeof l&&('Int'===l||l.includes('Int')?c.valueType='Int':'Boolean'===l||l.includes('Boolean')?c.valueType='Boolean':'String'===l?c.valueType='String':(c.valueType='String',c.defaultValue=l));a.push(c)}return a}function fa(e,t=0){if('object'!=typeof e||null===e)return JSON.stringify(e);if(Array.isArray(e))return JSON.stringify(e);const a='  '.repeat(t),n='  '.repeat(t+1),o=Object.keys(e).filter(e=>!e.startsWith('//'));if(0===o.length)return'{}';let l='{\n';return o.forEach((a,r)=>{const i=e[a],c=e['//'+a],s=fa(i,t+1);if('object'==typeof i&&null!==i&&!Array.isArray(i)&&s.includes('\n')){const e=s.indexOf('\n'),t=s.substring(0,e),i=s.substring(e);l+=`${n}"${a}": ${t}`,c&&(l+=` // ${c}`),l+=i,r<o.length-1&&(l+=',')}else l+=`${n}"${a}": ${s}`,r<o.length-1&&(l+=','),c&&(l+=` // ${c}`);l+='\n'}),l+=`${a}}`,l}var ya=l(374),ha=l(514);const ka=new Set(['default','normal','stand','idle']);function Na(e){return(e??'').trim()}function Ea(e){let t=5381;for(let a=0;a<e.length;a++)t=33*t^e.charCodeAt(a);return t>>>0}function Va(e){return Na(e.expression||e.diffName||'')}function ba(e,t,a,n){const o=Na(t);if(!e||!o)return'';const l=Na(a??''),r=Na(n??''),i=(Array.isArray(e?.characterImages)&&e.characterImages||[]).map(e=>{if(!e)return null;if('string'==typeof e)return{id:e,characterName:'',expression:'',outfit:'',isFallback:!1,imageUrl:Na(e)};const t=e,a=Na(t.imageUrl||t.url||t.src||'');return{id:String(t.id||a||crypto.randomUUID()),characterName:String(t.characterName||t.character||t.name||''),expression:String(t.expression||t.expressionName||t.emotion||t.diffName||''),outfit:String(t.outfit||t.outfitName||''),diffName:t.diffName,isFallback:Boolean(t.isFallback||t.fallback||t.isResident),imageUrl:a}}).filter(e=>!!e&&!!e.imageUrl).filter(e=>e.characterName&&(0,ha.uF)(e.characterName,o,'equals'));if(0===i.length)return'';const c=e=>l?(0,ha.Ao)(Va(e),l,'includes'):0,s=e=>r?(0,ha.Ao)(e.outfit||'',r,'includes'):0,d=e=>String(e.id||e.imageUrl||''),u=(e,t)=>{let a,n=-1,o=0;for(const l of e){const e=1e3*c(l)+(t?s(l):0),r=Ea(d(l));e>n?(n=e,o=r,a=l):e===n&&r<o&&(o=r,a=l)}return a};if(l&&r){const e=u(i.filter(e=>{const t=Va(e),a=Na(e.outfit||'');return(0,ha.uF)(t,l,'includes')&&a&&(0,ha.uF)(a,r,'includes')}),!0);if(e)return e.imageUrl;const t=u(i.filter(e=>{const t=Va(e),a=Na(e.outfit||'');return(0,ha.uF)(t,l,'includes')&&!a}),!1);if(t)return t.imageUrl}if(l){const e=i.filter(e=>{const t=Va(e);return(0,ha.uF)(t,l,'includes')});if(e.length>0){if(r){const t=u(e.filter(e=>{const t=Na(e.outfit||'');return t&&(0,ha.uF)(t,r,'includes')}),!0);if(t)return t.imageUrl;const a=u(e.filter(e=>!Na(e.outfit||'')),!1);if(a)return a.imageUrl}const t=u(e,!1);if(t)return t.imageUrl}}if(r){const e=u(i.filter(e=>{const t=Na(e.outfit||'');return t&&(0,ha.uF)(t,r,'includes')}),!0);if(e)return e.imageUrl}const m=i.find(e=>!!e.isFallback);if(m)return m.imageUrl;const p=i.find(e=>function(e){return ka.has(e.trim().toLowerCase())}(Va(e)));return p?p.imageUrl:i[0].imageUrl}function wa(e){return Na(e.naturalCondition||e.linkedVariable||'')}function Ca(e){return e?Na('string'==typeof e?e:e.imageUrl||e.url||e.src||''):''}function Sa(e){if(!e)return'';if('string'==typeof e)return'';const t=e;return Na(t.naturalCondition||t.linkedVariable||t.condition||t.trigger||t.keywords||t.aliases||t.name||t.title||'')}function Ba(e){const t=Array.isArray(e?.backgroundImages)?e.backgroundImages:[];if(t.length>0){const a=t.filter(e=>{if(!Na(e?.imageUrl||''))return!1;const t=e;if(Boolean(t?.isResident||t?.isFallback||t?.fallback))return!0;return!Na(e?.naturalCondition||e?.linkedVariable||'')});if(1===a.length)return Na(a[0].imageUrl||'');if(a.length>1){const t=a.map(e=>Na(e.imageUrl||'')).filter(Boolean);if(0===t.length)return'';const n=`${e?.id||''}|resident|${t.join('|')}`;return t[Ea(n)%t.length]}const n=t.find(e=>!!Na(e?.imageUrl||''));if(n)return Na(n.imageUrl||'')}const a=Array.isArray(e?.sceneBackgrounds)&&e.sceneBackgrounds||[];if(a.length>0){const e=Ca(a[0]);if(e)return e}return''}const xa={class:'step-container'},_a={class:'selection-grid'},Ia={class:'selection-column'},Ta={class:'column-header event-header'},Aa={class:'scrollable-list'},Da=['onClick'],Ma={key:0,class:'placeholder'},Pa={class:'card-info'},Oa={class:'pack-meta'},Ra={key:0,class:'link-badge'},$a={key:0,class:'checked-icon'},La={key:0,class:'empty-list'},Ua={class:'selection-column'},za={class:'column-header char-header'},Fa={class:'scrollable-grid'},Wa=['onClick'],ja={class:'char-info'},Ga={class:'preset-count'},Ja={key:0,class:'empty-list'},Ya=(0,r.defineComponent)({__name:'Step1_Selection',props:{eventPacks:{},characterPacks:{},selectedEventId:{},selectedCharIds:{}},emits:['update:selectedEventId','update:selectedCharIds'],setup(e,{emit:t}){const a=e,n=t;return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',xa,[(0,r.createElementVNode)('div',_a,[(0,r.createCommentVNode)(' Event Packs (Single Select) '),(0,r.createElementVNode)('div',Ia,[(0,r.createElementVNode)('div',Ta,[(0,r.createVNode)(v,{name:'book',size:'1.2em'}),t[0]||(t[0]=(0,r.createElementVNode)('h2',null,'ÈÄâÊã©ÂâßÊú¨ / Scenario',-1))]),(0,r.createElementVNode)('div',Aa,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPacks,t=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t.id,class:(0,r.normalizeClass)(['event-card',{selected:e.selectedEventId===t.id}]),onClick:e=>function(e){n('update:selectedEventId',e);const t=a.eventPacks.find(t=>t.id===e);if(t&&t.linkedCharacterPackIds&&t.linkedCharacterPackIds.length>0){const e=new Set([...a.selectedCharIds,...t.linkedCharacterPackIds]),o=new Set(a.characterPacks.map(e=>e.id)),l=[...e].filter(e=>o.has(e));n('update:selectedCharIds',l)}}(t.id)},[(0,r.createElementVNode)('div',{class:'card-cover',style:(0,r.normalizeStyle)({backgroundImage:`url(${t.coverImage||''})`})},[t.coverImage?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',Ma,'NO IMAGE'))],4),(0,r.createElementVNode)('div',Pa,[(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(t.name),1),(0,r.createElementVNode)('p',null,(0,r.toDisplayString)(t.description),1),(0,r.createElementVNode)('div',Oa,[t.linkedCharacterPackIds?.length?((0,r.openBlock)(),(0,r.createElementBlock)('span',Ra,' üîó '+(0,r.toDisplayString)(t.linkedCharacterPackIds.length)+' Linked ',1)):(0,r.createCommentVNode)('v-if',!0)])]),e.selectedEventId===t.id?((0,r.openBlock)(),(0,r.createElementBlock)('div',$a,[(0,r.createVNode)(v,{name:'check',size:'1.5em'})])):(0,r.createCommentVNode)('v-if',!0)],10,Da))),128)),0===e.eventPacks.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',La,'Ê≤°ÊúâÂ∑≤‰∏ãËΩΩÁöÑ‰∫ã‰ª∂ÂåÖ (No Event Packs Found)')):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createCommentVNode)(' Character Packs (Multi Select) '),(0,r.createElementVNode)('div',Ua,[(0,r.createElementVNode)('div',za,[(0,r.createVNode)(v,{name:'star',size:'1.2em'}),t[1]||(t[1]=(0,r.createElementVNode)('h2',null,'ÁôªÂú∫‰∫∫Áâ© / Characters',-1))]),(0,r.createElementVNode)('div',Fa,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.characterPacks,o=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:o.id,class:(0,r.normalizeClass)(['char-card',{selected:e.selectedCharIds.includes(o.id)}]),onClick:e=>function(e){const t=[...a.selectedCharIds],o=t.indexOf(e);o>=0?t.splice(o,1):t.push(e),n('update:selectedCharIds',t)}(o.id)},[(0,r.createElementVNode)('div',{class:'char-cover',style:(0,r.normalizeStyle)({backgroundImage:`url(${o.coverImage||''})`})},[t[2]||(t[2]=(0,r.createElementVNode)('div',{class:'overlay'},null,-1)),e.selectedCharIds.includes(o.id)?((0,r.openBlock)(),(0,r.createBlock)(v,{key:0,name:'check',class:'check-mark',size:'2em'})):(0,r.createCommentVNode)('v-if',!0)],4),(0,r.createElementVNode)('div',ja,[(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(o.name),1),(0,r.createElementVNode)('span',Ga,(0,r.toDisplayString)(o.presets?.length||0)+' Presets',1)])],10,Wa))),128)),0===e.characterPacks.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ja,'Ê≤°ÊúâÂ∑≤‰∏ãËΩΩÁöÑËßíËâ≤ÂåÖ (No Character Packs Found)')):(0,r.createCommentVNode)('v-if',!0)])])])]))}}),Ha=(0,y.A)(Ya,[['__scopeId','data-v-429894f2']]),Xa={class:'step-container'},Ka={class:'split-layout'},Qa={class:'info-column'},qa={class:'header'},Za={key:0,class:'scenario-details'},en={class:'detail-row'},tn={class:'detail-row'},an={key:1,class:'empty-state'},nn={class:'selection-column'},on={class:'header'},ln={key:0,class:'anchor-list'},rn=['onClick'],cn={class:'anchor-header'},sn={class:'badge'},dn={class:'anchor-meta'},un={class:'anchor-desc'},mn={key:0,class:'custom-form'},pn={key:1,class:'anchor-desc'},vn=(0,r.defineComponent)({__name:'Step2_Scenario',props:{eventPack:{},selectedAnchorId:{},useCustom:{type:Boolean},customData:{}},emits:['update:selectedAnchorId','update:useCustom','update:customData'],setup(e,{emit:t}){const a=t;function n(){a('update:useCustom',!0)}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Xa,[(0,r.createElementVNode)('div',Ka,[(0,r.createCommentVNode)(' Scenario Info (Left) '),(0,r.createElementVNode)('div',Qa,[(0,r.createElementVNode)('div',qa,[(0,r.createVNode)(v,{name:'map-pin',size:'1.2em'}),t[6]||(t[6]=(0,r.createElementVNode)('h2',null,'ÈÄâ‰∏≠ÂâßÊú¨‰ø°ÊÅØ',-1))]),e.eventPack?((0,r.openBlock)(),(0,r.createElementBlock)('div',Za,[(0,r.createElementVNode)('div',en,[t[7]||(t[7]=(0,r.createElementVNode)('label',null,'ÂâßÊú¨ÂêçÁß∞:',-1)),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(e.eventPack.name),1)]),(0,r.createElementVNode)('div',tn,[t[8]||(t[8]=(0,r.createElementVNode)('label',null,'ÊèèËø∞:',-1)),(0,r.createElementVNode)('p',null,(0,r.toDisplayString)(e.eventPack.description),1)])])):((0,r.openBlock)(),(0,r.createElementBlock)('div',an,'Êú™ÈÄâÊã©ÂâßÊú¨'))]),(0,r.createCommentVNode)(' Anchor Selection (Right) '),(0,r.createElementVNode)('div',nn,[(0,r.createElementVNode)('div',on,[(0,r.createVNode)(v,{name:'map-pin',size:'1.2em'}),t[9]||(t[9]=(0,r.createElementVNode)('h2',null,'ÈÄâÊã©ÂºÄÂ±ÄÈîöÁÇπ / Start Point',-1))]),e.eventPack?((0,r.openBlock)(),(0,r.createElementBlock)('div',ln,[(0,r.createCommentVNode)(' Presets '),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.startPoints,(t,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t.id,class:(0,r.normalizeClass)(['anchor-card',{selected:!e.useCustom&&e.selectedAnchorId===t.id}]),onClick:e=>{return n=t.id,a('update:useCustom',!1),void a('update:selectedAnchorId',n);var n}},[(0,r.createElementVNode)('div',cn,[(0,r.createElementVNode)('span',sn,'Preset #'+(0,r.toDisplayString)(n+1),1),(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(t.title||t.location||'Êú™ÂëΩÂêçÈîöÁÇπ'),1)]),(0,r.createElementVNode)('div',dn,[(0,r.createElementVNode)('span',null,[(0,r.createVNode)(v,{name:'time',size:'0.8em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(t.time),1)]),(0,r.createElementVNode)('span',null,[(0,r.createVNode)(v,{name:'map-pin',size:'0.8em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(t.location),1)])]),(0,r.createElementVNode)('p',un,(0,r.toDisplayString)(t.initialEvent),1)],10,rn))),128)),(0,r.createCommentVNode)(' Custom Option '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['anchor-card custom-card',{selected:e.useCustom}]),onClick:n},[t[10]||(t[10]=(0,r.createElementVNode)('div',{class:'anchor-header'},[(0,r.createElementVNode)('span',{class:'badge custom'},'Custom'),(0,r.createElementVNode)('h3',null,'Ëá™ÂÆö‰πâÂºÄÂ±Ä (Custom Start)')],-1)),e.useCustom?((0,r.openBlock)(),(0,r.createElementBlock)('div',mn,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=t=>e.customData.time=t),placeholder:'Êó∂Èó¥ (Time)...',onClick:t[1]||(t[1]=(0,r.withModifiers)(()=>{},['stop']))},null,512),[[r.vModelText,e.customData.time]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[2]||(t[2]=t=>e.customData.location=t),placeholder:'Âú∞ÁÇπ (Location)...',onClick:t[3]||(t[3]=(0,r.withModifiers)(()=>{},['stop']))},null,512),[[r.vModelText,e.customData.location]]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[4]||(t[4]=t=>e.customData.initialEvent=t),placeholder:'ÂàùÂßãÂâßÊÉÖ/Áä∂ÂÜµÊèèËø∞...',rows:'3',onClick:t[5]||(t[5]=(0,r.withModifiers)(()=>{},['stop']))},null,512),[[r.vModelText,e.customData.initialEvent]])])):((0,r.openBlock)(),(0,r.createElementBlock)('p',pn,'ÁºñÂÜô‰Ω†Ëá™Â∑±ÁöÑÊó∂Èó¥„ÄÅÂú∞ÁÇπÂíåÂàùÂßãÂâßÊÉÖ„ÄÇ'))],2)])):(0,r.createCommentVNode)('v-if',!0)])])]))}}),gn=(0,y.A)(vn,[['__scopeId','data-v-0b0de7a9']]),fn={class:'step-container'},yn={class:'presets-column'},hn={class:'header'},kn={class:'presets-list'},Nn={class:'preset-header'},En={class:'preset-info'},Vn={class:'pn'},bn={key:0,class:'origin'},wn={class:'category-buttons'},Cn=['onClick','title'],Sn=['onClick','title'],Bn=['onClick','title'],xn=['onClick','title'],_n=['onClick','title'],In={class:'preset-preview'},Tn={key:0,class:'preview-item'},An={key:1,class:'preview-item'},Dn={key:2,class:'preview-item'},Mn={key:3,class:'preview-item'},Pn={key:0,class:'empty-list'},On={class:'editor-column'},Rn={class:'header'},$n={class:'form-scroll'},Ln={class:'form-section'},Un={class:'input-grid'},zn={key:0},Fn={class:'identity-fields'},Wn={class:'field'},jn={class:'field'},Gn={class:'section-header'},Jn={key:0,class:'selection-count'},Yn=['onUpdate:modelValue','placeholder'],Hn=(0,r.defineComponent)({__name:'Step3_Protagonist',props:{modelValue:{},characterPacks:{},selectedCharIds:{}},emits:['update:modelValue'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.reactive)({...a.modelValue}),l=(0,r.reactive)({appearance:[],personality:[],background:[],ability:[]}),i=(0,r.ref)(null),c=(0,r.ref)(null),s=(0,r.computed)(()=>{const e=[];return a.characterPacks.forEach(t=>{a.selectedCharIds.includes(t.id)&&t.presets&&t.presets.forEach(a=>{e.push({...a,_packId:t.id})})}),e}),d=[{key:'appearance',label:'Â§ñË≤å (Appearance)',placeholder:'ÈªëÂèëÁ∫¢Áû≥ÔºåË∫´Á©ø...',icon:'eye'},{key:'personality',label:'ÊÄßÊ†º (Personality)',placeholder:'ÂÜ∑ÈÖ∑ÔºåÂ§öÁñë...',icon:'chat'},{key:'background',label:'Ë∫´‰∏ñ (Background)',placeholder:'Êù•Ëá™...',icon:'book'},{key:'ability',label:'ËÉΩÂäõ (Ability)',placeholder:'5ÂÄçÂäõÈáèÔºåÂ∏∏‰∫∫ÁöÑ5ÂÄçÂäõÈáè',icon:'lightning'}],u=(0,r.computed)(()=>o.name&&o.appearance&&o.personality&&o.background&&o.ability);function m(e,t){return e?e.length>t?e.slice(0,t)+'...':e:''}function p(e,t){return l[e].some(e=>e.presetId===t.id)}function g(e){return i.value===e.id}function f(e){return l[e].length}function y(e,t){const a=t[e];if(!a)return;const n=l[e].findIndex(e=>e.presetId===t.id);n>=0?l[e].splice(n,1):l[e].push({presetId:t.id,content:a}),function(e){const t=l[e].map(e=>e.content);o[e]=t.join('\n\n')}(e)}return(0,r.watch)(o,e=>{n('update:modelValue',{...e})},{deep:!0}),(0,r.watch)(()=>a.modelValue,e=>{Object.assign(o,e)},{deep:!0}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',fn,[(0,r.createCommentVNode)(' Presets Sidebar (grouped by category) '),(0,r.createElementVNode)('div',yn,[(0,r.createElementVNode)('div',hn,[(0,r.createVNode)(v,{name:'user',size:'1.2em'}),t[2]||(t[2]=(0,r.createElementVNode)('h2',null,'ÂèÇËÄÉÈ¢ÑËÆæ / PRESETS',-1))]),(0,r.createElementVNode)('div',kn,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.value,e=>{return(0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'preset-card'},[(0,r.createElementVNode)('div',Nn,[(0,r.createElementVNode)('div',{class:'preset-cover',style:(0,r.normalizeStyle)({backgroundImage:`url(${e.coverImage||''})`})},null,4),(0,r.createElementVNode)('div',En,[(0,r.createElementVNode)('span',Vn,(0,r.toDisplayString)((n=e._packId,a.characterPacks.find(e=>e.id===n)?.name||'Unknown')),1),e.name&&'Untitled Module'!==e.name?((0,r.openBlock)(),(0,r.createElementBlock)('span',bn,(0,r.toDisplayString)(e.name),1)):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createCommentVNode)(' Category buttons for this preset '),(0,r.createElementVNode)('div',wn,[e.name||e.description||e.coverImage?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:(0,r.normalizeClass)(['cat-btn',{selected:g(e)}]),onClick:t=>function(e){if(i.value===e.id)return c.value&&(o.name=c.value.name,o.description=c.value.description,o.coverImage=c.value.coverImage),c.value=null,void(i.value=null);i.value||(c.value={name:o.name,description:o.description,coverImage:o.coverImage}),i.value=e.id,o.name=e.name||'',o.description=e.description||'',o.coverImage=e.coverImage||''}(e),title:e.description||e.name||''},[(0,r.createVNode)(v,{name:'image',size:'0.9em'}),t[3]||(t[3]=(0,r.createTextVNode)(' Á´ãÁªò ',-1))],10,Cn)):(0,r.createCommentVNode)('v-if',!0),e.appearance?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:(0,r.normalizeClass)(['cat-btn',{selected:p('appearance',e)}]),onClick:t=>y('appearance',e),title:e.appearance},[(0,r.createVNode)(v,{name:'eye',size:'0.9em'}),t[4]||(t[4]=(0,r.createTextVNode)(' Â§ñË≤å ',-1))],10,Sn)):(0,r.createCommentVNode)('v-if',!0),e.personality?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:2,class:(0,r.normalizeClass)(['cat-btn',{selected:p('personality',e)}]),onClick:t=>y('personality',e),title:e.personality},[(0,r.createVNode)(v,{name:'chat',size:'0.9em'}),t[5]||(t[5]=(0,r.createTextVNode)(' ÊÄßÊ†º ',-1))],10,Bn)):(0,r.createCommentVNode)('v-if',!0),e.background?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:3,class:(0,r.normalizeClass)(['cat-btn',{selected:p('background',e)}]),onClick:t=>y('background',e),title:e.background},[(0,r.createVNode)(v,{name:'book',size:'0.9em'}),t[6]||(t[6]=(0,r.createTextVNode)(' Ë∫´‰∏ñ ',-1))],10,xn)):(0,r.createCommentVNode)('v-if',!0),e.ability?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:4,class:(0,r.normalizeClass)(['cat-btn',{selected:p('ability',e)}]),onClick:t=>y('ability',e),title:e.ability},[(0,r.createVNode)(v,{name:'lightning',size:'0.9em'}),t[7]||(t[7]=(0,r.createTextVNode)(' ËÉΩÂäõ ',-1))],10,_n)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createCommentVNode)(' Preview of content '),(0,r.createElementVNode)('div',In,[e.appearance?((0,r.openBlock)(),(0,r.createElementBlock)('div',Tn,[t[8]||(t[8]=(0,r.createElementVNode)('span',{class:'preview-label'},'Â§ñË≤å:',-1)),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(m(e.appearance,40)),1)])):(0,r.createCommentVNode)('v-if',!0),e.personality?((0,r.openBlock)(),(0,r.createElementBlock)('div',An,[t[9]||(t[9]=(0,r.createElementVNode)('span',{class:'preview-label'},'ÊÄßÊ†º:',-1)),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(m(e.personality,40)),1)])):(0,r.createCommentVNode)('v-if',!0),e.background?((0,r.openBlock)(),(0,r.createElementBlock)('div',Dn,[t[10]||(t[10]=(0,r.createElementVNode)('span',{class:'preview-label'},'Ë∫´‰∏ñ:',-1)),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(m(e.background,40)),1)])):(0,r.createCommentVNode)('v-if',!0),e.ability?((0,r.openBlock)(),(0,r.createElementBlock)('div',Mn,[t[11]||(t[11]=(0,r.createElementVNode)('span',{class:'preview-label'},'ËÉΩÂäõ:',-1)),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(m(e.ability,40)),1)])):(0,r.createCommentVNode)('v-if',!0)])]);var n}),128)),0===s.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Pn,'No presets available')):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createCommentVNode)(' Main Editor '),(0,r.createElementVNode)('div',On,[(0,r.createElementVNode)('div',Rn,[(0,r.createVNode)(v,{name:'edit',size:'1.2em'}),t[12]||(t[12]=(0,r.createElementVNode)('h2',null,'‰∏ªËßíËÆæÂÆö / PROTAGONIST',-1)),(0,r.createElementVNode)('span',{class:(0,r.normalizeClass)(['status-badge',{valid:u.value}])},(0,r.toDisplayString)(u.value?'Ready':'Incomplete'),3)]),(0,r.createElementVNode)('div',$n,[(0,r.createCommentVNode)(' Identity '),(0,r.createElementVNode)('div',Ln,[(0,r.createElementVNode)('div',Un,[(0,r.createElementVNode)('div',{class:'avatar-uploader',style:(0,r.normalizeStyle)({backgroundImage:`url(${o.coverImage})`})},[o.coverImage?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',zn,'Avatar'))],4),(0,r.createElementVNode)('div',Fn,[(0,r.createElementVNode)('div',Wn,[t[13]||(t[13]=(0,r.createElementVNode)('label',null,'ÂßìÂêç Name',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>o.name=e),type:'text',placeholder:'ËæìÂÖ•ÂßìÂêç...'},null,512),[[r.vModelText,o.name]])]),(0,r.createElementVNode)('div',jn,[t[14]||(t[14]=(0,r.createElementVNode)('label',null,'ÊèèËø∞ Description',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>o.description=e),type:'text',placeholder:'‰∏ÄÂè•ËØùÊèèËø∞...'},null,512),[[r.vModelText,o.description]])])])])]),(0,r.createCommentVNode)(' Trait Sections with combined content '),((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(d,e=>(0,r.createElementVNode)('div',{class:'form-section',key:e.key},[(0,r.createElementVNode)('div',Gn,[(0,r.createElementVNode)('h3',null,[(0,r.createVNode)(v,{name:e.icon,size:'1em'},null,8,['name']),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(e.label),1)]),f(e.key)>0?((0,r.openBlock)(),(0,r.createElementBlock)('span',Jn,' Â∑≤ÈÄâ '+(0,r.toDisplayString)(f(e.key))+' È°π ',1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>o[e.key]=t,placeholder:e.placeholder,rows:'3'},null,8,Yn),[[r.vModelText,o[e.key]]])])),64))])])]))}}),Xn=(0,y.A)(Hn,[['__scopeId','data-v-41af27aa']]),Kn={class:'new-game-root'},Qn={class:'visual-container'},qn={class:'new-game-header'},Zn={class:'steps-progress'},eo={class:'step-content-wrapper'},to=(0,r.defineComponent)({__name:'NewGame',setup(e){const t=(0,r.ref)([]),a=(0,r.ref)([]);(0,r.onMounted)(async()=>{try{const e=await re.idbService.getAllWorks();t.value=e.filter(e=>'EVENT'===e.type).map(e=>e.data),a.value=e.filter(e=>'CHARACTER'===e.type).map(e=>e.data)}catch(e){console.error('Failed to load works from IDB:',e)}const e=await W();if(e&&'NewGame'===e.currentPage&&e.newGame){const t=e.newGame;t.step&&(n.value=t.step),t.selectedEventId&&(l.value=t.selectedEventId),t.selectedCharIds&&(c.value=t.selectedCharIds),t.selectedAnchorId&&(s.value=t.selectedAnchorId),t.protagonistData&&Object.assign(m,t.protagonistData),console.log(`[NewGame] ÊÅ¢Â§çÂà∞Step ${n.value}`)}await H({step:n.value,selectedEventId:l.value||void 0,selectedCharIds:c.value,selectedAnchorId:s.value||void 0,protagonistData:{...m}})});const n=(0,r.ref)(1),o=(0,i.useRouter)(),l=(0,r.ref)(null),c=(0,r.ref)([]),s=(0,r.ref)(null),d=(0,r.ref)(!1),u=(0,r.reactive)({id:'custom',time:'',location:'',initialEvent:''}),m=(0,r.reactive)({name:'',description:'',coverImage:'',appearance:'',personality:'',background:'',ability:''}),p=(0,r.ref)(!1),g=(0,r.ref)(''),f=(0,r.ref)('info');function y(e,t='info'){g.value=e,f.value=t,p.value=!0}function h(e){if(!e)return{};try{const t=JSON.parse(e);if(t&&'object'==typeof t&&('EVENT'===t.type||'CHARACTER'===t.type)&&t.data)return{type:t.type,data:t.data}}catch{}return{}}let k=0;async function N(e){const t=++k,n=function(e){if(!e)return[];const t=[];if(Array.isArray(e.linkedCharacterPackIds))for(const a of e.linkedCharacterPackIds)'string'==typeof a&&a.trim()&&t.push(a.trim());else'string'==typeof e.linkedCharacterPackId&&e.linkedCharacterPackId.trim()&&t.push(e.linkedCharacterPackId.trim());return Array.from(new Set(t))}(e);if(!n.length)return;const o=new Set(a.value.map(e=>e.id)),l=n.filter(e=>!o.has(e));if(!l.length)return;y(`Ê£ÄÊµãÂà∞Áº∫Â∞ëÂÖ≥ËÅî‰∫∫ËÆæÂåÖÔºö${l.length} ‰∏™ÔºåÊ≠£Âú®Ëá™Âä®‰∏ãËΩΩ...`,'loading');let r=[];const i=[];try{const e=await async function(e,t){const a=new Set(e.filter(Boolean)),n=new Map;if(!a.size)return n;const o='number'==typeof t?.maxPages?t.maxPages:8,l='number'==typeof t?.pageSize?t.pageSize:50;for(let e=1;e<=o;e++){const t=await Ft.listPublicItems({page:e,limit:l},{timeoutMs:15e3}),o=Array.isArray(t?.data)?t.data:[];for(const e of o){const t='string'==typeof e?.clientWorkId?e.clientWorkId:'';t&&a.has(t)&&!n.has(t)&&'CHARACTER'===e.packType&&n.set(t,e)}if(n.size>=a.size)break;if(!t?.hasMore)break}return n}(l);for(const n of l){if(t!==k)return;const o=e.get(n);if(o?._id)try{const e=await Ft.getItem(String(o._id),{timeoutMs:2e4}),t=h(e?.data?.code);if('CHARACTER'!==t.type||!t.data){i.push(n);continue}const l=t.data,s=(new Date).toISOString(),d={id:String(l.id||n||crypto.randomUUID()),type:'CHARACTER',data:l,downloadedAt:s};await re.idbService.saveWork(d),a.value.find(e=>e.id===d.id)||a.value.push(l),c.value.includes(d.id)||(c.value=[...c.value,d.id]),r.push(l)}catch{i.push(n)}else i.push(n)}}catch{i.push(...l)}t===k&&(r.length&&i.length?y(`Â∑≤Ëá™Âä®‰∏ãËΩΩÂÖ≥ËÅî‰∫∫ËÆæÂåÖÔºö${r.map(e=>e.name||e.id).join('„ÄÅ')}\n‰∫ëÁ´ØÁº∫Â∞ë/‰∏çÂèØ‰∏ãËΩΩÔºö${i.join('„ÄÅ')}`,'warning'):r.length?y(`Â∑≤Ëá™Âä®‰∏ãËΩΩÂÖ≥ËÅî‰∫∫ËÆæÂåÖÔºö${r.map(e=>e.name||e.id).join('„ÄÅ')}`,'success'):i.length&&y(`‰∫ëÁ´ØÁº∫Â∞ëÂÖ≥ËÅî‰∫∫ËÆæÂåÖÔºåÊó†Ê≥ïËá™Âä®‰∏ãËΩΩÔºö${i.join('„ÄÅ')}`,'warning'))}let E=null;(0,r.watch)([n,l,c,s,()=>({...m})],async()=>{E&&clearTimeout(E),E=setTimeout(async()=>{await H({step:n.value,selectedEventId:l.value||void 0,selectedCharIds:c.value,selectedAnchorId:s.value||void 0,protagonistData:{...m}})},300)}),(0,r.watch)(l,async e=>{if(!e)return;const a=t.value.find(t=>t.id===e);a&&await N(a)},{flush:'post'});const V=(0,r.computed)(()=>{switch(n.value){case 1:default:return Ha;case 2:return gn;case 3:return Xn}}),b=(0,r.computed)(()=>{if(1===n.value){if(!l.value)return!1;const e=t.value.find(e=>e.id===l.value);if(e&&e.linkedCharacterPackIds&&e.linkedCharacterPackIds.length>0){if(!e.linkedCharacterPackIds.every(e=>c.value.includes(e)))return!1}return!0}return 2===n.value?d.value?!!(u.time&&u.location&&u.initialEvent):!!s.value:3===n.value&&(m.name&&m.appearance&&m.personality&&m.background&&m.ability)}),{updateStoryWorldbook:w,cleanGameDataEntry:C}=Mt();async function B(){if(b.value)if(n.value<3)n.value++;else{y('Ê≠£Âú®ÂêØÂä®Ê∏∏ÊàèÔºåËØ∑Á®çÂÄô...\nStarting Game...','loading');try{const e=t.value.find(e=>e.id===l.value);if(!e)throw new Error('Event Pack not found');const a=d.value?u:e.startPoints.find(e=>e.id===s.value),n='ÂêåÊ¢¶',r=window.TavernHelper;r.getWorldbookNames().includes(n)||await r.createWorldbook(n),await r.rebindChatWorldbook('current',n);const i=n;await C();const p=/^„Äê.*?„Äë„Äê.*?„Äë„Äê.*?„Äë„Äê.*?„Äë$/;await window.deleteWorldbookEntries(i,e=>p.test(e.name));const v=[],g='Local',f=(t,a,n,o=!1,l=null)=>{t&&v.push({name:`„Äê${g}„Äë„Äê${e.name}„Äë„Äê${a}„Äë„Äê${String(n).padStart(3,'0')}„Äë`,content:t,position:{type:'after_character_definition',order:n},enabled:o,probability:l,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}})};e.randomEvents&&e.randomEvents.forEach((e,t)=>{const a='number'==typeof e.config?.probability?e.config.probability:0;f(e.content,'ÈöèÊú∫‰∫ã‰ª∂',202+t,!0,a)}),await w(e,a?.time||''),e.conditionalEvents&&e.conditionalEvents.forEach((e,t)=>f(e.content,'Êù°‰ª∂‰∫ã‰ª∂',402+t,!0));let h=502;e.worldviews&&e.worldviews.forEach(e=>f(e.content,'‰∏ñÁïåËßÇ',h++,!0)),e.powerSystems&&e.powerSystems.forEach(e=>f(e.content,'‰∏ñÁïåËßÇ',h++,!0)),e.specialRules&&e.specialRules.forEach((e,t)=>f(e.content,'ÁâπÊÆäËßÑÂàô',602+t,!0)),Array.isArray(e.extraWorldBooks)&&e.extraWorldBooks.length>0&&e.extraWorldBooks.forEach((t,a)=>{const n='string'==typeof t?.content?t.content:'';if(!n.trim())return;const o='number'==typeof t?.uid?String(t.uid).padStart(3,'0'):String(800+a).padStart(3,'0'),l='string'==typeof t?.name&&t.name.trim()?t.name.trim():'È¢ùÂ§ñ‰∏ñÁïå‰π¶';v.push({name:`„Äê${g}„Äë„Äê${e.name}„Äë„ÄêÈ¢ùÂ§ñ‰∏ñÁïå‰π¶„Äë„Äê${o}„Äë${l}`,content:n,position:t?.position||{type:'after_character_definition',order:800+a},enabled:!1!==t?.enabled,probability:'number'==typeof t?.probability?t.probability:null,strategy:t?.strategy||{type:'selective',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},recursion:t?.recursion,effect:t?.effect})}),'string'==typeof e.extraWorldBook&&e.extraWorldBook.trim()&&v.push({name:`„Äê${g}„Äë„Äê${e.name}„Äë„ÄêÈ¢ùÂ§ñ‰∏ñÁïå‰π¶„Äë„ÄêLEGACY„Äë`,content:e.extraWorldBook.trim(),position:{type:'after_character_definition',order:799},enabled:!0,probability:null,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}});{const t=Ba(e);if(t)try{const e=await ye();e.bgImage=t,ke(e,0),console.log('[NewGame] Set start background:',t)}catch(e){console.error('Failed to set background',e)}}const k=`\nÂßìÂêç: ${m.name}\nÊèèËø∞: ${m.description}\nÂ§ñË≤å: ${m.appearance}\nÊÄßÊ†º: ${m.personality}\nË∫´‰∏ñ: ${m.background}\nËÉΩÂäõ: ${m.ability}\n      `.trim();let N;v.push({name:`„Äê${g}„Äë„Äê${e.name}„Äë„ÄêÁé©ÂÆ∂Ê°£Ê°à„Äë„Äê001„Äë`,content:k,position:{type:'after_character_definition',order:702},enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}}),v.length>0&&await window.createWorldbookEntries(i,v),N=e.variableTree&&e.variableTree.length>0?ma(e.variableTree):JSON.parse(JSON.stringify(Gt));const E={name:'ÂèòÈáèÂ∫ìÁªìÊûÑÂÆö‰πâ - Ê≠£Êñá',content:fa(N),position:{type:'before_character_definition',order:3},enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}};try{await window.deleteWorldbookEntries(i,e=>'ÂèòÈáèÂ∫ìÁªìÊûÑÂÆö‰πâ - Ê≠£Êñá'===e.name)}catch(e){console.warn('[NewGame] Failed to delete existing schema entry:',e)}await window.createWorldbookEntries(i,[E]),console.log('[NewGame] Variable schema entry created'),await $t('low'),console.log('[NewGame] Deviation prompt set to low');const V=`\n**<Áé©ÂÆ∂Ê°£Ê°à (Protagonist)>**\n${k}\n\n**<ÂºÄÂ±ÄÈîöÁÇπ (Scenario Anchor)>**\nÊó∂Èó¥: ${a?.time||''}\nÂú∞ÁÇπ: ${a?.location||''}\nÂàùÂßã‰∫ã‰ª∂: ${a?.initialEvent||''}\n`,b={injects:[{role:'user',content:`\n<ÂºÄÂ±ÄÊåá‰ª§>\n**[1. Êï∞ÊçÆÂä†ËΩΩ]**\nËØ∑ËØªÂèñ‰ª•‰∏ãÊ†∏ÂøÉÊï∞ÊçÆÔºö\n${V}\n\n**[2. ÊâßË°åÊåá‰ª§ (Execution)]**\n‰Ω†Áé∞Âú®ÊòØ **Game Master (GM)**„ÄÇËØ∑Ê†πÊçÆ‰ª•‰∏äÊï∞ÊçÆÔºå‰∏∫‰Ω†Èù¢ÂâçÁöÑÁé©ÂÆ∂ÁîüÊàê**ÂºÄÂ±ÄÂú∫ÊôØ**„ÄÇ\n**ÂÜô‰ΩúË¶ÅÊ±ÇÔºö**\n1.  **ËßÜËßíËΩ¨Êç¢**ÔºöÊó†ËÆ∫ÂâçÁΩÆÂâßÊÉÖ‰ΩøÁî®‰ªÄ‰πàËßÜËßíÔºåÈÉΩË¶ÅÊåâÊåáÂÆöËßÜËßíÈáçÂÜô„ÄÇ\n2.  **ËÉΩÂäõËûçÂÖ•**ÔºöÁªìÂêàÁé©ÂÆ∂ÁöÑ„ÄêÁâπÊÆäËÉΩÂäõ„ÄëÔºåÂú®ÊèèËø∞‰∏≠Âä†ÂÖ•Áã¨ÁâπÁöÑÊÑüÂÆòÁªÜËäÇ„ÄÇ\n3.  **‰∫∫ËÆæÂåπÈÖç**ÔºöÊèèËø∞Áé©ÂÆ∂ÁöÑÂøÉÁêÜÊ¥ªÂä®Êó∂ÔºåÂøÖÈ°ªÁ¨¶Âêà„ÄêÊÄßÊ†º„Äë\n4.  **ÁéØÂ¢ÉÊ∏≤Êüì**ÔºöÂà©Áî®„Äê‰∏ñÁïåËßÇ„ÄëËÆæÂÆöÔºåÊèèÂÜôÂë®Âõ¥ÁöÑÂÖâÂΩ±„ÄÅÊôØËâ≤„ÄÇ\n5.  **Ë°åÂä®ËØ±ÂØº**Ôºö**‰∏çË¶Å**Â∏ÆÁé©ÂÆ∂ÊâßË°å‰πãÂêéÁöÑ‰∏ÄÁ≥ªÂàóÂä®‰Ωú„ÄÇËØ∑ÊääÂâßÊÉÖÂÅúÂú®Áé©ÂÆ∂ÂÜ≥ÂÆöË°åÂä®ÁöÑÈÇ£‰∏ÄÂàªÔºåÁ≠âÂæÖÁé©ÂÆ∂ÁöÑÂÖ∑‰ΩìÊåá‰ª§„ÄÇ\n6Ôºå **ËØ≠Ë®ÄÈ£éÊ†º**ÔºöÈÅµ‰ªé<Ê≠£ÊñáÁîüÊàêËßÑËåÉ>ÁöÑË¶ÅÊ±ÇÁîüÊàêÊñáÊú¨„ÄÇ\n</ÂºÄÂ±ÄÊåá‰ª§>`,position:'in_chat',depth:0,should_scan:!0}],should_stream:!1};console.log('[NewGame] ÂáÜÂ§áÂèëÈÄÅ Prompt (No Stream):',b);const S=new Promise(e=>{const t=window.iframe_events||window.tavern_events,a=window.eventOnce;if(t&&t.GENERATION_ENDED&&a){const n=t=>{console.log('[NewGame] Êî∂Âà∞ GENERATION_ENDED ‰∫ã‰ª∂'),t&&e(t)};console.log('[NewGame] Ê≥®ÂÜå‰∏ÄÊ¨°ÊÄß GENERATION_ENDED ÁõëÂê¨Âô®'),a(t.GENERATION_ENDED,n),setTimeout(()=>{e('')},45e3)}else console.warn('[NewGame] Êó†Ê≥ïÊ≥®ÂÜåÁõëÂê¨Âô®Ôºå‰∫ã‰ª∂Á≥ªÁªü‰∏çÂèØÁî®'),e('')});let B=await window.TavernHelper.generate(b);console.log('[NewGame] TavernHelper.generate ËøîÂõû:',B);let x='string'==typeof B?B:'';if(x||(console.log('[NewGame] Á≠âÂæÖ‰∫ã‰ª∂ÊçïËé∑ÊñáÊú¨...'),x=await S),!x)throw new Error('No text received from generation');const I=De(x);console.log('[NewGame] ÁîüÊàêÊàêÂäü! finalText length:',I.length);const T=Be(I,'content',{stripThink:!0});if(!('string'==typeof T?T.trim():''))return void y('ÂêØÂä®Â§±Ë¥•ÔºöÊó†Ê≥ï‰ªéÊ®°ÂûãÂõûÂ∫î‰∏≠Ëß£ÊûêÂá∫ÊúâÊïà <content>„ÄÇ\nËØ∑ËÆ©Ê®°ÂûãÈáçÊñ∞ÂèëÈÄÅÔºåÊàñÊ£ÄÊü•ÊèêÁ§∫ËØçÊ®°ÊùøÊòØÂê¶ËæìÂá∫ <think>/<content>/<Â∞èÊÄªÁªì> Ê†áÁ≠æ„ÄÇ','error');sessionStorage.setItem('new_game_start_text',I),sessionStorage.setItem('last_final_text',I),sessionStorage.setItem('current_game_event_id',l.value||''),sessionStorage.setItem('current_game_char_ids',JSON.stringify(c.value));const A=`protagonist_${Date.now()}`;await re.idbService.setRuntimeAsset(A,{imageUrl:m.coverImage||''}),sessionStorage.setItem('current_game_protagonist_ref',JSON.stringify({name:m.name||'',runtimeId:A}));const D=(0,ya.zP)(e);(0,ya.RV)(D),console.log('[NewGame] Saved event pack assets:',D),await j({currentPage:'NewGame',mainGame:void 0}),o.push('/MainGame')}catch(e){console.error('Failed to start game:',e),y('ÂêØÂä®Â§±Ë¥•ÔºåËØ∑ÂÜçÊ¨°Â∞ùËØï„ÄÇ\nFailed to start game: '+(e.message||e),'error')}}}async function x(){n.value>1?n.value--:(await G(),o.push('/'))}const I=(0,r.computed)(()=>{if(1===n.value)return{eventPacks:t.value,characterPacks:a.value,selectedEventId:l.value,selectedCharIds:c.value};if(2===n.value){return{eventPack:t.value.find(e=>e.id===l.value),selectedAnchorId:s.value,useCustom:d.value,customData:u}}return{modelValue:m,characterPacks:a.value,selectedCharIds:c.value}}),T=(0,r.computed)(()=>1===n.value?{'update:selectedEventId':e=>l.value=e,'update:selectedCharIds':e=>c.value=e}:2===n.value?{'update:selectedAnchorId':e=>s.value=e,'update:useCustom':e=>d.value=e,'update:customData':e=>Object.assign(u,e)}:{'update:modelValue':e=>Object.assign(m,e)});return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Kn,[(0,r.createElementVNode)('div',Qn,[(0,r.createCommentVNode)(' Top Navigation '),(0,r.createElementVNode)('div',qn,[(0,r.createElementVNode)('button',{class:'nav-btn',onClick:x},[(0,r.createVNode)(v,{name:'back'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(1===n.value?'Back to Home':'Previous Step'),1)]),(0,r.createElementVNode)('div',Zn,[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['step-dot',{active:n.value>=1,current:1===n.value}])},'1',2),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['line',{active:n.value>=2}])},null,2),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['step-dot',{active:n.value>=2,current:2===n.value}])},'2',2),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['line',{active:n.value>=3}])},null,2),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['step-dot',{active:n.value>=3,current:3===n.value}])},'3',2)]),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['nav-btn next',{disabled:!b.value}]),onClick:B},[(0,r.createTextVNode)((0,r.toDisplayString)(3===n.value?'START GAME':'NEXT STEP')+' ',1),(0,r.createVNode)(v,{name:'next'})],2)]),(0,r.createCommentVNode)(' Content Area '),(0,r.createElementVNode)('div',eo,[((0,r.openBlock)(),(0,r.createBlock)(r.KeepAlive,null,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(V.value),(0,r.mergeProps)(I.value,(0,r.toHandlers)(T.value)),null,16))],1024))])]),(0,r.createVNode)(S,{visible:p.value,'onUpdate:visible':t[0]||(t[0]=e=>p.value=e),message:g.value,type:f.value},null,8,['visible','message','type'])]))}}),ao=(0,y.A)(to,[['__scopeId','data-v-5b862732']]);const no=['eval','Function','setTimeout','setInterval','document.cookie','localStorage','sessionStorage','indexedDB','window.opener','window.parent','window.top','postMessage','XMLHttpRequest','WebSocket','Worker','SharedWorker','ServiceWorker','importScripts','__proto__','prototype','constructor','atob','btoa','fetch','navigator.sendBeacon','location.href','location.assign','location.replace','history.pushState','history.replaceState'],oo=[/\b_0x[a-f0-9]+\b/gi,/\[['"][a-z]{1,2}['"]\]/gi,/\\x[0-9a-f]{2}/gi,/\\u[0-9a-f]{4}/gi,/String\.fromCharCode\(/gi,/unescape\(/gi,/decodeURIComponent\(/gi],lo=['Math','Date','console','String','Number','Boolean','Array','Object','JSON','parseInt','parseFloat','isNaN','isFinite','encodeURIComponent','decodeURIComponent','Promise','Map','Set','WeakMap','WeakSet','Symbol','Proxy','Reflect','RegExp','Error','TypeError','RangeError'];function ro(e){const t=[],a=[];for(const a of no){new RegExp(`\\b${a.replace(/\./g,'\\.')}\\b`,'gi').test(e)&&t.push(`Á¶ÅÊ≠¢‰ΩøÁî®Âç±Èô©ÂÖ≥ÈîÆËØç: ${a}`)}for(const t of oo)if(t.test(e)){a.push('Ê£ÄÊµãÂà∞ÂèØËÉΩÁöÑ‰ª£Á†ÅÊ∑∑Ê∑ÜÔºåËØ∑‰ΩøÁî®Ê∏ÖÊô∞ÂèØËØªÁöÑ‰ª£Á†Å');break}const n=e.match(/\[['"]\w+['"]\]/g);n&&n.length>10&&a.push('Ê£ÄÊµãÂà∞Â§ßÈáèÊã¨Âè∑Â±ûÊÄßËÆøÈóÆÔºåÂèØËÉΩÊòØÊ∑∑Ê∑Ü‰ª£Á†Å');const o=e.replace(/\bxmlns(?::[a-zA-Z_][\w.-]*)?\s*=\s*(['"])\s*(?:https?|ftp):\/\/[^'"\s]+\s*\1/gi,'').match(/\b(?:https?|ftp|ws|wss):\/\/[^\s'"\)\]]+/gi)||[],l=['webp','png','jpg','jpeg','gif','avif'];o.filter(e=>{return!(/^https:\/\//i.test(t=e)&&l.some(e=>new RegExp(`\\.${e}(?:[?#].*)?$`,'i').test(t)));var t}).length>0&&t.push(`Á¶ÅÊ≠¢Âú®‰ª£Á†Å‰∏≠ÂåÖÂê´Â§ñÈÉ® URLÔºà‰ªÖÂÖÅËÆ∏ https ÂõæÁâáÁõ¥Èìæ: ${l.join(', ')}Ôºâ`);const r=[/document\.(getElementById|querySelector|getElementsBy)/gi,/document\.(write|writeln|open|close)/gi,/\.innerHTML\s*=/gi,/\.outerHTML\s*=/gi,/\.insertAdjacentHTML/gi];for(const a of r)if(a.test(e)){t.push('Á¶ÅÊ≠¢Áõ¥Êé•Êìç‰Ωú DOMÔºåËØ∑‰ΩøÁî® GameSDK Êèê‰æõÁöÑÊñπÊ≥ï');break}return{isValid:0===t.length,errors:t,warnings:a}}function io(e,t={}){const{extraGlobals:n={}}=t,o=ro(e);if(!o.isValid)return{component:null,error:`‰ª£Á†ÅÂÆâÂÖ®Ê£ÄÊü•Â§±Ë¥•:\n${o.errors.join('\n')}`};const l=function(e={}){const t={};for(const e of lo)e in window&&(t[e]=window[e]);return Object.assign(t,e),new Proxy(t,{get(e,t){if(t in e)return e[t];if('string'==typeof t){const e=t.toLowerCase();if(e.includes('cookie')||e.includes('storage')||e.includes('location')||'window'===e||'document'===e||'global'===e||'self'===e||'top'===e||'parent'===e||'frames'===e)return void console.warn(`[SecuritySandbox] ÈòªÊ≠¢ËÆøÈóÆÂç±Èô©Â±ûÊÄß: ${t}`)}},set:(e,t,a)=>(e[t]=a,!0),has:(e,t)=>t in e,deleteProperty:()=>!1})}(n);try{const t=new Function('sandbox',`\n      const { Math, Date, console, JSON, String, Number, Boolean, Array, Object, \n              parseInt, parseFloat, isNaN, isFinite, Promise, Map, Set, RegExp,\n              Error, TypeError, RangeError, Symbol } = sandbox;\n      \n      // Â±èËîΩÂç±Èô©ÂÖ®Â±ÄÂèòÈáèÔºàËÆæ‰∏∫ undefinedÔºâ\n      const window = undefined;\n      const document = undefined;\n      const globalThis = undefined;\n      const self = undefined;\n      const top = undefined;\n      const parent = undefined;\n      const frames = undefined;\n      const localStorage = undefined;\n      const sessionStorage = undefined;\n      const indexedDB = undefined;\n      const fetch = undefined;\n      const XMLHttpRequest = undefined;\n      const WebSocket = undefined;\n      \n      return (${e});\n      `)(l);if(!t||'object'!=typeof t)return{component:null,error:'Áî®Êà∑‰ª£Á†ÅÂøÖÈ°ªËøîÂõû‰∏Ä‰∏™ÊúâÊïàÁöÑ Vue ÁªÑ‰ª∂ÈÖçÁΩÆÂØπË±°'};const n=t;if(!n.template&&!n.render)return{component:null,error:'ÁªÑ‰ª∂ÂøÖÈ°ªÂåÖÂê´ template Êàñ render Â±ûÊÄß'};if('string'==typeof n.template&&!n.render)try{const{code:e}=a(n.template,{mode:'function'});n.render=new Function('Vue',e)(r),delete n.template}catch(e){return{component:null,error:`template ÁºñËØëÂ§±Ë¥•: ${e?.message||String(e)}`}}return{component:t,error:null}}catch(e){return{component:null,error:`‰ª£Á†ÅÊâßË°åÈîôËØØ: ${e.message}`}}}const co=['id'],so={key:0,class:'widget-loading'},uo={class:'widget-error'},mo={class:'error-message'},po={key:2,class:'widget-warnings'},vo=(0,r.defineComponent)({__name:'DynamicLoader',props:{userCode:{},userCSS:{default:''},componentId:{default:''},gameState:{},previewVariables:{default:null}},emits:['loaded','error','notification'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(!0),l=(0,r.ref)(null),i=(0,r.ref)([]),c=(0,r.ref)(null),s=(0,r.ref)(0),d=(0,r.ref)('user-widget-'+Math.random().toString(36).substring(2,10)),u=(0,r.ref)(null),m=(0,r.ref)(null),p=(0,r.ref)(null),v=(0,r.ref)(!1),g=(0,r.ref)(1),f=(0,r.ref)(null),y=(0,r.computed)(()=>g.value<.999),h=(0,r.computed)(()=>{const e={'--th-widget-scale':String(g.value)};return null!=f.value&&(e.height=`${f.value}px`),e}),k=(0,r.ref)(a.gameState||{playerName:'Áé©ÂÆ∂',gold:0,level:1,customVars:{}}),N=(0,r.computed)(()=>function(e){const{gameState:t,maxLogEntries:a=100,componentId:n,previewVariables:o}=e,l=_t(),r=e=>{try{return structuredClone(e)}catch{try{return JSON.parse(JSON.stringify(e))}catch{return null}}},i=e=>{const t=o?.value;if(!t||'object'!=typeof t)return{found:!1,value:null};const a=String(e).split('.').map(e=>e.trim()).filter(Boolean);if(0===a.length)return{found:!1,value:null};let n=t;for(let e=0;e<a.length;e++){const t=a[e];if(null==n)return{found:!1,value:null};if(Array.isArray(n)){const e=Number(t);if(!Number.isInteger(e)||e<0||e>=n.length)return{found:!1,value:null};n=n[e];continue}if('object'!=typeof n)return{found:!1,value:null};if(!Object.prototype.hasOwnProperty.call(n,t))return{found:!1,value:null};n=n[t]}return{found:!0,value:n}},c=[],s=[],d=new Map;return{version:'1.0.0',componentId:n,getPlayerName:()=>t.value.playerName,getGold:()=>t.value.gold,getLevel:()=>t.value.level,getCustomVar:e=>JSON.parse(JSON.stringify(t.value.customVars[e]??null)),getAllCustomVars:()=>JSON.parse(JSON.stringify(t.value.customVars)),getVariable(e,t){if('string'!=typeof e||!e.trim())return console.warn(`[GameSDK:${n}] Êó†ÊïàÁöÑÂèòÈáèË∑ØÂæÑ`),void t(null);const a=i(e);a.found?t(r(a.value)):l.readVariable(e).then(e=>t(e)).catch(a=>{console.warn(`[GameSDK:${n}] Ëé∑ÂèñÂèòÈáèÂ§±Ë¥•:`,e,a),t(null)})},getDynamicKeys(e,t){if('string'!=typeof e||!e.trim())return console.warn(`[GameSDK:${n}] Êó†ÊïàÁöÑÂÆπÂô®Ë∑ØÂæÑ`),void t([]);const a=i(e);if(a.found){const e=a.value;return void(e&&'object'==typeof e&&!Array.isArray(e)?t(Object.keys(e)):t([]))}l.getDynamicKeys(e).then(e=>t(e)).catch(a=>{console.warn(`[GameSDK:${n}] Ëé∑ÂèñÂä®ÊÄÅ keys Â§±Ë¥•:`,e,a),t([])})},getDynamicInstance(e,t,a,o){if(!e||!t)return console.warn(`[GameSDK:${n}] Êó†ÊïàÁöÑÂÆπÂô®Ë∑ØÂæÑÊàñÂÆû‰æã key`),void o(null);const c=i(a?`${e}.${t}.${a}`:`${e}.${t}`);c.found?o(r(c.value)):l.getDynamicInstance(e,t,a||void 0).then(e=>o(e)).catch(l=>{console.warn(`[GameSDK:${n}] Ëé∑ÂèñÂä®ÊÄÅÂÆû‰æãÂ§±Ë¥•:`,e,t,a,l),o(null)})},modifyGold(e){if('number'!=typeof e||isNaN(e))return console.warn(`[GameSDK:${n}] Êó†ÊïàÁöÑÈáëÂ∏ÅÂèòÂåñÂÄº`),!1;const a=Math.max(-1e3,Math.min(1e3,e));return t.value.gold=Math.max(0,t.value.gold+a),!0},setCustomVar(e,a){if('string'!=typeof e||e.length>50)return console.warn(`[GameSDK:${n}] Êó†ÊïàÁöÑÂèòÈáèÂêç`),!1;const o=JSON.stringify(a);return o.length>1e4?(console.warn(`[GameSDK:${n}] ÂèòÈáèÂÄºËøáÂ§ß`),!1):(t.value.customVars[e]=JSON.parse(o),!0)},showNotification(e,t={}){if('string'!=typeof e)return;const a=e.substring(0,200);s.length>=10&&s.shift(),s.push({id:`${n}-${Date.now()}`,message:a,options:{type:t.type||'info',duration:Math.min(t.duration||3e3,1e4)}})},_consumeNotifications(){const e=[...s];return s.length=0,e},async confirm(e){if('string'!=typeof e)return!1;const t=e.substring(0,500);return new Promise(e=>{const a=d.get('_confirmRequest');a&&a.size>0?a.forEach(a=>a({message:t,resolve:e})):(console.log(`[GameSDK:${n}] Á°ÆËÆ§ËØ∑Ê±Ç: ${t}`),e(!0))})},log(...e){this._addLog('info',e)},warn(...e){this._addLog('warn',e)},error(...e){this._addLog('error',e)},_addLog(e,t){const o=t.map(e=>{if('object'==typeof e)try{return JSON.stringify(e)}catch{return String(e)}return String(e)}).join(' ');c.length>=a&&c.shift(),c.push({time:new Date,level:e,message:o.substring(0,1e3)});const l=`[UserWidget:${n}]`;switch(e){case'warn':console.warn(l,...t);break;case'error':console.error(l,...t);break;default:console.log(l,...t)}},_getLogs:()=>[...c],on:(e,t)=>['gameStateChange','turnStart','turnEnd','battleStart','battleEnd'].includes(e)||e.startsWith('_')?(d.has(e)||d.set(e,new Set),d.get(e).add(t),()=>{d.get(e)?.delete(t)}):(console.warn(`[GameSDK:${n}] ‰∏çÂÖÅËÆ∏ÁõëÂê¨‰∫ã‰ª∂: ${e}`),()=>{}),_emit(e,...t){const a=d.get(e);a&&a.forEach(e=>{try{e(...t)}catch(e){console.error(`[GameSDK:${n}] ‰∫ã‰ª∂Â§ÑÁêÜÂô®ÈîôËØØ:`,e)}})},formatNumber:e=>'number'!=typeof e?'0':e.toLocaleString(),formatTime(e){const t='number'==typeof e?new Date(e):e;return t instanceof Date&&!isNaN(t.getTime())?t.toLocaleTimeString():'--:--:--'},randomInt:(e,t)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e),delay(e){const t=Math.max(0,Math.min(e,1e4));return new Promise(e=>setTimeout(e,t))},_cleanup(){d.clear(),c.length=0,s.length=0}}}({gameState:k,componentId:a.componentId||d.value,previewVariables:(0,r.computed)(()=>a.previewVariables||null)}));function E(){o.value=!0,l.value=null,i.value=[];try{if('string'!=typeof a.userCode||!a.userCode.trim())return l.value='ÁªÑ‰ª∂‰ª£Á†Å‰∏∫Á©∫Êàñ‰∏çÊòØÂ≠óÁ¨¶‰∏≤',void n('error',l.value);const e=ro(a.userCode);if(!e.isValid)return l.value=`‰ª£Á†ÅÂÆâÂÖ®Ê£ÄÊü•Â§±Ë¥•:\n${e.errors.join('\n')}`,void n('error',l.value);i.value=e.warnings;const t=io(a.userCode,{extraGlobals:{GameSDK:N.value}});if(t.error)return l.value=t.error,void n('error',t.error);c.value=(0,r.markRaw)(t.component),s.value++,w(),n('loaded')}catch(e){l.value=`ÁªÑ‰ª∂Âä†ËΩΩÂºÇÂ∏∏: ${e.message}`,n('error',l.value)}finally{o.value=!1}}let V=null,b=null;function w(){null==V&&(V=window.requestAnimationFrame(()=>{V=null,async function(){if(!v.value)return g.value=1,void(f.value=null);if(o.value||l.value||!c.value)return g.value=1,void(f.value=null);if(function(){const e=p.value,t=e?.firstElementChild;return!(!t||!t.hasAttribute('data-th-no-autoscale')&&'true'!==t.getAttribute('data-th-no-autoscale'))}())return g.value=1,void(f.value=null);await(0,r.nextTick)();const e=m.value,t=p.value;if(!e||!t)return;const a=e.clientWidth,n=t.scrollWidth;if(a<=0||n<=0)return;let i=Math.min(1,a/n);i>.98&&(i=1);if(g.value=i,i<1){const e=t.scrollHeight;f.value=Math.ceil(e*i)}else f.value=null}()}))}function C(e){console.error(`[DynamicLoader:${d.value}] ÁªÑ‰ª∂ËøêË°åÊó∂ÈîôËØØ:`,e),N.value.error('ÁªÑ‰ª∂ËøêË°åÊó∂ÈîôËØØ:',e.message)}let S=null;return(0,r.watch)(()=>a.userCode,()=>{E()}),(0,r.watch)(()=>a.gameState,e=>{e&&(k.value=e)},{deep:!0}),(0,r.onMounted)(()=>{E(),S=window.setInterval(()=>{const e=N.value._consumeNotifications();for(const t of e)n('notification',{message:t.message,type:t.options.type||'info'})},100),v.value=!!u.value?.closest?.('.right-sidebar, .widgets-panel, .widget-host'),'undefined'!=typeof ResizeObserver&&(b=new ResizeObserver(()=>{w()}),m.value&&b.observe(m.value),p.value&&b.observe(p.value))}),(0,r.onUnmounted)(()=>{N.value._cleanup(),S&&clearInterval(S),b&&(b.disconnect(),b=null),null!=V&&(cancelAnimationFrame(V),V=null)}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{ref_key:'containerRef',ref:u,class:'user-widget-container',id:d.value},[(0,r.createCommentVNode)(' Âä†ËΩΩÁä∂ÊÄÅ '),o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',so,[...t[0]||(t[0]=[(0,r.createElementVNode)('div',{class:'loading-spinner'},null,-1),(0,r.createElementVNode)('span',null,'Âä†ËΩΩÁªÑ‰ª∂‰∏≠...',-1)])])):l.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' ÈîôËØØÁä∂ÊÄÅ '),(0,r.createElementVNode)('div',uo,[t[1]||(t[1]=(0,r.createElementVNode)('div',{class:'error-icon'},'‚ö†Ô∏è',-1)),t[2]||(t[2]=(0,r.createElementVNode)('div',{class:'error-title'},'ÁªÑ‰ª∂Âä†ËΩΩÂ§±Ë¥•',-1)),(0,r.createElementVNode)('div',mo,(0,r.toDisplayString)(l.value),1),(0,r.createElementVNode)('button',{class:'retry-btn',onClick:E},'ÈáçËØï')])],2112)):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Ë≠¶Âëä‰ø°ÊÅØ '),i.value.length>0?((0,r.openBlock)(),(0,r.createElementBlock)('div',po,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:'warning-item'},'‚ö†Ô∏è '+(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Âä®ÊÄÅÁªÑ‰ª∂ '),c.value&&!l.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:3,ref_key:'contentOuterRef',ref:m,class:(0,r.normalizeClass)(['user-widget-content-outer',{'is-autoscaled':y.value}]),style:(0,r.normalizeStyle)(h.value)},[(0,r.createElementVNode)('div',{ref_key:'contentInnerRef',ref:p,class:'user-widget-content-inner'},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(c.value),(0,r.mergeProps)({key:s.value},e.$attrs,{sdk:N.value,api:N.value,onError:C}),null,16,['sdk','api']))],512)],6)):(0,r.createCommentVNode)('v-if',!0)],8,co))}}),go=(0,y.A)(vo,[['__scopeId','data-v-79a103d6']]),fo={class:'card-image'},yo=['src','alt'],ho={class:'card-type-badge'},ko={class:'card-content'},No={class:'card-header'},Eo={class:'card-metrics'},Vo={key:0,class:'downloads',title:'‰∏ãËΩΩ/‰ΩøÁî®Ê¨°Êï∞'},bo={class:'card-author'},wo=['src'],Co={key:1,class:'author-avatar'},So={class:'card-tags'},Bo={class:'card-actions'},xo=['title'],_o=['title'],Io=(0,r.defineComponent)({__name:'WorkshopCard',props:{item:{},isDownloaded:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canDeleteRemote:{type:Boolean},canUpload:{type:Boolean},canDownload:{type:Boolean},canFileDownload:{type:Boolean},fileDownloadTitle:{},uploadTitle:{},uploadIcon:{},statusLabel:{},authorAvatarUrl:{}},emits:['edit','delete','delete-remote','upload','download','file-download','info'],setup(e){const t=e,a=(0,r.computed)(()=>{const e=t.item?.description;return'string'==typeof e&&e.trim().length>0}),n=(0,r.ref)(t.item.img);function o(){n.value&&n.value.startsWith('https://picsum.photos/')||(n.value='https://picsum.photos/400/250?random='+encodeURIComponent(String(t.item.id||'fallback')))}(0,r.watch)(()=>t.item.img,e=>{n.value=e});const l=(0,r.computed)(()=>'Êú¨Âú∞'===t.statusLabel?'local':'‰∫ëÁ´Ø'===t.statusLabel?'cloud':'both');return(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(N,{class:'gallery-card'},{default:(0,r.withCtx)(()=>{return[(0,r.createElementVNode)('div',fo,[(0,r.createElementVNode)('img',{src:n.value,alt:e.item.title,onError:o},null,40,yo),(0,r.createElementVNode)('div',ho,(0,r.toDisplayString)('EVENT'===e.item.type?'EVENT PACK':'CHAR PACK'),1),e.statusLabel?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:(0,r.normalizeClass)(['card-status-badge',l.value])},(0,r.toDisplayString)(e.statusLabel),3)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',ko,[(0,r.createElementVNode)('div',No,[(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(e.item.title),1),(0,r.createElementVNode)('div',Eo,['number'==typeof e.item.downloadCount?((0,r.openBlock)(),(0,r.createElementBlock)('div',Vo,[(0,r.createVNode)(v,{name:'download',size:'0.8em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)((i=e.item.downloadCount,i>=1e6?(i/1e6).toFixed(1)+'m':i>=1e3?(i/1e3).toFixed(1)+'k':i.toString())),1)])):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createElementVNode)('div',bo,[e.authorAvatarUrl?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,class:'author-avatar author-avatar-img',src:e.authorAvatarUrl,alt:'Author Avatar'},null,8,wo)):((0,r.openBlock)(),(0,r.createElementBlock)('div',Co)),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(e.item.author),1),(0,r.createVNode)(v,{name:'verified',size:'0.75em',class:'verified-icon'})]),(0,r.createElementVNode)('div',So,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.item.tags,e=>((0,r.openBlock)(),(0,r.createElementBlock)('span',{key:e},'#'+(0,r.toDisplayString)(e),1))),128))])]),(0,r.createCommentVNode)(' Actions Overlay '),(0,r.createElementVNode)('div',Bo,[a.value?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'btn-info',onClick:t[0]||(t[0]=(0,r.withModifiers)(t=>e.$emit('info',e.item),['stop'])),title:'Êü•ÁúãÁÆÄ‰ªã'},[(0,r.createVNode)(v,{name:'info',size:'1em'})])):(0,r.createCommentVNode)('v-if',!0),e.canFileDownload?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'btn-file-download',onClick:t[1]||(t[1]=(0,r.withModifiers)(t=>e.$emit('file-download',e.item),['stop'])),title:e.fileDownloadTitle||'ÂØºÂá∫‰∏∫JSONÊñá‰ª∂'},[(0,r.createVNode)(v,{name:'export',size:'1em'})],8,xo)):(0,r.createCommentVNode)('v-if',!0),e.canUpload?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:2,class:'btn-upload',onClick:t[2]||(t[2]=(0,r.withModifiers)(t=>e.$emit('upload',e.item),['stop'])),title:e.uploadTitle||'‰∏ä‰º†Âà∞‰∫ëÁ´Ø'},[(0,r.createVNode)(v,{name:e.uploadIcon||'upload-cloud',size:'1em'},null,8,['name'])],8,_o)):(0,r.createCommentVNode)('v-if',!0),e.canDownload?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:3,class:'btn-download',onClick:t[3]||(t[3]=(0,r.withModifiers)(t=>e.$emit('download',e.item),['stop'])),title:'‰∏ãËΩΩÂà∞Êú¨Âú∞'},[(0,r.createVNode)(v,{name:'download',size:'1em'})])):(0,r.createCommentVNode)('v-if',!0),e.canDeleteRemote?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:4,class:'btn-delete-remote',onClick:t[4]||(t[4]=(0,r.withModifiers)(t=>e.$emit('delete-remote',e.item),['stop'])),title:'Âà†Èô§‰∫ëÁ´ØÊ∫êÊñá‰ª∂ÔºàÂç±Èô©Ôºâ'},[(0,r.createVNode)(v,{name:'cloud-delete',size:'1em'})])):(0,r.createCommentVNode)('v-if',!0),e.isDownloaded||e.canDelete?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:5,class:'btn-delete',onClick:t[5]||(t[5]=(0,r.withModifiers)(t=>e.$emit('delete',e.item),['stop'])),title:'Âà†Èô§'},[(0,r.createVNode)(v,{name:'delete',size:'1em'})])):(0,r.createCommentVNode)('v-if',!0),e.canEdit?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:6,class:'btn-edit',onClick:t[6]||(t[6]=(0,r.withModifiers)(t=>e.$emit('edit',e.item),['stop'])),title:'ÁºñËæë/Êü•Áúã'},[(0,r.createVNode)(v,{name:'edit',size:'1em'})])):(0,r.createCommentVNode)('v-if',!0)])];var i}),_:1}))}}),To=(0,y.A)(Io,[['__scopeId','data-v-3e807441']]),Ao={class:'image-cropper-overlay'},Do={class:'cropper-modal'},Mo={class:'cropper-header'},Po={class:'controls'},Oo=['src'],Ro={class:'cropper-footer'},$o=(0,r.defineComponent)({__name:'ImageCropper',props:{imageUrl:{},aspectRatio:{}},emits:['confirm','cancel'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(1),l=(0,r.ref)(0),i=(0,r.ref)(0),c=(0,r.ref)(!1),s=(0,r.ref)(0),d=(0,r.ref)(0),u=(0,r.ref)(0),m=(0,r.ref)(0),p=(0,r.ref)(null),v=(0,r.ref)(null),g=(0,r.ref)(null),f=(0,r.computed)(()=>({transform:`translate(${l.value}px, ${i.value}px) scale(${o.value})`,cursor:c.value?'grabbing':'grab',transformOrigin:'top left'}));function y(){if(!p.value||!v.value)return;const e=p.value,t=v.value.getBoundingClientRect(),a=(e.getBoundingClientRect(),e.offsetWidth),n=e.offsetHeight;l.value=(t.width-a)/2,i.value=(t.height-n)/2,o.value=1}function h(e){c.value=!0,e instanceof MouseEvent?(s.value=e.clientX,d.value=e.clientY):(s.value=e.touches[0].clientX,d.value=e.touches[0].clientY),u.value=l.value,m.value=i.value,window.addEventListener('mousemove',k),window.addEventListener('mouseup',N),window.addEventListener('touchmove',k),window.addEventListener('touchend',N)}function k(e){if(!c.value)return;let t,a;e instanceof MouseEvent?(t=e.clientX,a=e.clientY):(t=e.touches[0].clientX,a=e.touches[0].clientY);const n=t-s.value,o=a-d.value;l.value=u.value+n,i.value=m.value+o}function N(){c.value=!1,window.removeEventListener('mousemove',k),window.removeEventListener('mouseup',N),window.removeEventListener('touchmove',k),window.removeEventListener('touchend',N)}function E(){if(!p.value||!v.value)return;const e=document.createElement('canvas'),t=1280,r=Math.round(t/a.aspectRatio);e.width=t,e.height=r;const c=e.getContext('2d');if(!c)return;c.fillStyle='#000',c.fillRect(0,0,e.width,e.height),c.imageSmoothingEnabled=!0,c.imageSmoothingQuality='high';const s=p.value,d=v.value.getBoundingClientRect(),u=(s.getBoundingClientRect(),o.value),m=l.value,g=i.value,f=s.offsetWidth,y=s.offsetHeight,h=s.naturalWidth/f/u,k=s.naturalHeight/y/u,N=-m*h,E=-g*k,V=d.width*h,b=d.height*k;c.drawImage(s,N,E,V,b,0,0,t,r),n('confirm',e.toDataURL('image/jpeg',.9))}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Ao,[(0,r.createElementVNode)('div',Do,[(0,r.createElementVNode)('div',Mo,[t[2]||(t[2]=(0,r.createElementVNode)('h3',null,'Ë∞ÉÊï¥Â∞ÅÈù¢ Image Adjustment',-1)),(0,r.createElementVNode)('div',Po,[(0,r.createElementVNode)('label',null,'Áº©Êîæ Zoom: '+(0,r.toDisplayString)(o.value.toFixed(1))+'x',1),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range','onUpdate:modelValue':t[0]||(t[0]=e=>o.value=e),min:'1',max:'5',step:'0.1'},null,512),[[r.vModelText,o.value,void 0,{number:!0}]])])]),(0,r.createElementVNode)('div',{class:'cropper-viewport-container',ref_key:'containerRef',ref:g},[(0,r.createCommentVNode)(' The viewport defines the output Frame '),(0,r.createElementVNode)('div',{class:'cropper-viewport',ref_key:'viewportRef',ref:v,style:(0,r.normalizeStyle)({aspectRatio:e.aspectRatio+''}),onMousedown:h,onTouchstart:(0,r.withModifiers)(h,['prevent'])},[(0,r.createElementVNode)('img',{ref_key:'imageRef',ref:p,src:e.imageUrl,style:(0,r.normalizeStyle)(f.value),draggable:'false',onLoad:y},null,44,Oo)],36)],512),(0,r.createElementVNode)('div',Ro,[(0,r.createElementVNode)('button',{class:'btn cancel',onClick:t[1]||(t[1]=t=>e.$emit('cancel'))},'ÂèñÊ∂à Cancel'),(0,r.createElementVNode)('button',{class:'btn confirm',onClick:E},'Á°ÆËÆ§‰ΩøÁî® Confirm')])])]))}}),Lo=(0,y.A)($o,[['__scopeId','data-v-085c99f0']]),Uo=['data-block-id'],zo={class:'block-header'},Fo={class:'block-label'},Wo={class:'block-content'},jo={key:0,class:'identity-form'},Go={key:0},Jo={class:'inputs'},Yo={class:'text-content'},Ho=['placeholder'],Xo=(0,r.defineComponent)({__name:'CharacterBlock',props:{block:{},isDragging:{type:Boolean},snapTargetId:{}},emits:['remove','trigger-upload','drag-start'],setup(e,{emit:t}){const a=e,n=t;function o(e){n('drag-start',{id:a.block.id,event:e})}function l(e){switch(e){case'IDENTITY':return'star';case'APPEARANCE':return'eye';case'PERSONALITY':return'brain';case'BACKGROUND':return'book';case'ABILITY':return'lightning';default:return'file'}}function i(e){switch(e){case'IDENTITY':return'Ë∫´‰ªΩ (IDENTITY)';case'APPEARANCE':return'Â§ñË≤å (APPEARANCE)';case'PERSONALITY':return'ÊÄßÊ†º (PERSONALITY)';case'BACKGROUND':return'Ë∫´‰∏ñ (BACKGROUND)';case'ABILITY':return'ËÉΩÂäõ (ABILITY)';default:return e}}function c(e){switch(e){case'APPEARANCE':return'ÊèèËø∞ËßíËâ≤ÁöÑÂ§ñË≤åÁâπÂæÅ...';case'PERSONALITY':return'ÊèèËø∞ËßíËâ≤ÁöÑÊÄßÊ†ºÁâπÂæÅ...';case'BACKGROUND':return'ËßíËâ≤ÁöÑË∫´‰∏ñËÉåÊôØ...';case'ABILITY':return'ËßíËâ≤ÁöÑÁâπÊÆäËÉΩÂäõ...';default:return'...'}}return(e,t)=>{const a=(0,r.resolveComponent)('CharacterBlock',!0);return(0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['character-block',[`type-${e.block.type.toLowerCase()}`,{'is-dragging':e.isDragging}]]),onPointerdown:(0,r.withModifiers)(o,['stop']),'data-block-id':e.block.id},[(0,r.createCommentVNode)(' Block Header/Grip '),(0,r.createElementVNode)('div',zo,[(0,r.createVNode)(v,{name:l(e.block.type),size:'1em'},null,8,['name']),(0,r.createElementVNode)('span',Fo,(0,r.toDisplayString)(i(e.block.type)),1),(0,r.createCommentVNode)(' Remove Button (Only on hover) '),(0,r.createElementVNode)('button',{class:'remove-btn',onClick:t[0]||(t[0]=(0,r.withModifiers)(t=>e.$emit('remove',e.block.id),['stop'])),onMousedown:t[1]||(t[1]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.createVNode)(v,{name:'x',size:'0.8em'})],32)]),(0,r.createCommentVNode)(' Block Content Form '),(0,r.createElementVNode)('div',Wo,[(0,r.createCommentVNode)(' Identity: Special Fields '),'IDENTITY'===e.block.type?((0,r.openBlock)(),(0,r.createElementBlock)('div',jo,[(0,r.createElementVNode)('div',{class:'avatar-upload',onClick:t[2]||(t[2]=(0,r.withModifiers)(t=>e.$emit('trigger-upload',e.block),['stop'])),onMousedown:t[3]||(t[3]=(0,r.withModifiers)(()=>{},['stop'])),style:(0,r.normalizeStyle)({backgroundImage:e.block.data.cover?`url(${e.block.data.cover})`:'none'})},[e.block.data.cover?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',Go,'Á´ãÁªò'))],36),(0,r.createElementVNode)('div',Jo,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[4]||(t[4]=t=>e.block.data.name=t),placeholder:'Name...',onMousedown:t[5]||(t[5]=(0,r.withModifiers)(()=>{},['stop']))},null,544),[[r.vModelText,e.block.data.name]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[6]||(t[6]=t=>e.block.data.description=t),placeholder:'ÊèèËø∞...',class:'tiny',onMousedown:t[7]||(t[7]=(0,r.withModifiers)(()=>{},['stop']))},null,544),[[r.vModelText,e.block.data.description]])])])):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Generic Text Area for others '),(0,r.createElementVNode)('div',Yo,[(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[8]||(t[8]=t=>e.block.data.text=t),placeholder:c(e.block.type),rows:'2',onMousedown:t[9]||(t[9]=(0,r.withModifiers)(()=>{},['stop']))},null,40,Ho),[[r.vModelText,e.block.data.text]])])],2112))]),(0,r.createCommentVNode)(' Snap Socket (Bottom) '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['block-socket-bottom',{'is-snap-target':e.snapTargetId===e.block.id}])},[(0,r.createCommentVNode)(' Recursive Child Rendering '),e.block.next?((0,r.openBlock)(),(0,r.createBlock)(a,{key:0,block:e.block.next,'snap-target-id':e.snapTargetId,onRemove:t[10]||(t[10]=t=>e.$emit('remove',t)),onTriggerUpload:t[11]||(t[11]=t=>e.$emit('trigger-upload',t)),onDragStart:t[12]||(t[12]=t=>e.$emit('drag-start',t))},null,8,['block','snap-target-id'])):(0,r.createCommentVNode)('v-if',!0)],2),(0,r.createCommentVNode)(' Visual Notch (Removed for Tech Style) '),(0,r.createCommentVNode)(' <div v-if="!block.next" class="notch-bottom"></div> '),(0,r.createCommentVNode)(' <div class="notch-top"></div> ')],42,Uo)}}}),Ko=(0,y.A)(Xo,[['__scopeId','data-v-844c50f4']]),Qo={class:'character-palette'},qo={class:'sidebar-group'},Zo={class:'metadata-form'},el={key:0,class:'upload-placeholder'},tl={class:'upload-hover'},al={class:'inputs'},nl=['value'],ol=['value'],ll={class:'input-hint'},rl=['value'],il={class:'sidebar-group'},cl={class:'palette-buttons'},sl=(0,r.defineComponent)({__name:'CharacterPalette',props:{name:{},description:{},coverImage:{}},emits:['spawn','update:name','update:description','update:coverImage','trigger-cover-upload'],setup:e=>(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Qo,[(0,r.createCommentVNode)(' Metadata Section '),(0,r.createElementVNode)('div',qo,[t[11]||(t[11]=(0,r.createElementVNode)('h3',null,'ËßíËâ≤ÂåÖ‰ø°ÊÅØ DETAILS',-1)),(0,r.createElementVNode)('div',Zo,[(0,r.createElementVNode)('div',{class:'cover-upload',onClick:t[0]||(t[0]=t=>e.$emit('trigger-cover-upload')),style:(0,r.normalizeStyle)({backgroundImage:e.coverImage?`url(${e.coverImage})`:'none'})},[e.coverImage?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',el,[(0,r.createVNode)(v,{name:'image',size:'1.2em'}),t[9]||(t[9]=(0,r.createElementVNode)('span',null,'Â∞ÅÈù¢',-1))])),(0,r.createElementVNode)('div',tl,[(0,r.createVNode)(v,{name:'edit',size:'1em'})])],4),(0,r.createElementVNode)('div',al,[(0,r.createElementVNode)('input',{type:'text',value:e.name,onInput:t[1]||(t[1]=t=>e.$emit('update:name',t.target.value)),placeholder:'ËßíËâ≤ÂåÖÂêçÁß∞...',class:'title-input'},null,40,nl),(0,r.createElementVNode)('input',{type:'text',value:e.coverImage,onInput:t[2]||(t[2]=t=>e.$emit('update:coverImage',t.target.value)),placeholder:'ÊàñËæìÂÖ•Â∞ÅÈù¢ÂõæÁâá URL...',class:'url-input'},null,40,ol),(0,r.createElementVNode)('div',ll,[(0,r.createVNode)(v,{name:'info',size:'0.75em'}),t[10]||(t[10]=(0,r.createTextVNode)(' Êé®Ëçê URLÔºàÈÅøÂÖç base64 ËøáÂ§ßÔºâ ',-1))]),(0,r.createElementVNode)('textarea',{value:e.description,onInput:t[3]||(t[3]=t=>e.$emit('update:description',t.target.value)),placeholder:'ÁÆÄË¶ÅÊèèËø∞...',rows:'2',class:'desc-input'},null,40,rl)])])]),(0,r.createElementVNode)('div',il,[t[17]||(t[17]=(0,r.createElementVNode)('h3',null,'ÁªÑ‰ª∂Â∫ì MODULES',-1)),(0,r.createElementVNode)('div',cl,[(0,r.createElementVNode)('button',{class:'palette-btn',onPointerdown:t[4]||(t[4]=(0,r.withModifiers)(t=>e.$emit('spawn',t,'IDENTITY'),['prevent']))},[(0,r.createVNode)(v,{name:'image',size:'0.9em'}),t[12]||(t[12]=(0,r.createTextVNode)(' Á´ãÁªò (Portrait) ',-1))],32),(0,r.createElementVNode)('button',{class:'palette-btn',onPointerdown:t[5]||(t[5]=(0,r.withModifiers)(t=>e.$emit('spawn',t,'APPEARANCE'),['prevent']))},[(0,r.createVNode)(v,{name:'eye',size:'0.9em'}),t[13]||(t[13]=(0,r.createTextVNode)(' Â§ñË≤å (Appearance) ',-1))],32),(0,r.createElementVNode)('button',{class:'palette-btn',onPointerdown:t[6]||(t[6]=(0,r.withModifiers)(t=>e.$emit('spawn',t,'PERSONALITY'),['prevent']))},[(0,r.createVNode)(v,{name:'brain',size:'0.9em'}),t[14]||(t[14]=(0,r.createTextVNode)(' ÊÄßÊ†º (Personality) ',-1))],32),(0,r.createElementVNode)('button',{class:'palette-btn',onPointerdown:t[7]||(t[7]=(0,r.withModifiers)(t=>e.$emit('spawn',t,'BACKGROUND'),['prevent']))},[(0,r.createVNode)(v,{name:'book',size:'0.9em'}),t[15]||(t[15]=(0,r.createTextVNode)(' Ë∫´‰∏ñ (Background) ',-1))],32),(0,r.createElementVNode)('button',{class:'palette-btn',onPointerdown:t[8]||(t[8]=(0,r.withModifiers)(t=>e.$emit('spawn',t,'ABILITY'),['prevent']))},[(0,r.createVNode)(v,{name:'lightning',size:'0.9em'}),t[16]||(t[16]=(0,r.createTextVNode)(' ËÉΩÂäõ (Ability) ',-1))],32)])]),t[18]||(t[18]=(0,r.createElementVNode)('div',{class:'sidebar-spacer'},null,-1)),t[19]||(t[19]=(0,r.createElementVNode)('div',{class:'sidebar-info'},[(0,r.createElementVNode)('div',{class:'info-group'},[(0,r.createElementVNode)('h3',null,'Êìç‰ΩúÊåáÂçó'),(0,r.createElementVNode)('p',null,'ÊãñÊãΩÁªÑ‰ª∂Âà∞ÁîªÂ∏É'),(0,r.createElementVNode)('p',null,'Â∞ÜÂÆÉ‰ª¨ÊãºÊé•Âà∞‰∏ÄËµ∑'),(0,r.createElementVNode)('p',null,'ÊØè‰∏ÄÁªÑ‰∏∫‰∏Ä‰∏™È¢ÑËÆæ')]),(0,r.createElementVNode)('div',{class:'info-group'},[(0,r.createElementVNode)('h3',null,'Âø´Êç∑ÈîÆ'),(0,r.createElementVNode)('p',null,'‰∏≠ÈîÆÊãñÊãΩÁîªÂ∏É'),(0,r.createElementVNode)('p',null,'ÊªöËΩÆÁº©ÊîæËßÜÂõæ')])],-1))]))}),dl=(0,y.A)(sl,[['__scopeId','data-v-5a44f092']]),ul=(0,r.defineComponent)({__name:'CharacterPackEditor',props:{initialData:{}},emits:['save','auto-save'],setup(e,{expose:t,emit:a}){const n=e,o=a,l=(0,r.ref)(null),i=(0,r.ref)(null),c=(0,r.ref)(1),s=(0,r.computed)(()=>{if(!i.value)return{};const e=i.value.clientWidth,t=i.value.clientHeight;return{width:e/c.value+'px',height:t/c.value+'px',transform:`scale(${c.value})`,transformOrigin:'center center',flexShrink:0,position:'relative'}});function d(){if(!i.value)return;const{width:e,height:t}=i.value.getBoundingClientRect();0!==e&&0!==t&&(c.value=t/1080)}const u=(0,r.ref)([]),m=(0,r.ref)(null),p=(0,r.reactive)({name:'New Character Pack',description:'',coverImage:''}),v=(0,r.reactive)({active:!1,block:null,isNew:!1,originalRootId:null,x:0,y:0,offsetX:0,offsetY:0}),g=(0,r.reactive)({active:!1,pointerId:null,lastX:0,lastY:0}),f=(0,r.reactive)({active:!1,startDist:0,startZoom:1,worldX:0,worldY:0}),y=new Map,h=(0,r.reactive)({x:0,y:0,zoom:1}),k=(0,r.computed)(()=>({transform:`translate(${h.x}px, ${h.y}px) scale(${h.zoom})`,transformOrigin:'0 0'})),N=(0,r.ref)(null),E=()=>Math.random().toString(36).substr(2,9);let V=null;function b(e){if(!l.value)return{x:e.clientX,y:e.clientY};const t=l.value.getBoundingClientRect(),a=e.clientX-t.left,n=e.clientY-t.top;return{x:a/c.value,y:n/c.value}}function w(e){if(e.target.closest('.character-block'))return;if(v.active)return;if('mouse'===e.pointerType&&0!==e.button&&1!==e.button)return;try{l.value?.setPointerCapture(e.pointerId)}catch{}const t=b(e);if(y.set(e.pointerId,t),y.size>=2){g.active=!1,g.pointerId=null;const t=Array.from(y.values()),a=t[0],n=t[1],o=(a.x+n.x)/2,l=(a.y+n.y)/2,r=a.x-n.x,i=a.y-n.y,c=Math.hypot(r,i);return f.active=!0,f.startDist=c||1,f.startZoom=h.zoom,f.worldX=(o-h.x)/h.zoom,f.worldY=(l-h.y)/h.zoom,void e.preventDefault()}g.active=!0,g.pointerId=e.pointerId,g.lastX=t.x,g.lastY=t.y,e.preventDefault()}function C(e){const t=h.zoom-.05*Math.sign(e.deltaY);h.zoom=Math.min(Math.max(t,.2),3)}function S(e,t){if(e.preventDefault(),void 0!==e.pointerId)try{l.value?.setPointerCapture(e.pointerId)}catch{}const a={id:E(),type:t,data:{}},n=b(e);v.block=a,v.isNew=!0,v.active=!0,v.pointerId=e.pointerId??null,v.offsetX=150,v.offsetY=30,v.x=n.x-v.offsetX,v.y=n.y-v.offsetY}function B({id:e,event:t}){if(t.stopPropagation(),t.preventDefault(),void 0!==t.pointerId)try{l.value?.setPointerCapture(t.pointerId)}catch{}const{block:a,parent:n,rootIndex:o}=T(e);if(!a)return;const r=document.querySelector(`[data-block-id="${e}"]`),i=b(t);if(v.block=a,v.active=!0,v.isNew=!1,v.pointerId=t.pointerId??null,r&&l.value){const e=r.getBoundingClientRect(),t=l.value.getBoundingClientRect(),a=(e.left-t.left)/c.value,n=(e.top-t.top)/c.value;v.offsetX=i.x-a,v.offsetY=i.y-n}else v.offsetX=150,v.offsetY=30;v.x=i.x-v.offsetX,v.y=i.y-v.offsetY,n?n.next=void 0:'number'==typeof o&&u.value.splice(o,1)}function x(e){const t=b(e);if(y.has(e.pointerId)&&y.set(e.pointerId,t),f.active){if(y.size<2)f.active=!1;else{const e=Array.from(y.values()),t=e[0],a=e[1],n=(t.x+a.x)/2,o=(t.y+a.y)/2,l=t.x-a.x,r=t.y-a.y,i=Math.hypot(l,r)/(f.startDist||1),c=Math.min(Math.max(f.startZoom*i,.2),3);h.zoom=c,h.x=n-f.worldX*c,h.y=o-f.worldY*c}return void e.preventDefault()}if(g.active&&g.pointerId===e.pointerId){const e=t.x-g.lastX,a=t.y-g.lastY;return h.x+=e,h.y+=a,g.lastX=t.x,void(g.lastY=t.y)}if(!v.active)return;const a=v.pointerId;'number'==typeof a&&e.pointerId!==a||(v.x=t.x-v.offsetX,v.y=t.y-v.offsetY,function(){if(!m.value||!l.value)return;const e=v.x,t=v.y,a=50;let n=null,o=a;const r=document.querySelectorAll('.character-block[data-block-id]'),i=l.value.getBoundingClientRect();r.forEach(l=>{const r=l.getAttribute('data-block-id');if(!r||r===v.block?.id)return;if(!T(r).block)return;const s=l.getBoundingClientRect(),d=(s.left-i.left)/c.value,u=(s.top-i.top)/c.value,m=(s.bottom-i.top)/c.value,p=s.height/c.value,g=Math.abs(t-m),f=Math.abs(e-d);if(g<a&&f<a){const e=Math.sqrt(f*f+g*g);e<o&&(o=e,n={id:r,x:d,y:u,height:p})}}),N.value=n}())}function I(e){if(y.has(e.pointerId)&&y.delete(e.pointerId),f.active&&y.size<2&&(f.active=!1),g.active&&g.pointerId===e.pointerId){g.active=!1,g.pointerId=null;try{l.value?.releasePointerCapture(e.pointerId)}catch{}return}if(!v.active){try{l.value?.releasePointerCapture(e.pointerId)}catch{}return}const t=v.pointerId;if('number'==typeof t&&e.pointerId!==t){try{l.value?.releasePointerCapture(e.pointerId)}catch{}return}try{l.value?.releasePointerCapture(e.pointerId)}catch{}const a=v.block;if(N.value){const e=T(N.value.id).block;if(e)if(e.next){const t=e.next;e.next=a;let n=a;for(;n.next;)n=n.next;n.next=t}else e.next=a}else{if(m.value){const e=m.value.getBoundingClientRect(),t=l.value.getBoundingClientRect(),n=(e.left-t.left)/c.value,o=(e.top-t.top)/c.value,r=v.x-n,i=v.y-o;a.x=(r-h.x)/h.zoom,a.y=(i-h.y)/h.zoom}u.value.push(a)}v.active=!1,v.block=null,v.pointerId=null,N.value=null}function T(e,t=u.value){for(let a=0;a<t.length;a++){if(t[a].id===e)return{block:t[a],rootIndex:a};let n=t[a],o=n.next;for(;o;){if(o.id===e)return{block:o,parent:n};n=o,o=o.next}}return{}}(0,r.onMounted)(()=>{V=new ResizeObserver(()=>{d()}),i.value&&V.observe(i.value),d(),n.initialData&&n.initialData.presets&&(p.name=n.initialData.name||'New Character Pack',p.description=n.initialData.description||'',p.coverImage=n.initialData.coverImage||'',n.initialData.presets.forEach((e,t)=>{const a=50+350*t,n={id:E(),type:'IDENTITY',x:a,y:50,data:{name:e.name,cover:e.coverImage,description:e.description}};let o=n;[{type:'APPEARANCE',text:e.appearance},{type:'PERSONALITY',text:e.personality},{type:'BACKGROUND',text:e.background},{type:'ABILITY',text:e.ability}].forEach(e=>{if(e.text){const t={id:E(),type:e.type,data:{text:e.text}};o.next=t,o=t}}),u.value.push(n)}))}),(0,r.onUnmounted)(()=>{V&&V.disconnect(),window.removeEventListener('resize',d)});const A=(0,r.ref)(null),D=(0,r.ref)(null),M=(0,r.ref)(!1),P=(0,r.ref)(!1),O=(0,r.ref)(''),R=(0,r.ref)(16/9);function L(e){D.value=e,M.value=!1,A.value?.click()}function U(){D.value=null,M.value=!0,R.value=16/9,A.value?.click()}function F(e){const t=e.target,a=t.files?.[0];if(a){const e=new FileReader;e.onload=e=>{O.value=e.target?.result,M.value?P.value=!0:D.value&&(D.value.data.cover=O.value,P.value=!1),t.value=''},e.readAsDataURL(a)}}function W(e){M.value&&(p.coverImage=e),P.value=!1}function j(){const e=[];return u.value.forEach(t=>{let a=t;const n={id:t.id,name:'',appearance:'',personality:'',background:'',ability:'',description:'',coverImage:''};for(;a;)'IDENTITY'===a.type?(a.data.name&&(n.name=a.data.name),a.data.cover&&(n.coverImage=a.data.cover),a.data.description&&(n.description=a.data.description)):'APPEARANCE'===a.type?n.appearance=(n.appearance?n.appearance+'\n':'')+(a.data.text||''):'PERSONALITY'===a.type?n.personality=(n.personality?n.personality+'\n':'')+(a.data.text||''):'BACKGROUND'===a.type?n.background=(n.background?n.background+'\n':'')+(a.data.text||''):'ABILITY'===a.type&&(n.ability=(n.ability?n.ability+'\n':'')+(a.data.text||'')),a=a.next;e.push(n)}),{id:n.initialData?.id||E(),name:p.name,description:p.description,coverImage:p.coverImage,presets:e,createdAt:n.initialData?.createdAt||(new Date).toISOString(),updatedAt:(new Date).toISOString()}}return(0,r.watch)(u,()=>{o('auto-save','Saving...')},{deep:!0}),t({save:function(){o('save',j())},get charPack(){return j()}}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'character-pack-editor-root',ref_key:'rootRef',ref:i},[(0,r.createCommentVNode)(' Scaled Container '),(0,r.createElementVNode)('div',{class:'visual-editor-container',ref_key:'containerRef',ref:l,style:(0,r.normalizeStyle)(s.value),onPointermove:x,onPointerup:I,onPointercancel:I,onPointerleave:I,onWheel:(0,r.withModifiers)(C,['prevent'])},[(0,r.createCommentVNode)(' Palette Sidebar '),(0,r.createVNode)(dl,{onSpawn:S,name:p.name,'onUpdate:name':t[0]||(t[0]=e=>p.name=e),description:p.description,'onUpdate:description':t[1]||(t[1]=e=>p.description=e),'cover-image':p.coverImage,'onUpdate:coverImage':t[2]||(t[2]=e=>p.coverImage=e),onTriggerCoverUpload:U},null,8,['name','description','cover-image']),(0,r.createCommentVNode)(' Workspace '),(0,r.createElementVNode)('div',{class:'workspace',ref_key:'workspaceStore',ref:m,onPointerdown:w},[(0,r.createElementVNode)('div',{class:'pan-zoom-wrapper',style:(0,r.normalizeStyle)(k.value)},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(u.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'root-block-wrapper',style:(0,r.normalizeStyle)({left:e.x+'px',top:e.y+'px',position:'absolute'})},[(0,r.createVNode)(Ko,{block:e,'snap-target-id':N.value?.id,onRemove:t=>function(e){const{rootIndex:t}=T(e);'number'==typeof t&&u.value.splice(t,1)}(e.id),onTriggerUpload:L,onDragStart:B},null,8,['block','snap-target-id','onRemove'])],4))),128)),(0,r.createCommentVNode)(' Ghost removed, visualization handled inside CharacterBlock ')],4)],544),(0,r.createCommentVNode)(' Dragging Proxy (When spawning or moving) '),v.active&&v.block?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'drag-proxy',style:(0,r.normalizeStyle)({left:v.x+'px',top:v.y+'px',transform:`scale(${h.zoom})`})},[(0,r.createVNode)(Ko,{block:v.block,'is-dragging':!0},null,8,['block'])],4)):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Hidden File Input '),(0,r.createElementVNode)('input',{type:'file',ref_key:'fileInput',ref:A,accept:'image/*',style:{display:'none'},onChange:F},null,544)],36),(0,r.createCommentVNode)(' Image Cropper Modal (Outside scaled container for proper display) '),P.value?((0,r.openBlock)(),(0,r.createBlock)(Lo,{key:0,'image-url':O.value,'aspect-ratio':R.value,onConfirm:W,onCancel:t[3]||(t[3]=e=>P.value=!1)},null,8,['image-url','aspect-ratio'])):(0,r.createCommentVNode)('v-if',!0)],512))}}),ml=(0,y.A)(ul,[['__scopeId','data-v-e7b1ae30']]),pl='autosave_event_pack_v1';let vl=null,gl=null;async function fl(){vl=null,null!=gl&&(clearTimeout(gl),gl=null),await re.idbService.deleteRuntimeAsset(pl).catch(()=>{})}function yl(e,t=500){vl=function(e){try{return structuredClone(e)}catch{return JSON.parse(JSON.stringify(e))}}(e),null==gl&&(gl=window.setTimeout(()=>{gl=null;const e=vl;vl=null,e&&re.idbService.setRuntimeAsset(pl,e).catch(e=>{console.warn('[EventPackAutosave] Failed to persist autosave to IndexedDB:',e)})},t))}const hl={class:'editor-section'},kl={class:'section-title'},Nl={key:0,class:'items-list'},El={class:'event-header'},Vl=['onUpdate:modelValue'],bl=['onClick'],wl={class:'natural-condition-panel'},Cl=['onUpdate:modelValue'],Sl={class:'event-content-wrapper'},Bl=['onUpdate:modelValue'],xl={key:1,class:'empty-hint'},_l=(0,r.defineComponent)({__name:'ConditionalEventsEditor',props:{eventPack:{},allVariables:{}},setup(e){const t=e;for(const e of t.eventPack.conditionalEvents||[])e.triggerType&&'natural'!==e.triggerType&&(e.triggerType='natural'),e.conditions&&delete e.conditions;function a(){const e={id:crypto.randomUUID(),name:'Êñ∞Êù°‰ª∂‰∫ã‰ª∂',content:'',naturalCondition:''};t.eventPack.conditionalEvents.push(e)}return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',hl,[(0,r.createElementVNode)('div',kl,[n[1]||(n[1]=(0,r.createElementVNode)('h4',null,'Êù°‰ª∂‰∫ã‰ª∂ (Conditional Events)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:a},[(0,r.createVNode)(v,{name:'plus',size:'0.75em'}),n[0]||(n[0]=(0,r.createTextVNode)(' Ê∑ªÂä†',-1))])]),e.eventPack.conditionalEvents.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Nl,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.conditionalEvents,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'event-item'},[(0,r.createElementVNode)('div',El,[(0,r.createVNode)(v,{name:'book',size:'1.2em',style:{opacity:'0.5'}}),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'event-name',placeholder:'‰∫ã‰ª∂ÂêçÁß∞'},null,8,Vl),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:e=>function(e){t.eventPack.conditionalEvents.splice(e,1)}(a)},[(0,r.createVNode)(v,{name:'delete',size:'0.9em'})],8,bl)]),(0,r.createCommentVNode)(' Natural Language Trigger (only) '),(0,r.createElementVNode)('div',wl,[(0,r.createElementVNode)('label',null,[(0,r.createVNode)(v,{name:'chat',size:'0.9em'}),n[2]||(n[2]=(0,r.createTextVNode)(' Ëá™ÁÑ∂ËØ≠Ë®ÄËß¶ÂèëÊèèËø∞ (AIÂ∞ÜÊ†πÊçÆÂâßÊÉÖÂà§Êñ≠ÊòØÂê¶Êª°Ë∂≥): ',-1))]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.naturalCondition=t,class:'natural-input',placeholder:'‰æãÂ¶ÇÔºöÂΩìÁé©ÂÆ∂ËøõÂÖ•Â∫üÂºÉ‰ªìÂ∫ìÔºå‰∏îÈöèË∫´Êê∫Â∏¶‰∫ÜÊóßÁÖßÁâáÊó∂Ëß¶Âèë...'},null,8,Cl),[[r.vModelText,e.naturalCondition]])]),(0,r.createElementVNode)('div',Sl,[n[3]||(n[3]=(0,r.createElementVNode)('label',null,'‰∫ã‰ª∂ÂâßÊú¨:',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'event-content',placeholder:'‰∫ã‰ª∂ÂèëÁîüÊó∂ÁöÑÂâßÊÉÖ...'},null,8,Bl),[[r.vModelText,e.content]])])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',xl,'ÊöÇÊó†Êù°‰ª∂‰∫ã‰ª∂'))]))}}),Il=(0,y.A)(_l,[['__scopeId','data-v-94b03bdc']]),Tl=Il,Al={class:'editor-section'},Dl={class:'wb-grid'},Ml={class:'wb-panel list'},Pl={class:'panel-header'},Ol={class:'panel-content'},Rl={key:0,class:'entry-list'},$l=['onClick'],Ll={class:'entry-title-row'},Ul={class:'entry-title'},zl={class:'entry-badges'},Fl={key:0,class:'badge disabled'},Wl={key:1,class:'badge enabled'},jl={class:'entry-sub'},Gl={key:0,class:'dim'},Jl={key:1,class:'dim'},Yl={key:2,class:'dim'},Hl={key:1,class:'empty-panel'},Xl={class:'wb-panel editor'},Kl={class:'panel-header'},Ql={class:'editor-actions'},ql=['disabled'],Zl={key:0,class:'panel-content'},er={class:'form-grid'},tr={class:'field span-2'},ar={class:'field'},nr={class:'pretty-check'},or=['checked'],lr={class:'field'},rr=['value'],ir={class:'field'},cr=['value'],sr={class:'field'},dr={class:'field'},ur=['value'],mr={class:'field span-2'},pr=['value'],vr={class:'field'},gr={class:'field span-1'},fr=['value'],yr={class:'field span-2'},hr={class:'field'},kr={class:'field'},Nr=['value'],Er={key:0,class:'field'},Vr={key:1,class:'field'},br=['value'],wr={class:'field'},Cr={class:'pretty-check'},Sr=['checked'],Br={class:'field'},xr={class:'pretty-check'},_r=['checked'],Ir={class:'field'},Tr=['value'],Ar={class:'field'},Dr=['value'],Mr={class:'field'},Pr=['value'],Or={class:'field'},Rr=['value'],$r={class:'field span-2'},Lr=['value'],Ur={key:0,class:'hint warning'},zr={key:1,class:'panel-content'},Fr=(0,r.defineComponent)({__name:'ExtraWorldbooksEditor',props:{eventPack:{}},setup(e){const t=e,a=(0,r.ref)(null);const n=(0,r.computed)(()=>{const e=a.value;if(!e)return null;const n=t.eventPack.extraWorldBooks.find(t=>t.id===e)||null;return n&&function(e){e.enabled??=!0,e.probability??=100,e.strategy??={},e.strategy.type??='selective',e.strategy.keys??=[],e.strategy.keys_secondary??={},e.strategy.keys_secondary.logic??='and_any',e.strategy.keys_secondary.keys??=[],e.strategy.scan_depth??='same_as_global',e.position??={},e.position.type??='after_character_definition',e.position.role??='system',e.position.depth??=0,e.position.order??=100,e.recursion??={},e.recursion.prevent_incoming??=!1,e.recursion.prevent_outgoing??=!1,e.recursion.delay_until??=null,e.effect??={},e.effect.sticky??=null,e.effect.cooldown??=null,e.effect.delay??=null,e.extra??={}}(n),n}),o=(0,r.computed)(()=>n.value||void 0);function l(){const e={id:crypto.randomUUID(),name:'',content:'',enabled:!0,uid:void 0,probability:100,strategy:{type:'selective',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:0,order:100},recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null},extra:{}};t.eventPack.extraWorldBooks.push(e),a.value=e.id}function i(){if(!o.value)return;const e=t.eventPack.extraWorldBooks.findIndex(e=>e.id===o.value.id);if(e<0)return;t.eventPack.extraWorldBooks.splice(e,1);const n=t.eventPack.extraWorldBooks[e]||t.eventPack.extraWorldBooks[e-1]||null;a.value=n?.id||null}(0,r.onMounted)(()=>{t.eventPack.extraWorldBooks||(t.eventPack.extraWorldBooks=[]),t.eventPack.extraWorldBooks.length&&!a.value&&(a.value=t.eventPack.extraWorldBooks[0].id)}),(0,r.watch)(()=>t.eventPack.extraWorldBooks.length,()=>{!a.value&&t.eventPack.extraWorldBooks.length&&(a.value=t.eventPack.extraWorldBooks[0].id)});const c=(0,r.computed)(()=>'number'==typeof n.value?.probability?n.value.probability:100);function s(e){if(!o.value)return;const t=e.target.value,a=''===t?100:Number(t);o.value.probability=Number.isFinite(a)?Math.max(0,Math.min(100,Math.round(a))):100}const d=(0,r.computed)(()=>'number'==typeof n.value?.uid?String(n.value.uid):'');function u(e){if(!o.value)return;const t=e.target.value;if(!t.trim())return void(o.value.uid=void 0);const a=Number(t);o.value.uid=Number.isFinite(a)?Math.max(0,Math.floor(a)):o.value.uid}function m(e){o.value&&(o.value.enabled=e.target.checked)}const p=(0,r.computed)({get(){const e=n.value?.strategy?.scan_depth;return'same_as_global'===e||'number'!=typeof e?'same_as_global':'custom'},set(e){o.value&&(o.value.strategy.scan_depth='same_as_global'===e?'same_as_global':7)}}),g=(0,r.computed)(()=>{const e=n.value?.strategy?.scan_depth;return'number'==typeof e?String(e):'7'});function f(e){if(!o.value)return;const t=e.target.value,a=Number(t);Number.isFinite(a)&&(o.value.strategy.scan_depth=Math.max(1,Math.floor(a)))}const y=(0,r.computed)(()=>(n.value?.strategy?.keys||[]).join('\n'));function h(e){if(!o.value)return;const t=e.target.value.split(/\r?\n/).map(e=>e.trim()).filter(Boolean);o.value.strategy.keys=t}const k=(0,r.computed)(()=>(n.value?.strategy?.keys_secondary?.keys||[]).join('\n'));function N(e){if(!o.value)return;const t=e.target.value.split(/\r?\n/).map(e=>e.trim()).filter(Boolean);o.value.strategy.keys_secondary.keys=t}const E=(0,r.computed)(()=>'number'==typeof n.value?.position?.order?String(n.value.position.order):'');function V(e){if(!o.value)return;const t=e.target.value;if(!t.trim())return void(o.value.position.order=100);const a=Number(t);Number.isFinite(a)&&(o.value.position.order=Math.floor(a))}const b=(0,r.computed)(()=>'number'==typeof n.value?.position?.depth?String(n.value.position.depth):'0');function w(e){if(!o.value)return;const t=e.target.value,a=Number(t);Number.isFinite(a)&&(o.value.position.depth=Math.max(0,Math.floor(a)))}function C(e){if(!e.trim())return null;const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):null}const S=(0,r.computed)(()=>null==n.value?.recursion?.delay_until?'':String(n.value.recursion.delay_until));function B(e){o.value&&(o.value.recursion.delay_until=C(e.target.value))}const x=(0,r.computed)(()=>null==n.value?.effect?.sticky?'':String(n.value.effect.sticky));function I(e){o.value&&(o.value.effect.sticky=C(e.target.value))}const T=(0,r.computed)(()=>null==n.value?.effect?.cooldown?'':String(n.value.effect.cooldown));function A(e){o.value&&(o.value.effect.cooldown=C(e.target.value))}const D=(0,r.computed)(()=>null==n.value?.effect?.delay?'':String(n.value.effect.delay));function M(e){o.value&&(o.value.effect.delay=C(e.target.value))}const P=(0,r.ref)(''),O=(0,r.computed)(()=>{const e=n.value?.extra||{};try{return JSON.stringify(e,null,2)}catch{return'{}'}});function R(e){if(!o.value)return;const t=e.target.value;if(!t.trim())return o.value.extra={},void(P.value='');try{o.value.extra=JSON.parse(t),P.value=''}catch(e){P.value='JSON Ê†ºÂºèÈîôËØØÔºö'+(e?.message||String(e))}}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Al,[(0,r.createElementVNode)('div',Dl,[(0,r.createCommentVNode)(' List '),(0,r.createElementVNode)('div',Ml,[(0,r.createElementVNode)('div',Pl,[(0,r.createElementVNode)('h4',null,[(0,r.createVNode)(v,{name:'book',size:'1em'}),t[9]||(t[9]=(0,r.createTextVNode)(' È¢ùÂ§ñ‰∏ñÁïå‰π¶',-1))]),(0,r.createElementVNode)('button',{class:'add-mini-btn',onClick:l},'+')]),(0,r.createElementVNode)('div',Ol,[e.eventPack.extraWorldBooks.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Rl,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.extraWorldBooks,e=>((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:e.id,class:(0,r.normalizeClass)(['entry-item',{active:e.id===a.value}]),onClick:t=>a.value=e.id,type:'button'},[(0,r.createElementVNode)('div',Ll,[(0,r.createElementVNode)('span',Ul,(0,r.toDisplayString)(e.name?.trim()?e.name:'ÔºàÊú™ÂëΩÂêçÊù°ÁõÆÔºâ'),1),(0,r.createElementVNode)('span',zl,[!1===e.enabled?((0,r.openBlock)(),(0,r.createElementBlock)('span',Fl,'Á¶ÅÁî®')):((0,r.openBlock)(),(0,r.createElementBlock)('span',Wl,'ÂêØÁî®'))])]),(0,r.createElementVNode)('div',jl,[e.strategy?.type?((0,r.openBlock)(),(0,r.createElementBlock)('span',Gl,(0,r.toDisplayString)(e.strategy.type),1)):(0,r.createCommentVNode)('v-if',!0),'number'==typeof e.probability?((0,r.openBlock)(),(0,r.createElementBlock)('span',Jl,' ¬∑ '+(0,r.toDisplayString)(e.probability)+'%',1)):(0,r.createCommentVNode)('v-if',!0),'number'==typeof e.uid?((0,r.openBlock)(),(0,r.createElementBlock)('span',Yl,' ¬∑ UID: '+(0,r.toDisplayString)(e.uid),1)):(0,r.createCommentVNode)('v-if',!0)])],10,$l))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Hl,'ÊöÇÊó†Êù°ÁõÆ'))])]),(0,r.createCommentVNode)(' Editor '),(0,r.createElementVNode)('div',Xl,[(0,r.createElementVNode)('div',Kl,[(0,r.createElementVNode)('h4',null,[(0,r.createVNode)(v,{name:'edit',size:'1em'}),t[10]||(t[10]=(0,r.createTextVNode)(' Êù°ÁõÆÁºñËæë',-1))]),(0,r.createElementVNode)('div',Ql,[(0,r.createElementVNode)('button',{class:'danger-btn',disabled:!o.value,onClick:i},'Âà†Èô§',8,ql)])]),o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Zl,[(0,r.createElementVNode)('div',er,[(0,r.createElementVNode)('div',tr,[t[11]||(t[11]=(0,r.createElementVNode)('label',null,'ÂêçÁß∞',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[0]||(t[0]=e=>o.value.name=e),type:'text',placeholder:'Êù°ÁõÆÊ†áÈ¢ò'},null,512),[[r.vModelText,o.value.name]])]),(0,r.createElementVNode)('div',ar,[t[14]||(t[14]=(0,r.createElementVNode)('label',null,'ÂêØÁî®',-1)),(0,r.createElementVNode)('label',nr,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!1!==o.value.enabled,onChange:m},null,40,or),t[12]||(t[12]=(0,r.createElementVNode)('span',{class:'check-ui','aria-hidden':'true'},null,-1)),t[13]||(t[13]=(0,r.createTextVNode)(' ÂêØÁî®ËØ•Êù°ÁõÆ ',-1))])]),(0,r.createElementVNode)('div',lr,[t[15]||(t[15]=(0,r.createElementVNode)('label',null,'ÊøÄÊ¥ªÊ¶ÇÁéá%',-1)),(0,r.createElementVNode)('input',{type:'number',min:'0',max:'100',step:'1',value:c.value,onInput:s,placeholder:'100'},null,40,rr)]),(0,r.createElementVNode)('div',ir,[t[16]||(t[16]=(0,r.createElementVNode)('label',null,'UID',-1)),(0,r.createElementVNode)('input',{type:'number',min:'0',step:'1',value:d.value,onInput:u,placeholder:'(Ëá™Âä®)'},null,40,cr),t[17]||(t[17]=(0,r.createElementVNode)('div',{class:'hint'},'ÁïôÁ©∫Âàô‰∏çÊåáÂÆö UIDÔºàÁî±ÈÖíÈ¶Ü/Á≥ªÁªüËá™Âä®ÂàÜÈÖçÔºõ‰ªÖÂú®Êú¨‰∫ã‰ª∂ÂåÖÂÜÖÈúÄË¶ÅÂîØ‰∏ÄÊó∂ÂÜçÂ°´ÂÜôÔºâ„ÄÇ',-1))]),(0,r.createElementVNode)('div',sr,[t[19]||(t[19]=(0,r.createElementVNode)('label',null,'ÊøÄÊ¥ªÁ≠ñÁï•',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[1]||(t[1]=e=>o.value.strategy.type=e)},[...t[18]||(t[18]=[(0,r.createElementVNode)('option',{value:'constant'},'Â∏∏Èáè (ËìùÁÅØ)',-1),(0,r.createElementVNode)('option',{value:'selective'},'ÂèØÈÄâÈ°π (ÁªøÁÅØ)',-1),(0,r.createElementVNode)('option',{value:'vectorized'},'ÂêëÈáèÂåñ',-1)])],512),[[r.vModelSelect,o.value.strategy.type]])]),(0,r.createElementVNode)('div',dr,[t[21]||(t[21]=(0,r.createElementVNode)('label',null,'Êâ´ÊèèÊ∑±Â∫¶',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[2]||(t[2]=e=>p.value=e)},[...t[20]||(t[20]=[(0,r.createElementVNode)('option',{value:'same_as_global'},'‰ΩøÁî®ÂÖ®Â±Ä',-1),(0,r.createElementVNode)('option',{value:'custom'},'Ëá™ÂÆö‰πâ',-1)])],512),[[r.vModelSelect,p.value]]),'custom'===p.value?((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:0,class:'mt',type:'number',min:'1',step:'1',value:g.value,onInput:f,placeholder:'‰æãÂ¶ÇÔºö7'},null,40,ur)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',mr,[t[22]||(t[22]=(0,r.createElementVNode)('label',null,'‰∏ªË¶ÅÂÖ≥ÈîÆÂ≠óÔºàÊØèË°å‰∏Ä‰∏™Ôºâ',-1)),(0,r.createElementVNode)('textarea',{class:'mono',value:y.value,onInput:h,placeholder:'‰æãÂ¶ÇÔºö\\nÁ•û‰πêÂÖâ\\nÂ∞èÂÖâ'},null,40,pr),t[23]||(t[23]=(0,r.createElementVNode)('div',{class:'hint'},'‰ªÖÂØπ‚ÄúÂèØÈÄâÈ°π(ÁªøÁÅØ)‚ÄùÁ≠ñÁï•ÁîüÊïà„ÄÇ',-1))]),(0,r.createElementVNode)('div',vr,[t[25]||(t[25]=(0,r.createElementVNode)('label',null,'Ê¨°Ë¶ÅÂÖ≥ÈîÆÂ≠óÈÄªËæë',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[3]||(t[3]=e=>o.value.strategy.keys_secondary.logic=e)},[...t[24]||(t[24]=[(0,r.createElementVNode)('option',{value:'and_any'},'and_anyÔºö‰ªªÊÑèÂëΩ‰∏≠',-1),(0,r.createElementVNode)('option',{value:'and_all'},'and_allÔºöÂÖ®ÈÉ®ÂëΩ‰∏≠',-1),(0,r.createElementVNode)('option',{value:'not_all'},'not_allÔºöËá≥Â∞ë‰∏Ä‰∏™Êú™ÂëΩ‰∏≠',-1),(0,r.createElementVNode)('option',{value:'not_any'},'not_anyÔºöÂÖ®ÈÉ®Êú™ÂëΩ‰∏≠',-1)])],512),[[r.vModelSelect,o.value.strategy.keys_secondary.logic]])]),(0,r.createElementVNode)('div',gr,[t[26]||(t[26]=(0,r.createElementVNode)('label',null,'Ê¨°Ë¶ÅÂÖ≥ÈîÆÂ≠óÔºàÊØèË°å‰∏Ä‰∏™Ôºâ',-1)),(0,r.createElementVNode)('textarea',{class:'mono',value:k.value,onInput:N,placeholder:'ÂèØÁïôÁ©∫'},null,40,fr)]),(0,r.createElementVNode)('div',yr,[t[27]||(t[27]=(0,r.createElementVNode)('label',null,'ÂÜÖÂÆπ',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[4]||(t[4]=e=>o.value.content=e),class:'content',placeholder:'‰∏ñÁïå‰π¶Êù°ÁõÆÂÜÖÂÆπ...'},null,512),[[r.vModelText,o.value.content]])]),t[45]||(t[45]=(0,r.createElementVNode)('div',{class:'field span-2'},[(0,r.createElementVNode)('div',{class:'sub-title'},'ÊèíÂÖ•‰ΩçÁΩÆ')],-1)),(0,r.createElementVNode)('div',hr,[t[29]||(t[29]=(0,r.createElementVNode)('label',null,'‰ΩçÁΩÆÁ±ªÂûã',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[5]||(t[5]=e=>o.value.position.type=e)},[...t[28]||(t[28]=[(0,r.createStaticVNode)('<option value="before_character_definition" data-v-0916b7e8>ËßíËâ≤ÂÆö‰πâ‰πãÂâç</option><option value="after_character_definition" data-v-0916b7e8>ËßíËâ≤ÂÆö‰πâ‰πãÂêé</option><option value="before_example_messages" data-v-0916b7e8>Á§∫‰æãÊ∂àÊÅØ‰πãÂâç</option><option value="after_example_messages" data-v-0916b7e8>Á§∫‰æãÊ∂àÊÅØ‰πãÂêé</option><option value="before_author_note" data-v-0916b7e8>‰ΩúËÄÖÊ≥®Èáä‰πãÂâç</option><option value="after_author_note" data-v-0916b7e8>‰ΩúËÄÖÊ≥®Èáä‰πãÂêé</option><option value="at_depth" data-v-0916b7e8>ÊèíÂÖ•Âà∞ÊåáÂÆöÊ∑±Â∫¶</option>',7)])],512),[[r.vModelSelect,o.value.position.type]])]),(0,r.createElementVNode)('div',kr,[t[30]||(t[30]=(0,r.createElementVNode)('label',null,'È°∫Â∫è(order)',-1)),(0,r.createElementVNode)('input',{type:'number',step:'1',value:E.value,onInput:V,placeholder:'100'},null,40,Nr)]),'at_depth'===o.value.position?.type?((0,r.openBlock)(),(0,r.createElementBlock)('div',Er,[t[32]||(t[32]=(0,r.createElementVNode)('label',null,'role',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[6]||(t[6]=e=>o.value.position.role=e)},[...t[31]||(t[31]=[(0,r.createElementVNode)('option',{value:'system'},'system',-1),(0,r.createElementVNode)('option',{value:'assistant'},'assistant',-1),(0,r.createElementVNode)('option',{value:'user'},'user',-1)])],512),[[r.vModelSelect,o.value.position.role]])])):(0,r.createCommentVNode)('v-if',!0),'at_depth'===o.value.position?.type?((0,r.openBlock)(),(0,r.createElementBlock)('div',Vr,[t[33]||(t[33]=(0,r.createElementVNode)('label',null,'depth',-1)),(0,r.createElementVNode)('input',{type:'number',min:'0',step:'1',value:b.value,onInput:w,placeholder:'0'},null,40,br)])):(0,r.createCommentVNode)('v-if',!0),t[46]||(t[46]=(0,r.createElementVNode)('div',{class:'field span-2'},[(0,r.createElementVNode)('div',{class:'sub-title'},'ÈÄíÂΩí & ÊïàÊûú')],-1)),(0,r.createElementVNode)('div',wr,[t[36]||(t[36]=(0,r.createElementVNode)('label',null,'Èò≤Ê≠¢ÂÖ•Á´ôÈÄíÂΩí',-1)),(0,r.createElementVNode)('label',Cr,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!!o.value.recursion?.prevent_incoming,onChange:t[7]||(t[7]=e=>{return t=e.target.checked,void(o.value&&(o.value.recursion.prevent_incoming=t));var t})},null,40,Sr),t[34]||(t[34]=(0,r.createElementVNode)('span',{class:'check-ui','aria-hidden':'true'},null,-1)),t[35]||(t[35]=(0,r.createTextVNode)(' prevent_incoming ',-1))])]),(0,r.createElementVNode)('div',Br,[t[39]||(t[39]=(0,r.createElementVNode)('label',null,'Èò≤Ê≠¢Âá∫Á´ôÈÄíÂΩí',-1)),(0,r.createElementVNode)('label',xr,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!!o.value.recursion?.prevent_outgoing,onChange:t[8]||(t[8]=e=>{return t=e.target.checked,void(o.value&&(o.value.recursion.prevent_outgoing=t));var t})},null,40,_r),t[37]||(t[37]=(0,r.createElementVNode)('span',{class:'check-ui','aria-hidden':'true'},null,-1)),t[38]||(t[38]=(0,r.createTextVNode)(' prevent_outgoing ',-1))])]),(0,r.createElementVNode)('div',Ir,[t[40]||(t[40]=(0,r.createElementVNode)('label',null,'delay_until',-1)),(0,r.createElementVNode)('input',{value:S.value,onInput:B,type:'number',min:'0',step:'1',placeholder:'ÁïôÁ©∫‰∏∫ null'},null,40,Tr)]),(0,r.createElementVNode)('div',Ar,[t[41]||(t[41]=(0,r.createElementVNode)('label',null,'sticky',-1)),(0,r.createElementVNode)('input',{value:x.value,onInput:I,type:'number',min:'0',step:'1',placeholder:'ÁïôÁ©∫‰∏∫ null'},null,40,Dr)]),(0,r.createElementVNode)('div',Mr,[t[42]||(t[42]=(0,r.createElementVNode)('label',null,'cooldown',-1)),(0,r.createElementVNode)('input',{value:T.value,onInput:A,type:'number',min:'0',step:'1',placeholder:'ÁïôÁ©∫‰∏∫ null'},null,40,Pr)]),(0,r.createElementVNode)('div',Or,[t[43]||(t[43]=(0,r.createElementVNode)('label',null,'delay',-1)),(0,r.createElementVNode)('input',{value:D.value,onInput:M,type:'number',min:'0',step:'1',placeholder:'ÁïôÁ©∫‰∏∫ null'},null,40,Rr)]),(0,r.createElementVNode)('div',$r,[t[44]||(t[44]=(0,r.createElementVNode)('div',{class:'sub-title'},'extra (JSON)',-1)),(0,r.createElementVNode)('textarea',{class:'mono',value:O.value,onInput:R,placeholder:'{}'},null,40,Lr),P.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ur,(0,r.toDisplayString)(P.value),1)):(0,r.createCommentVNode)('v-if',!0)])])])):((0,r.openBlock)(),(0,r.createElementBlock)('div',zr,[...t[47]||(t[47]=[(0,r.createElementVNode)('div',{class:'empty-panel'},'ËØ∑ÈÄâÊã©ÊàñÊñ∞Â¢û‰∏Ä‰∏™Êù°ÁõÆ',-1)])]))])])]))}}),Wr=(0,y.A)(Fr,[['__scopeId','data-v-0916b7e8']]),jr=Wr,Gr={class:'editor-section'},Jr={class:'metadata-grid'},Yr={class:'cover-uploader'},Hr={key:0,class:'placeholder'},Xr={class:'url-input-group'},Kr={class:'input-hint'},Qr={class:'info-fields'},qr={class:'form-group full-width'},Zr={class:'form-group full-width'},ei={class:'form-group full-width'},ti={class:'linked-packs-selector'},ai=['onClick'],ni={class:'pack-name'},oi={key:0,class:'empty-packs'},li={class:'form-group full-width full-height'},ri=(0,r.defineComponent)({__name:'MetadataEditor',props:{eventPack:{},characterPacks:{}},emits:['trigger-upload'],setup(e){const t=e;function a(e){return!!t.eventPack.linkedCharacterPackIds&&t.eventPack.linkedCharacterPackIds.includes(e)}const n=(0,r.computed)(()=>t.eventPack.coverImage?{backgroundImage:`url(${t.eventPack.coverImage})`}:{});return(e,o)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Gr,[o[12]||(o[12]=(0,r.createElementVNode)('div',{class:'section-title'},[(0,r.createElementVNode)('h4',null,'ÂÖÉÊï∞ÊçÆ (Metadata)')],-1)),(0,r.createElementVNode)('div',Jr,[(0,r.createCommentVNode)(' Left Column: Image '),(0,r.createElementVNode)('div',Yr,[o[7]||(o[7]=(0,r.createElementVNode)('label',null,'Â∞ÅÈù¢ / Cover',-1)),(0,r.createElementVNode)('div',{class:'image-preview',style:(0,r.normalizeStyle)(n.value),onClick:o[0]||(o[0]=t=>e.$emit('trigger-upload'))},[e.eventPack.coverImage?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',Hr,[(0,r.createVNode)(v,{name:'image',size:'2em'}),o[5]||(o[5]=(0,r.createElementVNode)('span',null,'ÁÇπÂáª‰∏ä‰º†Â∞ÅÈù¢',-1))]))],4),(0,r.createElementVNode)('div',Xr,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':o[1]||(o[1]=t=>e.eventPack.coverImage=t),placeholder:'ÊàñËæìÂÖ•ÂõæÁâáURL...',class:'url-input'},null,512),[[r.vModelText,e.eventPack.coverImage]]),(0,r.createElementVNode)('div',Kr,[(0,r.createVNode)(v,{name:'info',size:'0.75em'}),o[6]||(o[6]=(0,r.createTextVNode)(' Êé®Ëçê‰ΩøÁî®ÂõæÁâá URLÔºàÈÅøÂÖç base64 ÂØºËá¥‰∏ä‰º†Â§±Ë¥•/‰ΩìÁßØËøáÂ§ßÔºâ ',-1))])])]),(0,r.createCommentVNode)(' Right Column: Info '),(0,r.createElementVNode)('div',Qr,[(0,r.createElementVNode)('div',qr,[o[8]||(o[8]=(0,r.createElementVNode)('label',null,'ID (Unique Identifier)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':o[2]||(o[2]=t=>e.eventPack.id=t),disabled:'',class:'disabled-input'},null,512),[[r.vModelText,e.eventPack.id]])]),(0,r.createElementVNode)('div',Zr,[o[9]||(o[9]=(0,r.createElementVNode)('label',null,'ÂåÖÂêçÁß∞ (Name)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':o[3]||(o[3]=t=>e.eventPack.name=t),placeholder:'‰∏∫‰Ω†ÁöÑ‰∫ã‰ª∂ÂåÖËµ∑‰∏™ÂêçÂ≠ó...'},null,512),[[r.vModelText,e.eventPack.name]])]),(0,r.createElementVNode)('div',ei,[o[10]||(o[10]=(0,r.createElementVNode)('label',null,'ÂÖ≥ËÅîËßíËâ≤ÂåÖ (Linked Character Packs)',-1)),(0,r.createElementVNode)('div',ti,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.characterPacks,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:(0,r.normalizeClass)(['pack-option',{selected:a(e.id)}]),onClick:a=>function(e){t.eventPack.linkedCharacterPackIds||(t.eventPack.linkedCharacterPackIds=[]);const a=t.eventPack.linkedCharacterPackIds.indexOf(e);a>=0?t.eventPack.linkedCharacterPackIds.splice(a,1):t.eventPack.linkedCharacterPackIds.push(e)}(e.id)},[(0,r.createElementVNode)('div',{class:'pack-cover',style:(0,r.normalizeStyle)({backgroundImage:`url(${e.coverImage})`})},null,4),(0,r.createElementVNode)('span',ni,(0,r.toDisplayString)(e.name),1),a(e.id)?((0,r.openBlock)(),(0,r.createBlock)(v,{key:0,name:'check',size:'1em',class:'check-icon'})):(0,r.createCommentVNode)('v-if',!0)],10,ai))),128)),e.characterPacks&&0!==e.characterPacks.length?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',oi,' Êú™Ê£ÄÊµãÂà∞Â∑≤‰∏ãËΩΩÁöÑËßíËâ≤ÂåÖ (No downloaded character packs found) '))])]),(0,r.createElementVNode)('div',li,[o[11]||(o[11]=(0,r.createElementVNode)('label',null,'ÊèèËø∞ (Description)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':o[4]||(o[4]=t=>e.eventPack.description=t),placeholder:'ÊèèËø∞Ëøô‰∏™‰∫ã‰ª∂ÂåÖÁöÑÂÜÖÂÆπ...'},null,512),[[r.vModelText,e.eventPack.description]])])])])]))}}),ii=(0,y.A)(ri,[['__scopeId','data-v-6f86564c']]),ci=ii,si={class:'editor-section'},di={class:'section-title'},ui={key:0,class:'items-list'},mi={class:'event-header'},pi={class:'order-badge'},vi=['onUpdate:modelValue'],gi=['onClick'],fi=['onUpdate:modelValue'],yi={key:1,class:'empty-hint'},hi=(0,r.defineComponent)({__name:'PlotEventsEditor',props:{eventPack:{}},setup(e){const t=e;function a(){const e={id:crypto.randomUUID(),name:'Êñ∞ÂâßÊÉÖ‰∫ã‰ª∂',content:'',order:t.eventPack.plotEvents.length+1};t.eventPack.plotEvents.push(e)}return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',si,[(0,r.createElementVNode)('div',di,[n[1]||(n[1]=(0,r.createElementVNode)('h4',null,'ÂâßÊÉÖ‰∫ã‰ª∂ (Plot Events)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:a},[(0,r.createVNode)(v,{name:'plus',size:'0.75em'}),n[0]||(n[0]=(0,r.createTextVNode)(' Ê∑ªÂä†',-1))])]),e.eventPack.plotEvents.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',ui,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.plotEvents,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'event-item'},[(0,r.createElementVNode)('div',mi,[(0,r.createVNode)(v,{name:'book',size:'1.2em',style:{opacity:'0.5'}}),(0,r.createElementVNode)('span',pi,'#'+(0,r.toDisplayString)(a+1),1),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'event-name',placeholder:'‰∫ã‰ª∂ÂêçÁß∞'},null,8,vi),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:e=>function(e){t.eventPack.plotEvents.splice(e,1),t.eventPack.plotEvents.forEach((e,t)=>{e.order=t+1})}(a)},[(0,r.createVNode)(v,{name:'delete',size:'0.9em'})],8,gi)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'event-content',placeholder:'ÂøÖÈ°ªËß¶ÂèëÁöÑ‰∏ªÁ∫øÂâßÊÉÖÂÜÖÂÆπ...'},null,8,fi),[[r.vModelText,e.content]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',yi,'ÊöÇÊó†ÂâßÊÉÖ‰∫ã‰ª∂'))]))}}),ki=(0,y.A)(hi,[['__scopeId','data-v-5418ab68']]),Ni=ki,Ei={class:'editor-section'},Vi={class:'section-title'},bi={key:0,class:'items-list'},wi={class:'event-header'},Ci=['onUpdate:modelValue'],Si=['onClick'],Bi={class:'event-config'},xi={class:'config-row'},_i=['onUpdate:modelValue'],Ii=['onUpdate:modelValue'],Ti={key:1,class:'empty-hint'},Ai=(0,r.defineComponent)({__name:'RandomEventsEditor',props:{eventPack:{}},setup(e){const t=e;for(const e of t.eventPack.randomEvents||[])e.config||(e.config={probability:10}),'number'!=typeof e.config.probability&&(e.config.probability=10);function a(){const e={id:crypto.randomUUID(),name:'Êñ∞ÈöèÊú∫‰∫ã‰ª∂',content:'',config:{probability:10}};t.eventPack.randomEvents.push(e)}return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Ei,[(0,r.createElementVNode)('div',Vi,[n[1]||(n[1]=(0,r.createElementVNode)('h4',null,'ÈöèÊú∫‰∫ã‰ª∂ (Random Events)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:a},[(0,r.createVNode)(v,{name:'plus',size:'0.75em'}),n[0]||(n[0]=(0,r.createTextVNode)(' Ê∑ªÂä†',-1))])]),e.eventPack.randomEvents.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',bi,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.randomEvents,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'event-item'},[(0,r.createElementVNode)('div',wi,[(0,r.createVNode)(v,{name:'book',size:'1.2em',style:{opacity:'0.5'}}),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'event-name',placeholder:'‰∫ã‰ª∂ÂêçÁß∞'},null,8,Ci),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:e=>function(e){t.eventPack.randomEvents.splice(e,1)}(a)},[(0,r.createVNode)(v,{name:'delete',size:'0.9em'})],8,Si)]),(0,r.createCommentVNode)(' Config Area '),(0,r.createElementVNode)('div',Bi,[(0,r.createElementVNode)('div',xi,[n[2]||(n[2]=(0,r.createElementVNode)('label',null,'Âü∫Á°ÄÊ¶ÇÁéá (1-100):',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'number','onUpdate:modelValue':t=>e.config.probability=t,style:{width:'5em'}},null,8,_i),[[r.vModelText,e.config.probability,void 0,{number:!0}]])]),n[3]||(n[3]=(0,r.createElementVNode)('div',{class:'config-hint'},'Â∑≤ÂèñÊ∂àËß¶ÂèëÁ±ªÂûãÔºåÈöèÊú∫‰∫ã‰ª∂Áªü‰∏Ä‰∏∫ÂÆåÂÖ®ÈöèÊú∫„ÄÇ',-1))]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'event-content',placeholder:'‰∫ã‰ª∂ÂÜÖÂÆπ / ÂâßÊú¨...'},null,8,Ii),[[r.vModelText,e.content]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Ti,'ÊöÇÊó†ÈöèÊú∫‰∫ã‰ª∂ÔºåÁÇπÂáª‰∏äÊñπÊ∑ªÂä†'))]))}}),Di=(0,y.A)(Ai,[['__scopeId','data-v-72d4ee51']]),Mi=Di,Pi={class:'editor-section'},Oi={class:'world-settings-grid'},Ri={class:'world-panel special'},$i={class:'panel-header special'},Li={class:'panel-content'},Ui={key:0,class:'world-items'},zi={class:'card-header'},Fi=['onUpdate:modelValue'],Wi=['onClick'],ji=['onUpdate:modelValue'],Gi={key:1,class:'empty-panel'},Ji=(0,r.defineComponent)({__name:'SpecialRulesEditor',props:{eventPack:{}},setup(e){const t=e;function a(){t.eventPack.specialRules||(t.eventPack.specialRules=[]),t.eventPack.specialRules.push({id:crypto.randomUUID(),name:'',content:''})}return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Pi,[(0,r.createElementVNode)('div',Oi,[(0,r.createCommentVNode)(' Special Rules '),(0,r.createElementVNode)('div',Ri,[(0,r.createElementVNode)('div',$i,[(0,r.createElementVNode)('h4',null,[(0,r.createVNode)(v,{name:'alert',size:'1em'}),n[0]||(n[0]=(0,r.createTextVNode)(' ÁâπÊÆäËßÑÂàô (Special Rules)',-1))]),(0,r.createElementVNode)('button',{class:'add-mini-btn',onClick:a},'+')]),(0,r.createElementVNode)('div',Li,[e.eventPack.specialRules&&e.eventPack.specialRules.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ui,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.specialRules,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'world-card'},[(0,r.createElementVNode)('div',zi,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'card-title-input',placeholder:'ËßÑÂàôÂêçÁß∞'},null,8,Fi),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'mini-delete',onClick:e=>function(e){t.eventPack.specialRules.splice(e,1)}(a)},'√ó',8,Wi)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'card-content',placeholder:'ËßÑÂàôÊèèËø∞...'},null,8,ji),[[r.vModelText,e.content]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Gi,'ÊöÇÊó†ÁâπÊÆäËßÑÂàô'))])])])]))}}),Yi=(0,y.A)(Ji,[['__scopeId','data-v-3368875e']]),Hi=Yi,Xi={class:'editor-section'},Ki={class:'section-title'},Qi={key:0,class:'items-list'},qi={class:'event-header'},Zi={class:'order-badge'},ec=['onUpdate:modelValue'],tc=['onClick'],ac={class:'event-config'},nc={class:'config-row'},oc=['onUpdate:modelValue'],lc={class:'config-row'},rc=['onUpdate:modelValue'],ic=['onUpdate:modelValue'],cc={key:1,class:'empty-hint'},sc=(0,r.defineComponent)({__name:'StartPointsEditor',props:{eventPack:{}},setup(e){const t=e;function a(){t.eventPack.startPoints||(t.eventPack.startPoints=[]);const e={id:Date.now().toString(),title:'Êñ∞ÂºÄÂ±ÄÈîöÁÇπ',time:'Á¨¨1Â§© 08:00',location:'Êú™Áü•Âú∞ÁÇπ',initialEvent:''};t.eventPack.startPoints.push(e)}return(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Xi,[(0,r.createElementVNode)('div',Ki,[n[1]||(n[1]=(0,r.createElementVNode)('h4',null,'ÂºÄÂ±ÄÈîöÁÇπ (Start Points)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:a},[(0,r.createVNode)(v,{name:'plus',size:'0.75em'}),n[0]||(n[0]=(0,r.createTextVNode)(' Ê∑ªÂä†',-1))])]),n[4]||(n[4]=(0,r.createElementVNode)('div',{class:'description-text'},'ÂÆö‰πâÁé©ÂÆ∂ÂºÄÂßãÊ∏∏ÊàèÊó∂ÁöÑÊó∂Èó¥„ÄÅÂú∞ÁÇπÂèäÂàùÂßã‰∫ã‰ª∂ÂâßÊÉÖ„ÄÇ',-1)),e.eventPack.startPoints.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Qi,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.startPoints,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'event-item'},[(0,r.createElementVNode)('div',qi,[(0,r.createVNode)(v,{name:'map-pin',size:'1.2em',style:{opacity:'0.5'}}),(0,r.createElementVNode)('span',Zi,'#'+(0,r.toDisplayString)(a+1),1),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.title=t,class:'event-name',placeholder:'ÈîöÁÇπÊ†áÈ¢ò (‰æãÂ¶Ç: ÈªòËÆ§ÂºÄÂ±Ä - ÂüéÂ∏Ç)'},null,8,ec),[[r.vModelText,e.title]]),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:e=>function(e){t.eventPack.startPoints.splice(e,1)}(a)},[(0,r.createVNode)(v,{name:'delete',size:'0.9em'})],8,tc)]),(0,r.createElementVNode)('div',ac,[(0,r.createElementVNode)('div',nc,[n[2]||(n[2]=(0,r.createElementVNode)('label',null,'ÂàùÂßãÊó∂Èó¥:',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.time=t,placeholder:'‰æãÂ¶Ç: 2077Âπ¥1Êúà1Êó• 8:00',class:'input-text'},null,8,oc),[[r.vModelText,e.time]])]),(0,r.createElementVNode)('div',lc,[n[3]||(n[3]=(0,r.createElementVNode)('label',null,'ÂàùÂßãÂú∞ÁÇπ:',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.location=t,placeholder:'‰æãÂ¶Ç: ‰∏ªË¶ÅËΩ¶Á´ô',class:'input-text'},null,8,rc),[[r.vModelText,e.location]])])]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.initialEvent=t,class:'event-content',placeholder:'ÊèèËø∞ÂºÄÂ±ÄÊó∂ÁöÑÂâßÊÉÖ„ÄÅÁéØÂ¢ÉÊèèÂÜôÊàñÁ¨¨‰∏ÄÂè•ÂØπÁôΩ...',rows:'4'},null,8,ic),[[r.vModelText,e.initialEvent]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',cc,'ÊöÇÊó†ÂºÄÂ±ÄÈîöÁÇπÔºåÁÇπÂáª‰∏äÊñπÊ∑ªÂä†'))]))}}),dc=(0,y.A)(sc,[['__scopeId','data-v-e982b446']]),uc=dc,mc={class:'editor-section user-widgets-editor'},pc={class:'section-title'},vc={class:'title-actions'},gc={class:'security-notice'},fc={class:'preview-vars'},yc={key:0,class:'preview-vars-error'},hc={key:0,class:'widgets-list'},kc=['onClick'],Nc={class:'header-left'},Ec=['onUpdate:modelValue'],Vc={class:'header-right'},bc=['onClick'],wc=['onClick'],Cc={class:'expand-indicator'},Sc={class:'widget-body'},Bc={class:'form-group'},xc=['onUpdate:modelValue'],_c={class:'code-section'},Ic={class:'code-header'},Tc=['onClick'],Ac=['onUpdate:modelValue'],Dc={key:0,class:'validation-result'},Mc={key:0,class:'validation-success'},Pc={key:0,class:'warning-count'},Oc={key:1,class:'validation-error'},Rc={key:2,class:'validation-warnings'},$c={class:'widget-actions'},Lc=['onClick'],Uc=['onClick'],zc={key:1,class:'empty-hint'},Fc={class:'preview-container'},Wc={class:'preview-header'},jc={class:'preview-body'},Gc={class:'preview-console'},Jc={class:'console-logs'},Yc={key:0,class:'no-logs'},Hc=(0,r.defineComponent)({__name:'UserWidgetsEditor',props:{eventPack:{}},setup(e){const t=e,a=(0,r.ref)(!1),n=(0,r.ref)(''),o=(0,r.ref)('info');function l(e,t='info'){n.value=e,o.value=t,a.value=!0}const i=(0,r.ref)([]),c=(0,r.ref)(null),s=(0,r.reactive)({}),d=(0,r.ref)(!1),u=(0,r.ref)(null),m=(0,r.ref)([]),p=(0,r.ref)(''),g=(0,r.computed)(()=>{const e=(p.value||'').trim();if(!e)return{value:null,error:''};try{const t=JSON.parse(e);return!t||'object'!=typeof t||Array.isArray(t)?{value:null,error:'È¢ÑËßàÂèòÈáèÂøÖÈ°ªÊòØ JSON ÂØπË±°ÔºàObjectÔºâÔºå‰∏çËÉΩÊòØÊï∞ÁªÑ/Â≠óÁ¨¶‰∏≤/Êï∞Â≠ó„ÄÇ'}:{value:t,error:''}}catch(e){return{value:null,error:'È¢ÑËßàÂèòÈáè JSON Ëß£ÊûêÂ§±Ë¥•Ôºö'+(e?.message||String(e))}}});function f(){const e=pa(t.eventPack.variableTree,{dynamicKeySample:'Example'});return JSON.stringify(e,null,2)}function y(){p.value=f()}function h(){d.value&&(d.value=!1,queueMicrotask(()=>{d.value=!0}))}const k=(0,r.ref)({playerName:'ÊµãËØïÁé©ÂÆ∂',gold:1e3,level:5,customVars:{hp:100,mp:50}});function N(){const e={id:crypto.randomUUID(),name:'Êñ∞ÁªÑ‰ª∂',description:'',vueCode:'',cssCode:'',createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};i.value.push(e),c.value=e.id}function E(e){if(!e.vueCode.trim())return void l('ËØ∑ÂÖàËæìÂÖ•ÁªÑ‰ª∂‰ª£Á†Å','warning');const t=ro(e.vueCode);s[e.id]=t,t.isValid?(u.value=e,m.value=[],d.value=!0):l('‰ª£Á†ÅÂ≠òÂú®ÂÆâÂÖ®ÈóÆÈ¢òÔºåÊó†Ê≥ïÈ¢ÑËßà','error')}function V(){d.value=!1,u.value=null,m.value=[]}function b(){m.value.push({type:'info',message:'ÁªÑ‰ª∂Âä†ËΩΩÊàêÂäü'})}function w(e){m.value.push({type:'error',message:e})}function C(e){m.value.push({type:e.type,message:e.message})}return(0,r.onMounted)(()=>{t.eventPack.userWidgets&&t.eventPack.userWidgets.length>0?i.value=JSON.parse(JSON.stringify(t.eventPack.userWidgets)):t.eventPack.widgetStyles&&t.eventPack.widgetStyles.length>0&&(i.value=t.eventPack.widgetStyles.map(e=>({id:e.id,name:e.name,description:'',vueCode:e.vueCode,cssCode:'',linkedVariables:e.linkedVariables,position:'right-sidebar',order:0,allowStateModification:!1}))),p.value=String(t.eventPack.previewVariablesText||''),p.value.trim()||(p.value=f())}),(0,r.watch)(i,e=>{t.eventPack.userWidgets=JSON.parse(JSON.stringify(e))},{deep:!0}),(0,r.watch)(p,e=>{t.eventPack.previewVariablesText=String(e||'')},{immediate:!0}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',mc,[(0,r.createElementVNode)('div',pc,[t[4]||(t[4]=(0,r.createElementVNode)('h4',null,'Ëá™ÂÆö‰πâUIÁªÑ‰ª∂ (User Widgets)',-1)),(0,r.createElementVNode)('div',vc,[(0,r.createElementVNode)('button',{class:'add-btn',onClick:N},[(0,r.createVNode)(v,{name:'plus',size:'0.75em'}),t[3]||(t[3]=(0,r.createTextVNode)(' Ê∑ªÂä†ÁªÑ‰ª∂',-1))])])]),(0,r.createCommentVNode)(' ÂÆâÂÖ®ÊèêÁ§∫ '),(0,r.createElementVNode)('div',gc,[(0,r.createVNode)(v,{name:'alert',size:'1em'}),t[5]||(t[5]=(0,r.createElementVNode)('div',{class:'notice-content'},[(0,r.createElementVNode)('strong',null,'ÂÆâÂÖ®È°ªÁü•'),(0,r.createElementVNode)('p',null,[(0,r.createTextVNode)(' ÁªÑ‰ª∂‰ª£Á†ÅÂ∞ÜÂú®Ê≤ôÁÆ±ÁéØÂ¢É‰∏≠ËøêË°åÔºåÁ¶ÅÊ≠¢ËÆøÈóÆÊïèÊÑü APIÔºàÂ¶Ç localStorage„ÄÅfetch Á≠âÔºâ„ÄÇ ËØ∑‰ΩøÁî®Êèê‰æõÁöÑ '),(0,r.createElementVNode)('code',null,'sdk'),(0,r.createTextVNode)(' ÂØπË±°‰∏éÊ∏∏Êàè‰∫§‰∫í„ÄÇ ')])],-1))]),(0,r.createCommentVNode)(' È¢ÑËßàÂèòÈáèÔºà‰ªÖ Workshop È¢ÑËßàÁî®Ôºâ '),(0,r.createElementVNode)('div',fc,[(0,r.createElementVNode)('div',{class:'preview-vars-header'},[t[6]||(t[6]=(0,r.createElementVNode)('div',{class:'preview-vars-title'},'È¢ÑËßàÂèòÈáèÔºàJSONÔºå‰ªÖÁî®‰∫éÁªÑ‰ª∂È¢ÑËßàÔºâ',-1)),(0,r.createElementVNode)('div',{class:'preview-vars-actions'},[(0,r.createElementVNode)('button',{class:'preview-vars-btn',type:'button',onClick:y},'ÁîüÊàêÊ®°Êùø'),(0,r.createElementVNode)('button',{class:'preview-vars-btn primary',type:'button',onClick:h},'Â∫îÁî®Âπ∂Âà∑Êñ∞È¢ÑËßà')])]),t[7]||(t[7]=(0,r.createElementVNode)('div',{class:'preview-vars-hint'},[(0,r.createTextVNode)(' ËØ¥ÊòéÔºöWorkshop È¢ÑËßàÊó∂ÈÄöÂ∏∏Ê≤°ÊúâÁúüÂÆû‰∏ñÁïå‰π¶ÂèòÈáè„ÄÇÁªÑ‰ª∂ÈÄöËøá '),(0,r.createElementVNode)('code',null,'sdk.getVariable'),(0,r.createTextVNode)(' Á≠âËØªÂèñÊó∂Ôºå‰ºö‰ºòÂÖàËØªÂèñËøôÈáåÁöÑÈ¢ÑËßàÂèòÈáè„ÄÇ ')],-1)),g.value.error?((0,r.openBlock)(),(0,r.createElementBlock)('div',yc,(0,r.toDisplayString)(g.value.error),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[0]||(t[0]=e=>p.value=e),class:'preview-vars-editor',spellcheck:'false',placeholder:'Âú®ËøôÈáåËæìÂÖ•È¢ÑËßàÂèòÈáè JSON...'},null,512),[[r.vModelText,p.value]])]),(0,r.createCommentVNode)(' ÁªÑ‰ª∂ÂàóË°® '),i.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',hc,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:(0,r.normalizeClass)(['widget-card',{expanded:c.value===e.id}])},[(0,r.createElementVNode)('div',{class:'widget-header',onClick:t=>{return a=e.id,void(c.value=c.value===a?null:a);var a}},[(0,r.createElementVNode)('div',Nc,[(0,r.createVNode)(v,{name:'folder',size:'1.2em'}),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'widget-name',placeholder:'ÁªÑ‰ª∂ÂêçÁß∞',onClick:t[1]||(t[1]=(0,r.withModifiers)(()=>{},['stop']))},null,8,Ec),[[r.vModelText,e.name]]),t[8]||(t[8]=(0,r.createElementVNode)('span',{class:'position-badge'},'Âè≥ËæπÊ†è',-1))]),(0,r.createElementVNode)('div',Vc,[(0,r.createElementVNode)('button',{class:'preview-btn',onClick:(0,r.withModifiers)(t=>E(e),['stop']),title:'È¢ÑËßàÁªÑ‰ª∂'},[(0,r.createVNode)(v,{name:'play',size:'0.9em'})],8,bc),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:(0,r.withModifiers)(e=>function(e){confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÁªÑ‰ª∂ÂêóÔºü')&&(i.value.splice(e,1),l('ÁªÑ‰ª∂Â∑≤Âà†Èô§','success'))}(a),['stop']),title:'Âà†Èô§ÁªÑ‰ª∂'},[(0,r.createVNode)(v,{name:'delete',size:'0.9em'})],8,wc),(0,r.createElementVNode)('span',Cc,(0,r.toDisplayString)(c.value===e.id?'‚ñ≤':'‚ñº'),1)])],8,kc),(0,r.withDirectives)((0,r.createElementVNode)('div',Sc,[(0,r.createCommentVNode)(' Âü∫Á°ÄËÆæÁΩÆ '),(0,r.createElementVNode)('div',Bc,[t[9]||(t[9]=(0,r.createElementVNode)('label',null,'ÁªÑ‰ª∂ÊèèËø∞',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.description=t,class:'form-input',placeholder:'ÁÆÄË¶ÅÊèèËø∞ÁªÑ‰ª∂ÂäüËÉΩ'},null,8,xc),[[r.vModelText,e.description]])]),(0,r.createCommentVNode)(' Vue ‰ª£Á†ÅÁºñËæëÂô® '),(0,r.createElementVNode)('div',_c,[(0,r.createElementVNode)('div',Ic,[t[11]||(t[11]=(0,r.createElementVNode)('label',null,'Vue ÁªÑ‰ª∂‰ª£Á†Å (Options API)',-1)),(0,r.createElementVNode)('button',{class:'template-btn',onClick:t=>function(e){e.vueCode='{\n  // ÁªÑ‰ª∂Êé•Êî∂ sdk propÔºåÁî®‰∫é‰∏éÊ∏∏Êàè‰∫§‰∫í\n  props: [\'sdk\'],\n  \n  data() {\n    return {\n      message: \'Hello, World!\',\n      count: 0,\n      characters: [], // Â≠òÂÇ®ËßíËâ≤ÂàóË°®\n      currentTime: \'Êú™Áü•\' // ÂΩìÂâçÊó∂Èó¥\n    }\n  },\n  \n  mounted() {\n    // ÁªÑ‰ª∂ÊåÇËΩΩÊó∂Âä†ËΩΩÊï∞ÊçÆ\n    this.loadCharacters();\n    this.loadTime();\n  },\n  \n  computed: {\n    playerInfo() {\n      // ÈÄöËøá sdk ÂÆâÂÖ®Âú∞Ëé∑ÂèñÊ∏∏ÊàèÊï∞ÊçÆ\n      return {\n        name: this.sdk?.getPlayerName() || \'Êú™Áü•\',\n        gold: this.sdk?.getGold() || 0,\n        level: this.sdk?.getLevel() || 1\n      }\n    }\n  },\n  \n  methods: {\n    // Âä†ËΩΩÂΩìÂâçÊó∂Èó¥\n    loadTime() {\n      this.sdk?.getVariable(\'system.time\', (value) => {\n        this.currentTime = value || \'Êú™Áü•\';\n      });\n    },\n    \n    // Âä†ËΩΩÊâÄÊúâËßíËâ≤ÔºàÂä®ÊÄÅÂ∑•ÂéÇÁ§∫‰æãÔºâ\n    // Ê≥®ÊÑèÔºöDavid„ÄÅTanaka Á≠âËßíËâ≤Áõ¥Êé•‰Ωç‰∫éÊï∞ÊçÆÈ°∂Â±Ç\n    loadCharacters() {\n      // Ëé∑ÂèñÊâÄÊúâÂ±û‰∫é <characters> Ê®°ÊùøÁöÑÂÆû‰æãÂêçÁß∞\n      this.sdk?.getDynamicKeys(\'characters\', (keys) => {\n        // ÂØπÊØè‰∏™ÂÆû‰æãÂêçÁß∞Ëé∑ÂèñÊï∞ÊçÆ\n        keys.forEach(name => {\n          // Áõ¥Êé•ËÆøÈóÆÈ°∂Â±ÇÁöÑÂÆû‰æãÔºàÂ¶Ç \'David\'Ôºâ\n          this.sdk?.getDynamicInstance(\'characters\', name, null, (data) => {\n            this.characters.push({ name: name, ...data });\n          });\n        });\n      });\n    },\n    \n    handleClick() {\n      this.count++;\n      this.sdk?.showNotification(\'‰Ω†ÁÇπÂáª‰∫Ü \' + this.count + \' Ê¨°\', { type: \'info\' });\n      this.sdk?.log(\'ÊåâÈíÆË¢´ÁÇπÂáª\', this.count);\n      \n      // Á§∫‰æãÔºöËé∑ÂèñÁâπÂÆöËßíËâ≤ÁöÑ‰ø°‰ªªÂÄº\n      this.sdk?.getDynamicInstance(\'characters\', \'David\', \'trust\', (trust) => {\n        if (trust !== null) {\n          this.sdk?.log(\'David ÁöÑ‰ø°‰ªªÂÄº:\', trust);\n        }\n      });\n    }\n  },\n  \n  template: `\n    <div class="my-widget">\n      <h3>{{ message }}</h3>\n      <p>Áé©ÂÆ∂: {{ playerInfo.name }}</p>\n      <p>ÈáëÂ∏Å: {{ sdk?.formatNumber(playerInfo.gold) }}</p>\n      <p>Á≠âÁ∫ß: {{ playerInfo.level }}</p>\n      <p>ÂΩìÂâçÊó∂Èó¥: {{ currentTime }}</p>\n      <div v-if="characters.length">\n        <h4>ËßíËâ≤ÂàóË°®:</h4>\n        <div v-for="char in characters" :key="char.name">\n          {{ char.name }} (‰ø°‰ªª: {{ char.trust || 0 }})\n        </div>\n      </div>\n      <button @click="handleClick">ÁÇπÂáªËÆ°Êï∞: {{ count }}</button>\n    </div>\n  `\n}',l('Ê®°Êùø‰ª£Á†ÅÂ∑≤ÊèíÂÖ•','success')}(e)},[(0,r.createVNode)(v,{name:'code',size:'0.8em'}),t[10]||(t[10]=(0,r.createTextVNode)(' ÊèíÂÖ•Ê®°Êùø ',-1))],8,Tc)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.vueCode=t,class:'code-editor',placeholder:'ËØ∑ËæìÂÖ• Vue ÁªÑ‰ª∂ÈÖçÁΩÆÂØπË±°...',spellcheck:'false'},null,8,Ac),[[r.vModelText,e.vueCode]]),t[12]||(t[12]=(0,r.createElementVNode)('div',{class:'code-hint'},[(0,r.createTextVNode)(' ÁªÑ‰ª∂Êé•Êî∂ '),(0,r.createElementVNode)('code',null,'sdk'),(0,r.createTextVNode)(' propÔºåÂèØË∞ÉÁî® '),(0,r.createElementVNode)('code',null,'sdk.getGold()'),(0,r.createTextVNode)('„ÄÅ '),(0,r.createElementVNode)('code',null,'sdk.showNotification()'),(0,r.createTextVNode)(' Á≠âÂÆâÂÖ® API ')],-1))]),(0,r.createCommentVNode)(' ‰ª£Á†ÅÈ™åËØÅÁªìÊûú '),s[e.id]?((0,r.openBlock)(),(0,r.createElementBlock)('div',Dc,[s[e.id].isValid?((0,r.openBlock)(),(0,r.createElementBlock)('div',Mc,[(0,r.createVNode)(v,{name:'check',size:'1em'}),t[13]||(t[13]=(0,r.createTextVNode)(' ‰ª£Á†ÅÈ™åËØÅÈÄöËøá ',-1)),s[e.id].warnings?.length?((0,r.openBlock)(),(0,r.createElementBlock)('span',Pc,' ('+(0,r.toDisplayString)(s[e.id].warnings.length)+' ‰∏™Ë≠¶Âëä) ',1)):(0,r.createCommentVNode)('v-if',!0)])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Oc,[(0,r.createVNode)(v,{name:'alert',size:'1em'}),t[14]||(t[14]=(0,r.createTextVNode)(' ‰ª£Á†ÅÂ≠òÂú®ÈóÆÈ¢ò ',-1)),(0,r.createElementVNode)('ul',null,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s[e.id].errors,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('li',{key:t},(0,r.toDisplayString)(e),1))),128))])])),s[e.id].warnings?.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Rc,[(0,r.createElementVNode)('ul',null,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s[e.id].warnings,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('li',{key:t},'‚ö†Ô∏è '+(0,r.toDisplayString)(e),1))),128))])])):(0,r.createCommentVNode)('v-if',!0)])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Êìç‰ΩúÊåâÈíÆ '),(0,r.createElementVNode)('div',$c,[(0,r.createElementVNode)('button',{class:'validate-btn',onClick:t=>function(e){if(!e.vueCode.trim())return void l('ËØ∑ÂÖàËæìÂÖ•ÁªÑ‰ª∂‰ª£Á†Å','warning');const t=ro(e.vueCode);s[e.id]=t,t.isValid?l('‰ª£Á†ÅÈ™åËØÅÈÄöËøáÔºÅ','success'):l('‰ª£Á†ÅÂ≠òÂú®ÂÆâÂÖ®ÈóÆÈ¢òÔºåËØ∑Êü•ÁúãËØ¶ÊÉÖ','error')}(e)},[(0,r.createVNode)(v,{name:'check',size:'0.8em'}),t[15]||(t[15]=(0,r.createTextVNode)(' È™åËØÅ‰ª£Á†Å ',-1))],8,Lc),(0,r.createElementVNode)('button',{class:'preview-btn',onClick:t=>E(e)},[(0,r.createVNode)(v,{name:'play',size:'0.8em'}),t[16]||(t[16]=(0,r.createTextVNode)(' È¢ÑËßàÁªÑ‰ª∂ ',-1))],8,Uc)])],512),[[r.vShow,c.value===e.id]])],2))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',zc,[(0,r.createVNode)(v,{name:'settings',size:'2em'}),t[17]||(t[17]=(0,r.createElementVNode)('p',null,'ÊöÇÊó†Ëá™ÂÆö‰πâÁªÑ‰ª∂',-1)),(0,r.createElementVNode)('button',{class:'add-first-btn',onClick:N},'Ê∑ªÂä†Á¨¨‰∏Ä‰∏™ÁªÑ‰ª∂')])),(0,r.createCommentVNode)(' È¢ÑËßàÂºπÁ™ó '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'body'},[d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'preview-modal',onClick:(0,r.withModifiers)(V,['self'])},[(0,r.createElementVNode)('div',Fc,[(0,r.createElementVNode)('div',Wc,[(0,r.createElementVNode)('h3',null,'ÁªÑ‰ª∂È¢ÑËßà: '+(0,r.toDisplayString)(u.value?.name),1),(0,r.createElementVNode)('button',{class:'close-btn',onClick:V},'√ó')]),(0,r.createElementVNode)('div',jc,[u.value?((0,r.openBlock)(),(0,r.createBlock)(go,{key:0,'user-code':u.value.vueCode,'component-id':u.value.id,'game-state':k.value,'preview-variables':g.value.value,onLoaded:b,onError:w,onNotification:C},null,8,['user-code','component-id','game-state','preview-variables'])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',Gc,[t[18]||(t[18]=(0,r.createElementVNode)('div',{class:'console-header'},'ÊéßÂà∂Âè∞ËæìÂá∫',-1)),(0,r.createElementVNode)('div',Jc,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(m.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:(0,r.normalizeClass)(['log-entry',e.type])},' ['+(0,r.toDisplayString)(e.type)+'] '+(0,r.toDisplayString)(e.message),3))),128)),m.value.length?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',Yc,'ÊöÇÊó†Êó•Âøó'))])])])])):(0,r.createCommentVNode)('v-if',!0)])),(0,r.createCommentVNode)(' TempMessage '),(0,r.createVNode)(S,{visible:a.value,'onUpdate:visible':t[2]||(t[2]=e=>a.value=e),message:n.value,type:o.value},null,8,['visible','message','type'])]))}}),Xc=(0,y.A)(Hc,[['__scopeId','data-v-6f352719']]),Kc=Xc,Qc={class:'node-row'},qc={key:1,class:'toggle-placeholder'},Zc={key:2,class:'dynamic-badge'},es={key:3,class:'key-name'},ts={key:4,class:'comment'},as={class:'node-actions'},ns={key:0,class:'node-children'},os={class:'edit-modal'},ls={class:'edit-field'},rs={class:'edit-field checkbox-field'},is=['disabled'],cs={key:0,class:'hint'},ss={key:1,class:'hint warning'},ds={class:'edit-field'},us={class:'edit-field checkbox-field'},ms=['disabled'],ps={key:0,class:'hint'},vs={key:0,class:'edit-field'},gs={class:'edit-field'},fs=(0,r.defineComponent)({__name:'VariableNode',props:{node:{},depth:{}},emits:['add-child','remove','update'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(!0),l=(0,r.ref)(!1),i=(0,r.computed)(()=>a.node.children&&a.node.children.length>0),c=(0,r.reactive)({key:'',isDynamic:!1,valueType:'String',hasDefault:!1,defaultString:'',defaultInt:0,defaultBoolean:!1,defaultStringList:'',comment:''});function s(){c.key=a.node.key,c.isDynamic=a.node.isDynamic,c.valueType=a.node.valueType,c.comment=a.node.comment||'';const e=a.node.defaultValue;c.hasDefault=void 0!==e,c.defaultString='string'==typeof e?e:'',c.defaultInt='number'==typeof e&&Number.isFinite(e)?Math.trunc(e):0,c.defaultBoolean='boolean'==typeof e&&e,c.defaultStringList=Array.isArray(e)?e.join(','):'',l.value=!0}function d(){l.value=!1}function u(){let e;if(c.hasDefault&&!i.value)if('String'===c.valueType)e=c.defaultString;else if('Int'===c.valueType)e='number'==typeof c.defaultInt?Math.trunc(c.defaultInt):0;else if('Boolean'===c.valueType)e=!!c.defaultBoolean;else if('StringList'===c.valueType){e=String(c.defaultStringList).split(',').map(e=>e.trim()).filter(Boolean)}n('update',{id:a.node.id,key:c.key,isDynamic:c.isDynamic,valueType:c.valueType,defaultValue:e,comment:c.comment||void 0,children:a.node.children}),l.value=!1}return(e,t)=>{const a=(0,r.resolveComponent)('VariableNode',!0);return(0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'variable-node',style:(0,r.normalizeStyle)({'--depth':e.depth})},[(0,r.createElementVNode)('div',Qc,[(0,r.createCommentVNode)(' Expand/Collapse Toggle '),i.value||e.node.isDynamic?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'toggle-btn',onClick:t[0]||(t[0]=e=>o.value=!o.value)},[(0,r.createVNode)(v,{name:o.value?'chevron-down':'chevron-right',size:'0.8em'},null,8,['name'])])):((0,r.openBlock)(),(0,r.createElementBlock)('span',qc)),(0,r.createCommentVNode)(' Dynamic Badge '),e.node.isDynamic?((0,r.openBlock)(),(0,r.createElementBlock)('span',Zc,'<'+(0,r.toDisplayString)(e.node.key)+'>',1)):((0,r.openBlock)(),(0,r.createElementBlock)('span',es,(0,r.toDisplayString)(e.node.key),1)),(0,r.createCommentVNode)(' Type Badge '),(0,r.createElementVNode)('span',{class:(0,r.normalizeClass)(['type-badge',e.node.valueType.toLowerCase()])},(0,r.toDisplayString)(e.node.valueType),3),(0,r.createCommentVNode)(' Comment '),e.node.comment?((0,r.openBlock)(),(0,r.createElementBlock)('span',ts,'// '+(0,r.toDisplayString)(e.node.comment),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Actions '),(0,r.createElementVNode)('div',as,[(0,r.createElementVNode)('button',{class:'action-btn edit',onClick:s,title:'ÁºñËæë'},[(0,r.createVNode)(v,{name:'edit',size:'0.75em'})]),(0,r.createElementVNode)('button',{class:'action-btn add',onClick:t[1]||(t[1]=t=>e.$emit('add-child',e.node.id)),title:'Ê∑ªÂä†Â≠êËäÇÁÇπ'},[(0,r.createVNode)(v,{name:'plus',size:'0.75em'})]),(0,r.createElementVNode)('button',{class:'action-btn delete',onClick:t[2]||(t[2]=t=>e.$emit('remove',e.node.id)),title:'Âà†Èô§'},[(0,r.createVNode)(v,{name:'delete',size:'0.75em'})])])]),(0,r.createCommentVNode)(' Children '),o.value&&i.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',ns,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.node.children,n=>((0,r.openBlock)(),(0,r.createBlock)(a,{key:n.id,node:n,depth:e.depth+1,onAddChild:t[3]||(t[3]=t=>e.$emit('add-child',t)),onRemove:t[4]||(t[4]=t=>e.$emit('remove',t)),onUpdate:t[5]||(t[5]=t=>e.$emit('update',t))},null,8,['node','depth']))),128))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Edit Modal '),l.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:1,class:'edit-overlay',onClick:(0,r.withModifiers)(d,['self'])},[(0,r.createElementVNode)('div',os,[t[23]||(t[23]=(0,r.createElementVNode)('h4',null,'ÁºñËæëËäÇÁÇπ',-1)),(0,r.createElementVNode)('div',ls,[t[15]||(t[15]=(0,r.createElementVNode)('label',null,'ÈîÆÂêç (Key)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[6]||(t[6]=e=>c.key=e),type:'text',placeholder:'ÂèòÈáèÈîÆÂêç'},null,512),[[r.vModelText,c.key]])]),(0,r.createElementVNode)('div',rs,[(0,r.createElementVNode)('label',null,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[7]||(t[7]=e=>c.isDynamic=e),disabled:0===e.depth},null,8,is),[[r.vModelCheckbox,c.isDynamic]]),t[16]||(t[16]=(0,r.createTextVNode)(' Dynamic (Âä®ÊÄÅÈîÆÔºåÂ¶Ç <characters>) ',-1))]),c.isDynamic?((0,r.openBlock)(),(0,r.createElementBlock)('span',cs,'DynamicËäÇÁÇπÂøÖÈ°ªÊúâÂ≠êËäÇÁÇπ')):(0,r.createCommentVNode)('v-if',!0),0===e.depth?((0,r.openBlock)(),(0,r.createElementBlock)('span',ss,'Ê†πËäÇÁÇπ‰∏çËÉΩËÆæÁΩÆ‰∏∫ Dynamic')):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',ds,[t[18]||(t[18]=(0,r.createElementVNode)('label',null,'ÂÄºÁ±ªÂûã (Value Type)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[8]||(t[8]=e=>c.valueType=e)},[...t[17]||(t[17]=[(0,r.createElementVNode)('option',{value:'String'},'String (ÊñáÊú¨)',-1),(0,r.createElementVNode)('option',{value:'Int'},'Int (Êï¥Êï∞)',-1),(0,r.createElementVNode)('option',{value:'Boolean'},'Boolean (Â∏ÉÂ∞î)',-1),(0,r.createElementVNode)('option',{value:'StringList'},'StringList (["String"])',-1)])],512),[[r.vModelSelect,c.valueType]])]),(0,r.createElementVNode)('div',us,[(0,r.createElementVNode)('label',null,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[9]||(t[9]=e=>c.hasDefault=e),disabled:i.value},null,8,ms),[[r.vModelCheckbox,c.hasDefault]]),t[19]||(t[19]=(0,r.createTextVNode)(' ÈªòËÆ§ÂÄº (Default Value) ',-1))]),i.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',ps,'ÂΩìÂâçËäÇÁÇπÊúâÂ≠êËäÇÁÇπÔºöÈªòËÆ§ÂÄºÂè™ÂØπÂè∂Â≠êËäÇÁÇπÁîüÊïà')):(0,r.createCommentVNode)('v-if',!0)]),c.hasDefault&&!i.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',vs,[t[21]||(t[21]=(0,r.createElementVNode)('label',null,'ÈªòËÆ§ÂÄºÂÜÖÂÆπ',-1)),'String'===c.valueType?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:0,'onUpdate:modelValue':t[10]||(t[10]=e=>c.defaultString=e),type:'text',placeholder:'ÈªòËÆ§ÊñáÊú¨ÔºàÂèØ‰∏∫Á©∫Ôºâ'},null,512)),[[r.vModelText,c.defaultString]]):'Int'===c.valueType?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[11]||(t[11]=e=>c.defaultInt=e),type:'number',placeholder:'0'},null,512)),[[r.vModelText,c.defaultInt,void 0,{number:!0}]]):'Boolean'===c.valueType?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('select',{key:2,'onUpdate:modelValue':t[12]||(t[12]=e=>c.defaultBoolean=e)},[...t[20]||(t[20]=[(0,r.createElementVNode)('option',{value:!0},'true',-1),(0,r.createElementVNode)('option',{value:!1},'false',-1)])],512)),[[r.vModelSelect,c.defaultBoolean]]):'StringList'===c.valueType?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:3,'onUpdate:modelValue':t[13]||(t[13]=e=>c.defaultStringList=e),type:'text',placeholder:'Áî®Ëã±ÊñáÈÄóÂè∑ÂàÜÈöîÔºå‰æãÂ¶ÇÔºöÂºÄÂøÉ,ÊÇ≤‰º§'},null,512)),[[r.vModelText,c.defaultStringList]]):(0,r.createCommentVNode)('v-if',!0)])):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',gs,[t[22]||(t[22]=(0,r.createElementVNode)('label',null,'ÊèèËø∞ (Comment)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[14]||(t[14]=e=>c.comment=e),type:'text',placeholder:'ÂèòÈáèÁî®ÈÄîËØ¥Êòé'},null,512),[[r.vModelText,c.comment]])]),(0,r.createElementVNode)('div',{class:'edit-actions'},[(0,r.createElementVNode)('button',{class:'cancel-btn',onClick:d},'ÂèñÊ∂à'),(0,r.createElementVNode)('button',{class:'save-btn',onClick:u},'‰øùÂ≠ò')])])])):(0,r.createCommentVNode)('v-if',!0)],4)}}}),ys=(0,y.A)(fs,[['__scopeId','data-v-f020a9ba']]),hs=ys,ks={class:'editor-section variables-editor'},Ns={class:'section-title'},Es={class:'title-actions'},Vs={class:'info-hint'},bs={key:0,class:'variable-tree'},ws={key:1,class:'empty-hint'},Cs={class:'schema-preview'},Ss={class:'preview-header'},Bs={key:0,class:'error-message'},xs={class:'schema-code'},_s=(0,r.defineComponent)({__name:'VariablesEditor',props:{eventPack:{}},setup(e){const t=e,a=(0,r.ref)(!1),n=(0,r.ref)(''),o=(0,r.ref)('info');function l(e,t='info'){n.value=e,o.value=t,a.value=!0}const i=(0,r.ref)([]);(0,r.onMounted)(()=>{if(t.eventPack.variableTree&&t.eventPack.variableTree.length>0){let e=JSON.parse(JSON.stringify(t.eventPack.variableTree));e=function(e){const t=e.findIndex(e=>'characters'===e.key&&e.isDynamic);if(-1!==t){const a={id:'characters',key:'characters',isDynamic:!1,valueType:'String',children:[{id:'characters.<name>',key:'name',isDynamic:!0,valueType:'String',children:e[t].children}]},n=[...e];return n[t]=a,console.log('[VariablesEditor] Migrated old format: <characters> -> characters.<name>'),n}return e}(e),i.value=e}else{const e=ga(Gt);i.value=e}}),(0,r.watch)(i,e=>{t.eventPack.variableTree=JSON.parse(JSON.stringify(e))},{deep:!0});const c=(0,r.ref)(''),s=(0,r.computed)(()=>{try{const e=ma(i.value);return c.value='',fa(e)}catch(e){return c.value=e.message||String(e),'{}'}});function d(){return'var_'+Date.now()+'_'+Math.random().toString(36).substring(2,8)}function u(){const e={id:d(),key:'newVariable',isDynamic:!1,valueType:'String',defaultValue:void 0,comment:''};i.value.push(e),l('Ê†πËäÇÁÇπÂ∑≤Ê∑ªÂä†ÔºàÊ†πËäÇÁÇπ‰∏çËÉΩËÆæÁΩÆ‰∏∫ DynamicÔºâ','info')}function m(e){const t={id:d(),key:'child',isDynamic:!1,valueType:'String',defaultValue:void 0,comment:''};!function a(n,o){for(const l of n){const n=l.isDynamic?`<${l.key}>`:l.key,r=o?`${o}.${n}`:n;if(l.id===e)return l.children||(l.children=[]),l.children.push(t),!0;if(l.children&&a(l.children,r))return!0}return!1}(i.value,'')}function p(e){const t=function t(a,n){for(const o of a){const a=o.isDynamic?`<${o.key}>`:o.key,l=n?`${n}.${a}`:a;if(o.id===e)return{node:o,path:l};if(o.children){const e=t(o.children,l);if(e)return e}}return null}(i.value,'');if(t){const e=t.node,a=t.path,n='string'==typeof e.id&&e.id.startsWith('var_'),o=la(e.id),r=!n&&!!a&&la(a);if(o||r)return void l('Cannot remove default variable node (This is a fixed schema path).','warning')}!function t(a){const n=a.findIndex(t=>t.id===e);if(-1!==n)return a.splice(n,1),!0;for(const e of a)if(e.children&&t(e.children))return!0;return!1}(i.value)}function g(e){!function t(a,n=!1){for(let o=0;o<a.length;o++){if(a[o].id===e.id){if(n&&e.isDynamic)return l('Ê†πËäÇÁÇπ‰∏çËÉΩËÆæÁΩÆ‰∏∫ DynamicÔºàÂä®ÊÄÅÈîÆÂè™ËÉΩÂú®ÂµåÂ•óÁªìÊûÑ‰∏≠‰ΩøÁî®Ôºâ','warning'),!1;const t=a[o].children;return a[o]={...e,children:t},!0}const r=a[o].children;if(r&&t(r,!1))return!0}return!1}(i.value,!0)}async function f(){try{await navigator.clipboard.writeText(s.value)}catch(e){console.error('Failed to copy:',e)}}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',ks,[(0,r.createElementVNode)('div',Ns,[t[2]||(t[2]=(0,r.createElementVNode)('h4',null,'ÂèòÈáèÁªìÊûÑ (Variable Schema)',-1)),(0,r.createElementVNode)('div',Es,[(0,r.createElementVNode)('button',{class:'add-btn',onClick:u},[(0,r.createVNode)(v,{name:'plus',size:'0.75em'}),t[1]||(t[1]=(0,r.createTextVNode)(' Ê∑ªÂä†Ê†πËäÇÁÇπ',-1))])])]),(0,r.createElementVNode)('div',Vs,[(0,r.createVNode)(v,{name:'info',size:'0.9em'}),t[3]||(t[3]=(0,r.createElementVNode)('span',null,[(0,r.createTextVNode)(' Ê†ëÁä∂ÁªìÊûÑÂÆö‰πâÂèòÈáè„ÄÇÂãæÈÄâ '),(0,r.createElementVNode)('strong',null,'Dynamic'),(0,r.createTextVNode)(' Ë°®Á§∫Âä®ÊÄÅÈîÆÔºàÂ¶ÇËßíËâ≤ÂêçÔºâÔºåDynamicËäÇÁÇπÂøÖÈ°ªÊúâÂ≠êËäÇÁÇπ„ÄÇ ÂÄºÁ±ªÂûã: Int, String, Boolean, StringList (["String"]) ')],-1))]),(0,r.createCommentVNode)(' Tree View '),i.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',bs,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,e=>((0,r.openBlock)(),(0,r.createBlock)(hs,{key:e.id,node:e,depth:0,onAddChild:m,onRemove:p,onUpdate:g},null,8,['node']))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',ws,'ÊöÇÊó†Ëá™ÂÆö‰πâÂèòÈáèÔºåÁÇπÂáª‰∏äÊñπ"Ê∑ªÂä†Ê†πËäÇÁÇπ"ÂºÄÂßãÊûÑÂª∫ÂèòÈáèÁªìÊûÑ')),(0,r.createCommentVNode)(' Preview '),(0,r.createElementVNode)('div',Cs,[(0,r.createElementVNode)('div',Ss,[t[5]||(t[5]=(0,r.createElementVNode)('h5',null,'Schema È¢ÑËßà (JSON)',-1)),(0,r.createElementVNode)('button',{class:'copy-btn',onClick:f},[(0,r.createVNode)(v,{name:'copy',size:'0.8em'}),t[4]||(t[4]=(0,r.createTextVNode)(' Â§çÂà∂',-1))])]),c.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Bs,(0,r.toDisplayString)(c.value),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('pre',xs,(0,r.toDisplayString)(s.value),1)]),(0,r.createCommentVNode)(' Temporary Message '),(0,r.createVNode)(S,{visible:a.value,'onUpdate:visible':t[0]||(t[0]=e=>a.value=e),message:n.value,type:o.value},null,8,['visible','message','type'])]))}}),Is=(0,y.A)(_s,[['__scopeId','data-v-3c13ed4d']]),Ts=Is,As={class:'editor-section'},Ds={class:'sub-section'},Ms={class:'section-title'},Ps={key:0,class:'visual-grid'},Os=['onClick'],Rs=['src'],$s={key:1,class:'no-image'},Ls={class:'image-meta'},Us=['onUpdate:modelValue'],zs={class:'diff-row'},Fs=['onUpdate:modelValue'],Ws=['onUpdate:modelValue'],js={class:'fallback-row'},Gs={class:'fallback-check pretty-check'},Js=['checked','onChange'],Ys={key:0,class:'hint-badge'},Hs={class:'url-input-group'},Xs=['onUpdate:modelValue'],Ks=['onClick'],Qs=['onClick'],qs={key:1,class:'empty-hint'},Zs={class:'sub-section',style:{'margin-top':'2em'}},ed={class:'section-title'},td={key:0,class:'visual-grid'},ad=['onClick'],nd=['src'],od={key:1,class:'no-image'},ld={class:'image-meta'},rd={class:'url-input-group'},id=['onUpdate:modelValue'],cd=['onClick'],sd=['onUpdate:modelValue'],dd={class:'fallback-row'},ud={class:'fallback-check pretty-check'},md=['checked','onChange'],pd={key:0,class:'hint-badge'},vd={key:1,class:'hint-badge'},gd=['onClick'],fd={key:1,class:'empty-hint'},yd=(0,r.defineComponent)({__name:'VisualsEditor',props:{eventPack:{}},emits:['preview-char','preview-bg'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(null),l=(0,r.ref)(null);function i(){a.eventPack.characterImages.push({id:crypto.randomUUID(),characterName:'',expression:'Default',outfit:'',isFallback:!1,imageUrl:''})}function c(e){return((0,ha.V_)(e)[0]||'').trim().toLowerCase()}function s(){a.eventPack.backgroundImages.push({id:crypto.randomUUID(),imageUrl:'',isResident:!1})}function d(e,t){const o=('char'===t?a.eventPack.characterImages:a.eventPack.backgroundImages)[e];o.imageUrl?n('char'===t?'preview-char':'preview-bg',o):u(e,t)}function u(e,t){l.value={index:e,type:t},o.value?.click()}async function m(e){const t=e.target,n=t.files?.[0];if(n&&l.value)try{const e=await async function(e){return new Promise((t,a)=>{const n=new FileReader;n.onload=e=>{const n=new Image;n.onload=()=>{const e=document.createElement('canvas'),o=e.getContext('2d');let l=n.width,r=n.height;const i=1600;if((l>i||r>i)&&(l>r?(r=Math.round(r*i/l),l=i):(l=Math.round(l*i/r),r=i)),e.width=l,e.height=r,o){o.drawImage(n,0,0,l,r);const a=e.toDataURL('image/webp',.85);t(a)}else a(new Error('Failed to get canvas context'))},n.onerror=a,n.src=e.target?.result},n.onerror=a,n.readAsDataURL(e)})}(n),{index:t,type:o}=l.value;if('char'===o){const n=a.eventPack.characterImages[t];n&&(n.imageUrl=e)}else{const n=a.eventPack.backgroundImages[t];n&&(n.imageUrl=e)}}catch(e){console.error('Image processing failed:',e),alert('ÂõæÁâáÂ§ÑÁêÜÂ§±Ë¥•ÔºåËØ∑ÈáçËØï')}finally{l.value=null,o.value&&(o.value.value='')}}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',As,[(0,r.createCommentVNode)(' Character Images '),(0,r.createElementVNode)('div',Ds,[(0,r.createElementVNode)('div',Ms,[t[1]||(t[1]=(0,r.createElementVNode)('h4',null,'ËßíËâ≤Á´ãÁªò (Character Images)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:i},[(0,r.createVNode)(v,{name:'plus',size:'0.75em'}),t[0]||(t[0]=(0,r.createTextVNode)(' Ê∑ªÂä†',-1))])]),e.eventPack.characterImages.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ps,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.characterImages,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'char-image-item'},[(0,r.createCommentVNode)(' Image Preview / Uploader '),(0,r.createElementVNode)('div',{class:'image-preview char-preview',onClick:e=>d(n,'char')},[e.imageUrl?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.imageUrl},null,8,Rs)):((0,r.openBlock)(),(0,r.createElementBlock)('div',$s,[(0,r.createVNode)(v,{name:'upload-cloud',size:'2em'}),t[2]||(t[2]=(0,r.createElementVNode)('span',null,'ÁÇπÂáª‰∏ä‰º†',-1))]))],8,Os),(0,r.createElementVNode)('div',Ls,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.characterName=t,placeholder:'ËßíËâ≤Âêç (ÂèØÁî®ÈÄóÂè∑ÂàÜÈöîÂà´Âêç)'},null,8,Us),[[r.vModelText,e.characterName]]),(0,r.createElementVNode)('div',zs,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.expression=t,placeholder:'Ë°®ÊÉÖÂ∑ÆÂàÜ (‰æãÂ¶Ç: ÂºÄÂøÉ)'},null,8,Fs),[[r.vModelText,e.expression]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.outfit=t,placeholder:'ÊúçË£ÖÂ∑ÆÂàÜ (‰æãÂ¶Ç: Ê†°Êúç)'},null,8,Ws),[[r.vModelText,e.outfit]])]),(0,r.createElementVNode)('div',js,[(0,r.createElementVNode)('label',Gs,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!!e.isFallback,onChange:e=>function(e,t){const n=a.eventPack.characterImages[e];if(!n)return;if(!t)return void(n.isFallback=!1);const o=c(n.characterName);for(let t=0;t<a.eventPack.characterImages.length;t++){if(t===e)continue;const n=a.eventPack.characterImages[t];n&&c(n.characterName)===o&&(n.isFallback=!1)}n.isFallback=!0}(n,e.target.checked)},null,40,Js),t[3]||(t[3]=(0,r.createElementVNode)('span',{class:'check-ui','aria-hidden':'true'},null,-1)),t[4]||(t[4]=(0,r.createTextVNode)(' Â∏∏È©ªÂÖúÂ∫ïÁ´ãÁªò ',-1))]),e.isFallback?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ys,[(0,r.createVNode)(v,{name:'image',size:'0.8em'}),t[5]||(t[5]=(0,r.createTextVNode)(' ÂåπÈÖç‰∏çÂà∞Ë°®ÊÉÖ/ÊúçË£ÖÊó∂‰ΩøÁî® ',-1))])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',Hs,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.imageUrl=t,placeholder:'URL...'},null,8,Xs),[[r.vModelText,e.imageUrl]]),(0,r.createElementVNode)('button',{class:'icon-btn',title:'‰∏ä‰º†ÂõæÁâá',onClick:e=>u(n,'char')},[(0,r.createVNode)(v,{name:'upload-cloud',size:'1em'})],8,Ks)]),(0,r.createElementVNode)('button',{class:'delete-btn full',onClick:e=>function(e){a.eventPack.characterImages.splice(e,1)}(n)},'Âà†Èô§',8,Qs)])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',qs,'ÊöÇÊó†ËßíËâ≤ÂõæÁâá'))]),(0,r.createCommentVNode)(' Background Images '),(0,r.createElementVNode)('div',Zs,[(0,r.createElementVNode)('div',ed,[t[7]||(t[7]=(0,r.createElementVNode)('h4',null,'ËÉåÊôØÂõæÁâá (Backgrounds)',-1)),(0,r.createElementVNode)('button',{class:'add-btn',onClick:s},[(0,r.createVNode)(v,{name:'plus',size:'0.75em'}),t[6]||(t[6]=(0,r.createTextVNode)(' Ê∑ªÂä†',-1))])]),e.eventPack.backgroundImages.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',td,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.backgroundImages,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'bg-image-item'},[(0,r.createCommentVNode)(' Image Preview / Uploader '),(0,r.createElementVNode)('div',{class:'image-preview bg-preview',onClick:e=>d(n,'bg')},[e.imageUrl?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.imageUrl},null,8,nd)):((0,r.openBlock)(),(0,r.createElementBlock)('div',od,[(0,r.createVNode)(v,{name:'upload-cloud',size:'2em'}),t[8]||(t[8]=(0,r.createElementVNode)('span',null,'ÁÇπÂáª‰∏ä‰º†',-1))]))],8,ad),(0,r.createElementVNode)('div',ld,[(0,r.createElementVNode)('div',rd,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.imageUrl=t,placeholder:'URL...'},null,8,id),[[r.vModelText,e.imageUrl]]),(0,r.createElementVNode)('button',{class:'icon-btn',title:'‰∏ä‰º†ÂõæÁâá',onClick:e=>u(n,'bg')},[(0,r.createVNode)(v,{name:'upload-cloud',size:'1em'})],8,cd)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.linkedVariable=t,placeholder:'Ëß¶ÂèëÊù°‰ª∂ (ÁïôÁ©∫‰∏∫Â∏∏È©ª/ËΩÆÊç¢ÔºåÈÄóÂè∑ÂàÜÈöî)'},null,8,sd),[[r.vModelText,e.linkedVariable]]),(0,r.createElementVNode)('div',dd,[(0,r.createElementVNode)('label',ud,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!!e.isResident,onChange:e=>function(e,t){const n=a.eventPack.backgroundImages[e];n&&(n.isResident=!!t)}(n,e.target.checked)},null,40,md),t[9]||(t[9]=(0,r.createElementVNode)('span',{class:'check-ui','aria-hidden':'true'},null,-1)),t[10]||(t[10]=(0,r.createTextVNode)(' Â∏∏È©ªÂÖúÂ∫ïËÉåÊôØÔºàÂèØÂ§öÈÄâÔºâ ',-1))]),e.isResident?((0,r.openBlock)(),(0,r.createElementBlock)('div',pd,[(0,r.createVNode)(v,{name:'image',size:'0.8em'}),t[11]||(t[11]=(0,r.createTextVNode)(' Êú™ÂåπÈÖçÂà∞Âú∞ÁÇπÊó∂‰πüÂèØ‰Ωú‰∏∫ÈªòËÆ§ËÉåÊôØ ',-1))])):e.linkedVariable?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',vd,[(0,r.createVNode)(v,{name:'image',size:'0.8em'}),t[12]||(t[12]=(0,r.createTextVNode)(' ÁïôÁ©∫Ëß¶ÂèëÊù°‰ª∂ÔºöÈªòËÆ§ÂèÇ‰∏éÂ∏∏È©ª/ËΩÆÊç¢ ',-1))]))]),(0,r.createElementVNode)('button',{class:'delete-btn full',onClick:e=>function(e){a.eventPack.backgroundImages.splice(e,1)}(n)},'Âà†Èô§',8,gd)])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',fd,'ÊöÇÊó†ËÉåÊôØÂõæÁâá'))]),(0,r.createCommentVNode)(' Hidden File Input '),(0,r.createElementVNode)('input',{type:'file',ref_key:'fileInputRef',ref:o,accept:'image/*',style:{display:'none'},onChange:m},null,544)]))}}),hd=(0,y.A)(yd,[['__scopeId','data-v-68057b9f']]),kd={class:'editor-section'},Nd={class:'world-settings-grid'},Ed={class:'world-panel worldview'},Vd={class:'panel-header worldview'},bd={class:'panel-content'},wd={key:0,class:'world-items'},Cd={class:'card-header'},Sd=['onUpdate:modelValue'],Bd=['onClick'],xd=['onUpdate:modelValue'],_d={key:1,class:'empty-panel'},Id={class:'world-panel power'},Td={class:'panel-header power'},Ad={class:'panel-content'},Dd={key:0,class:'world-items'},Md={class:'card-header'},Pd=['onUpdate:modelValue'],Od=['onClick'],Rd=['onUpdate:modelValue'],$d={key:1,class:'empty-panel'},Ld=(0,r.defineComponent)({__name:'WorldSettingsEditor',props:{eventPack:{}},setup(e){const t=e;function a(){t.eventPack.worldviews.push({id:crypto.randomUUID(),name:'',content:''})}function n(){t.eventPack.powerSystems.push({id:crypto.randomUUID(),name:'',content:''})}return(e,o)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',kd,[(0,r.createElementVNode)('div',Nd,[(0,r.createCommentVNode)(' Worldview '),(0,r.createElementVNode)('div',Ed,[(0,r.createElementVNode)('div',Vd,[(0,r.createElementVNode)('h4',null,[(0,r.createVNode)(v,{name:'world',size:'1em'}),o[0]||(o[0]=(0,r.createTextVNode)(' ‰∏ñÁïåËßÇ (Worldview)',-1))]),(0,r.createElementVNode)('button',{class:'add-mini-btn',onClick:a},'+')]),(0,r.createElementVNode)('div',bd,[e.eventPack.worldviews.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',wd,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.worldviews,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'world-card'},[(0,r.createElementVNode)('div',Cd,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'card-title-input',placeholder:'Êù°ÁõÆÂêçÁß∞'},null,8,Sd),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'mini-delete',onClick:e=>function(e){t.eventPack.worldviews.splice(e,1)}(a)},'√ó',8,Bd)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'card-content',placeholder:'ËØ¶ÁªÜÊèèËø∞...'},null,8,xd),[[r.vModelText,e.content]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',_d,'ÊöÇÊó†‰∏ñÁïåËßÇÊù°ÁõÆ'))])]),(0,r.createCommentVNode)(' Power System '),(0,r.createElementVNode)('div',Id,[(0,r.createElementVNode)('div',Td,[(0,r.createElementVNode)('h4',null,[(0,r.createVNode)(v,{name:'lightning',size:'1em'}),o[1]||(o[1]=(0,r.createTextVNode)(' ÂäõÈáè‰ΩìÁ≥ª (Power System)',-1))]),(0,r.createElementVNode)('button',{class:'add-mini-btn',onClick:n},'+')]),(0,r.createElementVNode)('div',Ad,[e.eventPack.powerSystems.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Dd,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.eventPack.powerSystems,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'world-card'},[(0,r.createElementVNode)('div',Md,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t=>e.name=t,class:'card-title-input',placeholder:'‰ΩìÁ≥ªÂêçÁß∞'},null,8,Pd),[[r.vModelText,e.name]]),(0,r.createElementVNode)('button',{class:'mini-delete',onClick:e=>function(e){t.eventPack.powerSystems.splice(e,1)}(a)},'√ó',8,Od)]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t=>e.content=t,class:'card-content',placeholder:'ËßÑÂàôÊèèËø∞...'},null,8,Rd),[[r.vModelText,e.content]])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',$d,'ÊöÇÊó†ÂäõÈáè‰ΩìÁ≥ª'))])])])]))}}),Ud=(0,y.A)(Ld,[['__scopeId','data-v-0660add8']]),zd={class:'event-pack-editor'},Fd={class:'editor-sidebar'},Wd={class:'sidebar-group'},jd={class:'count-badge'},Gd={class:'sidebar-group'},Jd={class:'count-badge'},Yd={class:'count-badge'},Hd={class:'count-badge'},Xd={class:'sidebar-group'},Kd={class:'count-badge'},Qd={class:'sidebar-group'},qd={class:'editor-main'},Zd=(0,r.defineComponent)({__name:'EventPackEditor',props:{initialData:{},customerVariables:{},characterPacks:{},disableAutosave:{type:Boolean}},emits:['preview-char','preview-bg','preview-widget','auto-save'],setup(e,{expose:t,emit:a}){const n=(0,r.ref)('METADATA'),o=e,l=a,i=(0,r.ref)(null),c=(0,r.ref)(!1),s=(0,r.ref)('');function d(){i.value?.click()}function u(e){const t=e.target,a=t.files?.[0];if(a){const e=new FileReader;e.onload=e=>{s.value=e.target?.result,c.value=!0,t.value=''},e.readAsDataURL(a)}}function m(e){p.value.coverImage=e,c.value=!1}const p=(0,r.ref)({id:'',name:'',description:'',coverImage:'',randomEvents:[],plotEvents:[],conditionalEvents:[],worldviews:[],powerSystems:[],specialRules:[],extraWorldBooks:[],variables:[],widgetStyles:[],characterImages:[],backgroundImages:[],startPoints:[],linkedCharacterPackIds:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}),g=(0,r.ref)(!1),f=(0,r.ref)(!1),y=(0,r.ref)(null);function h(){p.value.id||(p.value.id=crypto.randomUUID()),setTimeout(()=>{g.value=!0},500)}function k(){y.value&&(p.value=y.value),f.value=!1,h()}function N(){fl().finally(()=>{f.value=!1,h()})}(0,r.onMounted)(async()=>{if(o.initialData){const e=JSON.parse(JSON.stringify(o.initialData));e.startPoints||(e.startPoints=[]),e.randomEvents||(e.randomEvents=[]),e.plotEvents||(e.plotEvents=[]),e.conditionalEvents||(e.conditionalEvents=[]),e.worldviews||(e.worldviews=[]),e.powerSystems||(e.powerSystems=[]),e.specialRules||(e.specialRules=[]),e.extraWorldBooks||(e.extraWorldBooks=[]),e.variables||(e.variables=[]),e.widgetStyles||(e.widgetStyles=[]),e.characterImages||(e.characterImages=[]),e.backgroundImages||(e.backgroundImages=[]),e.linkedCharacterPackIds||(e.linkedCharacterPackIds=[]),p.value=e,h()}else{if(o.disableAutosave)return void h();const e=await async function(){try{return await re.idbService.getRuntimeAsset(pl)??null}catch{return null}}();let t=!1;e&&(e&&(e.name||e.randomEvents?.length||e.plotEvents?.length)?(y.value=e,t=!0,f.value=!0):await fl().catch(()=>{})),t||h()}}),(0,r.watch)(()=>p.value,e=>{if(g.value&&!o.disableAutosave){try{yl(e)}catch(e){console.warn('[EventPackEditor] Autosave failed:',e)}l('auto-save','Â∑≤Ëá™Âä®‰øùÂ≠ò '+(new Date).toLocaleTimeString())}},{deep:!0});const E=(0,r.computed)(()=>[...o.customerVariables||[],...p.value.variables]);function V(e){l('preview-char',e)}function b(e){l('preview-bg',e)}return t({eventPack:p,getEventPack:()=>{try{return JSON.parse(JSON.stringify(p.value))}catch{return p.value}}}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',zd,[(0,r.createCommentVNode)(' Sidebar Navigation '),(0,r.createElementVNode)('div',Fd,[(0,r.createElementVNode)('div',Wd,[t[15]||(t[15]=(0,r.createElementVNode)('h3',null,'Âü∫Êú¨‰ø°ÊÅØ',-1)),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'METADATA'===n.value}),onClick:t[0]||(t[0]=e=>n.value='METADATA')},[(0,r.createVNode)(v,{name:'edit',size:'0.9em'}),t[13]||(t[13]=(0,r.createTextVNode)(' ÂÖÉÊï∞ÊçÆ & Â∞ÅÈù¢ ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'START_POINTS'===n.value}),onClick:t[1]||(t[1]=e=>n.value='START_POINTS')},[(0,r.createVNode)(v,{name:'map-pin',size:'0.9em'}),t[14]||(t[14]=(0,r.createTextVNode)(' ÂºÄÂ±ÄÈîöÁÇπ ',-1)),(0,r.createElementVNode)('span',jd,(0,r.toDisplayString)(p.value.startPoints?p.value.startPoints.length:0),1)],2)]),(0,r.createElementVNode)('div',Gd,[t[19]||(t[19]=(0,r.createElementVNode)('h3',null,'‰∫ã‰ª∂ÈÖçÁΩÆ',-1)),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'RANDOM_EVENTS'===n.value}),onClick:t[2]||(t[2]=e=>n.value='RANDOM_EVENTS')},[(0,r.createVNode)(v,{name:'book',size:'0.9em'}),t[16]||(t[16]=(0,r.createTextVNode)(' ÈöèÊú∫‰∫ã‰ª∂ ',-1)),(0,r.createElementVNode)('span',Jd,(0,r.toDisplayString)(p.value.randomEvents.length),1)],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'PLOT_EVENTS'===n.value}),onClick:t[3]||(t[3]=e=>n.value='PLOT_EVENTS')},[(0,r.createVNode)(v,{name:'book',size:'0.9em'}),t[17]||(t[17]=(0,r.createTextVNode)(' ÂâßÊÉÖ‰∫ã‰ª∂ ',-1)),(0,r.createElementVNode)('span',Yd,(0,r.toDisplayString)(p.value.plotEvents.length),1)],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'CONDITIONAL_EVENTS'===n.value}),onClick:t[4]||(t[4]=e=>n.value='CONDITIONAL_EVENTS')},[(0,r.createVNode)(v,{name:'book',size:'0.9em'}),t[18]||(t[18]=(0,r.createTextVNode)(' Êù°‰ª∂‰∫ã‰ª∂ ',-1)),(0,r.createElementVNode)('span',Hd,(0,r.toDisplayString)(p.value.conditionalEvents.length),1)],2)]),(0,r.createElementVNode)('div',Xd,[t[24]||(t[24]=(0,r.createElementVNode)('h3',null,'‰∏ñÁïåËÆæÂÆö',-1)),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'WORLD_SETTINGS'===n.value}),onClick:t[5]||(t[5]=e=>n.value='WORLD_SETTINGS')},[(0,r.createVNode)(v,{name:'world',size:'0.9em'}),t[20]||(t[20]=(0,r.createTextVNode)(' ‰∏ñÁïåËßÇ & ÂäõÈáè ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'EXTRA_WORLDBOOKS'===n.value}),onClick:t[6]||(t[6]=e=>n.value='EXTRA_WORLDBOOKS')},[(0,r.createVNode)(v,{name:'book',size:'0.9em'}),t[21]||(t[21]=(0,r.createTextVNode)(' È¢ùÂ§ñ‰∏ñÁïå‰π¶ ',-1)),(0,r.createElementVNode)('span',Kd,(0,r.toDisplayString)(p.value.extraWorldBooks.length),1)],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'SPECIAL_RULES'===n.value}),onClick:t[7]||(t[7]=e=>n.value='SPECIAL_RULES')},[(0,r.createVNode)(v,{name:'alert',size:'0.9em'}),t[22]||(t[22]=(0,r.createTextVNode)(' ÁâπÊÆäËßÑÂàô ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'VARIABLES'===n.value}),onClick:t[8]||(t[8]=e=>n.value='VARIABLES')},[(0,r.createVNode)(v,{name:'code',size:'0.9em'}),t[23]||(t[23]=(0,r.createTextVNode)(' ÂèòÈáè & ÈÄªËæë ',-1))],2)]),(0,r.createElementVNode)('div',Qd,[t[27]||(t[27]=(0,r.createElementVNode)('h3',null,'ËßÜËßâËµÑÊ∫ê',-1)),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'VISUALS'===n.value}),onClick:t[9]||(t[9]=e=>n.value='VISUALS')},[(0,r.createVNode)(v,{name:'image',size:'0.9em'}),t[25]||(t[25]=(0,r.createTextVNode)(' ËßíËâ≤ & ËÉåÊôØÂõæ ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)({active:'WIDGETS'===n.value}),onClick:t[10]||(t[10]=e=>n.value='WIDGETS')},[(0,r.createVNode)(v,{name:'settings',size:'0.9em'}),t[26]||(t[26]=(0,r.createTextVNode)(' UIÁªÑ‰ª∂Ê†∑Âºè ',-1))],2)])]),(0,r.createCommentVNode)(' Main Content Area '),(0,r.createElementVNode)('div',qd,[(0,r.createCommentVNode)(' Hidden File Input for Image Upload '),(0,r.createElementVNode)('input',{type:'file',ref_key:'fileInput',ref:i,accept:'image/*',style:{display:'none'},onChange:u},null,544),(0,r.createCommentVNode)(' Image Cropper Modal '),c.value?((0,r.openBlock)(),(0,r.createBlock)(Lo,{key:0,'image-url':s.value,'aspect-ratio':16/9,onConfirm:m,onCancel:t[11]||(t[11]=e=>c.value=!1)},null,8,['image-url'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Section Components '),'METADATA'===n.value?((0,r.openBlock)(),(0,r.createBlock)(ci,{key:1,eventPack:p.value,characterPacks:e.characterPacks,onTriggerUpload:d},null,8,['eventPack','characterPacks'])):'START_POINTS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(uc,{key:2,eventPack:p.value},null,8,['eventPack'])):'RANDOM_EVENTS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Mi,{key:3,eventPack:p.value},null,8,['eventPack'])):'PLOT_EVENTS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Ni,{key:4,eventPack:p.value},null,8,['eventPack'])):'CONDITIONAL_EVENTS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Tl,{key:5,eventPack:p.value,allVariables:E.value},null,8,['eventPack','allVariables'])):'WORLD_SETTINGS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Ud,{key:6,eventPack:p.value},null,8,['eventPack'])):'EXTRA_WORLDBOOKS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(jr,{key:7,eventPack:p.value},null,8,['eventPack'])):'SPECIAL_RULES'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Hi,{key:8,eventPack:p.value},null,8,['eventPack'])):'VARIABLES'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Ts,{key:9,eventPack:p.value},null,8,['eventPack'])):'VISUALS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(hd,{key:10,eventPack:p.value,onPreviewChar:V,onPreviewBg:b},null,8,['eventPack'])):'WIDGETS'===n.value?((0,r.openBlock)(),(0,r.createBlock)(Kc,{key:11,eventPack:p.value},null,8,['eventPack'])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createVNode)(le,{visible:f.value,title:'ÊÅ¢Â§çËçâÁ®ø',message:'ÂèëÁé∞Êú™‰øùÂ≠òÁöÑËçâÁ®øÔºåÊòØÂê¶ÊÅ¢Â§çÔºüÁÇπÂáª‚ÄúÂèñÊ∂à‚ÄùÂ∞Ü‰∏¢ÂºÉËØ•ËçâÁ®ø„ÄÇ','onUpdate:visible':t[12]||(t[12]=e=>!e&&f.value?N():null),onConfirm:k,onCancel:N},null,8,['visible'])]))}}),eu=(0,y.A)(Zd,[['__scopeId','data-v-068bcd7f']]),tu={class:'visual-preview'},au={class:'background-layer'},nu=['src'],ou={class:'character-layer'},lu=['src'],ru={class:'hud-layer'},iu={class:'location-pill'},cu={class:'location-text'},su={class:'location-name'},du={class:'location-time'},uu={class:'dialogue-wrapper'},mu={class:'dialogue-box'},pu={key:0,class:'speaker-name'},vu={class:'dialogue-content'},gu={class:'preview-info'},fu={key:0,class:'info-badge'},yu={key:0,class:'diff-name'},hu={key:1,class:'info-badge'},ku=(0,r.defineComponent)({__name:'VisualPreview',props:{bgImage:{},charImage:{},charName:{},diffName:{},expression:{},outfit:{},location:{},time:{},speakerName:{},dialogueText:{},condition:{},charScale:{default:80},charX:{default:50},charY:{default:0}},setup(e){const t=e,a=(0,r.computed)(()=>({height:`${t.charScale}%`,left:`${t.charX}%`,bottom:`${t.charY}%`,transform:'translateX(-50%)'}));return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',tu,[(0,r.createCommentVNode)(' Background Layer '),(0,r.createElementVNode)('div',au,[e.bgImage?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.bgImage,alt:'Background',class:'bg-image'},null,8,nu)):(0,r.createCommentVNode)('v-if',!0),t[0]||(t[0]=(0,r.createElementVNode)('div',{class:'bg-gradient'},null,-1))]),(0,r.createCommentVNode)(' Character Layer '),(0,r.createElementVNode)('div',ou,[(0,r.createVNode)(r.Transition,{name:'fade',appear:''},{default:(0,r.withCtx)(()=>[e.charImage?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.charImage,class:'char-img',style:(0,r.normalizeStyle)(a.value)},null,12,lu)):(0,r.createCommentVNode)('v-if',!0)]),_:1})]),(0,r.createCommentVNode)(' HUD Layer (simplified) '),(0,r.createElementVNode)('div',ru,[(0,r.createElementVNode)('div',iu,[(0,r.createVNode)(v,{name:'location',size:'0.875em'}),(0,r.createElementVNode)('div',cu,[(0,r.createElementVNode)('span',su,(0,r.toDisplayString)(e.location||'LOCATION'),1),(0,r.createElementVNode)('span',du,(0,r.toDisplayString)(e.time||'00:00'),1)])])]),(0,r.createCommentVNode)(' Dialogue Layer '),(0,r.createElementVNode)('div',uu,[(0,r.createElementVNode)('div',mu,[e.speakerName?((0,r.openBlock)(),(0,r.createElementBlock)('div',pu,(0,r.toDisplayString)(e.speakerName),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',vu,[(0,r.createElementVNode)('p',null,(0,r.toDisplayString)(e.dialogueText||'È¢ÑËßàÊñáÊú¨...'),1)])])]),(0,r.createCommentVNode)(' Preview Info Overlay '),(0,r.createElementVNode)('div',gu,[e.charName?((0,r.openBlock)(),(0,r.createElementBlock)('div',fu,[(0,r.createVNode)(v,{name:'user',size:'0.75em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(e.charName)+' ',1),e.expression||e.outfit||e.diffName?((0,r.openBlock)(),(0,r.createElementBlock)('span',yu,[t[1]||(t[1]=(0,r.createTextVNode)(' / ',-1)),e.expression?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[(0,r.createTextVNode)((0,r.toDisplayString)(e.expression),1)],64)):e.diffName?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createTextVNode)((0,r.toDisplayString)(e.diffName),1)],64)):(0,r.createCommentVNode)('v-if',!0),e.outfit?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createTextVNode)(' ¬∑ '+(0,r.toDisplayString)(e.outfit),1)],64)):(0,r.createCommentVNode)('v-if',!0)])):(0,r.createCommentVNode)('v-if',!0)])):(0,r.createCommentVNode)('v-if',!0),e.condition?((0,r.openBlock)(),(0,r.createElementBlock)('div',hu,[(0,r.createVNode)(v,{name:'settings',size:'0.75em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(e.condition),1)])):(0,r.createCommentVNode)('v-if',!0)])]))}}),Nu=(0,y.A)(ku,[['__scopeId','data-v-651a8ef6']]),Eu={class:'workshop-view'},Vu={key:0,class:'editor-backdrop'},bu={class:'workshop-header'},wu={class:'title-group'},Cu={key:0,class:'editor-badge'},Su={key:'gallery',class:'gallery-view'},Bu={class:'gallery-header'},xu={class:'header-left'},_u={class:'search-box'},Iu={class:'filter-tabs'},Tu=['onClick'],Au={class:'header-right'},Du={class:'upload-dropdown'},Mu={class:'upload-dropdown'},Pu={key:0,class:'dropdown-menu'},Ou={key:0,class:'autosave-toast'},Ru={key:0,class:'my-works-toolbar'},$u={class:'gallery-grid'},Lu={key:0,class:'empty-state'},Uu={key:2,class:'empty-state'},zu={key:0},Fu={key:1},Wu={class:'intro-panel'},ju={class:'intro-header'},Gu={class:'intro-title'},Ju={class:'intro-sub'},Yu={class:'intro-type'},Hu={class:'intro-author'},Xu={class:'intro-content'},Ku={key:'event-editor',class:'editor-view'},Qu={class:'editor-container'},qu={class:'editor-content'},Zu={key:'char-editor',class:'editor-view'},em={class:'editor-container'},tm={class:'editor-content'},am={class:'preview-modal'},nm={class:'widget-preview-modal'},om={class:'widget-preview-header'},lm={class:'widget-preview-body'},rm={class:'widget-preview-vars'},im={class:'vars-header'},cm={class:'vars-actions'},sm={key:0,class:'vars-error'},dm={class:'widget-preview-render'},um={key:0,class:'widget-error'},mm={class:'widget-preview-console'},pm={class:'console-logs'},vm={key:0,class:'no-logs'},gm={class:'upload-header'},fm={class:'upload-stage'},ym={class:'upload-progress'},hm={key:0,class:'upload-meta'},km={class:'upload-actions'},Nm=['disabled'],Em=(0,r.defineComponent)({__name:'Workshop',setup(e){const t=(0,i.useRouter)(),a=(0,r.ref)('GALLERY'),n=(0,r.ref)('explore'),o=(0,r.ref)('ALL'),l=(0,r.ref)(''),c=(0,r.ref)(!1),s=(0,r.ref)(null),d=(0,r.ref)('');let u;const m=(0,r.ref)(null);let p=null;function g(){m.value=null,D()}function f(){p&&window.clearTimeout(p),p=null;const e=M();if(!e.isValid||'number'!=typeof e.expiresAt)return;const t=Math.max(0,e.expiresAt-Date.now());p=window.setTimeout(()=>{g(),'my-works'===n.value&&(n.value='downloaded')},t)}function y(){t.push('/')}function h(e){if('my-works'===e&&!P())return ue('ËØ∑ÂÖàÂú®È¶ñÈ°µÁôªÂΩïÔºà7Â§©ÊúâÊïàÔºâ','warning'),void(n.value='downloaded');n.value=e}const k=(0,r.ref)('idle');async function E(e){if('pending'===k.value)return!1;k.value='pending';(e?.forceReauth??!1)&&(x.clear(),fetch('https://workshop.ab003317.dpdns.org/api/auth/logout',{method:'POST',credentials:'include',headers:{'X-Requested-With':'XMLHttpRequest'}}).catch(()=>{}));const t=(()=>{const e=new Uint32Array(4);return window.crypto.getRandomValues(e),Array.from(e,e=>e.toString(36)).join('')})(),a=(window.screen.width-500)/2,n=(window.screen.height-800)/2,o=`https://discord.com/api/oauth2/authorize?client_id=1456699602181820426&redirect_uri=${encodeURIComponent('https://workshop.ab003317.dpdns.org/api/auth/discord/callback')}&response_type=code&scope=identify&state=${t}`,l=window.open(o,'DiscordLogin',`width=500,height=800,top=${n},left=${a}`);return new Promise(e=>{const a=setInterval(async()=>{try{const n=`https://workshop.ab003317.dpdns.org/api/auth/check?socketId=${t}`,o=await fetch(n,{credentials:'include'});if(!o.ok)return;const r=await o.json();if('success'===r.status){clearInterval(a),k.value='idle';const t=r.data.user||r.data,n=r?.data?.accessToken||r?.data?.token||null;'string'==typeof n&&n.length>0?x.setAccessToken(n):x.setAccessToken(null);const o=t.avatar&&!t.avatar.startsWith('http')?`https://cdn.discordapp.com/avatars/${t.id}/${t.avatar}.png`:t.avatar||'',i={username:t.username,avatar:o,id:t.id};m.value=i,A(i),f();try{l&&!l.closed&&l.close()}catch{}e(!0)}l&&l.closed}catch(e){console.error('[Workshop] login poll error:',e),k.value='error'}},1e3);setTimeout(()=>{clearInterval(a),'pending'===k.value&&(k.value='timeout',ue('ÁôªÂΩïË∂ÖÊó∂ÔºåËØ∑ÈáçËØï','warning')),e(!1)},12e4)})}async function V(e){if(!await E({forceReauth:!0}))return null;try{return await e()}finally{x.clear()}}const b=(0,r.ref)(null),w=(0,r.ref)(null),C=(0,r.ref)(void 0),B=(0,r.ref)(void 0),I=(0,r.ref)(null),T=(0,r.ref)(!1),O=(0,r.ref)(''),R=(0,r.ref)(''),L=(0,r.ref)(''),U=(0,r.ref)(''),F=(0,r.ref)(''),J=(0,r.ref)(''),Y=(0,r.ref)(''),H=(0,r.ref)(!1),X=(0,r.ref)(null),K=(0,r.ref)(0),Q=(0,r.ref)([]),q=(0,r.ref)(''),Z=(0,r.ref)({playerName:'ÊµãËØïÁé©ÂÆ∂',gold:1e3,level:5,customVars:{hp:100,mp:50}}),ee=(0,r.ref)(''),te=(0,r.computed)(()=>{const e=(ee.value||'').trim();if(!e)return{value:null,error:''};try{const t=JSON.parse(e);return!t||'object'!=typeof t||Array.isArray(t)?{value:null,error:'È¢ÑËßàÂèòÈáèÂøÖÈ°ªÊòØ JSON ÂØπË±°ÔºàObjectÔºâÔºå‰∏çËÉΩÊòØÊï∞ÁªÑ/Â≠óÁ¨¶‰∏≤/Êï∞Â≠ó„ÄÇ'}:{value:t,error:''}}catch(e){return{value:null,error:'È¢ÑËßàÂèòÈáè JSON Ëß£ÊûêÂ§±Ë¥•Ôºö'+(e?.message||String(e))}}});function ae(){const e=C.value,t=pa(e?.variableTree,{dynamicKeySample:'Example'});return JSON.stringify(t,null,2)}function ne(){const e=C.value;e&&(e.previewVariablesText=ee.value)}function oe(){ee.value=ae(),ne()}function ie(){ne(),K.value++}const ce=(0,r.ref)(!1),se=(0,r.ref)(''),de=(0,r.ref)('info');function ue(e,t='info'){se.value=e,de.value=t,ce.value=!0}const me=(0,r.ref)(!1),pe=(0,r.ref)('Ê≠£Âú®‰∏ä‰º†...'),ve=(0,r.ref)(''),ge=(0,r.ref)(null),fe=(0,r.ref)(0),ye=(0,r.ref)(0),he=(0,r.ref)(!1),ke=(0,r.ref)('ÂèñÊ∂à');let Ne=null;function Ee(){me.value=!1,pe.value='Ê≠£Âú®‰∏ä‰º†...',ve.value='',ge.value=null,fe.value=0,ye.value=0,he.value=!1,ke.value='ÂèñÊ∂à',Ne=null}function Ve(){try{Ne?.abort()}catch{}}const be=(0,r.ref)(!1),we=(0,r.ref)(''),Ce=(0,r.ref)(''),Se=(0,r.ref)(null);function Be(e,t,a){we.value=e,Ce.value=t,Se.value=a,be.value=!0}function xe(){const e=Se.value;be.value=!1,Se.value=null,e&&queueMicrotask(()=>{try{const t=e();t&&'function'==typeof t.then&&t.then(void 0,e=>{console.error('[Workshop] confirm action failed:',e),ue('Êìç‰ΩúÂ§±Ë¥•ÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞Êó•Âøó','error')})}catch(e){console.error('[Workshop] confirm action threw:',e),ue('Êìç‰ΩúÂ§±Ë¥•ÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞Êó•Âøó','error')}})}function _e(e){const t=(0,r.toRaw)(e);try{return structuredClone(t)}catch{return JSON.parse(JSON.stringify(t))}}const Ie=(0,r.ref)([]),Te=(0,r.ref)([]),Ae=(0,r.ref)(!1),De=(0,r.ref)([]),Me=(0,r.ref)('idle');function Pe(e){if(!e)return{};try{const t=JSON.parse(e);if(t&&'object'==typeof t&&('EVENT'===t.type||'CHARACTER'===t.type))return{type:t.type,data:t.data}}catch{}return{}}function Oe(e){const t=Pe(e.code),a=('EVENT'===e.packType||'CHARACTER'===e.packType?e.packType:void 0)||t.type||'EVENT',n=String(e.coverImage||t.data?.coverImage||'').trim();return{id:e._id,type:a,title:e.title,description:e.description||'',author:e.authorName||'Unknown',tags:[],likes:e.likes||0,downloadCount:'number'==typeof e.downloadCount?e.downloadCount:void 0,img:n||'https://picsum.photos/400/250?random='+encodeURIComponent(e._id)}}async function Re(){P()?await V(async()=>{try{ue('Ê≠£Âú®Ëé∑ÂèñÈÖçÈ¢ù‰ø°ÊÅØ...','info');const e=await Ft.getUserUsage(),t=Math.round(e.used/1024/1024*10)/10;ue(`ÈÖçÈ¢ùÔºöÂ∑≤Áî® ${t}MB / ${Math.round(e.max/1024/1024*10)/10}MBÔºà${e.percentage}%Ôºâ`,'success')}catch(e){console.error(e);const t=e?.response?.status,a=e?.response?.data?.error||e?.response?.data?.message;if(401===t)return void ue('Ëé∑ÂèñÈÖçÈ¢ùÂ§±Ë¥•ÔºöËÆ§ËØÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï','warning');ue('Ëé∑ÂèñÈÖçÈ¢ùÂ§±Ë¥•'+(a?'Ôºö'+a:''),'error')}}):ue('ËØ∑ÂÖàÂú®È¶ñÈ°µÁôªÂΩïÔºà7Â§©ÊúâÊïàÔºâ','warning')}const $e=(0,r.ref)(!1),Le=(0,r.ref)(null);function Ue(e){Le.value=e,$e.value=!0}async function ze(){Ae.value=!0;try{const e=await Ft.listPublicItems({page:1,limit:50});Te.value=e.data||[]}catch(e){const t=e,a=t?.response?.status,n=t?.response?.data?.error||t?.response?.data?.message,o=String(t?.message||'').toLowerCase();if(!a&&('ECONNABORTED'===t?.code||o.includes('timeout')||o.includes('network'))){try{const e=await Ft.listPublicItems({page:1,limit:10},{timeoutMs:3e4});Te.value=e.data||[],ue('‰∫ëÁ´ØÂìçÂ∫îËæÉÊÖ¢ÔºöÂ∑≤Âä†ËΩΩÁ≤æÁÆÄÂàóË°®Ôºà10Êù°Ôºâ','warning')}catch{ue('‰∫ëÁ´ØËøûÊé•Ë∂ÖÊó∂/ÁΩëÁªú‰∏≠Êñ≠ÔºàÂèØËÉΩÊòØÊúçÂä°Âô®ÊöÇ‰∏çÂèØÁî®ÔºâÔºåËØ∑Á®çÂêéÈáçËØï','warning')}return}if(console.error('Failed to load cloud workshop items:',e),503===a)return void ue(`‰∫ëÁ´ØÊúçÂä°ÊöÇ‰∏çÂèØÁî®Ôºà${n||'503'}ÔºâÔºåËØ∑Á®çÂêéÈáçËØï`,'warning');ue('‰∫ëÁ´ØÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÊàñÁ®çÂêéÈáçËØï','warning')}finally{Ae.value=!1}}async function Fe(){if(!m.value)return De.value=[],void(Me.value='idle');De.value=[],Me.value='unauth'}(0,r.onMounted)(async()=>{const e=M();e.isValid&&e.user?(m.value=e.user,f()):g();const t=(await W()).workshop;if(t){if(t.viewMode){const e=t.viewMode;'my-works'!==e||P()?n.value=e:n.value='downloaded'}t.filterType&&(o.value=t.filterType),t.mode&&(a.value=t.mode),'string'==typeof t.searchQuery&&(l.value=t.searchQuery)}const r=localStorage.getItem('downloaded_works');if(r)try{const e=JSON.parse(r);if(Array.isArray(e)){for(const t of e)await re.idbService.saveWork(t);console.log('Migrated works to IDB'),localStorage.removeItem('downloaded_works')}}catch(e){console.error('Failed to parse downloaded_works:',e)}try{Ie.value=await re.idbService.getAllWorks()}catch(e){console.error('Failed to load works from IDB:',e)}await ze(),'my-works'===n.value&&await Fe()}),(0,r.onBeforeUnmount)(()=>{p&&window.clearTimeout(p),p=null});let We=null;function je(e){d.value=e,clearTimeout(u),u=window.setTimeout(()=>{d.value=''},2e3)}(0,r.watch)([n,o,a,l],async()=>{We&&clearTimeout(We),We=setTimeout(async()=>{await async function(e){return j({currentPage:'Workshop',workshop:e})}({viewMode:n.value,filterType:o.value,mode:a.value,searchQuery:l.value})},300)}),(0,r.watch)(n,async e=>{'explore'===e&&await ze(),'my-works'===e&&await Fe()});const Ge=(0,r.computed)(()=>Te.value.map(Oe)),Je=(0,r.computed)(()=>De.value.map(Oe)),Ye=(0,r.computed)(()=>{const e=m.value;return e?Te.value.filter(t=>String(t.authorId||'')===String(e.id||'')):[]}),He=(0,r.computed)(()=>Ye.value.map(Oe)),Xe=(0,r.computed)(()=>Je.value.length?Je.value:'unauth'===Me.value?He.value:[]),Ke=(0,r.computed)(()=>{const e=new Map;for(const t of Te.value)e.set(String(t._id),t);for(const t of De.value)e.set(String(t._id),t);return e});function Qe(e,t){if(!t)return;const a=String(t).trim();return a?a.startsWith('http://')||a.startsWith('https://')?a:e?`https://cdn.discordapp.com/avatars/${encodeURIComponent(e)}/${encodeURIComponent(a)}.png?size=96`:void 0:void 0}function qe(e){if(tt(e)&&m.value?.avatar)return m.value.avatar;const t=Ke.value.get(String(e.id));if(!t)return;const a=t;return Qe(t.authorId,a.authorAvatarUrl)||Qe(t.authorId,a.authorAvatar)||Qe(t.authorId,a.authorAvatarHash)||function(e){if(e)try{const t=Number((BigInt(e)>>22n)%6n);if(!Number.isFinite(t)||t<0||t>5)return;return`https://cdn.discordapp.com/embed/avatars/${t}.png`}catch{return}}(t.authorId)}function Ze(e){return!!Xe.value.find(t=>String(t.id)===String(e.id))}function et(e){return'my-works'===n.value&&Ze(e)&&!tt(e)}function tt(e){return mt.value.find(t=>t.id===e.id||t.cloudItemId===e.id)}function at(e){const t=new WeakSet,a=e=>{if(null==e)return e;const n=typeof e;if('number'===n||'string'===n||'boolean'===n)return e;if('object'!==n)return String(e);if(t.has(e))return'[Circular]';if(t.add(e),Array.isArray(e))return e.map(a);const o={};for(const t of Object.keys(e).sort()){const n=a(e[t]);void 0!==n&&(o[t]=n)}return o};return JSON.stringify(a(e))}function nt(e){const t=JSON.parse(JSON.stringify(e.data));t.id||(t.id=e.id);const a=JSON.stringify({type:e.type,data:t}),n='string'==typeof t?.coverImage?t.coverImage.trim():'';return{title:(e.type,e.data.name),description:e.data.description||'',code:a,coverImage:n||void 0,isPublic:!0}}function ot(e){if(!e||'object'!=typeof e)return null;return{title:'string'==typeof e.title?e.title.trim():'',description:'string'==typeof e.description?e.description.trim():'',code:'string'==typeof e.code?e.code:'',coverImage:('string'==typeof e.coverImage?e.coverImage.trim():'')||void 0,isPublic:'boolean'!=typeof e.isPublic||e.isPublic}}function lt(e){const t=e?.cloudItemId;return'string'==typeof t&&t.trim()?t.trim():void 0}function rt(e){const t=tt(e);if(!t)return!1;if(t.cloudBaseline){const e=ot(nt(t)),a=ot(t.cloudBaseline);return!e||(!a||!a.code||at(e)!==at(a))}return!0}function it(e){const t=tt(e);return t?!!lt(t):Ze(e)}function ct(e){const t=tt(e),a=Ze(e);if(!t)return a?'‰∫ëÁ´Ø':void 0;const n=lt(t);return n&&a||n?'ÂêåÊó∂':'Êú¨Âú∞'}function st(e){const t=tt(e);if(!t)return!1;return!lt(t)||rt(e)}function dt(e){return lt(tt(e))?'ÂêåÊ≠•Âà∞‰∫ëÁ´ØÔºà‰ªÖÂú®ÊúâÂèòÊõ¥Êó∂ÊòæÁ§∫Ôºâ':'‰∏ä‰º†Âà∞‰∫ëÁ´Ø'}const ut=(0,r.computed)(()=>Ie.value),mt=(0,r.computed)(()=>Ie.value.filter(e=>'mine'===e.owner)),pt=(0,r.computed)(()=>{const e=[];return Ie.value.forEach(t=>{'CHARACTER'===t.type&&e.push(t.data)}),e}),vt=(0,r.computed)(()=>ut.value.map((e,t)=>({id:e.id,type:e.type,title:(e.type,e.data.name),description:e.data.description||e.data.desc||'',author:'Local',tags:[],likes:0,isDownloaded:!0,img:e.data.coverImage||'https://picsum.photos/400/250?random='+(t+100)}))),gt=(0,r.computed)(()=>mt.value.map((e,t)=>({id:e.id,type:e.type,title:(e.type,e.data.name),description:e.data.description||e.data.desc||'',author:m.value?.username||'Local',tags:[],likes:0,img:e.data.coverImage||'https://picsum.photos/400/250?random='+(t+500)}))),ft=(0,r.computed)(()=>{const e=[],t=new Set;for(const a of Xe.value){const n=String(a.id);t.has(n)||(e.push(a),t.add(n))}for(const a of gt.value){const n=String(a.id);if(t.has(n))continue;const o=lt(tt(a));o&&t.has(String(o))||(e.push(a),t.add(n))}return e}),yt=[{value:'ALL',label:'ÂÖ®ÈÉ®'},{value:'EVENT',label:'‰∫ã‰ª∂ÂåÖ'},{value:'CHARACTER',label:'‰∫∫ËÆæÂåÖ'}],ht=(0,r.computed)(()=>{let e=[];return e='explore'===n.value?Ge.value:'my-works'===n.value?ft.value:vt.value,e.filter(e=>{const t='ALL'===o.value||e.type===o.value,a=!l.value||e.title.toLowerCase().includes(l.value.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(l.value.toLowerCase()));return t&&a})});async function kt(){'GALLERY'!==a.value?(a.value='GALLERY',C.value=void 0,B.value=void 0):(await G(),t.push('/'))}function Nt(){c.value=!1,C.value=void 0,I.value=null,a.value='EVENT_EDITOR'}function Et(){c.value=!1,B.value=void 0,I.value=null,a.value='CHARACTER_EDITOR'}function Vt(e){return Array.isArray(e)?e.filter(e=>e&&'object'==typeof e).map(e=>{const t={...e};return t.id&&'string'==typeof t.id||(t.id=crypto.randomUUID()),t}):[]}function bt(e){const t=(new Date).toISOString(),a=e&&'object'==typeof e?e:{},n=String(a.id||'').trim()||crypto.randomUUID(),o=Array.isArray(a.linkedCharacterPackIds)?a.linkedCharacterPackIds.filter(e=>'string'==typeof e):'string'==typeof a.linkedCharacterPackId&&a.linkedCharacterPackId.trim()?[a.linkedCharacterPackId.trim()]:void 0;return{id:n,name:String(a.name||a.title||'Êú™ÂëΩÂêç‰∫ã‰ª∂ÂåÖ'),description:String(a.description||a.desc||''),coverImage:'string'==typeof a.coverImage?a.coverImage:void 0,linkedCharacterPackId:'string'==typeof a.linkedCharacterPackId?a.linkedCharacterPackId:void 0,linkedCharacterPackIds:o,randomEvents:Vt(a.randomEvents),plotEvents:Vt(a.plotEvents),conditionalEvents:Vt(a.conditionalEvents),worldviews:Vt(a.worldviews),powerSystems:Vt(a.powerSystems),specialRules:Vt(a.specialRules),extraWorldBooks:Vt(a.extraWorldBooks),variables:Array.isArray(a.variables)?a.variables:[],variableTree:Array.isArray(a.variableTree)?a.variableTree:void 0,previewVariablesText:'string'==typeof a.previewVariablesText?a.previewVariablesText:void 0,widgetStyles:Array.isArray(a.widgetStyles)?a.widgetStyles:[],userWidgets:Array.isArray(a.userWidgets)?a.userWidgets:void 0,characterImages:Vt(a.characterImages),backgroundImages:Vt(a.backgroundImages),startPoints:Vt(a.startPoints),createdAt:String(a.createdAt||t),updatedAt:String(a.updatedAt||t)}}function wt(e){const t=(new Date).toISOString(),a=e&&'object'==typeof e?e:{},n=String(a.id||'').trim()||crypto.randomUUID(),o=Array.isArray(a.presets)?a.presets.filter(e=>e&&'object'==typeof e).map(e=>{const t={...e};return t.id&&'string'==typeof t.id||(t.id=crypto.randomUUID()),t.name=String(t.name||'Êú™ÂëΩÂêçËßíËâ≤'),t}):[];return{id:n,name:String(a.name||a.title||'Êú™ÂëΩÂêç‰∫∫ËÆæÂåÖ'),description:'string'==typeof a.description?a.description:'string'==typeof a.desc?a.desc:void 0,coverImage:'string'==typeof a.coverImage?a.coverImage:void 0,presets:o,createdAt:String(a.createdAt||t),updatedAt:String(a.updatedAt||t)}}function Ct(e){if(!e||'object'!=typeof e)return null;if(('EVENT'===e.type||'CHARACTER'===e.type)&&e.data)return e.type;if(Array.isArray(e.presets))return'CHARACTER';return['randomEvents','plotEvents','conditionalEvents','worldviews','powerSystems','specialRules','extraWorldBooks','variableTree','userWidgets','characterImages','backgroundImages','startPoints'].some(t=>t in e)?'EVENT':null}function St(){c.value=!1,s.value?.click()}function Bt(e){const t=function(e){const t=String(e.id),a=Ie.value.find(e=>String(e.id)===t);if(a)return a;return Ie.value.find(e=>String(e.cloudItemId||'')===t)||void 0}(e);if(!t)return void ue('Êú™ÊâæÂà∞Êú¨Âú∞‰ΩúÂìÅÔºåÊó†Ê≥ï‰∏ãËΩΩÊñá‰ª∂','warning');const a=(new Date).toISOString(),n={format:'tavern-helper-workshop-pack',version:1,type:t.type,exportedAt:a,data:t.data},o=(t.type,t.data.name);var l;!function(e,t){const a=new Blob([t],{type:'application/json;charset=utf-8'}),n=URL.createObjectURL(a),o=document.createElement('a');o.href=n,o.download=e,o.style.display='none',document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(n)}(`${l=o||t.id,(String(l||'').trim()||'workshop-pack').replace(/[<>:"/\\|?*]+/g,'_').replace(/\s+/g,' ').trim().slice(0,80)}.${'EVENT'===t.type?'event':'character'}.json`,JSON.stringify(n,null,2))}function xt(e){if('downloaded'===n.value){const t=ut.value.find(t=>t.id===e.id);t&&(I.value=t.id,'EVENT'===t.type?(C.value=JSON.parse(JSON.stringify(t.data)),a.value='EVENT_EDITOR'):(B.value=JSON.parse(JSON.stringify(t.data)),a.value='CHARACTER_EDITOR'))}else if('my-works'===n.value){const t=mt.value.find(t=>t.id===e.id||t.cloudItemId===e.id);if(!t)return void ue('ËØ•‰ΩúÂìÅ‰ªÖÂú®‰∫ëÁ´ØÔºåÂÖà‰∏ãËΩΩÂà∞Êú¨Âú∞ÂÜçÁºñËæë','warning');I.value=t.id,'EVENT'===t.type?(C.value=JSON.parse(JSON.stringify(t.data)),a.value='EVENT_EDITOR'):(B.value=JSON.parse(JSON.stringify(t.data)),a.value='CHARACTER_EDITOR')}}async function _t(e){try{const t=String(e.id),a=await Ft.getItem(t),o=Pe(a.data.code);if(!o.type||!o.data)return void ue('‰∏ãËΩΩÂ§±Ë¥•Ôºö‰∫ëÁ´ØÊï∞ÊçÆÊ†ºÂºè‰∏çÊîØÊåÅ','error');try{!!m.value&&(String(a.data.authorId)===String(m.value?.id)||String(a.data.authorName)===String(m.value?.username))||Ft.recordDownload(a.data._id).catch(()=>{})}catch{}const l=(new Date).toISOString(),r={id:o.data.id||crypto.randomUUID(),type:o.type,data:o.data,downloadedAt:l};'my-works'===n.value&&(r.owner='mine',r.cloudItemId=a.data._id,r.cloudBaseline=function(e){const t=e,a='string'==typeof t.coverImage?t.coverImage.trim():'',n='number'==typeof t.revision&&Number.isFinite(t.revision)?t.revision:void 0;return{title:e.title||'',description:e.description||'',code:e.code||'',coverImage:a||void 0,isPublic:!!e.isPublic,updatedAt:e.updatedAt,revision:n}}(a.data)),await re.idbService.saveWork(r);const i=Ie.value.findIndex(e=>e.id===r.id);i>=0?Ie.value[i]=r:Ie.value.push(r),ue('Â∑≤‰∏ãËΩΩÂà∞Êú¨Âú∞','success')}catch(e){console.error(e),ue('‰∏ãËΩΩÂ§±Ë¥•','error')}}async function It(e){const t=tt(e);if(!t)return void ue('Êú™ÊâæÂà∞Êú¨Âú∞‰ΩúÂìÅÔºåÊó†Ê≥ï‰∏ä‰º†','error');const a=!!lt(t);if(a&&!rt(e))return void ue('Êú¨Âú∞‰∏é‰∫ëÁ´ØÂÜÖÂÆπ‰∏ÄËá¥ÔºåÊó†ÈúÄÂêåÊ≠•','info');let n,o,l=null,r='',i='',c=null,s='',d=null;const u=e=>{const t=String(n||'').trim(),l=o,r=String(e?.updatedAt||'').trim(),i='number'==typeof e?.revision&&Number.isFinite(e.revision)?e.revision:void 0;if(a){if(void 0!==l&&void 0!==i&&i>l)return!0;if(t&&r&&r!==t)return!0}return!1};Be(a?'ÂêåÊ≠•Âà∞‰∫ëÁ´Ø':'‰∏ä‰º†Âà∞‰∫ëÁ´Ø',a?'Ê£ÄÊµãÂà∞Êú¨Âú∞‰∏é‰∫ëÁ´ØÂÜÖÂÆπ‰∏çÂêåÔºöÁ°ÆÂÆöË¶ÅÁî®Êú¨Âú∞ÁâàÊú¨Ë¶ÜÁõñ‰∫ëÁ´ØÂêóÔºü':'Á°ÆÂÆöË¶ÅÊääËøô‰∏™‰ΩúÂìÅ‰∏ä‰º†Âà∞‰∫ëÁ´ØÂêóÔºü',()=>{Be('ÂÜçÊ¨°Á°ÆËÆ§',a?'ÂêåÊ≠•ÂêéÂ∞ÜË¶ÜÁõñ‰∫ëÁ´ØÊ∫êÊñá‰ª∂Ôºà‰∏çÂèØÊÅ¢Â§çÔºâ„ÄÇ‰ªçË¶ÅÁªßÁª≠ÂêóÔºü':'‰∏ä‰º†ÂêéÂ∞Ü‰∏é‰∫ëÁ´ØÂêåÊ≠•ÔºåÂπ∂ÂèØËÉΩÂØπ‰ªñ‰∫∫ÂèØËßÅ„ÄÇ‰ªçË¶ÅÁªßÁª≠ÂêóÔºü',async()=>{await V(async()=>{try{Ee(),me.value=!0,pe.value=a?'Ê≠£Âú®ÂêåÊ≠•Âà∞‰∫ëÁ´Ø...':'Ê≠£Âú®‰∏ä‰º†Âà∞‰∫ëÁ´Ø...',ve.value='ÂáÜÂ§á‰∏ä‰º†...',ge.value=0,he.value=!0,ke.value='ÂèñÊ∂à‰∏ä‰º†',ue(a?'Ê≠£Âú®ÂêåÊ≠•...':'Ê≠£Âú®‰∏ä‰º†...','info');const e=nt(t);if(l=e,e.title=String(e.title??'').trim(),e.description=String(e.description??'').trim(),e.code=String(e.code??''),!e.title)return void ue('‰∏ä‰º†Â§±Ë¥•Ôºö‰ΩúÂìÅÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫ÔºàËØ∑ÂÖàÂú®Êú¨Âú∞Â°´ÂÜôÂêçÁß∞Ôºâ','error');if(!e.code)return void ue('‰∏ä‰º†Â§±Ë¥•ÔºöÁº∫Â∞ë‰ΩúÂìÅÂÜÖÂÆπÔºàcode ‰∏∫Á©∫Ôºâ','error');const m=Pe(e.code),p=String(m.data?.id??t.id??'').trim();if(r=p,!p)return void ue('‰∏ä‰º†Â§±Ë¥•ÔºöÁº∫Â∞ë‰ΩúÂìÅIDÔºàclientWorkIdÔºâ','error');const v=crypto.randomUUID();i=v;const g=async e=>{try{if(!globalThis.crypto||!('subtle'in globalThis.crypto)||!globalThis.crypto.subtle)return null;const t=(new TextEncoder).encode(e),a=await globalThis.crypto.subtle.digest('SHA-256',t);return Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,'0')).join('')}catch{return null}};let f,y;c=await g(e.code);try{const e=String(t?.cloudBaseline?.updatedAt||'').trim();e&&(f=e);const a=t?.cloudBaseline?.revision;if('number'==typeof a&&Number.isFinite(a)&&(y=a),!f){const e=await Ft.getMyItemByClientId(p,{timeoutMs:15e3});e?.data?.updatedAt&&(f=e.data.updatedAt),'number'==typeof e?.data?.revision&&Number.isFinite(e.data.revision)&&(y=e.data.revision)}}catch{}n=f,o=y;try{const t=(new TextEncoder).encode(JSON.stringify(e)).byteLength;d=t;const a=Math.ceil(t/1024),n=Math.round(t/1024/1024*10)/10;if(t>31457280)return void ue(`‰∏ä‰º†Â∑≤ÂèñÊ∂àÔºöÂÜÖÂÆπËøáÂ§ßÔºàÁ∫¶ ${n}MB / ${a}KBÔºåË∂ÖËøá 30MB ‰∏äÈôêÔºâÔºåËØ∑ÊîπÁî® URL ËµÑÊ∫êÊàñÊãÜÂàÜ‰∏ä‰º†`,'error')}catch{}const h=new AbortController;Ne=h;const k=e=>new Promise(t=>setTimeout(t,e)),N=(e,t)=>{if(fe.value=Math.max(0,e||0),ye.value=Math.max(0,t||0),t&&t>0){const a=Math.min(100,Math.max(0,Math.round(e/t*100)));ge.value=a,ve.value=a>=100?'‰∏ä‰º†ÂÆåÊàêÔºåÁ≠âÂæÖÊúçÂä°Âô®ÂÜôÂÖ•...':`Ê≠£Âú®‰∏ä‰º†... ${a}%`}else ge.value=null,ve.value='Ê≠£Âú®‰∏ä‰º†...'},E=async e=>{const t=Date.now()+6e4;let a=1e3;for(ve.value='Â∑≤Êî∂Âà∞ÂºÇÊ≠•ÂõûÊâßÔºåÊúçÂä°Âô®Â§ÑÁêÜ‰∏≠...',ge.value=null,he.value=!0,ke.value='ÂÅúÊ≠¢Á≠âÂæÖÔºàÂêéÂè∞ÁªßÁª≠Ôºâ';Date.now()<t;){if(h.signal.aborted){throw Object.assign(new Error('canceled'),{name:'CanceledError',code:'ERR_CANCELED'})}const t=await Ft.getOperation(e,{timeoutMs:15e3,signal:h.signal}),n=t?.data;if('done'===n?.status)return n;if('failed'===n?.status){const e=String(n?.error?.message||n?.error?.code||'upload failed'),t=new Error(e);throw t.status=n?.error?.status,t}const o=n?.progress?.percent,l='number'==typeof o&&Number.isFinite(o)?Math.min(100,Math.max(0,Math.round(o))):null,r=String(n?.progress?.message||n?.progress?.stage||n?.status||'processing');null===l?(ge.value=null,ve.value=`ÊúçÂä°Âô®Â§ÑÁêÜ‰∏≠...Ôºà${r}Ôºâ`):(ge.value=l,ve.value=`ÊúçÂä°Âô®Â§ÑÁêÜ‰∏≠... ${l}%Ôºà${r}Ôºâ`),await k(a),a=Math.min(2e3,Math.floor(1.5*a))}const n=new Error('upload still processing');throw n.code='WORKSHOP_OPERATION_TIMEOUT',n.operationId=e,n},V=async()=>Ft.upsertItemByClientId(p,e,{signal:h.signal,requestId:v,clientContentSha256:c||void 0,async:!0,onUploadProgress:e=>{try{const t=d,a='number'==typeof e.total?e.total:'number'==typeof t&&Number.isFinite(t)?t:null;N(Number(e.loaded||0),a)}catch{}}}),b=await V();if(b&&'object'==typeof b&&'string'==typeof b.operationId&&b.operationId){const n=String(b.operationId);s=n;const o=await E(n),l=await Ft.getMyItemByClientId(p,{timeoutMs:3e4,signal:h.signal}),r=l?.data;if(!r)return Ee(),ue(`${a?'ÂêåÊ≠•':'‰∏ä‰º†'}ÂÆåÊàêÔºå‰ΩÜËé∑Âèñ‰∫ëÁ´Ø‰ΩúÂìÅÂ§±Ë¥•ÔºàoperationId=${n}Ôºâ`,'warning'),void ze().catch(()=>{});t.cloudItemId=r._id,t.owner='mine',t.cloudBaseline={title:e.title,description:e.description,code:e.code,coverImage:e.coverImage,isPublic:e.isPublic,updatedAt:r.updatedAt,revision:r.revision};const i=_e(t);await re.idbService.saveWork(i);const d=Ie.value.findIndex(e=>e.id===t.id);d>=0&&(Ie.value[d]=i);const m=c,v=String(r.contentSha256||o?.serverContentSha256||'').trim();return Ee(),m&&v&&v===m?ue(o?.created?'‰∏ä‰º†ÊàêÂäüÔºàÂºÇÊ≠•ÂõûÊâßÂ∑≤Á°ÆËÆ§ÔºåÂìàÂ∏åÂåπÈÖçÔºâ':'ÂêåÊ≠•ÊàêÂäüÔºàÂºÇÊ≠•ÂõûÊâßÂ∑≤Á°ÆËÆ§ÔºåÂìàÂ∏åÂåπÈÖçÔºâ','success'):u(r)?ue(o?.created?'‰∏ä‰º†ÊàêÂäüÔºàÂºÇÊ≠•ÂõûÊâßÂ∑≤Á°ÆËÆ§ÔºåÁâàÊú¨Â∑≤Êõ¥Êñ∞Ôºâ':'ÂêåÊ≠•ÊàêÂäüÔºàÂºÇÊ≠•ÂõûÊâßÂ∑≤Á°ÆËÆ§ÔºåÁâàÊú¨Â∑≤Êõ¥Êñ∞Ôºâ','success'):ue(o?.created?'‰∏ä‰º†ÊàêÂäüÔºàÂºÇÊ≠•ÂõûÊâßÂ∑≤Á°ÆËÆ§Ôºâ':'ÂêåÊ≠•ÊàêÂäüÔºàÂºÇÊ≠•ÂõûÊâßÂ∑≤Á°ÆËÆ§Ôºâ','success'),void ze().catch(()=>{})}const w=b;if(w?.data?._id){t.cloudItemId=w.data._id,t.owner='mine',t.cloudBaseline={title:e.title,description:e.description,code:e.code,coverImage:e.coverImage,isPublic:e.isPublic,updatedAt:w.data.updatedAt,revision:w.data.revision};const a=_e(t);await re.idbService.saveWork(a);const n=Ie.value.findIndex(e=>e.id===t.id);n>=0&&(Ie.value[n]=a),Ee(),ue(w.created?'‰∏ä‰º†ÊàêÂäü':'ÂêåÊ≠•ÊàêÂäü','success');try{await ze()}catch(e){console.warn('[Workshop] refreshCloud failed after upload:',e)}return}throw new Error('Êú™Áü•ÁöÑ‰∏ä‰º†ÂõûÊâßÊ†ºÂºè')}catch(e){console.error(e),me.value&&Ee();if('ERR_CANCELED'===e?.code||'CanceledError'===e?.name)return void ue(s?`Â∑≤ÂÅúÊ≠¢Á≠âÂæÖÔºöÂêéÂè∞‰ªçÂú®Â§ÑÁêÜÔºàoperationId=${s}Ôºâ`:'Â∑≤ÂèñÊ∂à‰∏ä‰º†','info');if('WORKSHOP_OPERATION_TIMEOUT'===e?.code){const t=String(e?.operationId||s||'').trim();return void ue(`${a?'ÂêåÊ≠•':'‰∏ä‰º†'}Â∑≤Êèê‰∫§ÂêéÂè∞Â§ÑÁêÜÔºå‰ªçÂú®ËøõË°å‰∏≠${t?`ÔºàoperationId=${t}Ôºâ`:''}ÔºåËØ∑Á®çÂêéÂà∑Êñ∞‰∫ëÁ´ØÊàñÁ®çÂêéÈáçËØïÁ≠âÂæÖ`,'warning')}if(String(e?.message||'').toLowerCase().includes('cors')||'ERR_NETWORK'===e?.code&&e?.request&&0===e?.request?.status)return void ue('‰∏ä‰º†Â§±Ë¥•ÔºöÊµèËßàÂô® CORS Êã¶Êà™‰∫ÜËØ∑Ê±Ç„ÄÇËØ∑ÂêéÁ´ØÂÖÅËÆ∏Ë∑®ÂüüËØ∑Ê±ÇÂ§¥ÔºàX-Requested-With / X-Client-Request-Id / X-Client-Content-Sha256 / Authorization Á≠âÔºâ„ÄÇ','error');const n=e?.response?.status,o=e?.response?.data,d=o?.error||o?.message;let m='';try{if(o&&'object'==typeof o){const e=o.details??o.errors??o.issues;e&&(m='string'==typeof e?e:JSON.stringify(e)),!m&&o.message&&'string'==typeof o.message&&(m=o.message)}}catch{}const p=String(e?.message||'').toLowerCase();if(!n&&('ECONNABORTED'===e?.code||p.includes('timeout')||p.includes('network'))){try{if(r&&l&&i){const e=await Ft.upsertItemByClientId(r,l,{timeoutMs:2e4,requestId:i,clientContentSha256:c||void 0,async:!0});if(e&&'object'==typeof e&&'string'==typeof e.operationId&&e.operationId){const n=String(e.operationId);s=n;const o=e=>new Promise(t=>setTimeout(t,e)),i=Date.now()+6e4;let d=1e3;for(;Date.now()<i;){const e=await Ft.getOperation(n,{timeoutMs:15e3}),t=e?.data;if('done'===t?.status)break;if('failed'===t?.status)throw new Error(String(t?.error?.message||t?.error?.code||'upload failed'));await o(d),d=Math.min(2e3,Math.floor(1.5*d))}const m=await Ft.getMyItemByClientId(r,{timeoutMs:3e4}),p=m?.data;if(p){t.cloudItemId=p._id,t.owner='mine',t.cloudBaseline={title:String(l.title??'').trim(),description:String(l.description??'').trim(),code:String(l.code??''),coverImage:l.coverImage,isPublic:l.isPublic,updatedAt:p.updatedAt,revision:p.revision};const e=_e(t);await re.idbService.saveWork(e);const n=Ie.value.findIndex(e=>e.id===t.id);n>=0&&(Ie.value[n]=e);const o=c;return o&&String(p.contentSha256||'')===o?ue((a?'ÂêåÊ≠•':'‰∏ä‰º†')+'ÊàêÂäüÔºàÂ∑≤Ëé∑ÂèñÂºÇÊ≠•ÂõûÊâßÔºåÂìàÂ∏åÂåπÈÖçÔºâ','success'):u(p)?ue((a?'ÂêåÊ≠•':'‰∏ä‰º†')+'ÊàêÂäüÔºàÂ∑≤Ëé∑ÂèñÂºÇÊ≠•ÂõûÊâßÔºåÁâàÊú¨Â∑≤Êõ¥Êñ∞Ôºâ','success'):ue((a?'ÂêåÊ≠•':'‰∏ä‰º†')+'ÊàêÂäüÔºàÂ∑≤Ëé∑ÂèñÂºÇÊ≠•ÂõûÊâßÔºâ','success'),void ze().catch(()=>{})}return void ue(`${a?'ÂêåÊ≠•':'‰∏ä‰º†'}Â∑≤Êèê‰∫§ÂêéÂè∞Â§ÑÁêÜÔºàoperationId=${n}ÔºâÔºåËØ∑Á®çÂêéÂà∑Êñ∞‰∫ëÁ´ØÁ°ÆËÆ§`,'warning')}if(e?.data?._id){t.cloudItemId=e.data._id,t.owner='mine',t.cloudBaseline={title:String(l.title??'').trim(),description:String(l.description??'').trim(),code:String(l.code??''),coverImage:l.coverImage,isPublic:l.isPublic,updatedAt:e.data.updatedAt,revision:e.data.revision};const n=_e(t);await re.idbService.saveWork(n);const o=Ie.value.findIndex(e=>e.id===t.id);return o>=0&&(Ie.value[o]=n),ue((a?'ÂêåÊ≠•':'‰∏ä‰º†')+'ÊàêÂäüÔºàÂ∑≤Êåâ request-id ÂπÇÁ≠âÈáçËØïËé∑ÂèñÂõûÊâßÔºâ','success'),void ze().catch(()=>{})}}}catch(e){console.warn('[Workshop] upload idempotent retry failed:',e)}try{const e=r;if(e&&l){const n=await Ft.getMyItemByClientId(e,{timeoutMs:3e4}),o=n?.data;if(o){t.cloudItemId=o._id,t.owner='mine',t.cloudBaseline={title:String(l.title??'').trim(),description:String(l.description??'').trim(),code:String(l.code??''),coverImage:l.coverImage,isPublic:l.isPublic,updatedAt:o.updatedAt,revision:o.revision};const e=_e(t);await re.idbService.saveWork(e);const n=Ie.value.findIndex(e=>e.id===t.id);n>=0&&(Ie.value[n]=e);const r=c;return r&&String(o.contentSha256||'')===r?ue((a?'ÂêåÊ≠•':'‰∏ä‰º†')+'Â∑≤Á°ÆËÆ§ÊàêÂäüÔºà‰∫ëÁ´ØÂìàÂ∏åÂåπÈÖçÔºâ','success'):u(o)?ue((a?'ÂêåÊ≠•':'‰∏ä‰º†')+'Â∑≤Á°ÆËÆ§ÊàêÂäüÔºà‰∫ëÁ´ØÁâàÊú¨Â∑≤Êõ¥Êñ∞Ôºâ','success'):ue((a?'ÂêåÊ≠•':'‰∏ä‰º†')+'ÂèØËÉΩÂ∑≤ÊàêÂäüÔºà‰∫ëÁ´ØÂ∑≤ÊâæÂà∞ËÆ∞ÂΩïÔºâ','warning'),void ze().catch(()=>{})}}}catch(e){console.warn('[Workshop] upload verify failed:',e)}return void ue((a?'ÂêåÊ≠•':'‰∏ä‰º†')+'ÂìçÂ∫îË∂ÖÊó∂/‰∏≠Êñ≠ÔºöËØ∑Á®çÂêéÂà∑Êñ∞‰∫ëÁ´ØÂàóË°®Á°ÆËÆ§','warning')}if(401===n)return void ue('‰∏ä‰º†Â§±Ë¥•ÔºöËÆ§ËØÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØïÔºà‰ºöÈáçÊñ∞ÁôªÂΩïÔºâ','warning');if(413===n)return void ue('‰∏ä‰º†Â§±Ë¥•ÔºöÊúçÂä°Á´ØÊãíÁªùËØ∑Ê±ÇÔºà413Ôºâ„ÄÇÂª∫ËÆÆ‰ΩøÁî®ÂõæÁâá URLÔºåÊàñËÅîÁ≥ªÂêéÁ´ØÊèêÈ´òÂçïÊ¨°‰∏ä‰º†ÈôêÂà∂','warning');if(503===n)return void ue(`‰∏ä‰º†Â§±Ë¥•Ôºö‰∫ëÁ´ØÊúçÂä°ÊöÇ‰∏çÂèØÁî®Ôºà${d||'503'}Ôºâ`,'warning');ue(`${a?'ÂêåÊ≠•Â§±Ë¥•':'‰∏ä‰º†Â§±Ë¥•'}${d?'Ôºö'+d:''}${m?`\n${m}`:''}`,'error')}})})})}function Tt(e){if('my-works'===n.value){const t=tt(e);return t?void Be('Âà†Èô§Êú¨Âú∞ÂâØÊú¨','‰ªÖÂà†Èô§Êú¨Âú∞Êñá‰ª∂Ôºà‰∏ç‰ºöÂà†Èô§‰∫ëÁ´ØÊ∫êÊñá‰ª∂Ôºâ„ÄÇÁ°ÆÂÆöÁªßÁª≠ÂêóÔºü',async()=>{try{await re.idbService.deleteWork(t.id);const e=Ie.value.findIndex(e=>e.id===t.id);-1!==e&&Ie.value.splice(e,1),ue('Êú¨Âú∞ÂâØÊú¨Â∑≤Âà†Èô§','success')}catch(e){console.error(e),ue('Âà†Èô§Â§±Ë¥•','error')}}):void ue('Êú™ÊâæÂà∞Êú¨Âú∞ÂâØÊú¨ÔºåÊó†Ê≥ïÂà†Èô§Êú¨Âú∞Êñá‰ª∂','warning')}Be('Âà†Èô§‰ΩúÂìÅ','Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Â∑≤‰∏ãËΩΩÁöÑ‰ΩúÂìÅÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ',async()=>{try{await re.idbService.deleteWork(e.id);const t=Ie.value.findIndex(t=>t.id===e.id);-1!==t&&Ie.value.splice(t,1)}catch(e){console.error(e),ue('Âà†Èô§Â§±Ë¥•','error')}})}function At(e){const t=lt(tt(e))||(Ze(e)?String(e.id):void 0);t?Be('Âà†Èô§‰∫ëÁ´ØÊ∫êÊñá‰ª∂',`Â∞Ü‰ªé‰∫ëÁ´ØÂΩªÂ∫ïÂà†Èô§„Äå${e.title}„Äç„ÄÇÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºåÁ°ÆÂÆöÁªßÁª≠ÂêóÔºü`,()=>{Be('ÂÜçÊ¨°Á°ÆËÆ§','Âà†Èô§ÁöÑÊòØ‰∫ëÁ´Ø‚ÄúÊ∫êÊñá‰ª∂‚ÄùÔºå‰∏çÊòØÊú¨Âú∞ÂâØÊú¨„ÄÇ‰ªçË¶ÅÁªßÁª≠ÂêóÔºü',()=>{Be('ÊúÄÂêéÁ°ÆËÆ§',`ÊúÄÂêé‰∏ÄÊ¨°Á°ÆËÆ§ÔºöÁúüÁöÑË¶ÅÂà†Èô§‰∫ëÁ´Ø‰ΩúÂìÅ„Äå${e.title}„ÄçÂêóÔºü`,async()=>{await V(async()=>{try{ue('Ê≠£Âú®Âà†Èô§‰∫ëÁ´ØÊ∫êÊñá‰ª∂...','info'),await Ft.deleteItem(t);const e=mt.value.find(e=>e.cloudItemId===t);if(e){const t={...e};delete t.cloudItemId;const a=_e(t);await re.idbService.saveWork(a);const n=Ie.value.findIndex(t=>t.id===e.id);n>=0&&(Ie.value[n]=a)}await ze(),await Fe(),ue(e?'‰∫ëÁ´ØÊ∫êÊñá‰ª∂Â∑≤Âà†Èô§ÔºàÊú¨Âú∞ÂâØÊú¨‰øùÁïôÔºâ':'‰∫ëÁ´ØÊ∫êÊñá‰ª∂Â∑≤Âà†Èô§','success')}catch(e){console.error(e);const t=e?.response?.status,a='number'==typeof t?t:'string'==typeof t?Number(t):void 0,n=e?.response?.data?.error||e?.response?.data?.message;if(401===a)return void ue('Âà†Èô§Â§±Ë¥•ÔºöËÆ§ËØÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØïÔºà‰ºöÈáçÊñ∞ÁôªÂΩïÔºâ','warning');if(503===a)return void ue(`Âà†Èô§Â§±Ë¥•Ôºö‰∫ëÁ´ØÊúçÂä°ÊöÇ‰∏çÂèØÁî®Ôºà${n||'503'}Ôºâ`,'warning');ue('Âà†Èô§Â§±Ë¥•'+(n?'Ôºö'+n:''),'error')}})})})}):ue('ËØ•‰ΩúÂìÅ‰∏çÂú®‰∫ëÁ´ØÔºåÊó†Ê≥ïÂà†Èô§‰∫ëÁ´ØÊ∫êÊñá‰ª∂','warning')}function Dt(){'EVENT_EDITOR'===a.value?C.value=void 0:'CHARACTER_EDITOR'===a.value&&(B.value=void 0),I.value=null}async function Mt(){const e=(new Date).toISOString(),t=e=>{const t=Ie.value.find(t=>t.id===e);if(t)return t;const a=I.value;return a?Ie.value.find(e=>e.id===a):void 0},o=e=>e?.owner?e.owner:'my-works'===n.value?'mine':'downloaded'===n.value?'downloaded':m.value?'mine':'downloaded',l=(e,t)=>{t&&(t.cloudItemId&&!e.cloudItemId&&(e.cloudItemId=t.cloudItemId),t.cloudBaseline&&!e.cloudBaseline&&(e.cloudBaseline=_e(t.cloudBaseline)))},r=async e=>{if(!I.value)return;if(I.value===e)return;const t=I.value;try{await re.idbService.deleteWork(t)}catch{}const a=Ie.value.findIndex(e=>e.id===t);a>=0&&Ie.value.splice(a,1)};let i;if('EVENT_EDITOR'===a.value&&b.value){const a=JSON.parse(JSON.stringify(b.value.eventPack)),n=t(a.id),c={id:a.id,type:'EVENT',data:a,downloadedAt:e};c.owner=o(n),l(c,n),i=c.owner;try{const e=_e(c);await re.idbService.saveWork(e),await r(c.id);const t=Ie.value.findIndex(e=>e.id===c.id);t>=0?Ie.value[t]=e:Ie.value.push(e),je('‰øùÂ≠òÊàêÂäü')}catch(e){return console.error(e),void je('‰øùÂ≠òÂ§±Ë¥•: '+e)}}else if('CHARACTER_EDITOR'===a.value&&w.value){const a=JSON.parse(JSON.stringify(w.value.charPack)),n=t(a.id),c={id:a.id,type:'CHARACTER',data:a,downloadedAt:e};c.owner=o(n),l(c,n),i=c.owner;try{const e=_e(c);await re.idbService.saveWork(e),await r(c.id);const t=Ie.value.findIndex(e=>e.id===c.id);t>=0?Ie.value[t]=e:Ie.value.push(e),je('‰øùÂ≠òÊàêÂäü')}catch(e){return console.error(e),void je('‰øùÂ≠òÂ§±Ë¥•: '+e)}}a.value='GALLERY',I.value=null,n.value='mine'===i?'my-works':'downloaded'}function Pt(e){R.value=e.imageUrl,L.value=e.characterName,O.value='',Y.value='',T.value=!0}function Ot(e){O.value=e.imageUrl,R.value='',L.value='',U.value='',F.value=e.linkedVariable||'',Y.value=e.naturalCondition||e.linkedVariable||'',T.value=!0}function Rt(e){if(console.log('[Workshop] handlePreviewWidget Êî∂Âà∞:',{id:e.id,name:e.name,vueCode:e.vueCode?.substring(0,100),fullCode:e.vueCode}),!e.vueCode||!e.vueCode.trim())return void ue('ËØ∑ÂÖàËæìÂÖ•ÁªÑ‰ª∂‰ª£Á†Å','warning');const t=ro(e.vueCode);if(!t.isValid)return q.value=`‰ª£Á†ÅÂÆâÂÖ®Ê£ÄÊü•Â§±Ë¥•:\n${t.errors.join('\n')}`,void ue('‰ª£Á†ÅÂ≠òÂú®ÂÆâÂÖ®ÈóÆÈ¢òÔºåÊó†Ê≥ïÈ¢ÑËßà','error');X.value=e,Q.value=[],q.value='';const a=C.value,n=(a?.previewVariablesText||'').trim();ee.value=n||ae(),ne(),K.value++,H.value=!0}function $t(){Q.value.push({type:'info',message:'ÁªÑ‰ª∂Âä†ËΩΩÊàêÂäü'})}function Lt(e){q.value=e,Q.value.push({type:'error',message:e})}function Ut(e){Q.value.push({type:e.type,message:e.message}),ue(e.message,e.type)}function zt(){H.value=!1,X.value=null,Q.value=[],q.value=''}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Eu,[(0,r.createCommentVNode)(' Background Dimmer for Editor '),'GALLERY'!==a.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Vu)):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Header '),(0,r.createElementVNode)('div',bu,[(0,r.createElementVNode)('button',{class:'back-btn',onClick:kt},[(0,r.createVNode)(v,{name:'back',size:'1.125em'})]),(0,r.createElementVNode)('div',wu,[(0,r.createVNode)(v,{name:'hammer',size:'1.25em',class:'title-icon'}),t[13]||(t[13]=(0,r.createElementVNode)('h1',null,'ÂàõÊÑèÂ∑•Âùä WORKSHOP',-1)),'GALLERY'!==a.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',Cu,(0,r.toDisplayString)('EVENT_EDITOR'===a.value?'‰∫ã‰ª∂ÂåÖÁºñËæë':'‰∫∫ËÆæÂåÖÁºñËæë'),1)):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createCommentVNode)(' Main Panel '),(0,r.createVNode)(N,{class:'main-panel'},{default:(0,r.withCtx)(()=>[(0,r.createVNode)(r.Transition,{name:'fade',mode:'out-in'},{default:(0,r.withCtx)(()=>['GALLERY'===a.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Su,[(0,r.createCommentVNode)(' Gallery Header '),(0,r.createElementVNode)('div',Bu,[(0,r.createElementVNode)('div',xu,[(0,r.createElementVNode)('div',_u,[(0,r.createVNode)(v,{name:'search',size:'1.125em',class:'search-icon'}),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[0]||(t[0]=e=>l.value=e),placeholder:'ÊêúÁ¥¢ Tag / Ê†áÈ¢ò...'},null,512),[[r.vModelText,l.value]])]),(0,r.createElementVNode)('div',Iu,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(yt,e=>(0,r.createElementVNode)('button',{key:e.value,class:(0,r.normalizeClass)({active:o.value===e.value}),onClick:t=>o.value=e.value},(0,r.toDisplayString)(e.label),11,Tu)),64))])]),(0,r.createElementVNode)('div',Au,[(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['my-works-btn',{active:'explore'===n.value}]),onClick:t[1]||(t[1]=e=>h('explore'))},[(0,r.createVNode)(v,{name:'world',size:'1em'}),t[14]||(t[14]=(0,r.createTextVNode)(' ÊµèËßà ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['my-works-btn',{active:'my-works'===n.value}]),onClick:t[2]||(t[2]=e=>h('my-works'))},[(0,r.createVNode)(v,{name:'user',size:'1em'}),t[15]||(t[15]=(0,r.createTextVNode)(' ÊàëÁöÑ‰ΩúÂìÅ ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['downloaded-btn',{active:'downloaded'===n.value}]),onClick:t[3]||(t[3]=e=>h('downloaded'))},[(0,r.createVNode)(v,{name:'download',size:'1em'}),t[16]||(t[16]=(0,r.createTextVNode)(' Â∑≤‰∏ãËΩΩ ',-1))],2),(0,r.createElementVNode)('div',Du,[(0,r.createElementVNode)('button',{class:'import-btn',type:'button',onClick:St},[(0,r.createVNode)(v,{name:'import',size:'1.125em'}),t[17]||(t[17]=(0,r.createTextVNode)(' ÂØºÂÖ• ',-1))])]),(0,r.createElementVNode)('div',Mu,[(0,r.createElementVNode)('button',{class:'upload-btn',onClick:t[4]||(t[4]=e=>c.value=!c.value)},[(0,r.createVNode)(v,{name:'plus',size:'1.125em'}),t[18]||(t[18]=(0,r.createTextVNode)(' Êñ∞Âª∫ ',-1))]),(0,r.createVNode)(r.Transition,{name:'dropdown'},{default:(0,r.withCtx)(()=>[c.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Pu,[(0,r.createElementVNode)('button',{onClick:Nt},[(0,r.createVNode)(v,{name:'book',size:'0.875em'}),t[19]||(t[19]=(0,r.createTextVNode)(' ‰∫ã‰ª∂ÂåÖ ',-1))]),(0,r.createElementVNode)('button',{onClick:Et},[(0,r.createVNode)(v,{name:'user',size:'0.875em'}),t[20]||(t[20]=(0,r.createTextVNode)(' ‰∫∫ËÆæÂåÖ ',-1))])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])])]),(0,r.createCommentVNode)(' Auto-save Toast '),(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ou,[(0,r.createVNode)(v,{name:'check',size:'1em'}),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(d.value),1)])):(0,r.createCommentVNode)('v-if',!0)]),_:1}),(0,r.createCommentVNode)(' Local file import inputs (hidden) '),(0,r.createElementVNode)('input',{ref_key:'importPackInput',ref:s,class:'hidden-file-input',type:'file',accept:'application/json,.json',multiple:'',onChange:t[5]||(t[5]=e=>async function(e){const t=e.target,a=Array.from(t.files||[]);if(t.value='',!a.length)return;let o=0;try{for(const e of a){const t=await e.text();let a;try{a=JSON.parse(t)}catch{ue(`ÂØºÂÖ•Â§±Ë¥•ÔºöÊñá‰ª∂‰∏çÊòØÊúâÊïà JSONÔºö${e.name}`,'error');continue}const n=async t=>{const a=Ct(t);if(!a)return void ue(`ÂØºÂÖ•Â§±Ë¥•ÔºöÊó†Ê≥ïËØÜÂà´Á±ªÂûãÔºö${e.name}`,'error');const n=t&&'object'==typeof t&&('EVENT'===t.type||'CHARACTER'===t.type)&&t.data?t.data:t,l='EVENT'===a?bt(n):wt(n),r=(new Date).toISOString(),i={id:l.id,type:a,data:l,downloadedAt:r};await re.idbService.saveWork(i);const c=Ie.value.findIndex(e=>e.id===i.id);c>=0?Ie.value[c]=i:Ie.value.push(i),o++};if(Array.isArray(a))for(const e of a)await n(e);else await n(a)}o>0&&(n.value='downloaded',ue(`Â∑≤ÂØºÂÖ•Âà∞‚ÄúÂ∑≤‰∏ãËΩΩ‚ÄùÔºö${o} ‰∏™`,'success'))}catch(e){console.error('[Workshop] import failed:',e),ue('ÂØºÂÖ•Â§±Ë¥•ÔºöËØ∑Êü•ÁúãÊéßÂà∂Âè∞Êó•Âøó','error')}}(e))},null,544),(0,r.createCommentVNode)(' My Works actions (inside My Works view) '),'my-works'===n.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ru,[(0,r.createElementVNode)('button',{class:'my-works-btn',onClick:Re},[(0,r.createVNode)(v,{name:'info',size:'1em'}),t[21]||(t[21]=(0,r.createTextVNode)(' Êü•ÁúãÈÖçÈ¢ù ',-1))])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Gallery Grid '),(0,r.createElementVNode)('div',$u,['my-works'!==n.value||m.value?ht.value.length?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:1},(0,r.renderList)(ht.value,e=>((0,r.openBlock)(),(0,r.createBlock)(To,{key:e.id,item:e,'author-avatar-url':qe(e),'is-downloaded':'downloaded'===n.value,'can-edit':'downloaded'===n.value||'my-works'===n.value&&!!mt.value.find(t=>t.id===e.id||t.cloudItemId===e.id),'can-delete':'downloaded'===n.value||'my-works'===n.value&&!!tt(e),'can-delete-remote':'my-works'===n.value&&it(e),'can-download':'explore'===n.value||'my-works'===n.value&&et(e),'can-upload':'my-works'===n.value&&st(e),'can-file-download':'downloaded'===n.value||'my-works'===n.value&&!!tt(e),'file-download-title':'ÂØºÂá∫‰∏∫JSONÊñá‰ª∂','upload-title':'my-works'===n.value?dt(e):void 0,'upload-icon':'my-works'===n.value?'upload-cloud':void 0,'status-label':'my-works'===n.value?ct(e):void 0,onEdit:xt,onDelete:Tt,onDeleteRemote:At,onDownload:_t,onUpload:It,onFileDownload:Bt,onInfo:Ue},null,8,['item','author-avatar-url','is-downloaded','can-edit','can-delete','can-delete-remote','can-download','can-upload','can-file-download','upload-title','upload-icon','status-label']))),128)):((0,r.openBlock)(),(0,r.createElementBlock)('div',Uu,[(0,r.createVNode)(v,{name:'folder',size:'3em'}),'my-works'===n.value&&'unauth'===Me.value&&m.value?((0,r.openBlock)(),(0,r.createElementBlock)('p',zu,'ËøôÈáåÂè™Â±ïÁ§∫‰Ω†ÂèëÂ∏ÉÁöÑÂÖ¨ÂºÄ‰ΩúÂìÅÔºà‰∏çÈúÄË¶ÅÈ™åËØÅÁôªÂΩïÔºâ„ÄÇ‰∏ä‰º†/Âà†Èô§‰∫ëÁ´ØÁ≠âÂç±Èô©Êìç‰Ωú‰ºöË¶ÅÊ±ÇÂÜçÊ¨°ÁôªÂΩïÈ™åËØÅ„ÄÇ')):((0,r.openBlock)(),(0,r.createElementBlock)('p',Fu,(0,r.toDisplayString)('downloaded'===n.value?'ÊöÇÊó†Â∑≤‰∏ãËΩΩ‰ΩúÂìÅ':'Ê≤°ÊúâÊâæÂà∞Áõ∏ÂÖ≥ÂÜÖÂÆπ'),1))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Lu,[(0,r.createVNode)(v,{name:'user',size:'3em'}),t[22]||(t[22]=(0,r.createElementVNode)('p',null,'Êú™Âú®È¶ñÈ°µÁôªÂΩïÔºöËØ∑ÂÖàÁôªÂΩïÔºà7Â§©ÊúâÊïàÔºâÂÜçËøõÂÖ•‚ÄúÊàëÁöÑ‰ΩúÂìÅ‚Äù',-1)),(0,r.createElementVNode)('button',{class:'my-works-btn active',onClick:y},'ÂõûÈ¶ñÈ°µÁôªÂΩï')]))]),(0,r.createCommentVNode)(' Intro Modal '),(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[$e.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'intro-overlay',onClick:t[7]||(t[7]=(0,r.withModifiers)(e=>$e.value=!1,['self']))},[(0,r.createElementVNode)('div',Wu,[(0,r.createElementVNode)('div',ju,[(0,r.createElementVNode)('div',Gu,(0,r.toDisplayString)(Le.value?.title||'ÁÆÄ‰ªã'),1),(0,r.createElementVNode)('button',{class:'intro-close',type:'button',onClick:t[6]||(t[6]=e=>$e.value=!1)},'‚úï')]),(0,r.createElementVNode)('div',Ju,[(0,r.createElementVNode)('span',Yu,(0,r.toDisplayString)('EVENT'===Le.value?.type?'‰∫ã‰ª∂ÂåÖ':'‰∫∫ËÆæÂåÖ'),1),(0,r.createElementVNode)('span',Hu,'¬∑ '+(0,r.toDisplayString)(Le.value?.author||'Unknown'),1)]),(0,r.createElementVNode)('div',Xu,(0,r.toDisplayString)(Le.value?.description?.trim()||'ÊöÇÊó†ÁÆÄ‰ªã'),1)])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])):'EVENT_EDITOR'===a.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ku,[(0,r.createElementVNode)('div',Qu,[(0,r.createElementVNode)('div',qu,[(0,r.createVNode)(eu,{ref_key:'eventEditorRef',ref:b,'initial-data':C.value,'character-packs':pt.value,onPreviewChar:Pt,onPreviewBg:Ot,onPreviewWidget:Rt,onAutoSave:je},null,8,['initial-data','character-packs'])]),(0,r.createCommentVNode)(' Bottom Actions '),(0,r.createElementVNode)('div',{class:'editor-actions'},[(0,r.createElementVNode)('button',{class:'action-reset',onClick:Dt},'Ê∏ÖÁ©∫ÈáçÁΩÆ'),(0,r.createElementVNode)('button',{class:'action-submit',onClick:Mt},'‰øùÂ≠òÂà∞Â∑≤‰∏ãËΩΩ‰ΩúÂìÅ')])])])):'CHARACTER_EDITOR'===a.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Zu,[(0,r.createElementVNode)('div',em,[(0,r.createElementVNode)('div',tm,[(0,r.createVNode)(ml,{ref_key:'charEditorRef',ref:w,'initial-data':B.value,onAutoSave:je},null,8,['initial-data'])]),(0,r.createCommentVNode)(' Bottom Actions '),(0,r.createElementVNode)('div',{class:'editor-actions'},[(0,r.createElementVNode)('button',{class:'action-reset',onClick:Dt},'Ê∏ÖÁ©∫ÈáçÁΩÆ'),(0,r.createElementVNode)('button',{class:'action-submit',onClick:Mt},'‰øùÂ≠òÂà∞Â∑≤‰∏ãËΩΩ‰ΩúÂìÅ')])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})]),_:1}),(0,r.createCommentVNode)(' Visual Preview Modal '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'body'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[T.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'preview-overlay',onClick:t[9]||(t[9]=(0,r.withModifiers)(e=>T.value=!1,['self']))},[(0,r.createElementVNode)('div',am,[(0,r.createElementVNode)('button',{class:'close-btn',onClick:t[8]||(t[8]=e=>T.value=!1)},'√ó'),(0,r.createVNode)(Nu,{'bg-image':O.value,'char-image':R.value,'char-name':L.value,'diff-name':U.value,location:F.value,time:J.value,condition:Y.value},null,8,['bg-image','char-image','char-name','diff-name','location','time','condition'])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])),(0,r.createCommentVNode)(' Widget Preview Modal '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'body'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[H.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'widget-preview-overlay',onClick:(0,r.withModifiers)(zt,['self'])},[(0,r.createElementVNode)('div',nm,[(0,r.createElementVNode)('div',om,[(0,r.createElementVNode)('h3',null,'ÁªÑ‰ª∂È¢ÑËßà: '+(0,r.toDisplayString)(X.value?.name),1),(0,r.createElementVNode)('button',{class:'close-btn',onClick:zt},'√ó')]),(0,r.createElementVNode)('div',lm,[(0,r.createElementVNode)('div',rm,[(0,r.createElementVNode)('div',im,[t[23]||(t[23]=(0,r.createElementVNode)('div',{class:'vars-title'},'È¢ÑËßàÂèòÈáèÔºàJSONÔºå‰ªÖÁî®‰∫éÈ¢ÑËßàÔºâ',-1)),(0,r.createElementVNode)('div',cm,[(0,r.createElementVNode)('button',{class:'vars-btn',type:'button',onClick:(0,r.withModifiers)(oe,['stop'])},'ÁîüÊàêÊ®°Êùø'),(0,r.createElementVNode)('button',{class:'vars-btn primary',type:'button',onClick:(0,r.withModifiers)(ie,['stop'])},' Â∫îÁî®Âπ∂Âà∑Êñ∞ ')])]),te.value.error?((0,r.openBlock)(),(0,r.createElementBlock)('div',sm,(0,r.toDisplayString)(te.value.error),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[10]||(t[10]=e=>ee.value=e),class:'vars-textarea',spellcheck:'false',placeholder:'Âú®ËøôÈáåËæìÂÖ•È¢ÑËßàÂèòÈáè JSON...'},null,512),[[r.vModelText,ee.value]])]),(0,r.createElementVNode)('div',dm,[q.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',um,[(0,r.createVNode)(v,{name:'alert',size:'1.5em'}),(0,r.createElementVNode)('pre',null,(0,r.toDisplayString)(q.value),1)])):X.value&&K.value?((0,r.openBlock)(),(0,r.createBlock)(go,{key:`widget-preview-${K.value}`,'user-code':X.value.vueCode,'component-id':`preview-${X.value.id}-${K.value}`,'game-state':Z.value,'preview-variables':te.value.value,'allow-state-modification':!1,onLoaded:$t,onError:Lt,onNotification:Ut},null,8,['user-code','component-id','game-state','preview-variables'])):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createElementVNode)('div',mm,[t[24]||(t[24]=(0,r.createElementVNode)('div',{class:'console-header'},'ÊéßÂà∂Âè∞',-1)),(0,r.createElementVNode)('div',pm,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(Q.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:(0,r.normalizeClass)(['log-entry',e.type])},' ['+(0,r.toDisplayString)(e.type)+'] '+(0,r.toDisplayString)(e.message),3))),128)),Q.value.length?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',vm,'ÊöÇÊó†Êó•Âøó'))])])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])),(0,r.createCommentVNode)(' Upload Progress Overlay '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'body'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[me.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'upload-overlay',onClick:(0,r.withModifiers)(()=>{},['self'])},[(0,r.createVNode)(N,{class:'upload-box'},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',gm,[(0,r.createVNode)(v,{name:'upload-cloud',size:'1.5em',class:'upload-icon'}),(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(pe.value),1)]),(0,r.createElementVNode)('div',fm,(0,r.toDisplayString)(ve.value),1),(0,r.createElementVNode)('div',ym,[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['upload-progress-bar',{indeterminate:null===ge.value}]),style:(0,r.normalizeStyle)(null===ge.value?void 0:{width:ge.value+'%'})},null,6)]),ye.value>0&&null!==ge.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',hm,(0,r.toDisplayString)(Math.round(fe.value/1024))+'KB / '+(0,r.toDisplayString)(Math.round(ye.value/1024))+'KB Ôºà'+(0,r.toDisplayString)(ge.value)+'%Ôºâ ',1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',km,[(0,r.createElementVNode)('button',{class:'btn-cancel',type:'button',disabled:!he.value,onClick:Ve},(0,r.toDisplayString)(ke.value),9,Nm)])]),_:1})])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])),(0,r.createCommentVNode)(' Confirm Modal '),(0,r.createVNode)(le,{visible:be.value,'onUpdate:visible':t[11]||(t[11]=e=>be.value=e),title:we.value,message:Ce.value,onConfirm:xe},null,8,['visible','title','message']),(0,r.createVNode)(S,{visible:ce.value,'onUpdate:visible':t[12]||(t[12]=e=>ce.value=e),message:se.value,type:de.value},null,8,['visible','message','type'])]))}}),Vm=(0,y.A)(Em,[['__scopeId','data-v-4dcced44']]),bm={key:0,class:'char-name-container'},wm={class:'char-name-box'},Cm={class:'char-name'},Sm={class:'dialogue-text-wrapper'},Bm={key:0,class:'cursor'},xm={class:'dialogue-controls'},_m=(0,r.defineComponent)({__name:'DialogueBox',props:{name:{},text:{},effect:{},protagonistName:{},autoMode:{type:Boolean},skipMode:{type:Boolean},settings:{}},emits:['next','back','log','auto','skip'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(''),l=(0,r.ref)(!1);let i=null,c=null;const s=e=>'string'==typeof e&&e.trim().length>0,d=()=>{const e=(a.name||'').trim();if(!e)return!0;const t=(a.protagonistName||'').trim(),n=e.toLowerCase();return t&&e===t||'user'===n||'<user>'===n||'Áé©ÂÆ∂'===e||'‰∏ªËßí'===e},u=(0,r.ref)([]),m=(0,r.ref)(0),p=(0,r.ref)(!1),g=()=>{u.value=(e=>{const t=String(e??'');if(!t)return[];const a=[];let n=0;for(;n<t.length;){if('*'===t[n]&&'*'===t[n+1]){a.push({kind:'narration',text:'**'}),n+=2;continue}if('*'===t[n]&&'*'!==t[n+1]){let e=n+1;for(;e<t.length&&('*'!==t[e]||'*'===t[e+1]||'\\'===t[e-1]);)e++;if(e<t.length&&'*'===t[e]){const o=t.slice(n+1,e);o&&a.push({kind:'psych',text:o}),n=e+1;continue}a.push({kind:'narration',text:'*'}),n+=1;continue}if('„Äå'===t[n]){const e=t.indexOf('„Äç',n+1);if(-1!==e){const o=t.slice(n,e+1);a.push({kind:'dialogue',text:o}),n=e+1;continue}a.push({kind:'narration',text:'„Äå'}),n+=1;continue}const e=[t.indexOf('*',n),t.indexOf('„Äå',n)].filter(e=>-1!==e).sort((e,t)=>e-t)[0];let o='number'==typeof e&&e>=0?e:t.length;o<=n&&(o=Math.min(n+1,t.length));const l=t.slice(n,o);l&&a.push({kind:'narration',text:l}),n=o}const o=[];for(const e of a){const t=o[o.length-1];t&&t.kind===e.kind?t.text+=e.text:o.push({...e})}return o})(a.text)},f=()=>u.value.reduce((e,t)=>e+(t.text?.length||0),0),y=(0,r.ref)([]),h=()=>{p.value?y.value=[{kind:'narration',text:o.value}]:y.value=(e=>{if(e<=0)return[];const t=[];let a=e;for(const e of u.value){if(a<=0)break;const n=e.text||'';if(!n)continue;const o=n.slice(0,a);o&&t.push({kind:e.kind,text:o}),a-=o.length}return t})(m.value)},k=(0,r.ref)('');(0,r.watch)(()=>[a.name,a.text,a.protagonistName],()=>{g();const e=(a.name||'').trim();k.value=e&&(u.value.some(e=>'dialogue'===e.kind)||u.value.some(e=>'psych'===e.kind))?e:''},{immediate:!0});const E=e=>{const t=s(a.settings.dialogueTextColor)?a.settings.dialogueTextColor:'',n=s(a.settings.narrationTextColor)?a.settings.narrationTextColor:'',o=s(a.settings.psychTextColor)?a.settings.psychTextColor:'';return'dialogue'===e&&t?{color:t}:'psych'===e?d()&&o?{color:o}:!d()&&n?{color:n}:{}:'narration'===e&&n?{color:n}:{}},V=()=>{if(i&&(clearInterval(i),i=null),0===a.settings.textSpeed||a.skipMode)return p.value=!1,m.value=f(),h(),void(l.value=!1);l.value=!0;const e=Math.max(a.settings.textSpeed,1);p.value=!1,m.value=0,h();const t=f(),n=performance.now(),o=()=>{const a=performance.now()-n,l=Math.floor(a/e);l>=t?(m.value=t,h(),b()):(l>m.value&&(m.value=l,h()),c=requestAnimationFrame(o))};c=requestAnimationFrame(o)},b=()=>{i&&(clearInterval(i),i=null),c&&(cancelAnimationFrame(c),c=null),p.value||(m.value=f()),h(),l.value=!1},w=()=>{l.value?b():n('next')};return(0,r.watch)(()=>a.text,()=>{V()}),(0,r.watch)(()=>a.effect,()=>{V()}),(0,r.watch)(()=>a.skipMode,e=>{e&&l.value&&b()}),(0,r.onMounted)(()=>{V()}),(0,r.onUnmounted)(()=>{i&&clearInterval(i),c&&cancelAnimationFrame(c)}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'dialogue-layer',style:(0,r.normalizeStyle)({bottom:(e.settings.dialogueBottom??3)+'em'})},[(0,r.createVNode)(N,{class:'dialogue-panel',style:(0,r.normalizeStyle)({opacity:(e.settings.dialogueOpacity??85)/100,width:(e.settings.dialogueWidth??90)+'%',height:(e.settings.dialogueHeight??200)+'px',padding:`${e.settings.dialoguePaddingY??2}em ${e.settings.dialoguePaddingX??2.5}em`}),onClick:(0,r.withModifiers)(w,['stop'])},{default:(0,r.withCtx)(()=>[(0,r.createCommentVNode)(' Character Name '),k.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',bm,[(0,r.createElementVNode)('div',wm,[(0,r.createElementVNode)('span',Cm,(0,r.toDisplayString)(k.value),1)]),(0,r.createCommentVNode)(' Decorative Line '),t[4]||(t[4]=(0,r.createElementVNode)('div',{class:'name-deco-line'},null,-1))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Main Text '),(0,r.createElementVNode)('div',Sm,[(0,r.createElementVNode)('p',{class:'dialogue-text',style:(0,r.normalizeStyle)({fontSize:e.settings.fontSize+'px'})},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(y.value,(e,t)=>{return(0,r.openBlock)(),(0,r.createElementBlock)('span',{key:t,class:(0,r.normalizeClass)((a=e.kind,'dialogue'===a?'seg-dialogue':'psych'===a&&d()?'seg-psych':'seg-narration')),style:(0,r.normalizeStyle)(E(e.kind))},(0,r.toDisplayString)(e.text),7);var a}),128)),l.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',Bm,'|')):(0,r.createCommentVNode)('v-if',!0)],4)]),(0,r.createCommentVNode)(' In-Dialogue Controls '),(0,r.createElementVNode)('div',xm,[(0,r.createElementVNode)('button',{class:'control-btn hover-violet',onClick:t[0]||(t[0]=(0,r.withModifiers)(t=>e.$emit('log'),['stop']))},[(0,r.createVNode)(v,{name:'message',size:14}),t[5]||(t[5]=(0,r.createTextVNode)(' Log ',-1))]),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['control-btn hover-cyan',{active:e.autoMode}]),onClick:t[1]||(t[1]=(0,r.withModifiers)(t=>e.$emit('auto'),['stop']))},[(0,r.createVNode)(v,{name:'next',size:14}),t[6]||(t[6]=(0,r.createTextVNode)(' Auto ',-1))],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['control-btn hover-pink',{active:e.skipMode}]),onClick:t[2]||(t[2]=(0,r.withModifiers)(t=>e.$emit('skip'),['stop']))},[(0,r.createVNode)(v,{name:'next',size:14,class:'rotate-90'}),t[7]||(t[7]=(0,r.createTextVNode)(' Skip ',-1))],2)]),(0,r.createCommentVNode)(' Back Indicator '),(0,r.createElementVNode)('div',{class:'back-indicator',onClick:t[3]||(t[3]=(0,r.withModifiers)(t=>e.$emit('back'),['stop']))},[(0,r.createVNode)(v,{name:'next',size:24,class:'rotate-90'})])]),_:1},8,['style'])],4))}}),Im=(0,y.A)(_m,[['__scopeId','data-v-21001e54']]),Tm={class:'error-log-panel'},Am={class:'log-header'},Dm={class:'header-left'},Mm={class:'icon-wrapper'},Pm={key:0,class:'count-badge'},Om={key:0,class:'empty-state'},Rm={key:1,class:'log-content'},$m={class:'error-header'},Lm={class:'error-index'},Um={class:'error-time'},zm={class:'error-message'},Fm={key:0,class:'error-command'},Wm={class:'command-actions'},jm=['onClick'],Gm=['onClick'],Jm={key:1,class:'error-details'},Ym={key:2,class:'reprocess-panel'},Hm={class:'reprocess-title'},Xm={class:'reprocess-actions'},Km=['disabled'],Qm=['disabled'],qm={key:3,class:'log-footer'},Zm={class:'footer-info'},ep=(0,r.defineComponent)({__name:'ErrorLogModal',props:{visible:{type:Boolean,default:!1},errors:{default:()=>[]}},emits:['update:visible','clear','reprocess','notify'],setup(e,{emit:t}){const a=e,n=t,o=e=>{const t=new Date(e),a=(new Date).getTime()-t.getTime(),n=Math.floor(a/6e4),o=Math.floor(a/36e5);return n<1?'ÂàöÂàö':n<60?`${n} ÂàÜÈíüÂâç`:o<24?`${o} Â∞èÊó∂Ââç`:t.toLocaleString('zh-CN',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})},l=(0,r.ref)(!1);let i=null;const c=(0,r.computed)(()=>{for(let e=0;e<a.errors.length;e++){const t=a.errors[a.errors.length-1-e];if(t?.command)return t.command}return''}),s=(0,r.ref)('');const d=()=>{if(!l.value)return n('notify',{text:'ÂÜçÁÇπ‰∏ÄÊ¨°‚ÄúÊ∏ÖÁ©∫Êó•Âøó‚Äù‰ª•Á°ÆËÆ§',success:!1,duration:2e3}),l.value=!0,i&&window.clearTimeout(i),void(i=window.setTimeout(()=>{l.value=!1,i=null},2500));l.value=!1,i&&(window.clearTimeout(i),i=null),n('clear')},u=()=>{c.value&&(s.value=c.value,n('notify',{text:'Â∑≤Â°´ÂÖ•ÊúÄÊñ∞ÈîôËØØÊåá‰ª§',success:!0,duration:1500}))},m=()=>{const e=s.value.trim();e&&n('reprocess',e)};return(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'error-log-overlay',onClick:t[2]||(t[2]=(0,r.withModifiers)(t=>e.$emit('update:visible',!1),['self']))},[(0,r.createElementVNode)('div',Tm,[(0,r.createElementVNode)('div',Am,[(0,r.createElementVNode)('div',Dm,[(0,r.createElementVNode)('div',Mm,[(0,r.createVNode)(v,{name:'alert',size:24})]),t[3]||(t[3]=(0,r.createElementVNode)('span',{class:'title'},'ÂèòÈáèÂ§ÑÁêÜÈîôËØØÊó•Âøó',-1)),e.errors.length>0?((0,r.openBlock)(),(0,r.createElementBlock)('span',Pm,(0,r.toDisplayString)(e.errors.length),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('button',{class:'close-btn',onClick:t[0]||(t[0]=t=>e.$emit('update:visible',!1))},'‚úï')]),0===e.errors.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Om,[(0,r.createVNode)(v,{name:'check',size:48}),t[4]||(t[4]=(0,r.createElementVNode)('p',null,'ÊöÇÊó†ÈîôËØØËÆ∞ÂΩï',-1)),t[5]||(t[5]=(0,r.createElementVNode)('span',{class:'sub-text'},'ÊâÄÊúâÂèòÈáèÊåá‰ª§ÈÉΩÊâßË°åÊàêÂäü',-1))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Rm,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.errors,(a,l)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:l,class:'error-item'},[(0,r.createElementVNode)('div',$m,[(0,r.createElementVNode)('span',Lm,'#'+(0,r.toDisplayString)(e.errors.length-l),1),(0,r.createElementVNode)('span',Um,(0,r.toDisplayString)(o(a.timestamp)),1)]),(0,r.createElementVNode)('div',zm,(0,r.toDisplayString)(a.message),1),a.command?((0,r.openBlock)(),(0,r.createElementBlock)('div',Fm,[t[8]||(t[8]=(0,r.createElementVNode)('span',{class:'command-label'},'Êåá‰ª§:',-1)),(0,r.createElementVNode)('code',null,(0,r.toDisplayString)(a.command),1),(0,r.createElementVNode)('div',Wm,[(0,r.createElementVNode)('button',{class:'mini-btn',onClick:e=>(async e=>{try{await navigator.clipboard.writeText(e),n('notify',{text:'Â∑≤Â§çÂà∂Êåá‰ª§',success:!0,duration:1500})}catch{n('notify',{text:'Â§çÂà∂Â§±Ë¥•ÔºàÊµèËßàÂô®ÊùÉÈôêÈôêÂà∂Ôºâ',success:!1,duration:2e3})}})(a.command)},[(0,r.createVNode)(v,{name:'copy',size:14}),t[6]||(t[6]=(0,r.createTextVNode)(' Â§çÂà∂ ',-1))],8,jm),(0,r.createElementVNode)('button',{class:'mini-btn primary',onClick:e=>{return t=a.command,s.value=t,void n('notify',{text:'Â∑≤Â°´ÂÖ•Âà∞‚ÄúÈáçÊñ∞Â§ÑÁêÜÂèòÈáè‚ÄùÁºñËæëÊ°Ü',success:!0,duration:1500});var t}},[(0,r.createVNode)(v,{name:'edit',size:14}),t[7]||(t[7]=(0,r.createTextVNode)(' Áî®Ê≠§Êåá‰ª§ÁºñËæë ',-1))],8,Gm)])])):(0,r.createCommentVNode)('v-if',!0),a.details?((0,r.openBlock)(),(0,r.createElementBlock)('div',Jm,[t[9]||(t[9]=(0,r.createElementVNode)('span',{class:'details-label'},'ËØ¶ÊÉÖ:',-1)),(0,r.createElementVNode)('pre',null,(0,r.toDisplayString)(a.details),1)])):(0,r.createCommentVNode)('v-if',!0)]))),128))])),(0,r.createCommentVNode)(' Reprocess editor '),e.errors.length>0?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ym,[(0,r.createElementVNode)('div',Hm,[(0,r.createVNode)(v,{name:'hammer',size:18}),t[10]||(t[10]=(0,r.createTextVNode)(' ÈáçÊñ∞Â§ÑÁêÜÂèòÈáè ',-1))]),t[13]||(t[13]=(0,r.createElementVNode)('div',{class:'reprocess-desc'},' Êää‰∏äÈù¢ÈîôËØØÁöÑÈÇ£‰∏ÄÂè•Êåá‰ª§Ë¥¥ËøõÊù•‰øÆÊîπÔºåÁÑ∂ÂêéÁÇπ‚ÄúÂ∫îÁî®ÈáçÊñ∞Â§ÑÁêÜ‚Äù„ÄÇÊîØÊåÅÂçïÊù°ÊàñÂ§öÊù°Êåá‰ª§ÔºàÂèØÂ§öË°åÔºâ„ÄÇ ',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[1]||(t[1]=e=>s.value=e),class:'reprocess-input',spellcheck:'false',placeholder:'‰æãÂ¶ÇÔºö\\n\\n[$$ UPDATE(\'Á≥ªÁªü.Êó∂Èó¥\', \'Á¨¨3Â§©\') $$]'},null,512),[[r.vModelText,s.value]]),(0,r.createElementVNode)('div',Xm,[(0,r.createElementVNode)('button',{class:'mini-btn',onClick:u,disabled:!c.value},[(0,r.createVNode)(v,{name:'download',size:14}),t[11]||(t[11]=(0,r.createTextVNode)(' Â°´ÂÖ•ÊúÄÊñ∞ÈîôËØØÊåá‰ª§ ',-1))],8,Km),(0,r.createElementVNode)('button',{class:'mini-btn primary',onClick:m,disabled:!s.value.trim()},[(0,r.createVNode)(v,{name:'play',size:14}),t[12]||(t[12]=(0,r.createTextVNode)(' Â∫îÁî®ÈáçÊñ∞Â§ÑÁêÜ ',-1))],8,Qm)])])):(0,r.createCommentVNode)('v-if',!0),e.errors.length>0?((0,r.openBlock)(),(0,r.createElementBlock)('div',qm,[(0,r.createElementVNode)('button',{class:'btn-clear',onClick:d},[(0,r.createVNode)(v,{name:'trash',size:16}),t[14]||(t[14]=(0,r.createTextVNode)(' Ê∏ÖÁ©∫Êó•Âøó ',-1))]),(0,r.createElementVNode)('span',Zm,'ÂÖ± '+(0,r.toDisplayString)(e.errors.length)+' Êù°ÈîôËØØËÆ∞ÂΩï',1)])):(0,r.createCommentVNode)('v-if',!0)])])):(0,r.createCommentVNode)('v-if',!0)]),_:1}))}}),tp=(0,y.A)(ep,[['__scopeId','data-v-1628de53']]),ap={class:'hud-layer group'},np={class:'location-icon-wrapper'},op={class:'location-text'},lp={class:'time-text'},rp=(0,r.defineComponent)({__name:'GameHud',props:{overrideTime:{},overrideLocation:{},typingSpeedMs:{}},setup(e){const t=e,a=(0,r.ref)(''),n=(0,r.ref)(''),o=(0,r.ref)(''),l=(0,r.ref)('');let i=null,c=null,s=null;const{getCurrentTime:d,getCurrentLocation:u}=_t(),m=async()=>{try{const[e,r]=await Promise.all([d(),u()]);a.value='string'==typeof e?e:'',n.value='string'==typeof r?r:'',null==t.overrideTime&&(o.value=a.value),null==t.overrideLocation&&(l.value=n.value)}catch{}};(0,r.onMounted)(async()=>{await m(),t.overrideTime?o.value=t.overrideTime:o.value=a.value,t.overrideLocation?l.value=t.overrideLocation:l.value=n.value,s=setInterval(m,1e3)});const p=e=>{'time'===e&&i&&(clearInterval(i),i=null),'location'===e&&c&&(clearInterval(c),c=null)},g=(e,a)=>{p(e);Math.max(t.typingSpeedMs??30,16);const n='time'===e?o:l,r=String(a??'');let s=0;const d='!@#$%^&*()_+-=[]{}|;:,.<>?ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',u=e=>Array.from({length:e},()=>d[Math.floor(88*Math.random())]).join(''),m=setInterval(()=>{s+=50,s<600?n.value=u(r.length||5):(n.value=r,p(e))},50);'time'===e?i=m:c=m};(0,r.watch)(()=>t.overrideTime,(e,t)=>{e!==t&&('string'==typeof e?g('time',e):(p('time'),o.value=a.value))}),(0,r.watch)(()=>t.overrideLocation,(e,t)=>{e!==t&&('string'==typeof e?g('location',e):(p('location'),l.value=n.value))}),(0,r.onUnmounted)(()=>{s&&(clearInterval(s),s=null),p('time'),p('location')});const f=(0,r.computed)(()=>(l.value||'').trim()||'UNKNOWN'),y=(0,r.computed)(()=>(o.value||'').trim()||'----/--/-- --:--');return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',ap,[(0,r.createElementVNode)('div',np,[(0,r.createVNode)(v,{name:'location',size:20})]),(0,r.createElementVNode)('div',null,[(0,r.createElementVNode)('div',op,(0,r.toDisplayString)(f.value),1),(0,r.createElementVNode)('div',lp,(0,r.toDisplayString)(y.value),1)])]))}}),ip=(0,y.A)(rp,[['__scopeId','data-v-83a8506e']]),cp={class:'sidebar-content'},sp={class:'btn-icon-wrapper'},dp={class:'btn-icon-wrapper'},up={class:'btn-icon-wrapper'},mp={class:'btn-icon-wrapper'},pp={key:0,class:'error-badge'},vp={class:'btn-icon-wrapper danger-bg'},gp=(0,r.defineComponent)({__name:'LeftSidebar',props:{errorCount:{default:0}},emits:['saveload','asset','variables','settings','errorlog','exit'],setup(e){const t=e,a=(0,r.computed)(()=>t.errorCount>0),n=(0,r.ref)(null),o=(0,r.ref)(!1);let l=0,i=0;const c=()=>window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1;function s(e){if(!c())return;if(o.value)return;const t=e.touches[0];t&&(l=t.clientX,i=t.clientY)}function d(e){if(!c())return;if(o.value)return;const t=e.changedTouches[0];if(!t)return;if(l>28)return;const a=t.clientX-l,n=t.clientY-i;Math.abs(a)<40||Math.abs(a)<Math.abs(n)||a>0&&(o.value=!0)}function u(){o.value=!o.value}function m(e){'touch'!==e.pointerType&&(o.value=!0)}function p(e){'touch'!==e.pointerType&&(o.value=!1)}function g(e){if(!o.value)return;const t=n.value;if(!t)return;const a=e.target;a&&t.contains(a)||(o.value=!1)}return(0,r.onMounted)(()=>{document.addEventListener('pointerdown',g),document.addEventListener('touchstart',s,{passive:!0}),document.addEventListener('touchend',d,{passive:!0})}),(0,r.onUnmounted)(()=>{document.removeEventListener('pointerdown',g),document.removeEventListener('touchstart',s),document.removeEventListener('touchend',d)}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{ref_key:'rootRef',ref:n,class:(0,r.normalizeClass)(['left-sidebar group',{open:o.value}]),onPointerenter:m,onPointerleave:p},[(0,r.createCommentVNode)(' Invisible Trigger Area '),(0,r.createElementVNode)('div',{class:'trigger-area',onPointerdown:(0,r.withModifiers)(u,['stop','prevent'])},null,32),(0,r.createCommentVNode)(' Expanded Content '),(0,r.createElementVNode)('div',cp,[(0,r.createElementVNode)('button',{class:'sidebar-btn',onClick:t[0]||(t[0]=t=>e.$emit('saveload'))},[(0,r.createElementVNode)('div',sp,[(0,r.createVNode)(v,{name:'save',size:20})]),t[6]||(t[6]=(0,r.createElementVNode)('span',{class:'btn-label'},'SAVE/LOAD',-1))]),(0,r.createElementVNode)('button',{class:'sidebar-btn',onClick:t[1]||(t[1]=t=>e.$emit('asset'))},[(0,r.createElementVNode)('div',dp,[(0,r.createVNode)(v,{name:'edit',size:20})]),t[7]||(t[7]=(0,r.createElementVNode)('span',{class:'btn-label'},'ASSET',-1))]),(0,r.createElementVNode)('button',{class:'sidebar-btn',onClick:t[2]||(t[2]=t=>e.$emit('variables'))},[(0,r.createElementVNode)('div',up,[(0,r.createVNode)(v,{name:'code',size:20})]),t[8]||(t[8]=(0,r.createElementVNode)('span',{class:'btn-label'},'VAR',-1))]),t[12]||(t[12]=(0,r.createElementVNode)('div',{class:'sidebar-divider'},null,-1)),(0,r.createElementVNode)('button',{class:'sidebar-btn',onClick:t[3]||(t[3]=t=>e.$emit('settings'))},[(0,r.createElementVNode)('div',mp,[(0,r.createVNode)(v,{name:'settings',size:20})]),t[9]||(t[9]=(0,r.createElementVNode)('span',{class:'btn-label'},'SET',-1))]),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['sidebar-btn',{'has-errors':a.value}]),onClick:t[4]||(t[4]=t=>e.$emit('errorlog'))},[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['btn-icon-wrapper',{'error-bg':a.value}])},[(0,r.createVNode)(v,{name:'alert',size:20}),e.errorCount>0?((0,r.openBlock)(),(0,r.createElementBlock)('span',pp,(0,r.toDisplayString)(e.errorCount>99?'99+':e.errorCount),1)):(0,r.createCommentVNode)('v-if',!0)],2),t[10]||(t[10]=(0,r.createElementVNode)('span',{class:'btn-label'},'ERROR',-1))],2),t[13]||(t[13]=(0,r.createElementVNode)('div',{class:'sidebar-divider'},null,-1)),(0,r.createElementVNode)('button',{class:'sidebar-btn danger',onClick:t[5]||(t[5]=t=>e.$emit('exit'))},[(0,r.createElementVNode)('div',vp,[(0,r.createVNode)(v,{name:'home',size:20})]),t[11]||(t[11]=(0,r.createElementVNode)('span',{class:'btn-label'},'HOME',-1))])])],34))}}),fp=(0,y.A)(gp,[['__scopeId','data-v-3a4a3550']]),yp={class:'perf-text'},hp=(0,r.defineComponent)({__name:'PerformanceOverlay',props:{text:{},effect:{},textSpeedMs:{},skipMode:{type:Boolean}},emits:['done'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(!1),l=(0,r.ref)('');let i=null;const c=(0,r.computed)(()=>{const e=a.effect||'plain';return'rise'===e?'effect-rise':'retype-typo'===e?'effect-retype':'effect-plain'}),s=()=>{i&&(clearInterval(i),i=null)},d=()=>{s(),o.value=!1,setTimeout(()=>{n('done')},1200)};(0,r.watch)(()=>[a.text,a.effect,a.textSpeedMs,a.skipMode],()=>(()=>{s();const e=String(a.text??'');if(a.skipMode||(a.textSpeedMs??30)<=0)return l.value=e,void d();l.value='',o.value=!0;const t=Math.max(a.textSpeedMs??30,16);let n=0;i=setInterval(()=>{if(n<e.length)return l.value+=e[n],void n++;d()},t)})(),{immediate:!0}),(0,r.onUnmounted)(()=>s());const u=()=>{if(o.value)return l.value=String(a.text??''),void d();n('done')};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'perf-overlay',onClick:(0,r.withModifiers)(u,['stop'])},[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['perf-panel',c.value])},[(0,r.createElementVNode)('div',yp,(0,r.toDisplayString)(l.value),1),(0,r.createCommentVNode)(' <div class="perf-hint" v-if="!isTyping">(ÁÇπÂáªÁªßÁª≠)</div> ')],2)]))}}),kp=(0,y.A)(hp,[['__scopeId','data-v-0bf7f76c']]),Np='mycard_input_history';const Ep={key:0,class:'orb-icon'},Vp={class:'panel-header'},bp={class:'textarea-wrapper'},wp={class:'btn-group'},Cp={key:0,class:'history-list'},Sp={key:0,class:'history-empty'},Bp=['onClick'],xp={class:'history-time'},_p={class:'history-content'},Ip=['onClick'],Tp=(0,r.defineComponent)({__name:'QuickInput',setup(e){const{isExpanded:t,inputText:a,showHistory:n,isSending:o,inputHistory:l,toggle:i,toggleHistory:c,send:s,useHistoryItem:d,deleteHistoryItem:u}=function(){const e=(0,r.ref)(!1),t=(0,r.ref)(''),a=(0,r.ref)(!1),n=(0,r.ref)(!1),o=(0,r.reactive)([]),l=async()=>{try{const e=await se(Np);if(Array.isArray(e))return o.splice(0,o.length,...e),void console.log(`[useQuickInput] Â∑≤Âä†ËΩΩ ${o.length} Êù°ÂéÜÂè≤ËÆ∞ÂΩï`)}catch{}try{const e=localStorage.getItem(Np);if(e){const t=JSON.parse(e);Array.isArray(t)&&(o.splice(0,o.length,...t),await de(Np,t)),localStorage.removeItem(Np),console.log(`[useQuickInput] Â∑≤ËøÅÁßªÂπ∂Âä†ËΩΩ ${o.length} Êù°ÂéÜÂè≤ËÆ∞ÂΩï`)}}catch(e){console.error('[useQuickInput] Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩïÂ§±Ë¥•:',e),o.splice(0,o.length)}},i=()=>{try{ue(Np,[...o],200)}catch(e){console.error('[useQuickInput] ‰øùÂ≠òÂéÜÂè≤ËÆ∞ÂΩïÂ§±Ë¥•:',e)}},c=e=>{const t=(new Date).toLocaleString('zh-CN',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});o.unshift({id:Date.now(),content:e,timestamp:t}),o.length>50&&o.splice(50),i()},s=async e=>{if(e&&e.trim())try{console.log('[useQuickInput] ÂáÜÂ§áÂèëÈÄÅ:',e);try{const e=await ca('ÂêåÊ¢¶');await Lt(e),console.log('[useQuickInput] ÂÅèÁßªÂ∫¶ÊèêÁ§∫ËØçÂ∑≤Êõ¥Êñ∞')}catch(e){console.warn('[useQuickInput] Êõ¥Êñ∞ÂÅèÁßªÂ∫¶ÊèêÁ§∫ËØçÂ§±Ë¥•:',e)}const t=(()=>{try{return sessionStorage.getItem('last_final_text')||''}catch{return''}})(),a=6e3,n=t.length>a?t.slice(-a):t,o='\n<ËæìÂá∫Ê†ºÂºèË¶ÅÊ±Ç>\nÂøÖÈ°ª‰∏•Ê†ºÊåâÈ°∫Â∫èËæìÂá∫‰ª•‰∏ãÊ†áÁ≠æÔºå‰∏îÊ†áÁ≠æÂøÖÈ°ªÊàêÂØπÂÆåÊï¥Ôºö\n<think>...</think><content>...</content><Â∞èÊÄªÁªì>...</Â∞èÊÄªÁªì>\nÂèØÈÄâÔºö<Â§ßÊÄªÁªì>...</Â§ßÊÄªÁªì>\nËßÑÂàôÔºöÁ¨¨‰∏Ä‰∏™Ê†áÁ≠æ‰∏ÄÂÆöÊòØ <think>Ôºõ</think> ÂøÖÈ°ªÁ¥ßË¥¥ <content> ÂâçÔºõ</content> ÂøÖÈ°ªÁ¥ßË¥¥ <Â∞èÊÄªÁªì> Ââç„ÄÇ\nÊ≥®ÊÑèÔºö<think>...</think> ÂÜÖ‰∏çÂæóÂá∫Áé∞ <content>/<Â∞èÊÄªÁªì>/<Â§ßÊÄªÁªì> Á≠âÊ†áÁ≠æ„ÄÇ\n</ËæìÂá∫Ê†ºÂºèË¶ÅÊ±Ç>\n',l='auto_big_summary_need_big',r=await(async()=>{try{const e=await ye(),t=Boolean(e?.autoBigSummaryEnabled),a='1'===(sessionStorage.getItem(l)||'');return t&&a}catch{return!1}})()?'\n<Ëá™Âä®Â§ßÊÄªÁªìÊèêÁ§∫>\nÁé∞Âú®ÈúÄË¶ÅËæìÂá∫‰∏ÄÊ¨°Â§ßÊÄªÁªìÔºöËØ∑Âú®Êú¨Ê¨°ÂõûÂ§ç‰∏≠È¢ùÂ§ñËæìÂá∫‰∏ÄÊÆµ <Â§ßÊÄªÁªì>...</Â§ßÊÄªÁªì>ÔºåÊÄªÁªìÊà™Ëá≥ÁõÆÂâçÁöÑÊï¥‰ΩìÂâßÊÉÖ‰∏éÂÖ≥ÈîÆÁä∂ÊÄÅÂèòÊõ¥„ÄÇ\nÂπ∂‰øùÊåÅÊ†áÁ≠æÈ°∫Â∫è‰∏éÁõ∏ÈÇªËßÑÂàô‰∏çÂèòÔºà</content>ÂêéÁ¥ßË¥¥<Â∞èÊÄªÁªì>Ôºå<Â§ßÊÄªÁªì>ÂèØÊîæÂú®<Â∞èÊÄªÁªì>‰πãÂêéÔºâ„ÄÇ\n</Ëá™Âä®Â§ßÊÄªÁªìÊèêÁ§∫>\n':'',i=n?`\n<ÂâçÊñá(‰∏ä‰∏ÄËΩÆÂÆåÊï¥ËæìÂá∫)>\n${n}\n</ÂâçÊñá(‰∏ä‰∏ÄËΩÆÂÆåÊï¥ËæìÂá∫)>\n`:'',c={injects:[...i?[{role:'system',content:o+r+i,position:'in_chat',depth:0,should_scan:!0}]:[{role:'system',content:o+r,position:'in_chat',depth:0,should_scan:!0}],{role:'user',content:`<Ë°åÂä®ÈÄâÊã©>\n${e}\n</Ë°åÂä®ÈÄâÊã©>`,position:'in_chat',depth:0,should_scan:!0}],should_stream:!0};console.log('[useQuickInput] GenerateConfig:',c),await TavernHelper.generate(c),console.log('[useQuickInput] ÂèëÈÄÅÂÆåÊàê')}catch(e){throw console.error('[useQuickInput] ÂèëÈÄÅÂ§±Ë¥•:',e),e}else console.warn('[useQuickInput] ÂèëÈÄÅÂÜÖÂÆπ‰∏∫Á©∫')};return l(),{isExpanded:e,inputText:t,showHistory:a,isSending:n,inputHistory:o,toggle:()=>{e.value=!e.value,e.value||(a.value=!1)},toggleHistory:()=>{a.value=!a.value},send:async o=>{const l=t.value.trim();if(l){console.log('[useQuickInput] ÂèëÈÄÅÂÜÖÂÆπ:',l),n.value=!0;try{c(l),o?await o(l):await s(l),t.value='',e.value=!1,a.value=!1}catch(e){throw console.error('[useQuickInput] ÂèëÈÄÅÂ§±Ë¥•:',e),e}finally{n.value=!1}}else console.warn('[useQuickInput] ÂèëÈÄÅÂÜÖÂÆπ‰∏∫Á©∫')},executeQuickSend:s,clear:()=>{t.value=''},addToHistory:c,useHistoryItem:e=>{const n=o.find(t=>t.id===e);n&&(t.value=n.content,a.value=!1)},deleteHistoryItem:e=>{const t=o.findIndex(t=>t.id===e);t>-1&&(o.splice(t,1),i())},clearHistory:()=>{o.splice(0,o.length),i()},loadHistory:l}}(),m=(0,r.ref)(null),p=(0,r.ref)(null);let v=null;const g=(0,r.ref)(!1),f=(0,r.ref)(!1),y=(0,r.ref)(!1),h=(0,r.ref)(0),k=(0,r.ref)(0),N=(0,r.ref)(0),E=(0,r.ref)(0);let V=null,b=null,w=!1;const C=()=>{p.value&&(p.value.style.height='auto',p.value.style.height=Math.min(p.value.scrollHeight,280)+'px')};function S(e){if(!e.style.left||'auto'===e.style.left){const t=e.getBoundingClientRect();e.style.left=t.left+'px',e.style.top=t.top+'px',e.style.right='auto',e.style.bottom='auto'}}function B(e){if('mouse'===e.pointerType&&0!==e.button)return;const a=m.value;if(a&&(V=e.pointerId,b=e.pointerType,!t.value)){S(a),g.value=!0,f.value=!1,h.value=e.clientX,k.value=e.clientY,N.value=e.clientX-a.offsetLeft,E.value=e.clientY-a.offsetTop;try{a.setPointerCapture(e.pointerId)}catch{}document.addEventListener('pointermove',I,{passive:!1}),document.addEventListener('pointerup',T),document.addEventListener('pointercancel',T)}}function x(e){if('mouse'===e.pointerType&&0!==e.button)return;if(!t.value)return;const a=m.value;if(a){V=e.pointerId,b=e.pointerType,S(a),y.value=!0,f.value=!1,h.value=e.clientX,k.value=e.clientY,N.value=e.clientX-a.offsetLeft,E.value=e.clientY-a.offsetTop;try{a.setPointerCapture(e.pointerId)}catch{}document.addEventListener('pointermove',I,{passive:!1}),document.addEventListener('pointerup',T),document.addEventListener('pointercancel',T),e.preventDefault()}}function I(e){if(!g.value&&!y.value)return;if(null!=V&&e.pointerId!==V)return;const t=m.value;if(!t)return;const a=Math.abs(e.clientX-h.value),n=Math.abs(e.clientY-k.value);(a>5||n>5)&&(f.value=!0);let o=e.clientX-N.value,l=e.clientY-E.value;const r=window.innerWidth-t.offsetWidth,i=window.innerHeight-t.offsetHeight;o=Math.max(0,Math.min(o,r)),l=Math.max(0,Math.min(l,i)),t.style.left=o+'px',t.style.top=l+'px',t.style.right='auto',t.style.bottom='auto','touch'===b&&e.preventDefault()}function T(e){if(null!=V&&e.pointerId!==V)return;const a=m.value,n=(g.value||y.value,f.value);g.value=!1,y.value=!1,V=null,b=null,document.removeEventListener('pointermove',I),document.removeEventListener('pointerup',T),document.removeEventListener('pointercancel',T),n||t.value||(a&&S(a),w=!0,window.setTimeout(()=>{w=!1},0),i())}function A(){if(w)return;if(t.value)return;const e=m.value;e&&(S(e),i())}return(0,r.watch)(t,e=>{if(e)v||(v=function(){const e=document.documentElement,t=document.body,a=document.scrollingElement||e,n='number'==typeof window.scrollY?window.scrollY:a.scrollTop,o='number'==typeof window.scrollX?window.scrollX:a.scrollLeft,l={docOverflow:e.style.overflow,docOverscroll:e.style.overscrollBehavior,bodyOverflow:t.style.overflow,bodyPosition:t.style.position,bodyTop:t.style.top,bodyLeft:t.style.left,bodyRight:t.style.right,bodyWidth:t.style.width};return e.style.overflow='hidden',e.style.overscrollBehavior='none',t.style.overflow='hidden',t.style.position='fixed',t.style.top=`-${n}px`,t.style.left=`-${o}px`,t.style.right='0',t.style.width='100%',()=>{e.style.overflow=l.docOverflow,e.style.overscrollBehavior=l.docOverscroll,t.style.overflow=l.bodyOverflow,t.style.position=l.bodyPosition,t.style.top=l.bodyTop,t.style.left=l.bodyLeft,t.style.right=l.bodyRight,t.style.width=l.bodyWidth;try{window.scrollTo(o,n)}catch{}}}()),(0,r.nextTick)(()=>{try{p.value?.focus?.({preventScroll:!0})}catch{p.value?.focus()}C()});else if(v){const e=v;v=null,e()}}),(0,r.onMounted)(()=>{}),(0,r.onUnmounted)(()=>{if(document.removeEventListener('pointermove',I),document.removeEventListener('pointerup',T),document.removeEventListener('pointercancel',T),v){const e=v;v=null,e()}}),(e,v)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['quick-input-orb',{expanded:(0,r.unref)(t),dragging:g.value}]),ref_key:'orbRef',ref:m,onPointerdown:B,onClick:A},[(0,r.createCommentVNode)(' Êî∂Ëµ∑Áä∂ÊÄÅÊòæÁ§∫ÁöÑÂõæÊ†á '),(0,r.unref)(t)?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',Ep,'‚úé')),(0,r.createCommentVNode)(' Â±ïÂºÄÁöÑËæìÂÖ•Èù¢Êùø '),(0,r.createVNode)(r.Transition,{name:'quick-input-panel',persisted:''},{default:(0,r.withCtx)(()=>[(0,r.withDirectives)((0,r.createElementVNode)('div',{class:'input-panel',onClick:v[6]||(v[6]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.createElementVNode)('div',Vp,[(0,r.createElementVNode)('div',{class:'panel-title panel-drag-handle',onPointerdown:(0,r.withModifiers)(x,['stop'])},'Quick Input',32),(0,r.createElementVNode)('button',{type:'button',class:'panel-close','aria-label':'Close Quick Input',onPointerdown:v[0]||(v[0]=(0,r.withModifiers)(()=>{},['stop'])),onClick:v[1]||(v[1]=(0,r.withModifiers)((...e)=>(0,r.unref)(i)&&(0,r.unref)(i)(...e),['stop']))},' ‚úï ',32)]),(0,r.createElementVNode)('div',bp,[(0,r.withDirectives)((0,r.createElementVNode)('textarea',{ref_key:'textareaRef',ref:p,'onUpdate:modelValue':v[2]||(v[2]=e=>(0,r.isRef)(a)?a.value=e:null),placeholder:'ËæìÂÖ•‰Ω†ÁöÑË°åÂä®...',onInput:C,onKeydown:v[3]||(v[3]=(0,r.withKeys)((0,r.withModifiers)(e=>(0,r.unref)(s)(),['ctrl']),['enter']))},null,544),[[r.vModelText,(0,r.unref)(a)]])]),(0,r.createElementVNode)('div',wp,[(0,r.createElementVNode)('div',{class:'orb-btn',onClick:v[4]||(v[4]=(0,r.withModifiers)((...e)=>(0,r.unref)(c)&&(0,r.unref)(c)(...e),['stop']))},(0,r.toDisplayString)((0,r.unref)(n)?'Hide':'History'),1),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['orb-btn primary',{disabled:(0,r.unref)(o)}]),onClick:v[5]||(v[5]=(0,r.withModifiers)(e=>(0,r.unref)(s)(),['stop']))},(0,r.toDisplayString)((0,r.unref)(o)?'Sending...':'Send'),3)]),(0,r.createCommentVNode)(' ÂéÜÂè≤ËÆ∞ÂΩïÂàóË°® '),(0,r.unref)(n)?((0,r.openBlock)(),(0,r.createElementBlock)('div',Cp,[0===(0,r.unref)(l).length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Sp,'ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï')):(0,r.createCommentVNode)('v-if',!0),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(l),e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'history-item',onClick:(0,r.withModifiers)(t=>(0,r.unref)(d)(e.id),['stop'])},[(0,r.createElementVNode)('div',xp,(0,r.toDisplayString)(e.timestamp),1),(0,r.createElementVNode)('div',_p,(0,r.toDisplayString)(e.content),1),(0,r.createElementVNode)('div',{class:'history-delete',onClick:(0,r.withModifiers)(t=>(0,r.unref)(u)(e.id),['stop'])},'‚úï',8,Ip)],8,Bp))),128))])):(0,r.createCommentVNode)('v-if',!0)],512),[[r.vShow,(0,r.unref)(t)]])]),_:1})],34))}}),Ap=(0,y.A)(Tp,[['__scopeId','data-v-6193fdd3']]),Dp={class:'widgets-header-row'},Mp={class:'widgets-container'},Pp={key:0,class:'empty-state'},Op={key:1,class:'missing-state'},Rp=(0,r.defineComponent)({__name:'RightSidebar',props:{settings:{},forceOpen:{type:Boolean,default:!1},gameState:{}},setup(e){const t=e,a=(0,r.computed)(()=>t.settings?.enabledSidebarWidgets||[]),n=e=>(0,ya.WC)(e),o=e=>{const t=n(e),a=t?.code??t?.vueCode??t?.jsCode??t?.sourceCode;return'string'==typeof a&&a.trim()?a:null},l=e=>{const t=n(e),a=t?.cssCode??t?.css??'';return'string'==typeof a?a:''},i=(0,r.ref)(0),c=(0,r.ref)(!1),s=(0,r.ref)(320),d=(0,r.ref)(null),u=(0,r.ref)(null),m=(0,r.ref)(!1),p=(0,r.computed)(()=>!!t.forceOpen||m.value);let v=null;const g=()=>{i.value++,k()},f=()=>window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,y=e=>{t.forceOpen||'mouse'!==e.pointerType&&(m.value=!m.value)},h=()=>{const e=d.value;if(!e)return;const t=Math.ceil(e.scrollWidth||e.getBoundingClientRect().width);if(t>0){const e=Math.floor(.9*window.innerWidth);s.value=Math.min(t+2,e)}},k=async()=>{c.value=!0,await(0,r.nextTick)(),h(),c.value=!1};let N=null,E=null,V=null,b=0,w=0;return(0,r.onMounted)(()=>{k(),N=e=>{if(!p.value)return;if(t.forceOpen)return;if(!m.value)return;const a=u.value,n=e.target;a&&n&&a.contains(n)||(m.value=!1)},E=e=>{if(t.forceOpen)return;if(p.value&&m.value){const t=u.value,a=e.target;if(t&&a&&!t.contains(a))return void(m.value=!1)}if(!f())return;if(p.value)return;const a=e.touches[0];a&&(b=a.clientX,w=a.clientY)},V=e=>{if(!f())return;if(t.forceOpen)return;if(p.value)return;const a=e.changedTouches[0];if(!a)return;if(b<window.innerWidth-28)return;const n=a.clientX-b,o=a.clientY-w;Math.abs(n)<40||Math.abs(n)<Math.abs(o)||n<0&&(m.value=!0)},document.addEventListener('pointerdown',N,!0),document.addEventListener('touchstart',E,{passive:!0}),document.addEventListener('touchend',V,{passive:!0}),d.value&&(v=new ResizeObserver(()=>{const e=d.value;if(e){const t=Math.ceil(e.scrollWidth||e.getBoundingClientRect().width);if(t>0){const e=Math.floor(.9*window.innerWidth);s.value=Math.min(t+2,e)}}}),v.observe(d.value)),window.addEventListener('resize',h)}),(0,r.onBeforeUnmount)(()=>{v&&(v.disconnect(),v=null),N&&(document.removeEventListener('pointerdown',N,!0),N=null),E&&(document.removeEventListener('touchstart',E),E=null),V&&(document.removeEventListener('touchend',V),V=null),window.removeEventListener('resize',h)}),(0,r.watch)(a,()=>{k()}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{ref_key:'rootRef',ref:u,class:(0,r.normalizeClass)(['right-sidebar',{open:p.value,measuring:c.value}]),style:(0,r.normalizeStyle)({'--open-width':s.value+'px'})},[e.forceOpen?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'trigger-area',onPointerdown:(0,r.withModifiers)(y,['stop','prevent'])},null,32)),(0,r.createElementVNode)('div',{ref_key:'panelEl',ref:d,class:'widgets-panel'},[(0,r.createElementVNode)('div',Dp,[t[0]||(t[0]=(0,r.createElementVNode)('div',{class:'widgets-header-title'},'SIDEBAR',-1)),(0,r.createElementVNode)('button',{class:'refresh-btn',type:'button',onClick:(0,r.withModifiers)(g,['stop'])},'Âà∑Êñ∞')]),(0,r.createElementVNode)('div',Mp,[0===a.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Pp,'Êú™ÂêØÁî®ÁªÑ‰ª∂')):(0,r.createCommentVNode)('v-if',!0),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.value,t=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:'widget-host'},[o(t)?((0,r.openBlock)(),(0,r.createBlock)(go,{key:t+':'+i.value,'user-code':o(t),'user-css':l(t),'component-id':t,'game-state':e.gameState,onLoaded:k,onError:k},null,8,['user-code','user-css','component-id','game-state'])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Op,'ÁªÑ‰ª∂‰∏çÂ≠òÂú®Êàñ‰ª£Á†Å‰∏∫Á©∫Ôºö'+(0,r.toDisplayString)(t),1))]))),128))])],512)],6))}}),$p=(0,y.A)(Rp,[['__scopeId','data-v-c5ebd980']]),Lp={class:'saveload-container',role:'dialog','aria-modal':'true'},Up={class:'header'},zp={class:'header-left'},Fp={class:'page-title'},Wp={key:0,class:'mode-switch'},jp={class:'header-actions'},Gp={class:'saves-container'},Jp={key:0,class:'loading-state'},Yp={class:'system-saves'},Hp={class:'save-thumbnail'},Xp=['src'],Kp={key:1,class:'placeholder-thumb'},Qp={class:'save-info'},qp={class:'save-header'},Zp={class:'save-chapter'},ev={key:0,class:'save-date'},tv={class:'save-summary'},av={key:0,class:'save-firstline'},nv={class:'save-actions'},ov=['onClick'],lv={class:'slots-col',role:'list'},rv=['onClick'],iv={class:'save-thumbnail'},cv=['src'],sv={key:1,class:'placeholder-thumb'},dv={class:'slot-index-badge'},uv={class:'save-info'},mv={class:'save-header'},pv={class:'save-chapter'},vv={key:0,class:'save-date'},gv={class:'save-summary'},fv={key:0,class:'save-firstline'},yv={class:'save-actions'},hv=['title','onClick'],kv=['onClick'],Nv=['onClick'],Ev={class:'save-thumbnail'},Vv=['src'],bv={key:1,class:'placeholder-thumb'},wv={class:'save-info'},Cv={class:'save-header'},Sv={class:'save-chapter'},Bv={class:'save-date'},xv={class:'save-summary'},_v={key:0,class:'save-firstline'},Iv={class:'save-actions'},Tv=['onClick'],Av=['onClick'],Dv=['onClick'],Mv={class:'no-saves'},Pv={class:'rename-header'},Ov={class:'rename-desc'},Rv=['onKeydown'],$v=(0,r.defineComponent)({__name:'SaveLoadModal',props:{visible:{type:Boolean},mode:{default:'both'}},emits:['update:visible','close','save','load','delete'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.computed)(()=>'both'===a.mode||'save'===a.mode),l=(0,r.ref)('load'===a.mode?'load':'save'),i=(0,r.ref)([]),c=(0,r.ref)(!1),s=(0,r.computed)(()=>i.value.filter(e=>'manual'===e.slotType).sort((e,t)=>t.timestamp-e.timestamp).slice(0,7)),d=(0,r.computed)(()=>{const e=[];for(let t=0;t<7;t++)e.push(s.value[t]||null);return e}),u=(0,r.computed)(()=>[...i.value].sort((e,t)=>t.timestamp-e.timestamp)),m=(0,r.computed)(()=>[{key:'cloud',slotType:'cloud',fallbackTitle:'‰∫ëÂ≠òÊ°£',save:i.value.find(e=>'cloud'===e.slotType||'cloud'===e.id)||null},{key:'auto1',slotType:'auto',autoIndex:1,fallbackTitle:'Ëá™Âä®Â≠òÊ°£ 1',save:i.value.find(e=>'auto'===e.slotType&&(1===e.autoIndex||'auto_1'===e.id))||null},{key:'auto2',slotType:'auto',autoIndex:2,fallbackTitle:'Ëá™Âä®Â≠òÊ°£ 2',save:i.value.find(e=>'auto'===e.slotType&&(2===e.autoIndex||'auto_2'===e.id))||null}]),p=e=>{if(!e)return'';const t='string'==typeof e.firstLine?e.firstLine.trim():'';if(t)return t;const a=e=>{if(!e||'object'!=typeof e)return'';if('performance'===e.kind)return'';const t=[e.text,e.content,e.message,e.rawText,e.raw];for(const e of t){const t='string'==typeof e?e.trim():'';if(t)return t.slice(0,120)}return''},n=e=>{if(!Array.isArray(e))return'';for(const t of e){const e=a(t);if(e)return e}return''},o=e?.sessionData;return n(o?.dialogueQueue)||n(o?.historyLog)||n(e?.historyLog)||''},g=(0,r.ref)(!1),f=(0,r.ref)(''),y=(0,r.ref)('new'),h=(0,r.ref)(0),k=(0,r.ref)(void 0),E=(0,r.ref)(!1),V=(0,r.ref)(null),b=(0,r.ref)(!1),w=(0,r.ref)(''),C=(0,r.ref)('info');function B(e,t='info'){w.value=e,C.value=t,b.value=!0}async function x(){c.value=!0;try{await Le(),i.value=await re.idbService.getAllSaves()}catch(e){console.error('[SaveLoadModal] Failed to load saves:',e),i.value=[]}finally{c.value=!1}}function I(e,t,a){y.value=e,h.value=a,k.value=t?.id;const n=t?.title||`ÊâãÂä®Â≠òÊ°£ ${a+1}`;f.value=n,g.value=!0}function T(){g.value=!1}function A(){const e=f.value.trim();if(!e)return void B('ËØ∑ËæìÂÖ•Â≠òÊ°£Ê†áÈ¢ò','warning');const t='overwrite'===y.value?k.value:void 0;n('save',t,e),g.value=!1}function D(e){V.value=e,E.value=!0}async function M(){const e=V.value;if(V.value=null,e)try{await re.idbService.deleteSave(e),await x(),n('delete',e),B('Â≠òÊ°£Â∑≤Âà†Èô§','success')}catch(e){console.error('[SaveLoadModal] Failed to delete save:',e),B('Âà†Èô§Â§±Ë¥•','error')}}function P(e){return new Date(e).toLocaleString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})}(0,r.watch)(()=>a.visible,async e=>{e?(await x(),l.value='load'===a.mode?'load':'save'):(g.value=!1,E.value=!1,V.value=null,b.value=!1)}),(0,r.onMounted)(async()=>{a.visible&&await x()});const O=(e,t)=>'auto'===e?`AUTO${t||''}`:'cloud'===e?'CLOUD':'MANUAL',R=e=>'auto'===e?'badge-auto':'cloud'===e?'badge-cloud':'badge-manual';function L(){g.value=!1,E.value=!1,V.value=null,b.value=!1,n('update:visible',!1),n('close')}async function U(e){try{const t=await async function(e){const t=JSON.stringify(e,null,2);return new Blob([t],{type:'application/json'})}(e),a=URL.createObjectURL(t),n=document.createElement('a');n.href=a,n.download=`save_${e.id}_${Date.now()}.json`,n.click(),URL.revokeObjectURL(a),B('ÂØºÂá∫ÊàêÂäü','success')}catch(e){console.error('[SaveLoadModal] Failed to export:',e),B('ÂØºÂá∫Â§±Ë¥•','error')}}function F(){const e=document.createElement('input');e.type='file',e.accept='.json',e.onchange=async e=>{const t=e.target.files?.[0];if(t)try{B('Ê≠£Âú®ÂØºÂÖ•...','loading');const e=await t.text();await async function(e){const t=JSON.parse(e);return t.id=`imported_${Date.now()}`,t.slotType='manual',delete t.autoIndex,t.isCloud=!1,t.timestamp=Date.now(),await re.idbService.saveSave(t),t}(e),await x(),B('ÂØºÂÖ•ÊàêÂäü','success')}catch(e){console.error('[SaveLoadModal] Failed to import:',e),B('ÂØºÂÖ•Â§±Ë¥•','error')}},e.click()}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createVNode)(r.Transition,{name:'fade-scale'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'saveload-overlay',onClick:(0,r.withModifiers)(L,['self'])},[(0,r.createElementVNode)('div',Lp,[(0,r.createCommentVNode)(' Header (LoadGame-like) '),(0,r.createElementVNode)('div',Up,[(0,r.createElementVNode)('div',zp,[(0,r.createElementVNode)('h2',Fp,(0,r.toDisplayString)(o.value?'ËÆ∞ÂøÜÂõûÊ∫Ø':'ËØªÊ°£'),1),o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Wp,[(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['mode-btn',{active:'save'===l.value}]),onClick:t[0]||(t[0]=e=>l.value='save')},' Â≠òÊ°£ ',2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['mode-btn',{active:'load'===l.value}]),onClick:t[1]||(t[1]=e=>l.value='load')},' ËØªÊ°£ ',2)])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',jp,[(0,r.createElementVNode)('button',{class:'import-btn',onClick:F},[(0,r.createVNode)(v,{name:'import',size:16}),t[6]||(t[6]=(0,r.createElementVNode)('span',null,'ÂØºÂÖ•Â≠òÊ°£',-1))]),(0,r.createElementVNode)('button',{class:'close-x',onClick:L,'aria-label':'Close'},'‚úï')])]),(0,r.createCommentVNode)(' Save Slots Panel (LoadGame-like) '),(0,r.createVNode)(N,{class:'saves-panel',fullHeight:!0},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',Gp,[(0,r.createCommentVNode)(' Loading State '),c.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Jp,[...t[7]||(t[7]=[(0,r.createElementVNode)('div',{class:'loading-spinner'},null,-1),(0,r.createElementVNode)('p',null,'Âä†ËΩΩ‰∏≠...',-1)])])):'save'===l.value&&o.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Save Slots Column (7 manual slots) '),(0,r.createElementVNode)('div',Yp,[t[9]||(t[9]=(0,r.createElementVNode)('div',{class:'section-title'},'Ëá™Âä® / ‰∫ëÂ≠òÊ°£ÔºàÂè™ËØªÔºâ',-1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(m.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.key,class:'save-item system-save',onClick:t[2]||(t[2]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.createElementVNode)('div',Hp,[e.save&&(e.save.screenshot||e.save.thumbnail)?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.save.screenshot||e.save.thumbnail,alt:'Save'},null,8,Xp)):((0,r.openBlock)(),(0,r.createElementBlock)('div',Kp,[(0,r.createVNode)(v,{name:'image',size:32})])),t[8]||(t[8]=(0,r.createElementVNode)('div',{class:'thumbnail-overlay'},null,-1)),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['slot-badge',R(e.slotType)])},(0,r.toDisplayString)(O(e.slotType,e.autoIndex)),3)]),(0,r.createElementVNode)('div',Qp,[(0,r.createElementVNode)('div',qp,[(0,r.createElementVNode)('h3',Zp,(0,r.toDisplayString)(e.save?.title||e.fallbackTitle),1),e.save?((0,r.openBlock)(),(0,r.createElementBlock)('span',ev,(0,r.toDisplayString)(P(e.save.timestamp)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('p',tv,(0,r.toDisplayString)(e.save?.eventPackName||'ÊöÇÊó†Â≠òÊ°£'),1),p(e.save)?((0,r.openBlock)(),(0,r.createElementBlock)('p',av,(0,r.toDisplayString)(p(e.save)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',nv,[e.save?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn export-btn',title:'Export',onClick:(0,r.withModifiers)(t=>U(e.save),['stop'])},[(0,r.createVNode)(v,{name:'export',size:18})],8,ov)):(0,r.createCommentVNode)('v-if',!0)])]))),128))]),t[12]||(t[12]=(0,r.createElementVNode)('div',{class:'section-title'},'ÊâãÂä®Â≠òÊ°£',-1)),(0,r.createElementVNode)('div',lv,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(d.value,(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:`slot-${a}`,class:(0,r.normalizeClass)(['save-item save-slot',{empty:!e}]),role:'listitem',onClick:t=>e?I('overwrite',e,a):I('new',null,a)},[(0,r.createElementVNode)('div',iv,[e&&(e.screenshot||e.thumbnail)?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.screenshot||e.thumbnail,alt:'Save'},null,8,cv)):((0,r.openBlock)(),(0,r.createElementBlock)('div',sv,[(0,r.createVNode)(v,{name:'plus',size:32})])),t[10]||(t[10]=(0,r.createElementVNode)('div',{class:'thumbnail-overlay'},null,-1)),t[11]||(t[11]=(0,r.createElementVNode)('div',{class:'slot-badge badge-manual'},'MANUAL',-1)),(0,r.createElementVNode)('div',dv,(0,r.toDisplayString)(a+1),1)]),(0,r.createElementVNode)('div',uv,[(0,r.createElementVNode)('div',mv,[(0,r.createElementVNode)('h3',pv,(0,r.toDisplayString)(e?.title||`Á©∫‰Ωç ${a+1}`),1),e?((0,r.openBlock)(),(0,r.createElementBlock)('span',vv,(0,r.toDisplayString)(P(e.timestamp)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('p',gv,(0,r.toDisplayString)(e?.eventPackName||'ÁÇπÂáª‰øùÂ≠òËøõÂ∫¶'),1),p(e)?((0,r.openBlock)(),(0,r.createElementBlock)('p',fv,(0,r.toDisplayString)(p(e)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',yv,[(0,r.createElementVNode)('button',{class:'action-btn overwrite-btn',title:e?'ÊîπÂêç / Ë¶ÜÁõñ':'Êñ∞Âª∫Â≠òÊ°£',onClick:(0,r.withModifiers)(t=>e?I('overwrite',e,a):I('new',null,a),['stop'])},[(0,r.createVNode)(v,{name:'save',size:18})],8,hv),e?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn export-btn',title:'Export',onClick:(0,r.withModifiers)(t=>U(e),['stop'])},[(0,r.createVNode)(v,{name:'export',size:18})],8,kv)):(0,r.createCommentVNode)('v-if',!0),e?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'action-btn delete-btn',title:'Delete',onClick:(0,r.withModifiers)(t=>D(e.id),['stop'])},[(0,r.createVNode)(v,{name:'trash',size:18})],8,Nv)):(0,r.createCommentVNode)('v-if',!0)])],10,rv))),128))])],64)):u.value.length>0?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(' Existing Saves '),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(u.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'save-item'},[(0,r.createElementVNode)('div',Ev,[e.screenshot||e.thumbnail?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.screenshot||e.thumbnail,alt:'Save'},null,8,Vv)):((0,r.openBlock)(),(0,r.createElementBlock)('div',bv,[(0,r.createVNode)(v,{name:'image',size:32})])),t[13]||(t[13]=(0,r.createElementVNode)('div',{class:'thumbnail-overlay'},null,-1)),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['slot-badge',R(e.slotType)])},(0,r.toDisplayString)(O(e.slotType,e.autoIndex)),3)]),(0,r.createElementVNode)('div',wv,[(0,r.createElementVNode)('div',Cv,[(0,r.createElementVNode)('h3',Sv,(0,r.toDisplayString)(e.title||'Êú™ÂëΩÂêçÂ≠òÊ°£'),1),(0,r.createElementVNode)('span',Bv,(0,r.toDisplayString)(P(e.timestamp)),1)]),(0,r.createElementVNode)('p',xv,(0,r.toDisplayString)(e.eventPackName||'Êú™Áü•‰∫ã‰ª∂ÂåÖ'),1),p(e)?((0,r.openBlock)(),(0,r.createElementBlock)('p',_v,(0,r.toDisplayString)(p(e)),1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',Iv,['load'===l.value?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn load-btn',title:'Load',onClick:t=>async function(e){n('load',e)}(e)},[(0,r.createVNode)(v,{name:'play',size:20})],8,Tv)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('button',{class:'action-btn export-btn',title:'Export',onClick:t=>U(e)},[(0,r.createVNode)(v,{name:'export',size:18})],8,Av),(0,r.createElementVNode)('button',{class:'action-btn delete-btn',title:'Delete',onClick:t=>D(e.id)},[(0,r.createVNode)(v,{name:'trash',size:18})],8,Dv)])]))),128))],64)):((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:3},[(0,r.createCommentVNode)(' No Saves '),(0,r.createElementVNode)('div',Mv,[(0,r.createVNode)(v,{name:'info',size:48}),t[14]||(t[14]=(0,r.createElementVNode)('p',null,'ÊöÇÊó†Â≠òÊ°£',-1)),t[15]||(t[15]=(0,r.createElementVNode)('span',null,'ÂºÄÂßãÊñ∞Ê∏∏ÊàèÂêéÂèØÂú®Ê≠§ËØªÂèñÂ≠òÊ°£',-1))])],2112))])]),_:1}),(0,r.createCommentVNode)(' Footer '),(0,r.createElementVNode)('div',{class:'footer'},[(0,r.createElementVNode)('button',{class:'btn-secondary',onClick:L},'ÂÖ≥Èó≠')])]),(0,r.createCommentVNode)(' Rename / Save Dialog (TempMessage-like style) '),(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[g.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'rename-overlay',onClick:(0,r.withModifiers)(T,['self'])},[(0,r.createVNode)(N,{class:'rename-box'},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)('div',Pv,[(0,r.createVNode)(v,{name:'save',size:'1.5em',class:'rename-icon'}),(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)('overwrite'===y.value?'Ë¶ÜÁõñÂ≠òÊ°£':'Êñ∞Âª∫Â≠òÊ°£'),1)]),(0,r.createElementVNode)('p',Ov,(0,r.toDisplayString)('overwrite'===y.value?'Â∞ÜË¶ÜÁõñÂΩìÂâçÂ≠òÊ°£ÂÜÖÂÆπÔºàÂèØ‰øÆÊîπÊ†áÈ¢òÔºâ„ÄÇ':'ËØ∑ËæìÂÖ•Â≠òÊ°£Ê†áÈ¢ò„ÄÇ'),1),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[3]||(t[3]=e=>f.value=e),class:'rename-input',type:'text',maxlength:'40',placeholder:'ËæìÂÖ•Â≠òÊ°£Ê†áÈ¢ò',onKeydown:(0,r.withKeys)((0,r.withModifiers)(A,['prevent']),['enter'])},null,40,Rv),[[r.vModelText,f.value]]),(0,r.createElementVNode)('div',{class:'rename-actions'},[(0,r.createElementVNode)('button',{class:'btn-cancel',onClick:T},'ÂèñÊ∂à'),(0,r.createElementVNode)('button',{class:'btn-confirm',onClick:A},'Á°ÆÂÆö')])]),_:1})])):(0,r.createCommentVNode)('v-if',!0)]),_:1})])):(0,r.createCommentVNode)('v-if',!0)]),_:1}),(0,r.createCommentVNode)(' Delete confirm '),(0,r.createVNode)(le,{visible:E.value,'onUpdate:visible':t[4]||(t[4]=e=>E.value=e),title:'Âà†Èô§Â≠òÊ°£',message:'Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Â≠òÊ°£ÂêóÔºüËØ•Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ',onConfirm:M},null,8,['visible']),(0,r.createCommentVNode)(' Temp message '),(0,r.createVNode)(S,{visible:b.value,'onUpdate:visible':t[5]||(t[5]=e=>b.value=e),message:w.value,type:C.value},null,8,['visible','message','type'])],64))}}),Lv=(0,y.A)($v,[['__scopeId','data-v-2470003a']]),Uv='assets';function zv(){const e=(0,r.ref)(!1),t=(0,r.ref)(''),a=()=>new Promise((t,a)=>{const n=indexedDB.open('MhjgDebugDB',2);n.onerror=()=>{console.error('IDB Error',n.error),a(n.error)},n.onsuccess=()=>{e.value=!0,t(n.result)},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(Uv)||t.createObjectStore(Uv)}});return{isReady:e,status:t,saveAsset:async(e,n,o)=>{try{const l=await a(),r=l.transaction(Uv,'readwrite').objectStore(Uv),i=`${e}:${n}`;return await new Promise((e,t)=>{const a=r.put(o,i);a.onsuccess=()=>e(),a.onerror=()=>t(a.error)}),t.value=`Saved ${e}: ${n}`,!0}catch(e){return console.error('Save failed',e),t.value='Save failed',!1}},deleteAsset:async e=>{try{const t=await a(),n=t.transaction(Uv,'readwrite').objectStore(Uv);return await new Promise((t,a)=>{const o=n.delete(e);o.onsuccess=()=>t(),o.onerror=()=>a(o.error)}),!0}catch(e){return console.error('Delete failed',e),!1}},getAllAssets:async e=>{try{const t=await a(),n=t.transaction(Uv,'readonly').objectStore(Uv);return new Promise((t,a)=>{const o=[],l=n.openCursor();l.onsuccess=a=>{const n=a.target.result;if(n){const t=n.key;if(t.includes(':')){const[a,...l]=t.split(':'),r=l.join(':');e&&a!==e||'char'!==a&&'bg'!==a||o.push({key:t,type:a,name:r,data:n.value})}n.continue()}else t(o)},l.onerror=()=>a(l.error)})}catch(e){return console.error('Get All failed',e),[]}},getAsset:async(e,t)=>{try{const n=`${e}:${t}`,o=await a();return new Promise(a=>{const l=o.transaction(Uv,'readonly').objectStore(Uv).get(n);l.onsuccess=()=>{const o=l.result;a(o?{key:n,type:e,name:t,data:o}:null)},l.onerror=()=>a(null)})}catch(e){return null}}}}const Fv={class:'settings-section'},Wv={class:'debug-card highlight-glow'},jv={class:'card-row'},Gv={class:'setting-info'},Jv={class:'flex-row'},Yv={class:'card-header'},Hv={key:0,class:'disabled-hint'},Xv={class:'card-body'},Kv={class:'action-row'},Qv={class:'card-header'},qv={key:0,class:'disabled-hint'},Zv={class:'card-body'},eg={class:'upload-zone'},tg={class:'file-label'},ag=['disabled'],ng={key:0,class:'temp-preview'},og=['src'],lg={class:'assets-grid custom-scrollbar'},rg=['onClick'],ig={class:'asset-img-wrapper'},cg=['src'],sg={class:'asset-info'},dg={class:'asset-name'},ug=['onClick'],mg={class:'card-header'},pg={key:0,class:'disabled-hint'},vg={class:'card-body'},gg={class:'upload-zone'},fg={class:'file-label'},yg=['disabled'],hg={key:0,class:'temp-preview char-mode'},kg=['src'],Ng={class:'assets-grid custom-scrollbar'},Eg=['onClick'],Vg={class:'asset-img-wrapper'},bg=['src'],wg={class:'asset-info'},Cg={class:'asset-name'},Sg=['onClick'],Bg={key:0,class:'status-bar'},xg=(0,r.defineComponent)({__name:'SettingsDebugTab',props:{settings:{}},emits:['debug:text','update:settings'],setup(e,{emit:t}){const a=e,n=t,{saveAsset:o,deleteAsset:l,getAllAssets:i}=zv(),c=()=>{n('update:settings',{...a.settings,debugMode:!a.settings.debugMode})},s=(0,r.ref)(''),d=(0,r.ref)(''),u=(0,r.ref)(''),m=(0,r.ref)(''),p=(0,r.ref)(''),g=(0,r.ref)([]),f=(0,r.ref)([]),y=(0,r.ref)(''),h=(0,r.ref)(''),k=e=>{h.value=e,setTimeout(()=>h.value='',3e3)},N=async()=>{g.value=await i('bg'),f.value=await i('char')};(0,r.onMounted)(async()=>{await N();try{const e=await se('lastDebugText_v1');if('string'==typeof e&&e)return void(s.value=e)}catch{}try{const e=localStorage.getItem('lastDebugText');e&&(s.value=e,await de('lastDebugText_v1',e),localStorage.removeItem('lastDebugText'))}catch{}});const E=()=>{s.value&&(a.settings.debugMode?(de('lastDebugText_v1',s.value),n('debug:text',s.value),k('ÂâßÊÉÖÊñáÊú¨Â∑≤Â∫îÁî®')):k('ËØ∑ÂÖàÂºÄÂêØË∞ÉËØïÊ®°Âºè'))},V=(e,t)=>{const a=e.target.files?.[0];if(!a)return;const n=new FileReader;n.onload=e=>{const a=e.target?.result;'bg'===t?m.value=a:p.value=a},n.readAsDataURL(a)},b=async()=>{d.value&&m.value&&(await o('bg',d.value,m.value),m.value='',d.value='',await N(),k('ËÉåÊôØÂ∑≤‰øùÂ≠ò'))},w=async()=>{u.value&&p.value&&(await o('char',u.value,p.value),p.value='',u.value='',await N(),k('ËßíËâ≤Á´ãÁªòÂ∑≤‰øùÂ≠ò'))},C=async e=>{confirm(`Á°ÆÂÆöÂà†Èô§ ${e.name}?`)&&(await l(e.key),await N(),k('Â∑≤Âà†Èô§'))};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Fv,[t[16]||(t[16]=(0,r.createElementVNode)('div',{class:'section-header'},[(0,r.createElementVNode)('h3',{class:'section-title'},'ÂºÄÂèëËÄÖÂ∑•ÂÖ∑ (Debug)'),(0,r.createElementVNode)('p',{class:'section-desc'},'ÁÆ°ÁêÜÊµãËØïËµÑÊ∫ê„ÄÇÊâÄÊúâÊõ¥Êîπ‰ªÖÂú®Êú¨Âú∞‰øùÂ≠ò (IndexedDB)„ÄÇ')],-1)),(0,r.createCommentVNode)(' Debug Mode Toggle '),(0,r.createElementVNode)('div',Wv,[(0,r.createElementVNode)('div',jv,[(0,r.createElementVNode)('div',Gv,[(0,r.createElementVNode)('div',Jv,[(0,r.createVNode)(v,{name:'settings',size:18}),t[5]||(t[5]=(0,r.createElementVNode)('span',{class:'setting-name'},'Ë∞ÉËØïÊ®°Âºè (Debug Mode)',-1))]),t[6]||(t[6]=(0,r.createElementVNode)('span',{class:'setting-hint'},'ÂºÄÂêØÂêéÂ∫îÁî®Ë∞ÉËØïÂÜÖÂÆπ (Open to apply debug content)',-1))]),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['toggle-switch',{active:a.settings.debugMode}]),onClick:c},[...t[7]||(t[7]=[(0,r.createElementVNode)('div',{class:'toggle-knob'},null,-1)])],2)])]),(0,r.createCommentVNode)(' 1. ÂâßÊÉÖÊñáÊú¨Ë∞ÉËØï '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['debug-card',{disabled:!a.settings.debugMode}])},[(0,r.createElementVNode)('div',Yv,[(0,r.createVNode)(v,{name:'code',class:'card-icon'}),t[8]||(t[8]=(0,r.createElementVNode)('span',{class:'card-title'},'ÂâßÊÉÖÊ®°Êãü (Story Update)',-1)),a.settings.debugMode?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',Hv,'ÈúÄÂºÄÂêØË∞ÉËØïÊ®°Âºè'))]),(0,r.createElementVNode)('div',Xv,[(0,r.withDirectives)((0,r.createElementVNode)('textarea',{class:'debug-textarea','onUpdate:modelValue':t[0]||(t[0]=e=>s.value=e),placeholder:'ËæìÂÖ•ÂâßÊÉÖÊñáÊú¨... (‰æãÂ¶Ç: Alice: Hello!)',rows:'3'},null,512),[[r.vModelText,s.value]]),(0,r.createElementVNode)('div',Kv,[(0,r.createElementVNode)('button',{class:'action-btn',onClick:E},[(0,r.createVNode)(v,{name:'play',size:16}),t[9]||(t[9]=(0,r.createElementVNode)('span',null,'Â∫îÁî®Âπ∂ËøêË°å (Apply & Run)',-1))])])])],2),(0,r.createCommentVNode)(' 2. ËÉåÊôØÁÆ°ÁêÜ '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['debug-card',{disabled:!a.settings.debugMode}])},[(0,r.createElementVNode)('div',Qv,[(0,r.createVNode)(v,{name:'location',class:'card-icon'}),t[10]||(t[10]=(0,r.createElementVNode)('span',{class:'card-title'},'ËÉåÊôØÂ∫ì (Backgrounds)',-1)),a.settings.debugMode?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',qv,'ÈúÄÂºÄÂêØË∞ÉËØïÊ®°Âºè'))]),(0,r.createElementVNode)('div',Zv,[(0,r.createCommentVNode)(' ‰∏ä‰º†Âå∫ '),(0,r.createElementVNode)('div',eg,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[1]||(t[1]=e=>d.value=e),placeholder:'Âú∞ÁÇπÂêçÁß∞ (Â¶Ç: Bedroom)',class:'input-text'},null,512),[[r.vModelText,d.value]]),(0,r.createElementVNode)('label',tg,[t[11]||(t[11]=(0,r.createTextVNode)(' ÈÄâÊã©ÂõæÁâá ',-1)),(0,r.createElementVNode)('input',{type:'file',accept:'image/*',onChange:t[2]||(t[2]=e=>V(e,'bg')),hidden:''},null,32)]),(0,r.createElementVNode)('button',{class:'action-btn small',disabled:!d.value||!m.value,onClick:b},'‰øùÂ≠ò',8,ag)]),(0,r.createCommentVNode)(' È¢ÑËßàÂæÖ‰øùÂ≠òÂõæÁâá '),m.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',ng,[(0,r.createElementVNode)('img',{src:m.value},null,8,og),t[12]||(t[12]=(0,r.createElementVNode)('span',{class:'preview-tag'},'ÂæÖ‰øùÂ≠ò',-1))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' ÂàóË°®Âå∫ '),(0,r.createElementVNode)('div',lg,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(g.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.key,class:(0,r.normalizeClass)(['asset-item',{active:y.value===e.key}]),onClick:t=>(e=>{a.settings.debugMode?(y.value=e.key,n('update:settings',{...a.settings,bgImage:e.data}),k(`ËÉåÊôØÂ∑≤ÂàáÊç¢: ${e.name}`)):k('ËØ∑ÂÖàÂºÄÂêØË∞ÉËØïÊ®°Âºè')})(e)},[(0,r.createElementVNode)('div',ig,[(0,r.createElementVNode)('img',{src:e.data,loading:'lazy'},null,8,cg)]),(0,r.createElementVNode)('div',sg,[(0,r.createElementVNode)('span',dg,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:(0,r.withModifiers)(t=>C(e),['stop'])},'√ó',8,ug)])],10,rg))),128))])])],2),(0,r.createCommentVNode)(' 3. Á´ãÁªòÁÆ°ÁêÜ '),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['debug-card',{disabled:!a.settings.debugMode}])},[(0,r.createElementVNode)('div',mg,[(0,r.createVNode)(v,{name:'user',class:'card-icon'}),t[13]||(t[13]=(0,r.createElementVNode)('span',{class:'card-title'},'ËßíËâ≤Á´ãÁªòÂ∫ì (Characters)',-1)),a.settings.debugMode?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('span',pg,'ÈúÄÂºÄÂêØË∞ÉËØïÊ®°Âºè'))]),(0,r.createElementVNode)('div',vg,[(0,r.createCommentVNode)(' ‰∏ä‰º†Âå∫ '),(0,r.createElementVNode)('div',gg,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[3]||(t[3]=e=>u.value=e),placeholder:'ËßíËâ≤Âêç (Â¶Ç: Alice)',class:'input-text'},null,512),[[r.vModelText,u.value]]),(0,r.createElementVNode)('label',fg,[t[14]||(t[14]=(0,r.createTextVNode)(' ÈÄâÊã©ÂõæÁâá ',-1)),(0,r.createElementVNode)('input',{type:'file',accept:'image/*',onChange:t[4]||(t[4]=e=>V(e,'char')),hidden:''},null,32)]),(0,r.createElementVNode)('button',{class:'action-btn small',disabled:!u.value||!p.value,onClick:w},'‰øùÂ≠ò',8,yg)]),(0,r.createCommentVNode)(' È¢ÑËßàÂæÖ‰øùÂ≠òÂõæÁâá '),p.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',hg,[(0,r.createElementVNode)('img',{src:p.value},null,8,kg),t[15]||(t[15]=(0,r.createElementVNode)('span',{class:'preview-tag'},'ÂæÖ‰øùÂ≠ò',-1))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' ÂàóË°®Âå∫ '),(0,r.createElementVNode)('div',Ng,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(f.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.key,class:'asset-item char-mode',onClick:t=>(e=>{a.settings.debugMode?(n('update:settings',{...a.settings,charImage:e.data}),k(`Á´ãÁªòÂ∑≤Â∫îÁî®: ${e.name}`)):k('ËØ∑ÂÖàÂºÄÂêØË∞ÉËØïÊ®°ÂºèÊâçËÉΩÈ¢ÑËßà')})(e)},[(0,r.createElementVNode)('div',Vg,[(0,r.createElementVNode)('img',{src:e.data,loading:'lazy'},null,8,bg)]),(0,r.createElementVNode)('div',wg,[(0,r.createElementVNode)('span',Cg,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:(0,r.withModifiers)(t=>C(e),['stop'])},'√ó',8,Sg)])],8,Eg))),128))])])],2),h.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Bg,(0,r.toDisplayString)(h.value),1)):(0,r.createCommentVNode)('v-if',!0)]))}}),_g=(0,y.A)(xg,[['__scopeId','data-v-5c1378ba']]),Ig=_g,Tg={class:'preview-stage-wrapper'},Ag={class:'preview-stage'},Dg={class:'background-layer'},Mg=['src'],Pg={key:1,class:'bg-placeholder'},Og={class:'character-layer'},Rg=['src'],$g=['src'],Lg=(0,r.defineComponent)({__name:'PreviewStage',props:{charCount:{},bgImage:{},charImage:{},settings:{},layoutConfigs:{}},setup(e){const t=e,a=(0,r.ref)(!1),n=()=>{if('undefined'==typeof window)return;const e=window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,t=window.matchMedia?.('(orientation: landscape)')?.matches??window.innerWidth>window.innerHeight;a.value=e&&t};(0,r.onMounted)(()=>{n(),window.addEventListener('resize',n,{passive:!0}),window.addEventListener('orientationchange',n)}),(0,r.onUnmounted)(()=>{window.removeEventListener('resize',n),window.removeEventListener('orientationchange',n)});const o=(0,r.computed)(()=>({fontSize:t.settings?.fontSize??20,textSpeed:t.settings?.textSpeed??0,autoSpeed:t.settings?.autoSpeed??1e3,dialogueOpacity:t.settings?.dialogueOpacity??85,dialogueWidth:t.settings?.dialogueWidth??90,dialogueHeight:t.settings?.dialogueHeight??200,dialoguePaddingX:t.settings?.dialoguePaddingX??2.5,dialoguePaddingY:t.settings?.dialoguePaddingY??2,dialogueBottom:t.settings?.dialogueBottom??3})),l=()=>{},i=e=>{const a=t.charCount,n=t.layoutConfigs[a];if(!n||!n[e-1]){return{left:`calc(50% + ${(e-(a+1)/2)*25}%)`,transform:'translateX(-50%)',height:'60%',bottom:'0'}}const o=n[e-1];return{left:`${o.charX}%`,transform:'translateX(-50%)',bottom:`${o.charY}%`,height:`${o.charScale}%`}};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Tg,[(0,r.createCommentVNode)(' Preview Header '),t[1]||(t[1]=(0,r.createElementVNode)('div',{class:'preview-header'},[(0,r.createElementVNode)('span',{class:'preview-label'},'ÂÆûÊó∂È¢ÑËßà (Live Preview)')],-1)),(0,r.createCommentVNode)(' Preview Stage (1:1 matches MainGame structure) '),(0,r.createElementVNode)('div',Ag,[(0,r.createCommentVNode)(' 1. Background Layer '),(0,r.createElementVNode)('div',Dg,[e.bgImage?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:e.bgImage,alt:'Background',class:'bg-image'},null,8,Mg)):((0,r.openBlock)(),(0,r.createElementBlock)('div',Pg)),t[0]||(t[0]=(0,r.createElementVNode)('div',{class:'bg-gradient'},null,-1))]),(0,r.createCommentVNode)(' 2. Character Layer (z-index: 5, under dialogue) '),(0,r.createElementVNode)('div',Og,[a.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' Mobile landscape safe mode: avoid FLIP/transform animations from transition-group '),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.charCount,t=>(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:t,src:e.charImage,class:'char-img dynamic-char',style:(0,r.normalizeStyle)(i(t))},null,12,$g)),[[r.vShow,e.charImage]])),128))],64)):((0,r.openBlock)(),(0,r.createBlock)(r.TransitionGroup,{key:0,name:'char-fade'},{default:(0,r.withCtx)(()=>[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.charCount,t=>(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:t,src:e.charImage,class:'char-img dynamic-char',style:(0,r.normalizeStyle)(i(t))},null,12,Rg)),[[r.vShow,e.charImage]])),128))]),_:1})),(0,r.createCommentVNode)(' Placeholder when no image '),e.charImage?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:2},(0,r.renderList)(e.charCount,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:'ph-'+e,class:'char-placeholder',style:(0,r.normalizeStyle)(i(e))},[(0,r.createVNode)(v,{name:'user',size:28}),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(e),1)],4))),128))]),(0,r.createCommentVNode)(' 3. HUD Layer (z-index: 20) - Uses GameHud component style '),(0,r.createVNode)(ip,{class:'preview-hud'}),(0,r.createCommentVNode)(' 4. Dialogue Box Layer (z-index: 30) - Uses real DialogueBox '),(0,r.createVNode)(Im,{name:'ËßíËâ≤Âêç',text:'ËøôÊòØÈ¢ÑËßàÊñáÊú¨„ÄÇË∞ÉÊï¥ËÆæÂÆöÂèØ‰ª•ÂÆûÊó∂ÁúãÂà∞ÊïàÊûúÂèòÂåñ„ÄÇ','auto-mode':!1,'skip-mode':!1,settings:o.value,onNext:l,onBack:l,onLog:l,onAuto:l,onSkip:l},null,8,['settings'])])]))}}),Ug=(0,y.A)(Lg,[['__scopeId','data-v-adbfeaec']]),zg={class:'settings-section'},Fg={class:'sub-tabs'},Wg=['onClick'],jg={key:0,class:'debug-card preview-card'},Gg={key:1,class:'debug-card'},Jg={class:'card-header'},Yg={class:'card-body'},Hg={class:'controls-panel'},Xg={class:'control-row'},Kg={class:'control-value'},Qg={class:'control-row'},qg={class:'control-value'},Zg={class:'control-row'},ef={class:'control-value'},tf={key:2,class:'dialogue-settings'},af={class:'debug-card'},nf={class:'card-header'},of={class:'card-body'},lf={class:'controls-panel'},rf={class:'control-row'},cf={class:'control-value'},sf={class:'control-row'},df={class:'control-value'},uf={class:'control-row'},mf={class:'control-value'},pf={class:'control-row'},vf={class:'control-value'},gf={class:'debug-card'},ff={class:'card-header'},yf={class:'card-body'},hf={class:'controls-panel'},kf={class:'control-row'},Nf={class:'control-value'},Ef={class:'control-row'},Vf={class:'control-value'},bf={key:3,class:'performance-settings'},wf={class:'debug-card highlight-card'},Cf={class:'card-header-row'},Sf={class:'switch'},Bf={class:'card-content-row'},xf={class:'debug-card hint-card'},_f={class:'hint-icon'},If=(0,r.defineComponent)({__name:'SettingsDisplayTab',props:{settings:{}},emits:['update:settings'],setup(e,{emit:t}){const a=e,n=t,{getAllAssets:o}=zv(),i=(0,r.ref)(!1),c=()=>{if('undefined'==typeof window)return;const e=window.matchMedia?.('(hover: none) and (pointer: coarse)')?.matches??!1,t=navigator.userAgent||'',a=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t),n=window.innerWidth<=900;i.value=a||e&&n},s=[{id:'layout',label:'Á´ãÁªòÂ∏ÉÂ±Ä'},{id:'dialogue',label:'ÂØπËØùÊ°Ü'},{id:'performance',label:'ÊºîÂá∫ÊïàÊûú'}],d=(0,r.ref)('layout'),u=(0,r.ref)(''),m=(0,r.ref)(''),p=(0,r.ref)(a.settings.performanceEnabled??!0),g=(0,r.reactive)({debugMode:a.settings.debugMode??!1});(0,r.watch)(()=>a.settings.performanceEnabled,e=>{'boolean'==typeof e&&(p.value=e)});const f=(0,r.reactive)({dialogueWidth:a.settings.dialogueWidth??90,dialogueOpacity:a.settings.dialogueOpacity??85,dialogueHeight:a.settings.dialogueHeight??200,dialoguePaddingX:a.settings.dialoguePaddingX??2.5,dialoguePaddingY:a.settings.dialoguePaddingY??2,dialogueBottom:a.settings.dialogueBottom??3}),y=(0,r.computed)(()=>({...a.settings,...f})),h=(0,r.reactive)(a.settings.layoutConfigs?JSON.parse(JSON.stringify(a.settings.layoutConfigs)):{1:[{charScale:80,charX:50,charY:0}],2:[{charScale:75,charX:30,charY:0},{charScale:75,charX:70,charY:0}],3:[{charScale:70,charX:20,charY:0},{charScale:75,charX:50,charY:0},{charScale:70,charX:80,charY:0}],4:[{charScale:65,charX:15,charY:0},{charScale:70,charX:38,charY:0},{charScale:70,charX:62,charY:0},{charScale:65,charX:85,charY:0}]}),k=(0,r.computed)(()=>{const e=h?.[1]?.[0];return e||{charScale:80,charX:50,charY:0}});(0,r.onMounted)(async()=>{c(),window.addEventListener('resize',c,{passive:!0}),window.addEventListener('orientationchange',c);try{const{getAllBackgroundImages:e,getAllCharacterImages:t}=await Promise.resolve().then(l.bind(l,374)),a=e(),n=t();if(a.length>0&&(u.value=a[0].imageUrl,console.log('[SettingsDisplayTab] Loaded background from gameAssets')),n.length>0&&(m.value=n[0].imageUrl,console.log('[SettingsDisplayTab] Loaded character from gameAssets')),u.value&&m.value)return}catch(e){console.warn('[SettingsDisplayTab] gameAssets not available, trying event pack')}const e=sessionStorage.getItem('current_game_event_id');if(e)try{const{idbService:t}=await Promise.resolve().then(l.bind(l,894)),a=(await t.getAllWorks()).find(t=>'EVENT'===t.type&&t.id===e);if(a?.data){const e=a.data;if(e.sceneBackgrounds?.length>0&&(u.value=e.sceneBackgrounds[0].imageUrl||e.sceneBackgrounds[0]),e.characterImages?.length>0&&(m.value=e.characterImages[0].imageUrl||e.characterImages[0]),console.log('[SettingsDisplayTab] Loaded event pack assets:',{bg:!!u.value,char:!!m.value}),u.value&&m.value)return}}catch(e){console.warn('[SettingsDisplayTab] Failed to load event pack:',e)}const t=await o('char');t.length>0&&!m.value&&(m.value=t[0].data);const a=await o('bg');a.length>0&&!u.value&&(u.value=a[0].data)}),(0,r.onUnmounted)(()=>{window.removeEventListener('resize',c),window.removeEventListener('orientationchange',c)}),(0,r.watch)(()=>a.settings,e=>{void 0!==e.debugMode&&(g.debugMode=e.debugMode),e.layoutConfigs&&Object.assign(h,JSON.parse(JSON.stringify(e.layoutConfigs))),void 0!==e.dialogueWidth&&(f.dialogueWidth=e.dialogueWidth),void 0!==e.dialogueOpacity&&(f.dialogueOpacity=e.dialogueOpacity),void 0!==e.dialogueHeight&&(f.dialogueHeight=e.dialogueHeight),void 0!==e.dialoguePaddingX&&(f.dialoguePaddingX=e.dialoguePaddingX),void 0!==e.dialoguePaddingY&&(f.dialoguePaddingY=e.dialoguePaddingY),void 0!==e.dialogueBottom&&(f.dialogueBottom=e.dialogueBottom)},{deep:!0});const N=()=>{E()},E=()=>{n('update:settings',{...a.settings,debugMode:g.debugMode,layoutConfigs:JSON.parse(JSON.stringify(h)),charScale:h[1][0].charScale,charX:h[1][0].charX,charY:h[1][0].charY,...f,performanceEnabled:!!p.value})},V=()=>{if('layout'===d.value){const e={1:[{charScale:80,charX:50,charY:0}],2:[{charScale:75,charX:30,charY:0},{charScale:75,charX:70,charY:0}],3:[{charScale:70,charX:20,charY:0},{charScale:75,charX:50,charY:0},{charScale:70,charX:80,charY:0}],4:[{charScale:65,charX:15,charY:0},{charScale:70,charX:38,charY:0},{charScale:70,charX:62,charY:0},{charScale:65,charX:85,charY:0}]};Object.assign(h,e)}else'dialogue'===d.value&&(f.dialogueWidth=90,f.dialogueOpacity=85,f.dialogueHeight=200,f.dialoguePaddingX=2.5,f.dialoguePaddingY=2,f.dialogueBottom=3);E()},b=(e,t,a)=>(e-t)/(a-t)*100;return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',zg,[t[27]||(t[27]=(0,r.createElementVNode)('div',{class:'section-header'},[(0,r.createElementVNode)('h3',{class:'section-title'},'ÁîªÈù¢Ë°®Áé∞ (Display)'),(0,r.createElementVNode)('p',{class:'section-desc'},'Ë∞ÉÊï¥Á´ãÁªòÂ§ßÂ∞è„ÄÅ‰ΩçÁΩÆÂèäÁïåÈù¢ÂÖÉÁ¥†„ÄÇ')],-1)),(0,r.createCommentVNode)(' Sub-tabs '),(0,r.createElementVNode)('div',Fg,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s,e=>(0,r.createElementVNode)('button',{key:e.id,class:(0,r.normalizeClass)(['sub-tab-btn',{active:d.value===e.id}]),onClick:t=>d.value=e.id},(0,r.toDisplayString)(e.label),11,Wg)),64))]),(0,r.createCommentVNode)(' È¢ÑËßàÂå∫Âüü (Áã¨Á´ãÁªÑ‰ª∂) '),(0,r.createCommentVNode)(' Mobile: disabled due to WebView/GPU artifacts; desktop unchanged '),i.value?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',jg,[(0,r.createVNode)(Ug,{'char-count':1,'bg-image':u.value,'char-image':m.value,settings:y.value,'layout-configs':h},null,8,['bg-image','char-image','settings','layout-configs'])])),(0,r.createCommentVNode)(' Á´ãÁªòÂ∏ÉÂ±ÄËÆæÁΩÆ (Êåâ‰∫∫Êï∞) '),'layout'===d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Gg,[(0,r.createElementVNode)('div',Jg,[(0,r.createVNode)(v,{name:'user',class:'card-icon'}),t[10]||(t[10]=(0,r.createElementVNode)('span',{class:'card-title'},'Á´ãÁªòÂ∏ÉÂ±Ä',-1))]),(0,r.createElementVNode)('div',Yg,[(0,r.createCommentVNode)(' ÂΩìÂâçËßíËâ≤ÁöÑÊéßÂà∂Èù¢Êùø '),(0,r.createElementVNode)('div',Hg,[(0,r.createCommentVNode)(' Áº©Êîæ '),(0,r.createElementVNode)('div',Xg,[t[11]||(t[11]=(0,r.createElementVNode)('span',{class:'control-label'},'Áº©Êîæ (Scale)',-1)),(0,r.createElementVNode)('span',Kg,(0,r.toDisplayString)(k.value.charScale)+'%',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'20',max:'500',step:'5','onUpdate:modelValue':t[0]||(t[0]=e=>k.value.charScale=e),onInput:N,style:(0,r.normalizeStyle)({'--progress':b(k.value.charScale,20,500)+'%'})},null,36),[[r.vModelText,k.value.charScale,void 0,{number:!0}]]),(0,r.createCommentVNode)(' Ê∞¥Âπ≥‰ΩçÁΩÆ '),(0,r.createElementVNode)('div',Qg,[t[12]||(t[12]=(0,r.createElementVNode)('span',{class:'control-label'},'Ê∞¥Âπ≥‰ΩçÁΩÆ (X)',-1)),(0,r.createElementVNode)('span',qg,(0,r.toDisplayString)(k.value.charX)+'%',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'0',max:'100',step:'1','onUpdate:modelValue':t[1]||(t[1]=e=>k.value.charX=e),onInput:N,style:(0,r.normalizeStyle)({'--progress':b(k.value.charX,0,100)+'%'})},null,36),[[r.vModelText,k.value.charX,void 0,{number:!0}]]),(0,r.createCommentVNode)(' ÂûÇÁõ¥ÂÅèÁßª '),(0,r.createElementVNode)('div',Zg,[t[13]||(t[13]=(0,r.createElementVNode)('span',{class:'control-label'},'ÂûÇÁõ¥ÂÅèÁßª (Y)',-1)),(0,r.createElementVNode)('span',ef,(0,r.toDisplayString)(k.value.charY)+'%',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'-100',max:'100',step:'1','onUpdate:modelValue':t[2]||(t[2]=e=>k.value.charY=e),onInput:N,style:(0,r.normalizeStyle)({'--progress':b(k.value.charY,-100,100)+'%'})},null,36),[[r.vModelText,k.value.charY,void 0,{number:!0}]])])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' ÂØπËØùÊ°ÜËÆæÁΩÆÂå∫Âùó '),'dialogue'===d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',tf,[(0,r.createCommentVNode)(' ÂØπËØùÊ°ÜÊéßÂà∂ '),(0,r.createElementVNode)('div',af,[(0,r.createElementVNode)('div',nf,[(0,r.createVNode)(v,{name:'message',class:'card-icon'}),t[14]||(t[14]=(0,r.createElementVNode)('span',{class:'card-title'},'Â∞∫ÂØ∏‰∏é‰ΩçÁΩÆ (Size & Position)',-1))]),(0,r.createElementVNode)('div',of,[(0,r.createElementVNode)('div',lf,[(0,r.createCommentVNode)(' ÂÆΩÂ∫¶ '),(0,r.createElementVNode)('div',rf,[t[15]||(t[15]=(0,r.createElementVNode)('span',{class:'control-label'},'ÂÆΩÂ∫¶ (Width)',-1)),(0,r.createElementVNode)('span',cf,(0,r.toDisplayString)(f.dialogueWidth)+'%',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'30',max:'100',step:'5','onUpdate:modelValue':t[3]||(t[3]=e=>f.dialogueWidth=e),onInput:E,style:(0,r.normalizeStyle)({'--progress':b(f.dialogueWidth,30,100)+'%'})},null,36),[[r.vModelText,f.dialogueWidth,void 0,{number:!0}]]),(0,r.createCommentVNode)(' ÊúÄÂ∞èÈ´òÂ∫¶ '),(0,r.createElementVNode)('div',sf,[t[16]||(t[16]=(0,r.createElementVNode)('span',{class:'control-label'},'ÊúÄÂ∞èÈ´òÂ∫¶ (Min Height)',-1)),(0,r.createElementVNode)('span',df,(0,r.toDisplayString)(f.dialogueHeight)+'px',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'100',max:'400',step:'10','onUpdate:modelValue':t[4]||(t[4]=e=>f.dialogueHeight=e),onInput:E,style:(0,r.normalizeStyle)({'--progress':b(f.dialogueHeight,100,400)+'%'})},null,36),[[r.vModelText,f.dialogueHeight,void 0,{number:!0}]]),(0,r.createCommentVNode)(' Â∫ïÈÉ®Ë∑ùÁ¶ª '),(0,r.createElementVNode)('div',uf,[t[17]||(t[17]=(0,r.createElementVNode)('span',{class:'control-label'},'Â∫ïÈÉ®Ë∑ùÁ¶ª (Bottom)',-1)),(0,r.createElementVNode)('span',mf,(0,r.toDisplayString)(f.dialogueBottom)+'em',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'0',max:'10',step:'0.5','onUpdate:modelValue':t[5]||(t[5]=e=>f.dialogueBottom=e),onInput:E,style:(0,r.normalizeStyle)({'--progress':b(f.dialogueBottom,0,10)+'%'})},null,36),[[r.vModelText,f.dialogueBottom,void 0,{number:!0}]]),(0,r.createCommentVNode)(' ÈÄèÊòéÂ∫¶ '),(0,r.createElementVNode)('div',pf,[t[18]||(t[18]=(0,r.createElementVNode)('span',{class:'control-label'},'ÈÄèÊòéÂ∫¶ (Opacity)',-1)),(0,r.createElementVNode)('span',vf,(0,r.toDisplayString)(f.dialogueOpacity)+'%',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'30',max:'100',step:'5','onUpdate:modelValue':t[6]||(t[6]=e=>f.dialogueOpacity=e),onInput:E,style:(0,r.normalizeStyle)({'--progress':b(f.dialogueOpacity,30,100)+'%'})},null,36),[[r.vModelText,f.dialogueOpacity,void 0,{number:!0}]])])])]),(0,r.createCommentVNode)(' ÂÜÖËæπË∑ùËÆæÁΩÆ '),(0,r.createElementVNode)('div',gf,[(0,r.createElementVNode)('div',ff,[(0,r.createVNode)(v,{name:'compress',class:'card-icon'}),t[19]||(t[19]=(0,r.createElementVNode)('span',{class:'card-title'},'ÂÜÖËæπË∑ù (Padding)',-1))]),(0,r.createElementVNode)('div',yf,[(0,r.createElementVNode)('div',hf,[(0,r.createCommentVNode)(' Ê∞¥Âπ≥ÂÜÖËæπË∑ù '),(0,r.createElementVNode)('div',kf,[t[20]||(t[20]=(0,r.createElementVNode)('span',{class:'control-label'},'Ê∞¥Âπ≥ÂÜÖËæπË∑ù (Horizontal)',-1)),(0,r.createElementVNode)('span',Nf,(0,r.toDisplayString)(f.dialoguePaddingX)+'em',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'0.5',max:'5',step:'0.1','onUpdate:modelValue':t[7]||(t[7]=e=>f.dialoguePaddingX=e),onInput:E,style:(0,r.normalizeStyle)({'--progress':b(f.dialoguePaddingX,.5,5)+'%'})},null,36),[[r.vModelText,f.dialoguePaddingX,void 0,{number:!0}]]),(0,r.createCommentVNode)(' ÂûÇÁõ¥ÂÜÖËæπË∑ù '),(0,r.createElementVNode)('div',Ef,[t[21]||(t[21]=(0,r.createElementVNode)('span',{class:'control-label'},'ÂûÇÁõ¥ÂÜÖËæπË∑ù (Vertical)',-1)),(0,r.createElementVNode)('span',Vf,(0,r.toDisplayString)(f.dialoguePaddingY)+'em',1)]),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range full',min:'0.5',max:'5',step:'0.1','onUpdate:modelValue':t[8]||(t[8]=e=>f.dialoguePaddingY=e),onInput:E,style:(0,r.normalizeStyle)({'--progress':b(f.dialoguePaddingY,.5,5)+'%'})},null,36),[[r.vModelText,f.dialoguePaddingY,void 0,{number:!0}]])])])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' ÊÄßËÉΩËÆæÁΩÆÂå∫Âùó '),'performance'===d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',bf,[(0,r.createElementVNode)('div',wf,[(0,r.createElementVNode)('div',Cf,[(0,r.createVNode)(v,{name:'sparkles',class:'card-icon'}),t[23]||(t[23]=(0,r.createElementVNode)('span',{class:'card-label'},'Ê≤âÊµ∏ÂºèÊºîÂá∫Ê®°Âºè',-1)),t[24]||(t[24]=(0,r.createElementVNode)('div',{class:'spacer'},null,-1)),(0,r.createElementVNode)('label',Sf,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[9]||(t[9]=e=>p.value=e),onChange:E},null,544),[[r.vModelCheckbox,p.value]]),t[22]||(t[22]=(0,r.createElementVNode)('span',{class:'slider'},null,-1))])]),(0,r.createElementVNode)('div',Bf,[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['status-indicator',{active:p.value}])},[t[25]||(t[25]=(0,r.createElementVNode)('div',{class:'status-dot'},null,-1)),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(p.value?'Â∑≤ÂºÄÂêØ (ENABLED)':'Â∑≤ÂÖ≥Èó≠ (DISABLED)'),1)],2)])]),(0,r.createElementVNode)('div',xf,[(0,r.createElementVNode)('div',_f,[(0,r.createVNode)(v,{name:'info',size:20})]),t[26]||(t[26]=(0,r.createElementVNode)('div',{class:'hint-content'},[(0,r.createElementVNode)('div',{class:'hint-title'},'ÊºîÂá∫Ê®°ÂºèËØ¥Êòé'),(0,r.createElementVNode)('div',{class:'hint-text'},[(0,r.createTextVNode)(' ÂºÄÂêØÂêéÔºåÁ≥ªÁªüÊó∂Èó¥„ÄÅÂú∞ÁÇπÂèòÊõ¥„ÄÅÊñ∞ËßíËâ≤ÁôªÂú∫‰ª•ÂèäÂ•ΩÊÑüÂ∫¶ÂèòÂåñÂ∞Ü‰ª•ÁâπÊÆäÁöÑËßÜËßâÊïàÊûúÂ±ïÁ§∫ÔºåÂ¢ûÂº∫‰ª£ÂÖ•ÊÑü„ÄÇ '),(0,r.createElementVNode)('br'),(0,r.createElementVNode)('span',{class:'sub-hint'},'ÂÖ≥Èó≠Ê≠§ÈÄâÈ°π‰∏ç‰ºöÂΩ±ÂìçÂèòÈáèÁöÑÂÆûÈôÖËÆ°ÁÆóÔºå‰ªÖË∑≥ËøáËßÜËßâÂä®Áîª„ÄÇ')])],-1))])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Âø´ÈÄüÊìç‰Ωú '),(0,r.createElementVNode)('div',{class:'quick-actions'},[(0,r.createElementVNode)('button',{class:'action-btn outline',onClick:V},'ÈáçÁΩÆÈªòËÆ§ (Reset)')])]))}}),Tf=(0,y.A)(If,[['__scopeId','data-v-69a21231']]),Af={class:'settings-section'},Df={class:'sidebar-layout'},Mf={class:'config-column'},Pf={class:'debug-card'},Of={class:'card-header'},Rf={class:'card-body'},$f={key:0,class:'empty-state'},Lf={key:1,class:'widget-list'},Uf=['onClick'],zf={class:'widget-checkbox'},Ff={class:'switch small'},Wf=['checked'],jf={class:'widget-info'},Gf={class:'widget-name'},Jf={class:'widget-desc'},Yf={key:0,class:'debug-card'},Hf={class:'card-header'},Xf={class:'card-body'},Kf={class:'order-list'},Qf={class:'order-number'},qf={class:'order-name'},Zf={class:'order-actions'},ey=['disabled','onClick'],ty=['disabled','onClick'],ay={class:'preview-column'},ny={class:'debug-card preview-card'},oy={class:'card-header'},ly={class:'card-body no-padding'},ry={class:'sidebar-preview__container'},iy={class:'sidebar-preview__viewport'},cy=(0,r.defineComponent)({__name:'SettingsSidebarTab',props:{settings:{}},emits:['update:settings'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)([]),l=(0,r.ref)(a.settings.enabledSidebarWidgets||[]);(0,r.watch)(()=>a.settings.enabledSidebarWidgets,e=>{Array.isArray(e)&&(l.value=[...e])});const i=(0,r.computed)(()=>({...a.settings,enabledSidebarWidgets:[...l.value]}));(0,r.onMounted)(()=>{const e=(0,ya.wO)();o.value=e;const t=new Set(e.map(e=>e.id));l.value=l.value.filter(e=>t.has(e)),console.log('[SettingsSidebarTab] Loaded widgets:',e.length)});const c=e=>l.value.includes(e),s=e=>{const t=o.value.find(t=>t.id===e);return t?.name||e},d=(e,t)=>{const a='up'===t?e-1:e+1;if(a<0||a>=l.value.length)return;const n=l.value.splice(e,1)[0];l.value.splice(a,0,n),p()},u=()=>{l.value=o.value.map(e=>e.id),p()},m=()=>{l.value=[],p()},p=()=>{n('update:settings',{...a.settings,enabledSidebarWidgets:[...l.value]})};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Af,[t[6]||(t[6]=(0,r.createElementVNode)('div',{class:'section-header'},[(0,r.createElementVNode)('h3',{class:'section-title'},'Âè≥ËæπÊ†è (Sidebar)'),(0,r.createElementVNode)('p',{class:'section-desc'},'ÈÖçÁΩÆÂè≥ËæπÊ†èÊòæÁ§∫Âì™‰∫õ‰∫ã‰ª∂ÂåÖUIÁªÑ‰ª∂„ÄÇ')],-1)),(0,r.createElementVNode)('div',Df,[(0,r.createCommentVNode)(' Left Column: Configuration '),(0,r.createElementVNode)('div',Mf,[(0,r.createCommentVNode)(' ÂèØÁî®ÁªÑ‰ª∂ÂàóË°® '),(0,r.createElementVNode)('div',Pf,[(0,r.createElementVNode)('div',Of,[(0,r.createVNode)(v,{name:'hammer',class:'card-icon'}),t[0]||(t[0]=(0,r.createElementVNode)('span',{class:'card-title'},'ÂèØÁî®ÁªÑ‰ª∂ (Available Widgets)',-1))]),(0,r.createElementVNode)('div',Rf,[0===o.value.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',$f,[(0,r.createVNode)(v,{name:'info',size:32,class:'empty-icon'}),t[1]||(t[1]=(0,r.createElementVNode)('p',null,'ÂΩìÂâç‰∫ã‰ª∂ÂåÖÊ≤°ÊúâÁî®Êà∑ÁªÑ‰ª∂',-1)),t[2]||(t[2]=(0,r.createElementVNode)('p',{class:'empty-hint'},'Âú®ÂàõÊÑèÂ∑•Âùä‰∏≠‰∏∫‰∫ã‰ª∂ÂåÖÊ∑ªÂä†Áî®Êà∑ÁªÑ‰ª∂',-1))])):((0,r.openBlock)(),(0,r.createElementBlock)('div',Lf,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:(0,r.normalizeClass)(['widget-item',{active:c(e.id)}]),onClick:t=>(e=>{const t=l.value.indexOf(e);-1===t?l.value.push(e):l.value.splice(t,1),p()})(e.id)},[(0,r.createElementVNode)('div',zf,[(0,r.createElementVNode)('label',Ff,[(0,r.createElementVNode)('input',{type:'checkbox',checked:c(e.id),readonly:''},null,8,Wf),t[3]||(t[3]=(0,r.createElementVNode)('span',{class:'slider'},null,-1))])]),(0,r.createElementVNode)('div',jf,[(0,r.createElementVNode)('div',Gf,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)('div',Jf,(0,r.toDisplayString)(e.description||'Êó†ÊèèËø∞'),1)])],10,Uf))),128))]))])]),(0,r.createCommentVNode)(' ÊòæÁ§∫È°∫Â∫è '),l.value.length>0?((0,r.openBlock)(),(0,r.createElementBlock)('div',Yf,[(0,r.createElementVNode)('div',Hf,[(0,r.createVNode)(v,{name:'menu',class:'card-icon'}),t[4]||(t[4]=(0,r.createElementVNode)('span',{class:'card-title'},'ÊòæÁ§∫È°∫Â∫è (Display Order)',-1))]),(0,r.createElementVNode)('div',Xf,[(0,r.createElementVNode)('div',Kf,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(l.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e,class:'order-item'},[(0,r.createElementVNode)('div',Qf,(0,r.toDisplayString)(t+1),1),(0,r.createElementVNode)('div',qf,(0,r.toDisplayString)(s(e)),1),(0,r.createElementVNode)('div',Zf,[(0,r.createElementVNode)('button',{class:'order-btn',disabled:0===t,onClick:e=>d(t,'up'),title:'‰∏äÁßª'},[(0,r.createVNode)(v,{name:'next',size:14,class:'rotate-270'})],8,ey),(0,r.createElementVNode)('button',{class:'order-btn',disabled:t===l.value.length-1,onClick:e=>d(t,'down'),title:'‰∏ãÁßª'},[(0,r.createVNode)(v,{name:'next',size:14,class:'rotate-90'})],8,ty)])]))),128))])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Âø´ÈÄüÊìç‰Ωú '),(0,r.createElementVNode)('div',{class:'quick-actions'},[(0,r.createElementVNode)('button',{class:'action-btn outline',onClick:u},'ÂÖ®ÈÉ®ÂêØÁî®'),(0,r.createElementVNode)('button',{class:'action-btn outline',onClick:m},'ÂÖ®ÈÉ®Á¶ÅÁî®')])]),(0,r.createCommentVNode)(' Right Column: Live Preview '),(0,r.createElementVNode)('div',ay,[(0,r.createElementVNode)('div',ny,[(0,r.createElementVNode)('div',oy,[(0,r.createVNode)(v,{name:'eye',class:'card-icon'}),t[5]||(t[5]=(0,r.createElementVNode)('span',{class:'card-title'},'ÂÆûÊó∂È¢ÑËßà (Live Preview)',-1))]),(0,r.createElementVNode)('div',ly,[(0,r.createElementVNode)('div',ry,[(0,r.createCommentVNode)(' Simulate game viewport for correct sizing '),(0,r.createElementVNode)('div',iy,[(0,r.createVNode)($p,{settings:i.value,'force-open':!0},null,8,['settings'])])])])])])])]))}}),sy=(0,y.A)(cy,[['__scopeId','data-v-11e8c394']]),dy={class:'system-tab'},uy={class:'setting-group'},my={class:'setting-row'},py={class:'switch'},vy=['checked'],gy=['value','disabled'],fy=(0,r.defineComponent)({__name:'SettingsSystemTab',props:{settings:{}},emits:['update:settings'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.computed)(()=>{const e=Number(a.settings.autoBigSummaryInterval);return Number.isFinite(e)&&e>0?Math.floor(e):25}),l=e=>{const t=e.target.checked;n('update:settings',{...a.settings,autoBigSummaryEnabled:t})},i=e=>{const t=e.target.value,o=Number.parseInt(t,10),l=Number.isFinite(o)&&o>0?o:1;n('update:settings',{...a.settings,autoBigSummaryInterval:l})};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',dy,[t[4]||(t[4]=(0,r.createElementVNode)('h2',{class:'tab-title'},'Á≥ªÁªü (System)',-1)),(0,r.createElementVNode)('div',uy,[(0,r.createElementVNode)('div',my,[t[1]||(t[1]=(0,r.createElementVNode)('div',{class:'setting-info'},[(0,r.createElementVNode)('div',{class:'setting-label'},'Ëá™Âä®Â§ßÊÄªÁªì'),(0,r.createElementVNode)('div',{class:'setting-desc'},'ÂºÄÂêØÂêéÔºåËææÂà∞ËÆæÂÆöÁöÑ‚ÄúÂ∞èÊÄªÁªìÈó¥Ë∑ù‚Äù‰ºöÊèêÁ§∫ AI ËæìÂá∫‰∏ÄÊ¨° <Â§ßÊÄªÁªì>„ÄÇ')],-1)),(0,r.createElementVNode)('label',py,[(0,r.createElementVNode)('input',{type:'checkbox',checked:!!e.settings.autoBigSummaryEnabled,onChange:l},null,40,vy),t[0]||(t[0]=(0,r.createElementVNode)('span',{class:'slider'},null,-1))])]),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['setting-row',{disabled:!e.settings.autoBigSummaryEnabled}])},[t[2]||(t[2]=(0,r.createElementVNode)('div',{class:'setting-info'},[(0,r.createElementVNode)('div',{class:'setting-label'},'ÊÄªÁªìÈó¥Ë∑ù'),(0,r.createElementVNode)('div',{class:'setting-desc'},'ÊØèÊî∂Âà∞ N Ê¨°ÈùûÁ©∫ <Â∞èÊÄªÁªì>ÔºåÂ∞±Ëß¶Âèë‰∏ÄÊ¨°‚ÄúËØ∑Ê±ÇÂ§ßÊÄªÁªì‚ÄùÁöÑÊèêÁ§∫„ÄÇ')],-1)),(0,r.createElementVNode)('input',{class:'number-input',type:'number',min:'1',step:'1',value:o.value,disabled:!e.settings.autoBigSummaryEnabled,onInput:i},null,40,gy)],2),t[3]||(t[3]=(0,r.createElementVNode)('div',{class:'setting-note'},' ËØ¥ÊòéÔºöËß¶ÂèëÂêé‰ºöÂú®‰∏ã‰∏ÄÊ¨°ÂèëÈÄÅÁªô AI ÁöÑÊèêÁ§∫ËØçÈáåËøΩÂä†‚ÄúËØ∑ËæìÂá∫<Â§ßÊÄªÁªì>‚Ä¶</Â§ßÊÄªÁªì>‚Äù„ÄÇ ',-1))])]))}}),yy=(0,y.A)(fy,[['__scopeId','data-v-77f1bfd9']]),hy={class:'settings-section'},ky={class:'settings-grid'},Ny={class:'setting-card full-width-card'},Ey={class:'setting-info'},Vy={class:'setting-name'},by={class:'setting-value'},wy={class:'setting-control wide-control'},Cy={class:'setting-card'},Sy={class:'card-group-title'},By={class:'control-group'},xy={class:'setting-row'},_y={class:'setting-info-compact'},Iy={class:'setting-value'},Ty={class:'setting-control compact'},Ay={class:'setting-row'},Dy={class:'setting-info-compact'},My={class:'setting-value'},Py={class:'setting-control compact'},Oy={class:'setting-card'},Ry={class:'card-group-title'},$y={class:'control-group'},Ly={class:'color-row'},Uy={class:'color-actions'},zy={class:'color-row'},Fy={class:'color-actions'},Wy={class:'color-row'},jy={class:'color-actions'},Gy=(0,r.defineComponent)({__name:'SettingsTextTab',props:{settings:{}},emits:['update:settings'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.reactive)({fontSize:a.settings.fontSize??18,textSpeed:a.settings.textSpeed??30,autoSpeed:a.settings.autoSpeed??2e3,dialogueTextColor:a.settings.dialogueTextColor??'#f1f5f9',narrationTextColor:a.settings.narrationTextColor??'#f1f5f9',psychTextColor:a.settings.psychTextColor??'#a78bfa'});(0,r.watch)(()=>a.settings,e=>{void 0!==e.fontSize&&(o.fontSize=e.fontSize),void 0!==e.textSpeed&&(o.textSpeed=e.textSpeed),void 0!==e.autoSpeed&&(o.autoSpeed=e.autoSpeed),void 0!==e.dialogueTextColor&&(o.dialogueTextColor=e.dialogueTextColor),void 0!==e.narrationTextColor&&(o.narrationTextColor=e.narrationTextColor),void 0!==e.psychTextColor&&(o.psychTextColor=e.psychTextColor)},{deep:!0});const l=()=>{n('update:settings',{...a.settings,...o})},i=(e,t,a)=>(e-t)/(a-t)*100;return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',hy,[t[19]||(t[19]=(0,r.createElementVNode)('div',{class:'section-header'},[(0,r.createElementVNode)('h3',{class:'section-title'},'ÈòÖËØª‰ΩìÈ™å (Reading)'),(0,r.createElementVNode)('p',{class:'section-desc'},'Ë∞ÉÊï¥ÊñáÂ≠óÂ§ßÂ∞è‰∏éÊí≠ÊîæÈÄüÂ∫¶‰ª•Ëé∑ÂæóÊúÄ‰Ω≥ÈòÖËØª‰ΩìÈ™å„ÄÇ')],-1)),(0,r.createElementVNode)('div',ky,[(0,r.createCommentVNode)(' Font Size (Full Width) '),(0,r.createElementVNode)('div',Ny,[(0,r.createElementVNode)('div',Ey,[(0,r.createElementVNode)('span',Vy,[(0,r.createVNode)(v,{name:'text',size:16,class:'setting-icon'}),t[9]||(t[9]=(0,r.createTextVNode)(' Â≠ó‰ΩìÂ§ßÂ∞è ',-1))]),(0,r.createElementVNode)('span',by,(0,r.toDisplayString)(o.fontSize)+'px',1)]),(0,r.createElementVNode)('div',wy,[t[10]||(t[10]=(0,r.createElementVNode)('span',{class:'range-label'},'Aa',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range',min:'14',max:'32',step:'1','onUpdate:modelValue':t[0]||(t[0]=e=>o.fontSize=e),onInput:l,style:(0,r.normalizeStyle)({'--progress':i(o.fontSize,14,32)+'%'})},null,36),[[r.vModelText,o.fontSize,void 0,{number:!0}]]),t[11]||(t[11]=(0,r.createElementVNode)('span',{class:'range-label big'},'Aa',-1))])]),(0,r.createCommentVNode)(' Speed Settings '),(0,r.createElementVNode)('div',Cy,[(0,r.createElementVNode)('div',Sy,[(0,r.createVNode)(v,{name:'sparkles',size:16,class:'setting-icon'}),t[12]||(t[12]=(0,r.createTextVNode)(' Êí≠ÊîæÈÄüÂ∫¶ ',-1))]),(0,r.createElementVNode)('div',By,[(0,r.createElementVNode)('div',xy,[(0,r.createElementVNode)('div',_y,[t[13]||(t[13]=(0,r.createElementVNode)('span',{class:'setting-name'},'ÊâìÂ≠óÈÄüÂ∫¶',-1)),(0,r.createElementVNode)('span',Iy,(0,r.toDisplayString)(0===o.textSpeed?'Instant':o.textSpeed+'ms'),1)]),(0,r.createElementVNode)('div',Ty,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range',min:'0',max:'100',step:'5','onUpdate:modelValue':t[1]||(t[1]=e=>o.textSpeed=e),onInput:l,style:(0,r.normalizeStyle)({'--progress':i(o.textSpeed,0,100)+'%'})},null,36),[[r.vModelText,o.textSpeed,void 0,{number:!0}]])])]),(0,r.createElementVNode)('div',Ay,[(0,r.createElementVNode)('div',Dy,[t[14]||(t[14]=(0,r.createElementVNode)('span',{class:'setting-name'},'Auto Èó¥Èöî',-1)),(0,r.createElementVNode)('span',My,(0,r.toDisplayString)((o.autoSpeed/1e3).toFixed(1))+'s',1)]),(0,r.createElementVNode)('div',Py,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'range',class:'styled-range',min:'500',max:'5000',step:'100','onUpdate:modelValue':t[2]||(t[2]=e=>o.autoSpeed=e),onInput:l,style:(0,r.normalizeStyle)({'--progress':i(o.autoSpeed,500,5e3)+'%'})},null,36),[[r.vModelText,o.autoSpeed,void 0,{number:!0}]])])])])]),(0,r.createCommentVNode)(' Text Colors '),(0,r.createElementVNode)('div',Oy,[(0,r.createElementVNode)('div',Ry,[(0,r.createVNode)(v,{name:'palette',size:16,class:'setting-icon'}),t[15]||(t[15]=(0,r.createTextVNode)(' ÊñáÊú¨ÈÖçËâ≤ ',-1))]),(0,r.createElementVNode)('div',$y,[(0,r.createElementVNode)('div',Ly,[t[16]||(t[16]=(0,r.createElementVNode)('span',{class:'setting-name-compact'},'ÂØπËØù',-1)),(0,r.createElementVNode)('div',Uy,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'color','onUpdate:modelValue':t[3]||(t[3]=e=>o.dialogueTextColor=e),onInput:l},null,544),[[r.vModelText,o.dialogueTextColor]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{class:'color-input compact',type:'text','onUpdate:modelValue':t[4]||(t[4]=e=>o.dialogueTextColor=e),onInput:l},null,544),[[r.vModelText,o.dialogueTextColor]])])]),(0,r.createElementVNode)('div',zy,[t[17]||(t[17]=(0,r.createElementVNode)('span',{class:'setting-name-compact'},'ÊóÅÁôΩ',-1)),(0,r.createElementVNode)('div',Fy,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'color','onUpdate:modelValue':t[5]||(t[5]=e=>o.narrationTextColor=e),onInput:l},null,544),[[r.vModelText,o.narrationTextColor]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{class:'color-input compact',type:'text','onUpdate:modelValue':t[6]||(t[6]=e=>o.narrationTextColor=e),onInput:l},null,544),[[r.vModelText,o.narrationTextColor]])])]),(0,r.createElementVNode)('div',Wy,[t[18]||(t[18]=(0,r.createElementVNode)('span',{class:'setting-name-compact'},'ÂøÉÁêÜ',-1)),(0,r.createElementVNode)('div',jy,[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'color','onUpdate:modelValue':t[7]||(t[7]=e=>o.psychTextColor=e),onInput:l},null,544),[[r.vModelText,o.psychTextColor]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{class:'color-input compact',type:'text','onUpdate:modelValue':t[8]||(t[8]=e=>o.psychTextColor=e),onInput:l},null,544),[[r.vModelText,o.psychTextColor]])])])])])])]))}}),Jy=(0,y.A)(Gy,[['__scopeId','data-v-3f3e5e2d']]),Yy={class:'settings-modal-overlay'},Hy={class:'settings-modal'},Xy={class:'settings-header'},Ky={class:'settings-title'},Qy={class:'settings-body'},qy={class:'settings-sidebar'},Zy=['onClick'],eh={class:'settings-content custom-scrollbar'},th=(0,r.defineComponent)({__name:'SettingsModal',props:{settings:{}},emits:['close','update:settings','debug:text'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.computed)(()=>[{id:'display',label:'ÊòæÁ§∫ (Display)'},{id:'text',label:'ÊñáÊú¨ (Text)'},{id:'sidebar',label:'Âè≥ËæπÊ†è (Sidebar)'},{id:'system',label:'Á≥ªÁªü (System)'},{id:'debug',label:'Ë∞ÉËØï (Debug)'}]),l=(0,r.ref)('text'),i=(0,r.reactive)({...a.settings,bgImage:a.settings.bgImage||'',charImage:a.settings.charImage||'',debugMode:a.settings.debugMode??!1,performanceEnabled:a.settings.performanceEnabled??!0,autoBigSummaryEnabled:a.settings.autoBigSummaryEnabled??!1,autoBigSummaryInterval:a.settings.autoBigSummaryInterval??25,dialogueTextColor:a.settings.dialogueTextColor??'#f1f5f9',narrationTextColor:a.settings.narrationTextColor??'#f1f5f9',psychTextColor:a.settings.psychTextColor??'#a78bfa',charScale:a.settings.charScale??80,charX:a.settings.charX??50,charY:a.settings.charY??0,dialogueWidth:a.settings.dialogueWidth??90,dialogueOpacity:a.settings.dialogueOpacity??85});let c=null;const s=e=>{e&&Object.assign(i,e),null==c&&(c=window.requestAnimationFrame(()=>{c=null,n('update:settings',{...i,_ts:Date.now()})}))},d=e=>{n('debug:text',e)};return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',Yy,[(0,r.createElementVNode)('div',Hy,[(0,r.createElementVNode)('div',Xy,[(0,r.createElementVNode)('div',Ky,[(0,r.createVNode)(v,{name:'settings',class:'icon-violet'}),t[1]||(t[1]=(0,r.createElementVNode)('span',null,'SYSTEM SETTINGS',-1))]),(0,r.createElementVNode)('button',{onClick:t[0]||(t[0]=t=>e.$emit('close')),class:'close-btn'},[(0,r.createVNode)(v,{name:'close',size:24})])]),(0,r.createElementVNode)('div',Qy,[(0,r.createCommentVNode)(' Sidebar '),(0,r.createElementVNode)('div',qy,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:e.id,class:(0,r.normalizeClass)(['settings-tab-btn',{active:l.value===e.id}]),onClick:t=>l.value=e.id},(0,r.toDisplayString)(e.label),11,Zy))),128))]),(0,r.createCommentVNode)(' Content '),(0,r.createElementVNode)('div',eh,[(0,r.createCommentVNode)(' Display Tab '),'display'===l.value?((0,r.openBlock)(),(0,r.createBlock)(Tf,{key:0,settings:i,'onUpdate:settings':s},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Text Tab '),'text'===l.value?((0,r.openBlock)(),(0,r.createBlock)(Jy,{key:1,settings:i,'onUpdate:settings':s},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Sidebar Tab '),'sidebar'===l.value?((0,r.openBlock)(),(0,r.createBlock)(sy,{key:2,settings:i,'onUpdate:settings':s},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' System Tab '),'system'===l.value?((0,r.openBlock)(),(0,r.createBlock)(yy,{key:3,settings:i,'onUpdate:settings':s},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Debug Tab '),'debug'===l.value?((0,r.openBlock)(),(0,r.createBlock)(Ig,{key:4,settings:i,'onUpdate:settings':s,'onDebug:text':d},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0)])])])]))}}),ah=(0,y.A)(th,[['__scopeId','data-v-40e66e51']]),nh={class:'gaem-dialog'},oh={class:'gaem-header'},lh={class:'gaem-title'},rh={class:'subtitle'},ih={class:'mono'},ch={key:0},sh={class:'gaem-toolbar'},dh={class:'field'},uh=['disabled'],mh={class:'select-value'},ph=['onKeydown'],vh={class:'select-options'},gh=['onClick'],fh={class:'opt-name'},yh={class:'opt-id mono'},hh={class:'actions'},kh=['disabled'],Nh=['disabled'],Eh={key:0,class:'gaem-error'},Vh={class:'gaem-body'},bh={key:0,class:'loading'},wh={key:1,class:'empty'},Ch=(0,r.defineComponent)({__name:'GameAssetEditorModal',props:{visible:{type:Boolean},currentEventPack:{}},emits:['update:visible','apply'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(!1),l=(0,r.ref)(''),i=(0,r.ref)([]),c=(0,r.computed)(()=>{try{return sessionStorage.getItem('current_game_event_id')||''}catch{return''}}),s=(0,r.computed)(()=>a.currentEventPack?.name||''),d=(0,r.ref)(''),u=(0,r.ref)(null),m=(0,r.ref)(0),p=(0,r.ref)(null),v=(0,r.ref)(null),g=(0,r.ref)(null),f=(0,r.ref)(!1),y=(0,r.ref)(''),h=(0,r.computed)(()=>{if(!d.value)return'(ËØ∑ÈÄâÊã©‰∫ã‰ª∂ÂåÖ)';const e=i.value.find(e=>e.id===d.value);return e?.name||e?.id||d.value}),k=(0,r.computed)(()=>{const e=y.value.trim().toLowerCase();return e?i.value.filter(t=>{const a=(t.name||'').toLowerCase(),n=(t.id||'').toLowerCase();return a.includes(e)||n.includes(e)}):i.value});function N(){n('update:visible',!1)}function E(){f.value=!1,y.value=''}function V(){f.value?E():o.value||(f.value=!0,(0,r.nextTick)(()=>g.value?.focus()))}function b(e){d.value=e,E()}function w(e){if(!f.value)return;const t=v.value,a=e.target;t&&a&&(t.contains(a)||E())}async function C(){o.value=!0,l.value='';try{const e=await re.idbService.getAllWorks();i.value=e.filter(e=>'EVENT'===e.type).map(e=>e.data)}catch(e){console.error('[GameAssetEditorModal] Failed to load works:',e),l.value='Âä†ËΩΩ‰∫ã‰ª∂ÂåÖÂàóË°®Â§±Ë¥•Ôºö'+(e?.message||String(e)),i.value=[]}finally{o.value=!1}}function S(e){return JSON.parse(JSON.stringify(e))}function B(){l.value='';const e=d.value;if(!e)return;const t=i.value.find(t=>t.id===e);t?(u.value=S(t),m.value++):l.value='Êú™ÊâæÂà∞ÊâÄÈÄâ‰∫ã‰ª∂ÂåÖ„ÄÇ'}function x(){l.value='';const e=d.value||c.value||'';if(!e)return void(l.value='ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™‰∫ã‰ª∂ÂåÖ„ÄÇ');const t=p.value;let a=null;try{t?.getEventPack?a=t.getEventPack():t?.eventPack?.value&&(a=S(t.eventPack.value))}catch(e){console.warn('[GameAssetEditorModal] Failed to read editor state:',e)}a?(a.id=e,n('apply',{boundEventId:e,eventPack:a}),n('update:visible',!1)):l.value='Êó†Ê≥ïËØªÂèñÁºñËæëÂô®ÂÜÖÂÆπÔºåËØ∑ÈáçËØï„ÄÇ'}return(0,r.watch)(()=>a.visible,e=>{e?(d.value=c.value||a.currentEventPack?.id||'',a.currentEventPack?(u.value=S(a.currentEventPack),m.value++):u.value=null,C()):E()}),(0,r.onMounted)(()=>{document.addEventListener('mousedown',w,!0),document.addEventListener('touchstart',w,!0),C()}),(0,r.onBeforeUnmount)(()=>{document.removeEventListener('mousedown',w,!0),document.removeEventListener('touchstart',w,!0)}),(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'#ethereal-overlay-root'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'gaem-overlay',onClick:(0,r.withModifiers)(N,['self'])},[(0,r.createElementVNode)('div',nh,[(0,r.createElementVNode)('div',oh,[(0,r.createElementVNode)('div',lh,[t[4]||(t[4]=(0,r.createElementVNode)('div',{class:'title'},'‰∫ã‰ª∂ÂåÖ / GameAsset ÁºñËæë',-1)),(0,r.createElementVNode)('div',rh,[t[3]||(t[3]=(0,r.createTextVNode)(' ÂΩìÂâçÁªëÂÆöÔºö',-1)),(0,r.createElementVNode)('span',ih,(0,r.toDisplayString)(c.value||'Êú™ÁªëÂÆö'),1),s.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',ch,'Ôºà'+(0,r.toDisplayString)(s.value)+'Ôºâ',1)):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createElementVNode)('button',{class:'gaem-close',onClick:N},'‚úï')]),(0,r.createElementVNode)('div',sh,[(0,r.createElementVNode)('label',dh,[t[7]||(t[7]=(0,r.createElementVNode)('span',{class:'label'},'ÂàáÊç¢ÁªëÂÆö',-1)),(0,r.createElementVNode)('div',{ref_key:'selectRoot',ref:v,class:(0,r.normalizeClass)(['selectbox',{disabled:o.value}])},[(0,r.createElementVNode)('button',{type:'button',class:'select-trigger',disabled:o.value,onClick:V},[(0,r.createElementVNode)('span',mh,(0,r.toDisplayString)(h.value),1),t[5]||(t[5]=(0,r.createElementVNode)('span',{class:'select-chevron'},'‚ñæ',-1))],8,uh),(0,r.createVNode)(r.Transition,{name:'dropdown'},{default:(0,r.withCtx)(()=>[f.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'select-menu',onClick:t[2]||(t[2]=(0,r.withModifiers)(()=>{},['stop']))},[(0,r.withDirectives)((0,r.createElementVNode)('input',{ref_key:'selectSearchRef',ref:g,'onUpdate:modelValue':t[0]||(t[0]=e=>y.value=e),class:'select-search',type:'text',placeholder:'ÊêúÁ¥¢‰∫ã‰ª∂ÂåÖ...',onKeydown:(0,r.withKeys)((0,r.withModifiers)(E,['prevent']),['escape'])},null,40,ph),[[r.vModelText,y.value]]),(0,r.createElementVNode)('div',vh,[(0,r.createElementVNode)('button',{type:'button',class:(0,r.normalizeClass)(['select-option',{selected:''===d.value}]),onClick:t[1]||(t[1]=e=>b(''))},[...t[6]||(t[6]=[(0,r.createElementVNode)('span',{class:'opt-name'},'(ËØ∑ÈÄâÊã©‰∫ã‰ª∂ÂåÖ)',-1)])],2),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(k.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:e.id,type:'button',class:(0,r.normalizeClass)(['select-option',{selected:d.value===e.id}]),onClick:t=>b(e.id)},[(0,r.createElementVNode)('span',fh,(0,r.toDisplayString)(e.name||e.id),1),(0,r.createElementVNode)('span',yh,(0,r.toDisplayString)(e.id),1)],10,gh))),128))])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})],2)]),(0,r.createElementVNode)('div',hh,[(0,r.createElementVNode)('button',{class:'btn',disabled:!d.value,onClick:B},'ËΩΩÂÖ•',8,kh),(0,r.createElementVNode)('button',{class:'btn primary',disabled:!u.value,onClick:x},'Â∫îÁî®Âà∞ÂΩìÂâçÂ≠òÊ°£',8,Nh)])]),l.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Eh,(0,r.toDisplayString)(l.value),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',Vh,[o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',bh,'Âä†ËΩΩ‰∏≠...')):u.value?((0,r.openBlock)(),(0,r.createBlock)(eu,{ref_key:'editorRef',ref:p,key:m.value,'initial-data':u.value,'disable-autosave':!0},null,8,['initial-data'])):((0,r.openBlock)(),(0,r.createElementBlock)('div',wh,[...t[8]||(t[8]=[(0,r.createElementVNode)('div',{class:'hint'},'ÁÇπÂáª‚ÄúËΩΩÂÖ•‚ÄùÂ∞Ü‰∫ã‰ª∂ÂåÖËΩΩÂÖ•‰∏∫ÂèØÁºñËæëËçâÁ®ø„ÄÇ',-1),(0,r.createElementVNode)('div',{class:'hint'},'‚ÄúÂ∫îÁî®Âà∞ÂΩìÂâçÂ≠òÊ°£‚Äù‰ºöÊõ¥Êñ∞ÂΩìÂâçÊ∏∏Êàè‰ΩøÁî®ÁöÑ‰∫ã‰ª∂ÂåÖÔºåÂπ∂ÂΩ±Âìç‰πãÂêéÁöÑÂ≠òÊ°£ÂÜÖÂÆπ„ÄÇ',-1)])]))])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})]))}}),Sh=(0,y.A)(Ch,[['__scopeId','data-v-2b7a117a']]),Bh={class:'node-row'},xh={key:1,class:'toggle-placeholder'},_h={class:'key-name'},Ih={key:2,class:'value-preview'},Th={key:3,class:'value-preview dim'},Ah={class:'node-actions'},Dh={key:0,class:'node-children'},Mh={class:'edit-modal'},Ph={key:0,class:'edit-field'},Oh={class:'edit-field'},Rh={class:'edit-modal'},$h={key:0,class:'edit-field'},Lh={class:'edit-field'},Uh={class:'preset-row','aria-label':'Âø´ÈÄüÁ±ªÂûã'},zh=(0,r.defineComponent)({__name:'VariableDataNode',props:{root:{},parent:{},nodeKey:{},depth:{}},setup(e){const t=e,a=(0,r.ref)(!0),n=(0,r.ref)(!1),o=(0,r.ref)(!1),l=(0,r.computed)(()=>null===t.nodeKey),i=(0,r.computed)(()=>l.value?t.root:t.parent?t.parent[t.nodeKey]:void 0);const c=(0,r.computed)(()=>Array.isArray(i.value)),s=(0,r.computed)(()=>{const e=i.value;return!!e&&'object'==typeof e&&!Array.isArray(e)}),d=(0,r.computed)(()=>c.value||s.value),u=(0,r.computed)(()=>l.value?'root':'number'==typeof t.nodeKey?`[${t.nodeKey}]`:String(t.nodeKey));const m=(0,r.computed)(()=>function(e){if(null===e)return{label:'null',cls:'null'};if(Array.isArray(e))return{label:'Array',cls:'array'};const t=typeof e;return'string'===t?{label:'String',cls:'string'}:'number'===t?{label:'Number',cls:'number'}:'boolean'===t?{label:'Boolean',cls:'boolean'}:'object'===t?{label:'Object',cls:'object'}:'undefined'===t?{label:'undefined',cls:'undefined'}:{label:t,cls:'other'}}(i.value)),p=(0,r.computed)(()=>m.value.label),g=(0,r.computed)(()=>m.value.cls),f=(0,r.computed)(()=>{const e=i.value;if('string'==typeof e){const t=e.length>40?e.slice(0,40)+'‚Ä¶':e;return JSON.stringify(t)}if('number'==typeof e||'boolean'==typeof e)return String(e);if(null===e)return'null';if(void 0===e)return'undefined';try{return JSON.stringify(e)}catch{return String(e)}}),y=(0,r.computed)(()=>{const e=i.value;return Array.isArray(e)?`(${e.length} items)`:e&&'object'==typeof e?`(${Object.keys(e).length} keys)`:''}),h=(0,r.computed)(()=>{const e=i.value,t=[];if(Array.isArray(e))for(let a=0;a<e.length;a++)t.push({key:String(a),parent:e,nodeKey:a});else if(e&&'object'==typeof e)for(const a of Object.keys(e))t.push({key:a,parent:e,nodeKey:a});return t}),k=(0,r.computed)(()=>!l.value&&!Array.isArray(t.parent)),N=(0,r.ref)('json'),E=(0,r.ref)(''),V=(0,r.ref)(''),b=(0,r.ref)(0),w=(0,r.ref)(!1),C=(0,r.ref)('');function S(){const e=i.value;if(E.value='string'==typeof t.nodeKey?t.nodeKey:'','string'==typeof e)N.value='string',V.value=e;else if('number'==typeof e)N.value='number',b.value=Number.isFinite(e)?e:0;else if('boolean'==typeof e)N.value='boolean',w.value=e;else{N.value='json';try{C.value=JSON.stringify(e,null,2)}catch{C.value=String(e)}}n.value=!0}function B(){n.value=!1}function x(e){if(l.value){if(!e||'object'!=typeof e||Array.isArray(e))return;!function(e,t){if(e&&'object'==typeof e){for(const t of Object.keys(e))delete e[t];t&&'object'==typeof t&&!Array.isArray(t)&&Object.assign(e,t)}}(t.root,e)}else t.parent&&(t.parent[t.nodeKey]=e)}function I(){if(k.value){const e=E.value.trim(),a=String(t.nodeKey);if(!e)return;e!==a&&t.parent&&'object'==typeof t.parent&&!Array.isArray(t.parent)&&(t.parent[e]=t.parent[a],delete t.parent[a])}if('string'===N.value)x(V.value);else if('number'===N.value)x('number'==typeof b.value?b.value:0);else if('boolean'===N.value)x(!!w.value);else{const e=(C.value||'').trim();try{x(e?JSON.parse(e):null)}catch{return}}n.value=!1}const T=(0,r.ref)(''),A=(0,r.ref)('null'),D=(0,r.ref)('null');function M(e){D.value=e,A.value='string'===e?JSON.stringify(''):'number'===e?'0':'boolean'===e?'true':'object'===e?'{}':'array'===e?'[]':'null'}function P(){T.value='',M('null'),o.value=!0}function O(){o.value=!1}function R(){const e=i.value;if(!e||'object'!=typeof e)return;let t=null;try{t=JSON.parse((A.value||'').trim()||'null')}catch{return}if(Array.isArray(e))e.push(t);else{const a=T.value.trim();if(!a)return;e[a]=t}o.value=!1,a.value=!0}function L(){l.value||t.parent&&(Array.isArray(t.parent)&&'number'==typeof t.nodeKey?t.parent.splice(t.nodeKey,1):t.parent&&'object'==typeof t.parent&&delete t.parent[t.nodeKey])}return(e,t)=>{const i=(0,r.resolveComponent)('VariableDataNode',!0);return(0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'variable-node',style:(0,r.normalizeStyle)({'--depth':e.depth})},[(0,r.createElementVNode)('div',Bh,[(0,r.createCommentVNode)(' Expand/Collapse '),d.value?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'toggle-btn',onClick:t[0]||(t[0]=e=>a.value=!a.value)},[(0,r.createVNode)(v,{name:a.value?'chevron-down':'chevron-right',size:'0.8em'},null,8,['name'])])):((0,r.openBlock)(),(0,r.createElementBlock)('span',xh)),(0,r.createCommentVNode)(' Key '),(0,r.createElementVNode)('span',_h,(0,r.toDisplayString)(u.value),1),(0,r.createCommentVNode)(' Type '),(0,r.createElementVNode)('span',{class:(0,r.normalizeClass)(['type-badge',g.value])},(0,r.toDisplayString)(p.value),3),(0,r.createCommentVNode)(' Value Preview '),d.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',Th,(0,r.toDisplayString)(y.value),1)):((0,r.openBlock)(),(0,r.createElementBlock)('span',Ih,(0,r.toDisplayString)(f.value),1)),(0,r.createCommentVNode)(' Actions '),(0,r.createElementVNode)('div',Ah,[(0,r.createElementVNode)('button',{class:'action-btn edit',onClick:S,title:'ÁºñËæë'},[(0,r.createVNode)(v,{name:'edit',size:'0.75em'})]),d.value?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn add',onClick:P,title:'Ê∑ªÂä†'},[(0,r.createVNode)(v,{name:'plus',size:'0.75em'})])):(0,r.createCommentVNode)('v-if',!0),l.value?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'action-btn delete',onClick:L,title:'Âà†Èô§'},[(0,r.createVNode)(v,{name:'delete',size:'0.75em'})]))])]),(0,r.createCommentVNode)(' Children '),a.value&&d.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Dh,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(h.value,t=>((0,r.openBlock)(),(0,r.createBlock)(i,{key:t.key,root:e.root,parent:t.parent,'node-key':t.nodeKey,depth:e.depth+1},null,8,['root','parent','node-key','depth']))),128))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Edit Modal '),n.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:1,class:'edit-overlay',onClick:(0,r.withModifiers)(B,['self'])},[(0,r.createElementVNode)('div',Mh,[t[18]||(t[18]=(0,r.createElementVNode)('h4',null,'ÁºñËæëÂèòÈáè',-1)),k.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ph,[t[14]||(t[14]=(0,r.createElementVNode)('label',null,'ÈîÆÂêç (Key)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[1]||(t[1]=e=>E.value=e),type:'text',placeholder:'ÂèòÈáèÈîÆÂêç'},null,512),[[r.vModelText,E.value]])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',Oh,[t[16]||(t[16]=(0,r.createElementVNode)('label',null,'ÂÄº (Value)',-1)),'string'===N.value?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:0,'onUpdate:modelValue':t[2]||(t[2]=e=>V.value=e),type:'text',placeholder:'ÊñáÊú¨'},null,512)),[[r.vModelText,V.value]]):'number'===N.value?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('input',{key:1,'onUpdate:modelValue':t[3]||(t[3]=e=>b.value=e),type:'number',placeholder:'0'},null,512)),[[r.vModelText,b.value,void 0,{number:!0}]]):'boolean'===N.value?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('select',{key:2,'onUpdate:modelValue':t[4]||(t[4]=e=>w.value=e)},[...t[15]||(t[15]=[(0,r.createElementVNode)('option',{value:!0},'true',-1),(0,r.createElementVNode)('option',{value:!1},'false',-1)])],512)),[[r.vModelSelect,w.value]]):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('textarea',{key:3,'onUpdate:modelValue':t[5]||(t[5]=e=>C.value=e),class:'json',spellcheck:'false',placeholder:'ËæìÂÖ• JSONÔºå‰æãÂ¶ÇÔºö\\n\\n{\\n  "a": 1\\n}'},null,512)),[[r.vModelText,C.value]]),t[17]||(t[17]=(0,r.createElementVNode)('div',{class:'hint'},' ÊîØÊåÅÁºñËæë‰ªªÊÑè JSON ÂÄºÔºàÂØπË±°/Êï∞ÁªÑ/Â≠óÁ¨¶‰∏≤/Êï∞Â≠ó/Â∏ÉÂ∞î/nullÔºâ„ÄÇ ',-1))]),(0,r.createElementVNode)('div',{class:'edit-actions'},[(0,r.createElementVNode)('button',{class:'cancel-btn',onClick:B},'ÂèñÊ∂à'),(0,r.createElementVNode)('button',{class:'save-btn',onClick:I},'‰øùÂ≠ò')])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' Add Modal '),o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:2,class:'edit-overlay',onClick:(0,r.withModifiers)(O,['self'])},[(0,r.createElementVNode)('div',Rh,[t[22]||(t[22]=(0,r.createElementVNode)('h4',null,'Ê∑ªÂä†Â≠êÈ°π',-1)),s.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',$h,[t[19]||(t[19]=(0,r.createElementVNode)('label',null,'ÈîÆÂêç (Key)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[6]||(t[6]=e=>T.value=e),type:'text',placeholder:'newKey'},null,512),[[r.vModelText,T.value]])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',Lh,[t[20]||(t[20]=(0,r.createElementVNode)('label',null,'ÂÄº (Value)',-1)),(0,r.createElementVNode)('div',Uh,[(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[7]||(t[7]=e=>M('string'))},'ÊñáÊú¨'),(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[8]||(t[8]=e=>M('number'))},'Êï∞Â≠ó'),(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[9]||(t[9]=e=>M('boolean'))},'Â∏ÉÂ∞î'),(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[10]||(t[10]=e=>M('object'))},'ÂØπË±°'),(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[11]||(t[11]=e=>M('array'))},'Êï∞ÁªÑ'),(0,r.createElementVNode)('button',{type:'button',class:'preset-btn',onClick:t[12]||(t[12]=e=>M('null'))},'null')]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[13]||(t[13]=e=>A.value=e),class:'json',spellcheck:'false',placeholder:'ËæìÂÖ• JSONÔºå‰æãÂ¶ÇÔºö\\n\\n"text"\\n123\\ntrue\\nnull\\n{"a":1}\\n[1,2,3]'},null,512),[[r.vModelText,A.value]]),t[21]||(t[21]=(0,r.createElementVNode)('div',{class:'hint'},[(0,r.createTextVNode)('ÊèêÁ§∫ÔºöÁÇπ‚ÄúÂØπË±°‚Äù‰ºöËá™Âä®Â°´ÂÖ• '),(0,r.createElementVNode)('span',{class:'mono'},'{}'),(0,r.createTextVNode)('ÔºåÂç≥ÂèØÊ∑ªÂä† Object ËäÇÁÇπ„ÄÇ')],-1))]),(0,r.createElementVNode)('div',{class:'edit-actions'},[(0,r.createElementVNode)('button',{class:'cancel-btn',onClick:O},'ÂèñÊ∂à'),(0,r.createElementVNode)('button',{class:'save-btn',onClick:R},'Ê∑ªÂä†')])])])):(0,r.createCommentVNode)('v-if',!0)],4)}}}),Fh=(0,y.A)(zh,[['__scopeId','data-v-ed213a2c']]),Wh={class:'vem-dialog'},jh={class:'vem-header'},Gh={class:'vem-title'},Jh={class:'subtitle'},Yh={class:'mono'},Hh={class:'mono'},Xh={class:'vem-toolbar'},Kh={class:'left'},Qh=['disabled'],qh=['disabled'],Zh={class:'right'},ek=['disabled'],tk={key:0,class:'vem-error'},ak={class:'vem-body'},nk={key:0,class:'loading'},ok={key:1,class:'tree-wrap'},lk={class:'tree-view'},rk={class:'json-preview'},ik={class:'preview-header'},ck=['disabled'],sk={class:'schema-code'},dk=(0,r.defineComponent)({__name:'VariableEditorModal',props:{visible:{type:Boolean},worldbookName:{},entryName:{default:'ÂΩìÂâçÊ∏∏ÊàèÊï∞ÊçÆ'}},emits:['update:visible','applied'],setup(e,{emit:t}){const a=e,n=t,o=(0,r.ref)(!1),l=(0,r.ref)(''),i=(0,r.reactive)({});function c(e,t){if(e&&'object'==typeof e){for(const t of Object.keys(e))delete e[t];t&&'object'==typeof t&&!Array.isArray(t)&&Object.assign(e,t)}}const s=(0,r.computed)(()=>{try{return JSON.stringify(i??{},null,2)}catch{return String(i)}});async function d(){o.value=!0,l.value='';try{const e=await ca(a.worldbookName);c(i,e??{})}catch(e){console.error('[VariableEditorModal] reload failed:',e),l.value='ËØªÂèñÂ§±Ë¥•Ôºö'+(e?.message||String(e))}finally{o.value=!1}}function u(){l.value='';try{const e=JSON.parse(s.value||'{}');if(!e||'object'!=typeof e||Array.isArray(e))return void(l.value='ÂÜÖÂÆπÂøÖÈ°ªÊòØ‰∏Ä‰∏™ JSON ÂØπË±°Ôºà‰∏çËÉΩÊòØÊï∞ÁªÑ/Á©∫ÂÄºÔºâ„ÄÇ');c(i,e)}catch(e){l.value='JSON Ê†ºÂºèÈîôËØØÔºö'+(e?.message||String(e))}}async function m(){try{await navigator.clipboard.writeText(s.value||'')}catch(e){console.warn('[VariableEditorModal] copyJson failed:',e)}}async function p(){o.value=!0,l.value='';try{const e=i;if(!e||'object'!=typeof e||Array.isArray(e))return void(l.value='ÂÜÖÂÆπÂøÖÈ°ªÊòØ‰∏Ä‰∏™ JSON ÂØπË±°Ôºà‰∏çËÉΩÊòØÊï∞ÁªÑ/Á©∫ÂÄºÔºâ„ÄÇ');if(!await sa(JSON.parse(JSON.stringify(e)),a.worldbookName))return void(l.value='‰øùÂ≠òÂ§±Ë¥•ÔºösaveGameData ËøîÂõû false');n('applied',e),n('update:visible',!1)}catch(e){console.error('[VariableEditorModal] apply failed:',e),l.value='‰øùÂ≠òÂ§±Ë¥•Ôºö'+(e?.message||String(e))}finally{o.value=!1}}function v(){n('update:visible',!1)}return(0,r.watch)(()=>a.visible,e=>{e&&d()}),(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'#ethereal-overlay-root'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[e.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'vem-overlay',onClick:(0,r.withModifiers)(v,['self'])},[(0,r.createElementVNode)('div',Wh,[(0,r.createElementVNode)('div',jh,[(0,r.createElementVNode)('div',Gh,[t[3]||(t[3]=(0,r.createElementVNode)('div',{class:'title'},'ÂèòÈáèÁºñËæëÂô®',-1)),(0,r.createElementVNode)('div',Jh,[t[0]||(t[0]=(0,r.createTextVNode)(' WorldbookÔºö',-1)),(0,r.createElementVNode)('span',Yh,(0,r.toDisplayString)(e.worldbookName),1),t[1]||(t[1]=(0,r.createElementVNode)('span',{class:'sep'},'¬∑',-1)),t[2]||(t[2]=(0,r.createTextVNode)(' EntryÔºö',-1)),(0,r.createElementVNode)('span',Hh,(0,r.toDisplayString)(e.entryName),1)])]),(0,r.createElementVNode)('button',{class:'vem-close',onClick:v},'‚úï')]),(0,r.createElementVNode)('div',Xh,[(0,r.createElementVNode)('div',Kh,[(0,r.createElementVNode)('button',{class:'btn',disabled:o.value,onClick:d},'ÈáçËΩΩ',8,Qh),(0,r.createElementVNode)('button',{class:'btn',disabled:o.value,onClick:m},'Â§çÂà∂ JSON',8,qh)]),(0,r.createElementVNode)('div',Zh,[(0,r.createElementVNode)('button',{class:'btn primary',disabled:o.value,onClick:p},'Â∫îÁî®',8,ek)])]),l.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',tk,(0,r.toDisplayString)(l.value),1)):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',ak,[o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',nk,'Âä†ËΩΩ‰∏≠...')):((0,r.openBlock)(),(0,r.createElementBlock)('div',ok,[t[5]||(t[5]=(0,r.createElementVNode)('div',{class:'info-hint'},[(0,r.createElementVNode)('span',{class:'hint-text'},'ÂÉè‰∫ã‰ª∂ÂåÖ‰∏ÄÊ†∑ÁöÑÊ†ëÁä∂ÁºñËæëÔºöÂ±ïÂºÄ/ÁºñËæë/Êñ∞Â¢û/Âà†Èô§ÔºåÊúÄÂêéÁÇπ‚ÄúÂ∫îÁî®‚ÄùÂÜôÂõû‰∏ñÁïå‰π¶„ÄÇ')],-1)),(0,r.createElementVNode)('div',lk,[(0,r.createVNode)(Fh,{root:i,parent:null,'node-key':null,depth:0},null,8,['root'])]),(0,r.createElementVNode)('div',rk,[(0,r.createElementVNode)('div',ik,[t[4]||(t[4]=(0,r.createElementVNode)('div',{class:'preview-title'},'JSON È¢ÑËßà',-1)),(0,r.createElementVNode)('button',{class:'btn',disabled:o.value,onClick:u},'Ê†ºÂºèÂåñ',8,ck)]),(0,r.createElementVNode)('pre',sk,(0,r.toDisplayString)(s.value),1)])]))])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1})]))}}),uk=(0,y.A)(dk,[['__scopeId','data-v-698cb22e']]);function mk(e){if(!e||!vk(e.type)||!vk(e.path))return null;const t=e.type.toUpperCase(),a=fk(e.path);if('Á≥ªÁªü.Êó∂Èó¥'===a||'system.time'===a){const t=gk(e.value);return{text:t?`„ÄêÊó∂Èó¥„Äë${t}`:'„ÄêÊó∂Èó¥„ÄëÂ∑≤Êõ¥Êñ∞',meta:{category:'time',effect:'retype-typo',apply:t?{kind:'time',value:t}:{kind:'none'}}}}if('Á≥ªÁªü.Âú∞ÁÇπ'===a||'system.location'===a){const t=gk(e.value);return{text:t?`„ÄêÂú∞ÁÇπ„Äë${t}`:'„ÄêÂú∞ÁÇπ„ÄëÂ∑≤Êõ¥Êñ∞',meta:{category:'location',effect:'retype-typo',apply:t?{kind:'location',value:t}:{kind:'none'}}}}if('CREATE'===t){const e=a.match(/^ËßíËâ≤\.([^\.]+)$/),t=(e?.[1]||(a.includes('.')?'':a)).trim();if(t)return{text:`„ÄêÊñ∞ËßíËâ≤„ÄëÊñ∞ËÆ§ËØÜ ${t}`,meta:{category:'new-character',effect:'plain',apply:{kind:'none'}}}}const n=yk(a);if(n){const a=n.prop;if(('Â•ΩÊÑüÂ∫¶'===a||'trust'===a)&&('MOD'===t||'UPDATE'===t)){const a=e.value,o='number'==typeof a?a:NaN;if('MOD'===t&&Number.isFinite(o)){const e=o>=0?'+':'';return{text:`„ÄêÂ•ΩÊÑüÂ∫¶„Äë${n.name} ‚ô• ${e}${o}`,meta:{category:'affection',effect:'rise',apply:{kind:'none'}}}}const l=gk(a);return{text:l?`„ÄêÂ•ΩÊÑüÂ∫¶„Äë${n.name} ‚ô• = ${l}`:`„ÄêÂ•ΩÊÑüÂ∫¶„Äë${n.name} Â∑≤Êõ¥Êñ∞`,meta:{category:'affection',effect:'rise',apply:{kind:'none'}}}}}return'UPDATE'===t?{text:`„ÄêÂèòÈáè„Äë${a} Â∑≤Êõ¥Êñ∞`,meta:{category:'generic',effect:'plain',apply:{kind:'none'}}}:'MOD'===t?{text:`„ÄêÂèòÈáè„Äë${a} Â∑≤ÂèòÊõ¥`,meta:{category:'generic',effect:'plain',apply:{kind:'none'}}}:'CREATE'===t?{text:`„ÄêÂèòÈáè„ÄëÂ∑≤ÂàõÂª∫ ${a}`,meta:{category:'generic',effect:'plain',apply:{kind:'none'}}}:'REMOVE'===t?{text:`„ÄêÂèòÈáè„ÄëÂ∑≤ÁßªÈô§ ${a}`,meta:{category:'generic',effect:'plain',apply:{kind:'none'}}}:null}function pk(e){if(!vk(e))return[];const t=ta(e);if(!Array.isArray(t)||0===t.length)return[];const a=[];for(const e of t){const t=mk(e);t&&a.push(t)}return a}const vk=e=>'string'==typeof e&&e.trim().length>0,gk=e=>{if(null==e)return'';if('string'==typeof e)return e;if('number'==typeof e||'boolean'==typeof e)return String(e);try{const t=JSON.stringify(e);return'string'==typeof t?t:''}catch{return''}},fk=e=>e.trim(),yk=e=>{let t=e.match(/^ËßíËâ≤\.([^\.]+)\.(.+)$/);return t?{name:t[1],prop:t[2]}:(t=e.match(/^characters\.([^\.]+)\.(.+)$/),t?{name:t[1],prop:t[2]}:null)};function hk(e){if(!vk(e))return null;const t=pk(e);return t.length>0?t[0]:null}const kk='System',Nk='Summary',Ek=`„Äê${kk}„Äë„Äê${Nk}„Äë„ÄêÂ∞èÊÄªÁªì„Äë„Äê722„Äë`,Vk=`„Äê${kk}„Äë„Äê${Nk}„Äë„ÄêÂ§ßÊÄªÁªì„Äë„Äê723„Äë`,bk=`„Äê${kk}„Äë„Äê${Nk}„Äë„ÄêÂ∞èÊÄªÁªìÂ§á‰ªΩ„Äë„Äê724„Äë`;const wk=e=>(e??'').replace(/\r\n/g,'\n'),Ck=(e,t)=>{const a=(t??'').trim();return a?`<${e}>\n${a}\n</${e}>`:''},Sk=(e,t)=>{const a=wk(Se(e));if(!a)return[];const n=[],o=new RegExp(`<${t}>([\\s\\S]*?)<\\/${t}>`,'gi');let l;for(;null!==(l=o.exec(a));){const e=Ck(t,l[1]??'');e&&n.push(e)}return n},Bk=e=>{const t=Sk(e,'Â∞èÊÄªÁªì'),a=Sk(e,'Â§ßÊÄªÁªì'),n=Sk(e,'small_summary').map(e=>e.replace(/^<small_summary>/i,'<Â∞èÊÄªÁªì>').replace(/<\/small_summary>$/i,'</Â∞èÊÄªÁªì>')),o=[...Sk(e,'big_summary'),...Sk(e,'big-summary')].map(e=>e.replace(/^<(big_summary|big-summary)>/i,'<Â§ßÊÄªÁªì>').replace(/<\/(big_summary|big-summary)>$/i,'</Â§ßÊÄªÁªì>'));return{smallBlocks:[...t,...n].map(e=>e.trim()).filter(Boolean),bigBlocks:[...a,...o].map(e=>e.trim()).filter(Boolean)}},xk=(e,t)=>{const a=(e??'').trim(),n=t.map(e=>(e??'').trim()).filter(Boolean).join('\n\n');return n?a?`${a}\n\n${n}`:n:a};async function _k(e){const{worldbookName:t,finalText:a,resolveUserPlaceholders:n}=e,o='function'==typeof n?n(a):a,{smallBlocks:l,bigBlocks:r}=Bk(o);if(0===l.length&&0===r.length)return{smallAdded:0,bigAdded:0};const i=window;if('function'!=typeof i.getWorldbook||'function'!=typeof i.replaceWorldbook)return console.warn('[SummaryWorldbook] Summary tags found, but worldbook APIs are unavailable'),{smallAdded:0,bigAdded:0};const c=await i.getWorldbook(t),s=(e,t,a)=>{let n=(e=>c.find(t=>t?.name===e))(e);return n||(n={uid:Date.now()+Math.floor(1e5*Math.random()),name:e,enabled:a,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:0,order:t},content:'',probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}},c.push(n)),n.enabled=a,n.position={...n.position??{},type:'after_character_definition',order:t},n},d=s(Ek,722,!0),u=s(Vk,723,!0),m=s(bk,724,!1);if(m.enabled=!1,l.length>0&&(d.content=xk(d.content,l)),r.length>0&&(u.content=xk(u.content,r)),r.length>0){const e=Bk(d.content??'').smallBlocks.map(e=>(e??'').trim()).filter(Boolean);e.length>0&&(m.content=xk(m.content,e)),d.content=''}return await i.replaceWorldbook(t,c,{render:'debounced'}),console.log('[SummaryWorldbook] ‚úì Summary entries updated',{small:l.length,big:r.length}),{smallAdded:l.length,bigAdded:r.length}}const Ik={class:'background-layer'},Tk={class:'bg-frame'},Ak=['src'],Dk={class:'character-layer'},Mk=['src'],Pk={class:'log-panel'},Ok={class:'log-header'},Rk={class:'log-content'},$k=['onClick'],Lk={class:'log-item-header'},Uk={class:'log-name'},zk={class:'log-text'},Fk={class:'exit-confirm-dialog'},Wk={class:'dialog-icon'},jk={class:'dialog-actions'},Gk='current_game_protagonist_ref',Jk='current_game_protagonist',Yk='ÂêåÊ¢¶',Hk=(0,r.defineComponent)({__name:'MainGame',setup(e){try{window.__MYCARD_PHASE__='MainGame:setup';try{const e=window.top;e&&e!==window&&(e.__MYCARD_PHASE__=window.__MYCARD_PHASE__)}catch{}}catch{}const t=(0,r.ref)(!1),a=(0,r.ref)(!1),n=(0,r.ref)(!1),o=(0,r.ref)(!1),l=(0,r.ref)(!1),c=(0,r.ref)(!1),s=(0,r.reactive)([]),{getAsset:d}=zv(),u=(0,i.useRouter)(),m=(0,r.ref)(!1);let p=!1;const g=(0,r.ref)(!1),f=(0,r.ref)(!1),y=(0,r.reactive)({w:0,h:0}),h=(0,r.computed)(()=>{const e=y.w,t=y.h;return{'--stable-vw':e?`${e}px`:void 0,'--stable-vh':t?`${t}px`:void 0}}),k=(e=!1)=>{const t=Math.max(0,Math.floor(window.innerWidth||0)),a=Math.max(0,Math.floor(window.innerHeight||0));if(!t||!a)return;const n=Math.abs(t-(y.w||t))>80;(e||0===y.w||0===y.h||n)&&(y.w=t,y.h=a)},N=()=>k(!1);(0,r.onUnmounted)(()=>{p=!0;try{Ge&&clearTimeout(Ge)}catch{}try{te&&clearTimeout(te)}catch{}try{xe&&clearTimeout(xe)}catch{}try{be&&clearTimeout(be)}catch{}try{window.removeEventListener('resize',N)}catch{}});const E=(0,r.ref)(''),V=(0,r.ref)(''),b=async()=>{try{const e=sessionStorage.getItem(Gk);if(e){const t=JSON.parse(e);E.value='string'==typeof t?.name?t.name:'';const a='string'==typeof t?.runtimeId?t.runtimeId:'';if(a){const e=await re.idbService.getRuntimeAsset(a);V.value='string'==typeof e?.imageUrl?e.imageUrl:''}return}}catch(e){console.warn('[MainGame] Failed to load protagonist ref from session:',e)}try{const e=sessionStorage.getItem(Jk);if(!e)return;const t=JSON.parse(e);t&&'object'==typeof t&&(E.value='string'==typeof t.name?t.name:'',V.value='string'==typeof t.imageUrl?t.imageUrl:'')}catch(e){console.warn('[MainGame] Failed to load protagonist legacy from session:',e)}},w=e=>{if(!e)return'';const t=E.value?.trim()||'Áé©ÂÆ∂';return e.replace(/<user>/gi,t)},C=(0,r.ref)(null),S=(0,r.ref)(null),B=(0,r.ref)([]);const x=(0,r.reactive)({fontSize:18,textSpeed:30,autoSpeed:2e3,bgImage:'',charImage:'',dialogueTextColor:'#f1f5f9',narrationTextColor:'#f1f5f9',psychTextColor:'#a78bfa',performanceEnabled:!0,debugMode:!1,charScale:80,charX:50,charY:0,dialogueWidth:90,dialogueOpacity:85,dialogueHeight:200,dialoguePaddingX:2.5,dialoguePaddingY:2,dialogueBottom:3,layoutConfigs:{1:[{charScale:80,charX:50,charY:0}],2:[{charScale:75,charX:30,charY:0},{charScale:75,charX:70,charY:0}],3:[{charScale:70,charX:20,charY:0},{charScale:75,charX:50,charY:0},{charScale:70,charX:80,charY:0}],4:[{charScale:65,charX:15,charY:0},{charScale:70,charX:38,charY:0},{charScale:70,charX:62,charY:0},{charScale:65,charX:85,charY:0}]},autoBigSummaryEnabled:!1,autoBigSummaryInterval:25}),I=e=>{try{sessionStorage.setItem('auto_big_summary_need_big',e?'1':'0')}catch{}},T=(0,r.computed)(()=>x.bgImage||''),A=(0,r.ref)({bgImage:'',charImage:'',dialogueQueue:[]}),D=(0,r.ref)(1),M=(0,r.computed)(()=>{const e=x.layoutConfigs?.[D.value],t=e?.[0]||{charScale:80,charX:50,charY:0};return{left:`${t.charX}%`,transform:'translateX(-50%)',bottom:`${t.charY}%`,height:`${t.charScale}%`}}),P=(0,r.ref)(''),O=(e=250)=>{ke(JSON.parse(JSON.stringify((0,r.toRaw)(x))),e)},R=async e=>{const t=x.debugMode,a=e.debugMode??t;try{const t='auto_bg_mode';a||'string'!=typeof e?.bgImage||e.bgImage===x.bgImage||sessionStorage.setItem(t,'0')}catch{}!t&&a&&(A.value={bgImage:x.bgImage||'',charImage:x.charImage||'',dialogueQueue:[...K]}),t&&!a&&(void 0!==A.value.bgImage&&(e.bgImage=A.value.bgImage),void 0!==A.value.charImage&&(e.charImage=A.value.charImage),A.value.dialogueQueue.length>0&&(K.splice(0,K.length,...A.value.dialogueQueue),Q.value=0)),(()=>{if(a)return;if('string'==typeof e.bgImage?e.bgImage:x.bgImage)return;const t=(0,ya.getAllBackgroundImages)();if(t.length>0&&t[0]?.imageUrl)return void(e.bgImage=t[0].imageUrl);const n=C.value?.sceneBackgrounds;if(Array.isArray(n)&&n.length>0){const t=n[0],a='string'==typeof t?t:t?.imageUrl||'';a&&(e.bgImage=a)}})(),Object.assign(x,e),O(),$e(),await Je()};function F(e){try{return JSON.parse(JSON.stringify(e,(e,t)=>{if('function'!=typeof t&&'symbol'!=typeof t)return'bigint'==typeof t?t.toString():t}))}catch{return}}function j(e){const t=Array.isArray(e)?e.length:0;let a=0,n=0;for(const t of e){const e='string'==typeof t?.text?t.text.length:0;a+=e,e>n&&(n=e)}return{count:t,totalTextChars:a,maxTextChars:n}}function J(e,t){const a=Array.isArray(e?.dialogueQueue)?e.dialogueQueue:[],n=Array.isArray(e?.historyLog)?e.historyLog:[];return{...e,dialogueQueue:a.slice(Math.max(0,a.length-t)),historyLog:n.slice(Math.max(0,n.length-t)),__trimmed:!0,__keepTailCount:t}}function H(e){const t='string'==typeof e?.name?e.name:'',a='string'==typeof e?.text?e.text:'',n='string'==typeof e?.emotion?e.emotion:void 0,o='string'==typeof e?.outfit?e.outfit:void 0,l='performance'===e?.kind?'performance':'dialogue'===e?.kind?'dialogue':void 0;let r;if(e?.performance&&'object'==typeof e.performance){const t=e.performance??{};r={};for(const e of Object.keys(t)){const a=t[e];if('function'==typeof a)continue;const n=F(a);void 0!==n&&(r[e]=n)}}return{name:t,text:a,emotion:n,outfit:o,kind:l,performance:r}}function X(e){return{name:'string'==typeof e?.name?e.name:'',text:'string'==typeof e?.text?e.text:'',emotion:'string'==typeof e?.emotion?e.emotion:void 0,outfit:'string'==typeof e?.outfit?e.outfit:void 0,kind:'performance'===e?.kind?'performance':'dialogue',performance:e?.performance&&'object'==typeof e.performance?e.performance:void 0}}(0,r.onMounted)(async()=>{k(!0);try{window.addEventListener('resize',N,{passive:!0})}catch{}try{window.__MYCARD_PHASE__='MainGame:onMounted:begin'}catch{}await(async()=>{try{const e=await ye();e.layoutConfigs||(e.layoutConfigs={1:[{charScale:80,charX:50,charY:0}],2:[{charScale:75,charX:30,charY:0},{charScale:75,charX:70,charY:0}],3:[{charScale:70,charX:20,charY:0},{charScale:75,charX:50,charY:0},{charScale:70,charX:80,charY:0}],4:[{charScale:65,charX:15,charY:0},{charScale:70,charX:38,charY:0},{charScale:70,charX:62,charY:0},{charScale:65,charX:85,charY:0}]}),Object.assign(x,e)}catch(e){console.error('Failed to load settings',e)}})(),await b();let e=!1;await(0,ya.An)();try{window.__MYCARD_PHASE__='MainGame:onMounted:afterHydrateAssets'}catch{}try{let t=null,a=null;const n=sessionStorage.getItem('restore_save_id');if(n)try{const e=await re.idbService.getSave(n);a=e??null,t=e?.sessionData}finally{sessionStorage.removeItem('restore_save_id')}const o=t?null:sessionStorage.getItem('restore_save_ref');if(o)try{const e=JSON.parse(o),a='string'==typeof e?.runtimeId?e.runtimeId:'';a&&(t=await re.idbService.getRuntimeAsset(a),await re.idbService.deleteRuntimeAsset(a).catch(()=>{}))}finally{sessionStorage.removeItem('restore_save_ref')}if(!t){const e=sessionStorage.getItem('restore_save_data');e&&(t=JSON.parse(e),sessionStorage.removeItem('restore_save_data'))}if(t){console.log('[MainGame] Restoring save session data'),e=!0,g.value=!0;try{window.__MYCARD_PHASE__='MainGame:restore:sessionData'}catch{}try{const e=t?.lastFinalText,a='string'==typeof e&&e.trim()?e:Pe(t);if(a&&'string'==typeof a){const e=De(a),t=2e4;sessionStorage.setItem('last_final_text',e.length>t?e.slice(e.length-t):e)}else sessionStorage.removeItem('last_final_text')}catch{}if(t.eventPackData){try{(0,ya.w7)(t.eventPackData)}catch(e){console.warn('[MainGame] Failed to ensure game assets from saved eventPackData:',e)}try{C.value=t.eventPackData}catch{}}try{const e=sessionStorage.getItem('current_game_event_id');if(!e||!e.trim()){const e='string'==typeof a?.eventPackId&&a.eventPackId||('string'==typeof t?.eventPackData?.id?String(t.eventPackData.id):'');e&&sessionStorage.setItem('current_game_event_id',e)}}catch{}if(t.dialogueQueue){K.splice(0,K.length,...t.dialogueQueue);const e='number'==typeof t.currentLineIndex?t.currentLineIndex:0,a=Math.max(0,K.length-1);Q.value=Math.min(Math.max(e,0),a)}if(t.historyLog&&q.splice(0,q.length,...t.historyLog),t.gameSettings){const e=Array.isArray(x.enabledSidebarWidgets)?[...x.enabledSidebarWidgets]:null;Object.assign(x,t.gameSettings);const a=x.enabledSidebarWidgets;!e||Array.isArray(a)&&0!==a.length||(x.enabledSidebarWidgets=e)}if(Ee(),Ve(),t.protagonist){const e=`restore_${Date.now()}_protagonist`;await re.idbService.setRuntimeAsset(e,{imageUrl:t.protagonist.imageUrl||''}),sessionStorage.setItem(Gk,JSON.stringify({name:t.protagonist.name||'',runtimeId:e})),await b()}}}catch(e){console.error('[MainGame] Failed to restore save data:',e)}const a=sessionStorage.getItem('new_game_start_text');let o=!!a;const r=sessionStorage.getItem('current_game_event_id'),i=sessionStorage.getItem('current_game_char_ids');try{window.__MYCARD_PHASE__='MainGame:loadContext:begin'}catch{}if(r&&!C.value)try{const e=(await re.idbService.getAllWorks()).find(e=>'EVENT'===e.type&&e.id===r);if(e){C.value=e.data,console.log('[MainGame] Loaded Event Pack:',C.value.name);try{window.__MYCARD_PHASE__='MainGame:loadContext:afterEventPackLoaded'}catch{}try{(0,ya.w7)(C.value)}catch(e){console.warn('[MainGame] Failed to ensure game assets from loaded event pack:',e)}if(!x.debugMode&&!x.bgImage){const e=(0,ya.getAllBackgroundImages)();if(e.length>0&&e[0]?.imageUrl)x.bgImage=e[0].imageUrl,O();else{const e=C.value?.sceneBackgrounds;if(Array.isArray(e)&&e.length>0){const t=e[0],a='string'==typeof t?t:t?.imageUrl||'';a&&(x.bgImage=a,O())}}}$e(),await Le()}}catch(e){console.error('[MainGame] Failed to load event pack context',e)}if(a&&(console.log('[MainGame] Found start text from NewGame'),sessionStorage.removeItem('new_game_start_text'),await tt(a)),i)try{B.value=JSON.parse(i)}catch(e){console.error('[MainGame] Failed to parse char ids',e)}if(!o&&!e){const e=await W(),a=e?.mainGame,o=sessionStorage.getItem('current_game_event_id')||'',r='string'==typeof a?.eventPackId?String(a.eventPackId):'',i=!(!o||!r||o===r);if(a&&a.hasActiveGame&&!i){console.log('[MainGame] Restoring complete game state from persistence'),g.value=!0;try{const e='string'==typeof a?.eventPackOverrideRuntimeId?String(a.eventPackOverrideRuntimeId):'';if(e){const t=await re.idbService.getRuntimeAsset(e),a='string'==typeof t?.id?t.id:'';if(!o||!a||a===o){C.value=t,S.value=e;try{(0,ya.w7)(C.value)}catch(e){console.warn('[MainGame] Failed to ensure game assets from overridden event pack:',e)}}}}catch(e){console.warn('[MainGame] Failed to restore event pack override from persistence:',e)}let e=null;try{const t=('string'==typeof a.payloadRuntimeId?a.payloadRuntimeId:'')||L;e=await re.idbService.getRuntimeAsset(t)??null,e&&Array.isArray(e.dialogueQueue)||(e=null)}catch{e=null}if(e?.dialogueQueue&&e.dialogueQueue.length>0)try{K.splice(0,K.length,...e.dialogueQueue.map(e=>X(e))),console.log(`[MainGame] ‚úì ‰ªé IndexedDB ÊÅ¢Â§ç‰∫Ü ${K.length} Êù°ÂØπËØù`)}catch(e){console.warn('[MainGame] Failed to hydrate dialogueQueue from payload:',e)}if(e?.historyLog&&Array.isArray(e.historyLog)&&e.historyLog.length>0)try{q.splice(0,q.length,...e.historyLog.map(e=>X(e))),console.log(`[MainGame] ‚úì ‰ªé IndexedDB ÊÅ¢Â§ç‰∫Ü ${q.length} Êù°ÂéÜÂè≤ËÆ∞ÂΩï`)}catch(e){console.warn('[MainGame] Failed to hydrate historyLog from payload:',e)}try{window.__MYCARD_PHASE__='MainGame:restore:persistence'}catch{}if(0===K.length&&a.dialogueQueue&&a.dialogueQueue.length>0&&(K.splice(0,K.length,...a.dialogueQueue.map(e=>X(e))),console.log(`[MainGame] ‚úì (fallback) ÊÅ¢Â§ç‰∫Ü ${K.length} Êù°ÂØπËØù`)),0===q.length&&a.historyLog&&a.historyLog.length>0&&(q.splice(0,q.length,...a.historyLog.map(e=>X(e))),console.log(`[MainGame] ‚úì (fallback) ÊÅ¢Â§ç‰∫Ü ${q.length} Êù°ÂéÜÂè≤ËÆ∞ÂΩï`)),0===K.length&&q.length>0){const e=q[q.length-1];K.splice(0,K.length,{...e,kind:'dialogue'}),console.log('[MainGame] ‚úì (fallback) ‰ΩøÁî®ÊúÄÂêé‰∏ÄÊù°ÂéÜÂè≤ËÆ∞ÂΩïÈáçÂª∫ÂØπËØùÊòæÁ§∫')}if(K.length>0){const e='number'==typeof a.dialogueIndex?a.dialogueIndex:Math.max(0,K.length-1),t=Math.max(0,K.length-1);Q.value=Math.min(Math.max(e,0),t),console.log(`[MainGame] ‚úì ÂΩìÂâçÁ¥¢Âºï: ${Q.value}`)}a.gameSettings&&(Object.assign(x,a.gameSettings),console.log('[MainGame] ‚úì ÊÅ¢Â§ç‰∫ÜÊ∏∏ÊàèËÆæÁΩÆ')),await Le(),Ee(),Ve(),'settings'===a.activeModal?t.value=!0:'saveload'===a.activeModal?n.value=!0:'errorlog'===a.activeModal&&(l.value=!0);try{await Ye({eventPackId:a.eventPackId||sessionStorage.getItem('current_game_event_id')||void 0})}catch{}if(0===K.length&&!f.value){f.value=!0;const t=a.eventPackId||sessionStorage.getItem('current_game_event_id')||e?.eventPackId;await async function(e){try{const t=await re.idbService.getAllSaves(),a=(Array.isArray(t)?t:[]).filter(t=>{const a=t?.sessionData?.dialogueQueue;return!(!Array.isArray(a)||0===a.length)&&('string'!=typeof e||!e.trim()||t?.eventPackId===e)}).sort((e,t)=>(t.timestamp||0)-(e.timestamp||0)),n=a[0];if(!n)return!1;const o=n.sessionData,l=Array.isArray(o?.dialogueQueue)?o.dialogueQueue.map(e=>X(e)):[],r=Array.isArray(o?.historyLog)?o.historyLog.map(e=>X(e)):[];if(0===l.length)return!1;K.splice(0,K.length,...l),q.splice(0,q.length,...r);const i='number'==typeof o?.currentLineIndex?o.currentLineIndex:Math.max(0,l.length-1),c=Math.max(0,l.length-1);return Q.value=Math.min(Math.max(i,0),c),o?.gameSettings&&'object'==typeof o.gameSettings&&Object.assign(x,o.gameSettings),g.value=!0,Ee(),Ve(),await Ye({eventPackId:n?.eventPackId||e}),!0}catch(e){return console.warn('[MainGame] tryRecoverDialogueFromLocalSaves failed:',e),!1}}('string'==typeof t&&t.trim()?t:void 0)&&_e('‚úì Â∑≤‰ªéÊú¨Âú∞Â≠òÊ°£ÊÅ¢Â§çÂØπËØù',!0,2e3)}}try{window.__MYCARD_PHASE__='MainGame:restore:done'}catch{}}}),(0,r.watch)(()=>x.performanceEnabled,()=>{Ee()}),(0,r.watch)([()=>t.value,()=>n.value,()=>l.value],([e,t,a])=>{if(m.value||p)return;let n=null;e?n='settings':t?n='saveload':a&&(n='errorlog'),Y({activeModal:n})});const K=(0,r.reactive)([]),Q=(0,r.ref)(0),q=(0,r.reactive)([]),Z=(0,r.ref)(!1),ee=(0,r.ref)(!1);let te=null;const ae=(0,r.ref)(!1),ne=(0,r.ref)(null),oe=(0,r.ref)(null),le=(0,r.ref)(''),ie=(0,r.ref)(''),ce=(0,r.computed)(()=>K.length>0&&Q.value<K.length?K[Q.value]:{name:'',text:''}),se=e=>{if(0===K.length)return null;for(let t=Math.min(Math.max(e,0),Math.max(0,K.length-1));t>=0;t--){const e=K[t];if(e&&('performance'!==e.kind&&'string'==typeof e.text&&e.text.trim()))return e}return null},de=(0,r.computed)(()=>{const e=ce.value,t='string'==typeof e?.name?e.name:'',a='string'==typeof e?.text?e.text:'';if(g.value&&0===K.length)return{name:'',text:'ÔºàÂØπËØùÊï∞ÊçÆÊú™‰ªéÊåÅ‰πÖÂåñÊÅ¢Â§ç„ÄÇ\nÁÇπÂáªÊ≠§Â§ÑÊâìÂºÄ‚ÄúËØªÊ°£‚ÄùÂ∞ùËØï‰øÆÂ§çÔºõÊàñËøîÂõû‰∏ªÈ°µÈáçÊñ∞ËøõÂÖ•„ÄÇÔºâ'};if(!ue(e)&&a.trim())return{name:t,text:a};if(ue(e)&&pe.value){const e=se(Q.value-1);return e?{name:e.name||'',text:e.text||''}:{name:'',text:''}}if(ue(e)&&!pe.value){if(a.trim())return{name:t||'',text:a};const e=se(Q.value-1);return e?{name:e.name||'',text:e.text||''}:{name:'',text:''}}return null}),ue=e=>'performance'===e?.kind,me=e=>!!(e&&ue(e)&&e.performance)&&('time'===e.performance.category||'location'===e.performance.category),pe=(0,r.computed)(()=>!!x.performanceEnabled&&(!!ue(ce.value)&&(!me(ce.value)&&!!ce.value.text))),ve=e=>!!e&&(!ue(e)||!!x.performanceEnabled),ge=e=>!!e&&(!ue(e)&&('string'==typeof e.text&&!!e.text.trim())),fe=e=>{if(0===K.length)return 0;const t=Math.min(Math.max(e,0),Math.max(0,K.length-1));for(let e=t;e>=0;e--)if(ge(K[e]))return e;for(let e=t+1;e<K.length;e++)if(ge(K[e]))return e;return t},Ne=(e,t)=>{if(0===K.length)return 0;let a=e;for(;a>=0&&a<K.length;){if(ve(K[a]))return a;a+=t}return Math.min(Math.max(e,0),Math.max(0,K.length-1))},Ee=()=>{if(0===K.length)return;if(ve(ce.value))return;const e=Ne(Q.value,1);if(ve(K[e]))return void(Q.value=e);const t=Ne(Q.value,-1);Q.value=t},Ve=()=>{if(0===K.length)return;if(ge(ce.value))return;const e=fe(Q.value);e!==Q.value&&(Q.value=e)};let be=null;(0,r.watch)(()=>ce.value,e=>{be&&(clearTimeout(be),be=null),me(e)&&x.performanceEnabled&&(be=setTimeout(()=>{m.value||p||ce.value===e&&He()},800))},{immediate:!0});const we=(0,r.ref)(!1),Ce=(0,r.ref)(''),Se=(0,r.ref)(!0);let xe=null;const _e=(e,t=!0,a=3e3)=>{Ce.value=e,Se.value=t,we.value=!0,xe&&clearTimeout(xe),a>0&&(xe=setTimeout(()=>{we.value=!1},a))},Ie=()=>{s.splice(0,s.length),_e('Â∑≤Ê∏ÖÁ©∫ÈîôËØØÊó•Âøó',!0,2e3)},Te=e=>{try{return JSON.stringify(e,null,2)}catch{try{return String(e)}catch{return'[unserializable]'}}},Ae=async e=>{const t=(e=>{const t=String(e??'').trim();return t?t.includes('[$$')?t:`[$$\n${t}\n$$]`:''})(e);if(t)try{const e=await da(t);if(e.errors.length>0){const a=Array.isArray(e.errorDetails)&&e.errorDetails.length>0?e.errorDetails:[];a.length>0?a.forEach(e=>{s.push({timestamp:Date.now(),message:e.message,command:e.rawCommand,details:Te({code:e.code,commandType:e.commandType,path:e.path,normalizedPath:e.normalizedPath,details:e.details})})}):e.errors.forEach(e=>{s.push({timestamp:Date.now(),message:e,command:t})}),_e(`‚ö† ÈáçÊñ∞Â§ÑÁêÜÔºö${e.errors.length} Êù°Êåá‰ª§Â§±Ë¥•`,!1,3e3)}else e.commandsExecuted>0?_e('‚úì Â∑≤ÈáçÊñ∞Â∫îÁî®ÂèòÈáèÊåá‰ª§',!0,2e3):_e('Êú™Ê£ÄÊµãÂà∞ÂèØÊâßË°åÁöÑÂèòÈáèÊåá‰ª§',!1,2500);try{await Le()}catch{}}catch(e){s.push({timestamp:Date.now(),message:'ÈáçÊñ∞Â§ÑÁêÜÂèòÈáèÊó∂ÂèëÁîüÂºÇÂ∏∏',command:t,details:e?.message||String(e)}),_e('ÈáçÊñ∞Â§ÑÁêÜÂ§±Ë¥•',!1,2500)}},Me=e=>{const t=e.split('\n'),a=[];let n='',o='',l='',r=[],i=!1,c=!1,s=[];const d=e=>{let t=e??'';for(;t;){if(i){const e=t.indexOf('--\x3e');if(-1===e)return'';t=t.slice(e+3),i=!1;continue}const e=t.indexOf('\x3c!--');if(-1===e)return t;const a=t.indexOf('--\x3e',e+4);if(-1===a)return i=!0,t.slice(0,e);t=t.slice(0,e)+t.slice(a+3)}return t},u=()=>{r.length>0&&a.push({name:'Narrator'===n?'':n,text:r.join('\n'),emotion:o,outfit:l}),r=[]},m=()=>{const e=s.join('\n');s=[],c=!1;const t=`[$$\n${e}\n$$]`,n=pk(t);if(n.length>0)for(const e of n){const t='time'===e?.meta?.category||'location'===e?.meta?.category;a.push({name:'',text:t?'':e.text||'„ÄêÂèòÈáè„ÄëÂ∑≤Êõ¥Êñ∞',kind:'performance',performance:e.meta})}else{const n=hk(t);if(n){const e='time'===n?.meta?.category||'location'===n?.meta?.category||'time'===n?.meta?.apply?.kind||'location'===n?.meta?.apply?.kind;a.push({name:'',text:e?'':n.text||`„ÄêÂèòÈáè„Äë${t}`,kind:'performance',performance:n.meta})}else a.push({name:'',text:`„ÄêÂèòÈáè„Äë${e.trim()||'Â∑≤Êõ¥Êñ∞'}`,kind:'performance'})}};for(const e of t){const t=d(e).trim();if(!t)continue;if(c){const e=t.indexOf('$$]');if(-1!==e){const a=t.slice(0,e).trim();a&&s.push(a),u(),m();continue}s.push(t);continue}if(t.startsWith('[$$')){if(-1!==t.indexOf('$$]')){u();const e=pk(t);if(e.length>0)for(const n of e){const e='time'===n?.meta?.category||'location'===n?.meta?.category;a.push({name:'',text:e?'':n.text||`„ÄêÂèòÈáè„Äë${t}`,kind:'performance',performance:n.meta})}else{const e=hk(t),n='time'===e?.meta?.category||'location'===e?.meta?.category||'time'===e?.meta?.apply?.kind||'location'===e?.meta?.apply?.kind;a.push({name:'',text:n?'':e?.text||`„ÄêÂèòÈáè„Äë${t}`,kind:'performance',performance:e?.meta})}continue}c=!0;const e=t.slice(3).trim();e&&s.push(e);continue}const i=t.replace(/^[\u201c\u201d\u2018\u2019"'‚Äú‚Äù‚Äò‚Äô]+/,'').match(/^\[(.*?)\](.*)$/);if(i){const e=(i[1]??'').trim(),t=(i[2]??'').trim(),a=e.split('|').map(e=>e.trim()).filter(e=>e.length>0);if(a.length>=2){u(),n=a[0],o='null'===a[1]?.toLowerCase()?'':a[1]??'',l='null'===a[2]?.toLowerCase()?'':a[2]??'',t&&r.push(t);continue}}r.push(t)}return u(),a},Re=e=>{if(!e)return;K.splice(0,K.length);const t=Me(e);t.length>0&&(K.push(...t),Q.value=0)},$e=async()=>{const e=('string'==typeof ce.value?.name?String(ce.value.name):'').trim();if(e&&!ue(ce.value)){if(x.debugMode){const t=await d('char',e);return t?void(P.value=t.data):void(P.value='')}{const t=e,a=t.toLowerCase(),n=E.value.trim(),o=n&&t===n||'user'===a||'<user>'===a||'Áé©ÂÆ∂'===t||'‰∏ªËßí'===t;if(o&&V.value)return void(P.value=V.value);if(o&&x.charImage)return void(P.value=x.charImage)}if(C.value){const t=e,a=ce.value?.emotion?.trim?.()||'',n=ce.value?.outfit?.trim?.()||'';if(t){const e=ba(C.value,t,a,n);if(e)return void(P.value=e)}}P.value=''}else P.value=''},Le=async()=>{if(x.debugMode)return;const e='auto_bg_mode',t='auto_bg_last_url';try{const a=await ca(Yk),n=('string'==typeof a?.Á≥ªÁªü?.Âú∞ÁÇπ?a.Á≥ªÁªü.Âú∞ÁÇπ:'')||('string'==typeof a?.system?.location?a.system.location:'')||'',o=Ba(C.value)||(()=>{const e=(0,ya.getAllBackgroundImages)();return e.length>0&&e[0]?.imageUrl?e[0].imageUrl:''})(),l=function(e,t){const a=Na(t);if(!e||!a)return'';const n=Array.isArray(e.backgroundImages)?e.backgroundImages:[],o=Array.isArray(e.sceneBackgrounds)?e.sceneBackgrounds:[];if(0===n.length&&0===o.length)return'';let l=0,r=[];for(const e of n){const t=wa(e);if(!t)continue;const n=Na(e.imageUrl);if(!n)continue;const o=(0,ha.Ao)(t,a,'includes');o<=0||(o>l?(l=o,r=[n]):o===l&&r.push(n))}for(const e of o){const t=Sa(e);if(!t)continue;const n=Ca(e);if(!n)continue;const o=(0,ha.Ao)(t,a,'includes');o<=0||(o>l?(l=o,r=[n]):o===l&&r.push(n))}if(l>0){if(1===r.length)return r[0];const t=`${e.id||''}|${a}|${r.join('|')}`;return r[Ea(t)%r.length]}return''}(C.value,n);if(l){x.bgImage=l;try{sessionStorage.setItem(e,'1'),sessionStorage.setItem(t,l)}catch{}return}if(o&&x.bgImage!==o){x.bgImage=o;try{sessionStorage.setItem(e,'1'),sessionStorage.setItem(t,o)}catch{}}}catch(e){console.warn('[MainGame] Failed to apply background from location:',e)}};async function Fe(e){try{await sa(e,Yk).catch(()=>!1);const{time:a,location:n}=(t=e,{time:('string'==typeof t?.Á≥ªÁªü?.Êó∂Èó¥?t.Á≥ªÁªü.Êó∂Èó¥:'')||('string'==typeof t?.system?.time?t.system.time:'')||'',location:('string'==typeof t?.Á≥ªÁªü?.Âú∞ÁÇπ?t.Á≥ªÁªü.Âú∞ÁÇπ:'')||('string'==typeof t?.system?.location?t.system.location:'')||''});le.value=a||le.value,ie.value=n||ie.value,ne.value=a||null,oe.value=n||null,await Le(),_e('ÂèòÈáèÂ∑≤Â∫îÁî®',!0,1800)}catch(e){console.warn('[MainGame] handleVariablesApplied failed:',e),_e('ÂèòÈáèÂ∫îÁî®Â§±Ë¥•',!1,2e3)}var t}const je=(0,r.computed)(()=>JSON.stringify(ce.value));(0,r.watch)(je,()=>{$e()}),(0,r.watch)(()=>x,()=>{$e()},{deep:!0});let Ge=null;const Je=async()=>{m.value||(Ge&&clearTimeout(Ge),Ge=setTimeout(async()=>{try{if(0===K.length&&0===q.length)return;const e=sessionStorage.getItem('current_game_event_id'),t=sessionStorage.getItem('current_game_char_ids'),a=ge(ce.value)?Q.value:fe(Q.value);try{const t={eventPackId:e||void 0,savedAt:Date.now(),dialogueQueue:K.map(e=>H(e)),historyLog:q.map(e=>H(e))};try{await re.idbService.setRuntimeAsset(L,t)}catch(e){const a=function(e){try{const t=JSON.stringify(e);return(new TextEncoder).encode(t).length}catch{return null}}(t),n=j(t.dialogueQueue),o=j(t.historyLog);if(console.warn('[MainGame] Failed to persist large state payload to IndexedDB:',e),console.warn('[MainGame] Persist payload stats:',{id:L,bytes:a,dialogue:n,history:o,errorName:e?.name,errorMessage:e?.message}),function(e){const t=e?.name,a=e?.message,n=`${t||''} ${a||''}`.toLowerCase();return n.includes('too large')||n.includes('quota')||n.includes('exceeded')}(e)){const e=[800,400,200,100];for(const a of e)try{const e=J(t,a);await re.idbService.setRuntimeAsset(L,e),console.warn('[MainGame] Retried IDB persist with trimmed payload:',{keepTailCount:a});break}catch{}}}}catch(e){console.warn('[MainGame] Failed to persist large state payload to IndexedDB:',e)}await Y({hasActiveGame:!0,eventPackId:e||void 0,eventPackOverrideRuntimeId:S.value||void 0,characterIds:t?JSON.parse(t):void 0,payloadRuntimeId:L,dialogueQueue:void 0,dialogueIndex:a,historyLog:void 0,gameSettings:{...x}}),console.log(`[MainGame] ‚úì Ëá™Âä®‰øùÂ≠òÊ∏∏ÊàèÁä∂ÊÄÅ (ÂØπËØù: ${Q.value}/${K.length})`)}catch(e){console.error('[MainGame] ‚úó Ëá™Âä®‰øùÂ≠òÂ§±Ë¥•:',e)}},300))};async function Ye(e){try{if(0===K.length&&0===q.length)return!1;const t=('string'==typeof e?.eventPackId&&e.eventPackId.trim()?e.eventPackId:void 0)||sessionStorage.getItem('current_game_event_id')||void 0,a=sessionStorage.getItem('current_game_char_ids'),n=ge(ce.value)?Q.value:fe(Q.value),o={eventPackId:t||void 0,savedAt:Date.now(),dialogueQueue:K.map(e=>H(e)),historyLog:q.map(e=>H(e))};return await re.idbService.setRuntimeAsset(L,o),await Y({hasActiveGame:!0,eventPackId:t||void 0,eventPackOverrideRuntimeId:S.value||void 0,characterIds:a?JSON.parse(a):void 0,payloadRuntimeId:L,dialogueQueue:void 0,dialogueIndex:n,historyLog:void 0,gameSettings:{...x}}),!0}catch(e){return console.warn('[MainGame] persistMainGamePersistenceNow failed:',e),!1}}const He=async()=>{if(Ee(),Q.value<K.length-1){if(ce.value.text){q.some(e=>e.queueIndex===Q.value)||q.push({...ce.value,queueIndex:Q.value})}const e=Ne(Q.value+1,1);Q.value=e,await Je(),et()}else Z.value=!1,ee.value=!1,te&&clearTimeout(te)},Xe=async()=>{Ee();let e=Q.value-1;for(;e>=0;)if(ue(K[e]))e--;else{if(ve(K[e]))break;e--}e>=0&&(Q.value=e,await Je(),Z.value=!1,ee.value=!1,te&&clearTimeout(te))},Ke=e=>'number'==typeof e.queueIndex&&e.queueIndex>=0&&e.queueIndex<K.length,Qe=()=>{g.value&&0===K.length?n.value=!0:Z.value||ee.value?(Z.value=!1,ee.value=!1,te&&clearTimeout(te)):He()},qe=()=>{Z.value=!Z.value,ee.value=!1,Z.value?et():te&&clearTimeout(te)},Ze=()=>{ee.value=!ee.value,Z.value=!1,ee.value?et():te&&clearTimeout(te)},et=()=>{if(te&&clearTimeout(te),!Z.value&&!ee.value)return;let e=100;if(ee.value)e=100;else if(Z.value){e=(ce.value.text?.length||0)*x.textSpeed+x.autoSpeed}te=setTimeout(()=>{He()},e)};(0,r.watch)(()=>x.performanceEnabled,()=>{Ee()}),(0,r.watch)(()=>ce.value,e=>{let t=null,a=null;for(let e=Q.value;e>=0;e--){const n=K[e];if(ue(n)&&n.performance?.apply){const e=n.performance.apply;if(null===t&&'time'===e.kind&&(t=e.value),null===a&&'location'===e.kind&&(a=e.value),null!==t&&null!==a)break}}ne.value=t??(le.value||null),oe.value=a??(ie.value||null)},{deep:!0,immediate:!0});const tt=async e=>{const t=De(e);if(!t||!t.trim())return void _e('‚ö† Êî∂Âà∞ÁöÑÂõûÂ§çÈïøÂ∫¶‰∏∫ 0ÔºåËØ∑Áé©ÂÆ∂ÈáçÊñ∞ÂèëÈÄÅ',!1,3500);try{sessionStorage.setItem('last_final_text',t)}catch{}q.splice(0,q.length);Boolean(x.debugMode)&&(console.log('[MainGame] ========================================'),console.log('[MainGame] handleStreamEnd Ë¢´Ë∞ÉÁî®ÔºÅ'),console.log('[MainGame] finalText ÈïøÂ∫¶:',t?.length),console.log('[MainGame] ÂÆåÊï¥ÂõûÂ§çÂÜÖÂÆπ(Â∑≤ËßÑËåÉÂåñ):\n',t),console.log('[MainGame] ========================================'));try{let e='',a='';try{const t=await ca(Yk);e=('string'==typeof t?.Á≥ªÁªü?.Êó∂Èó¥?t.Á≥ªÁªü.Êó∂Èó¥:'')||('string'==typeof t?.system?.time?t.system.time:'')||'',a=('string'==typeof t?.Á≥ªÁªü?.Âú∞ÁÇπ?t.Á≥ªÁªü.Âú∞ÁÇπ:'')||('string'==typeof t?.system?.location?t.system.location:'')||'',le.value=e,ie.value=a}catch{}const n=sessionStorage.getItem('current_game_event_id'),o=sessionStorage.getItem('current_game_char_ids');await Y({hasActiveGame:!0,eventPackId:n||void 0,characterIds:o?JSON.parse(o):void 0,dialogueQueue:[...K],dialogueIndex:Q.value,historyLog:[...q],gameSettings:{...x}});const l=await W(),r=(e=>`${sessionStorage.getItem('current_game_event_id')||''}:${(e=>{let t=5381;for(let a=0;a<e.length;a++)t=33*t^e.charCodeAt(a);return(t>>>0).toString(16)})(e||'')}`)(t),i=l?.mainGame?.lastVariablesProcessedKey;if(i!==r)try{const e=await da(t);if(e.commandsExecuted>0&&console.log(`[MainGame] ‚úì ÊâßË°å‰∫Ü ${e.commandsExecuted} ‰∏™ÂèòÈáèÊåá‰ª§`),await Y({lastVariablesProcessedKey:r}),e.errors.length>0){console.warn('[MainGame] ‚ö† ÂèòÈáèÂ§ÑÁêÜÈîôËØØ:',e.errors);const t=Array.isArray(e.errorDetails)&&e.errorDetails.length>0?e.errorDetails:[];t.length>0?t.forEach(e=>{s.push({timestamp:Date.now(),message:e.message,command:e.rawCommand,details:Te({code:e.code,commandType:e.commandType,path:e.path,normalizedPath:e.normalizedPath,details:e.details})})}):e.errors.forEach(e=>{s.push({timestamp:Date.now(),message:e})});const a=200;s.length>a&&s.splice(0,s.length-a),_e(`‚ö† ${e.errors.length} ‰∏™ÂèòÈáèÊåá‰ª§ÊâßË°åÂ§±Ë¥•`,!1,3e3)}}catch(e){console.error('[MainGame] ‚úó ÂèòÈáèÂ§ÑÁêÜÂá∫Èîô:',e),s.push({timestamp:Date.now(),message:'ÂèòÈáèÂ§ÑÁêÜÁ≥ªÁªüÈîôËØØ',details:e.message||String(e)});const t=200;s.length>t&&s.splice(0,s.length-t),_e('ÂèòÈáèÂ§ÑÁêÜÂ§±Ë¥•Ôºå‰ΩÜÁªßÁª≠ÊòæÁ§∫ÂÜÖÂÆπ',!1,2e3),await Y({lastVariablesProcessedKey:r})}else console.log('[MainGame] ‚è≠ Ë∑≥ËøáÂèòÈáèÂ§ÑÁêÜÔºàÊú¨Ê¨°ÂõûÂ§çÂ∑≤Â§ÑÁêÜËøáÔºâ');await Le();try{const e=await _k({worldbookName:Yk,finalText:t,resolveUserPlaceholders:w}),a=Math.max(1,Number.parseInt(String(x.autoBigSummaryInterval??25),10)||25),n=Boolean(x.autoBigSummaryEnabled);if(e.bigAdded>0)I(!1);else if(e.smallAdded>0&&n)try{const e=await async function(e){try{const t=window;if('function'!=typeof t.getWorldbook)return 0;const a=await t.getWorldbook(e);if(!Array.isArray(a))return 0;const n=a.find(e=>e?.name===Ek),o='string'==typeof n?.content?n.content:'';if(!o.trim())return 0;const{smallBlocks:l}=Bk(o);return Array.isArray(l)?l.length:0}catch{return 0}}(Yk);e>0&&e%a===0&&I(!0)}catch{}}catch(e){console.warn('[MainGame] Failed to process summaries:',e)}const c=Be(t,'content',{stripThink:!0});if(console.log('[MainGame] content ÂåπÈÖçÁªìÊûú:',!!c),null!==c){let t=c;t=w(t),t=(e=>{const t=wk(e);return t?t.replace(/<Â∞èÊÄªÁªì>[\s\S]*?<\/Â∞èÊÄªÁªì>/gi,'').replace(/<Â§ßÊÄªÁªì>[\s\S]*?<\/Â§ßÊÄªÁªì>/gi,'').replace(/<small_summary>[\s\S]*?<\/small_summary>/gi,'').replace(/<(big_summary|big-summary)>[\s\S]*?<\/(big_summary|big-summary)>/gi,''):''})(t),console.log('[MainGame] ‚úì ÊèêÂèñÂà∞ content ÂÜÖÂÆπÔºåÈïøÂ∫¶:',t.length);const n=Me(t);if(n.length>0){K.splice(0,K.length,...n),Q.value=0,Ee();const t=n.some(e=>'performance'===e.kind&&('time'===e.performance?.category||'location'===e.performance?.category));x.performanceEnabled&&t?(ne.value=e||ne.value,oe.value=a||oe.value):(ne.value=null,oe.value=null),console.log('[MainGame] ‚úì ÂØπËØùÂ∑≤Êõ¥Êñ∞ÔºåÂÖ±',n.length,'Êù°')}else console.warn('[MainGame] ‚úó Êú™Ëß£ÊûêÂà∞‰ªª‰ΩïÂØπËØùË°å')}else console.warn('[MainGame] ‚úó Êú™ÊâæÂà∞ <content> Ê†áÁ≠æ');try{const{updateStoryWorldbook:e,getCurrentGameTime:t}=Mt(),a=await t();a&&C.value?(console.log('[MainGame] Updating plot events for time:',a),await e(C.value,a)):console.log('[MainGame] Skipping plot update (no time or pack)')}catch(e){console.warn('[MainGame] Failed to update plot events:',e)}const d=Be(t,'Â∞èÊÄªÁªì',{stripThink:!0})??Be(t,'state_bar',{stripThink:!0});if(console.log('[MainGame] Â∞èÊÄªÁªì/Áä∂ÊÄÅÊ†è ÂåπÈÖçÁªìÊûú:',!!d),null!==d){const e=d;console.log('[MainGame] ‚úì ÊèêÂèñÂà∞ Â∞èÊÄªÁªì/Áä∂ÊÄÅÊ†è ÂÜÖÂÆπÔºåÈïøÂ∫¶:',e.length)}_e('‚ú¶ ÂõûÂ∫îÂ∑≤Êé•Êî∂ ‚ú¶',!0,2e3)}catch(e){console.error('[MainGame] ‚úó‚úó‚úó handleStreamEnd Âá∫Èîô ‚úó‚úó‚úó:',e),_e('Â§ÑÁêÜÂìçÂ∫îÊó∂Âá∫Èîô',!1,3e3)}try{const e=await at('auto','Ëá™Âä®Â≠òÊ°£');await We(e)}catch(e){console.warn('[MainGame] Auto-save failed:',e)}console.log('[MainGame] ======== handleStreamEnd ÊâßË°åÂÆåÊØï ========')};!function(e){const t=(0,r.ref)(!1),a=(0,r.ref)(''),n=t=>{console.log('[useStreamListener] ===== GENERATION_ENDED ‰∫ã‰ª∂Ëß¶Âèë ====='),console.log('[useStreamListener] text ÈïøÂ∫¶:',t?.length),a.value=t,e&&e(t)},o=()=>{try{const e=iframe_events||tavern_events;if(console.log('[useStreamListener] ÂºÄÂßãËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®'),console.log('[useStreamListener] iframe_events:',e),console.log('[useStreamListener] eventOn ÂáΩÊï∞:',typeof eventOn),!e)return void console.error('[useStreamListener] Êó†Ê≥ïÊâæÂà∞ iframe_events Êàñ tavern_events');console.log('[useStreamListener] ÂèØÁî®‰∫ã‰ª∂:',Object.keys(e)),e.GENERATION_ENDED?(eventOn(e.GENERATION_ENDED,n),console.log('[useStreamListener] ‚úì Â∑≤ÁõëÂê¨ GENERATION_ENDED ‰∫ã‰ª∂'),t.value=!0):console.warn('[useStreamListener] GENERATION_ENDED ‰∫ã‰ª∂‰∏çÂ≠òÂú®'),tavern_events?.MESSAGE_RECEIVED&&(eventOn(tavern_events.MESSAGE_RECEIVED,e=>{console.log('[useStreamListener] MESSAGE_RECEIVED ‰∫ã‰ª∂Ëß¶Âèë, messageId:',e)}),console.log('[useStreamListener] ‚úì Â∑≤ÁõëÂê¨ MESSAGE_RECEIVED ‰∫ã‰ª∂'))}catch(e){console.error('[useStreamListener] ËÆæÁΩÆÊµÅÁªìÊùüÁõëÂê¨Âô®Â§±Ë¥•:',e)}},l=()=>{try{const e=iframe_events||tavern_events;e?.GENERATION_ENDED&&(eventRemoveListener(e.GENERATION_ENDED,n),console.log('[useStreamListener] ‚úì Â∑≤ÁßªÈô§ GENERATION_ENDED ‰∫ã‰ª∂ÁõëÂê¨'),t.value=!1)}catch(e){console.error('[useStreamListener] ÁßªÈô§ÁõëÂê¨Âô®Â§±Ë¥•:',e)}};(0,r.onMounted)(()=>{o()}),(0,r.onUnmounted)(()=>{l()})}(tt);const at=async(e,t,a)=>{const n=sessionStorage.getItem('current_game_event_id')||'',o=sessionStorage.getItem('current_game_char_ids')||'[]',l=sessionStorage.getItem('last_final_text')||'',i=l.length>2e4?l.slice(l.length-2e4):l;let c;try{const e=sessionStorage.getItem(Gk);if(e){const t=JSON.parse(e),a='string'==typeof t?.runtimeId?t.runtimeId:'',n=a?await re.idbService.getRuntimeAsset(a):void 0;c={name:'string'==typeof t?.name?t.name:E.value,imageUrl:'string'==typeof n?.imageUrl?n.imageUrl:V.value}}}catch(e){console.warn('[MainGame] Failed to prepare protagonist for save:',e)}return{slotType:e,autoIndex:a,title:t||('auto'===e?'Ëá™Âä®Â≠òÊ°£':'ÊâãÂä®Â≠òÊ°£'),eventPackId:n,eventPackName:C.value?.name||'Êú™Áü•‰∫ã‰ª∂ÂåÖ',charIds:JSON.parse(o),dialogueQueue:JSON.parse(JSON.stringify(K)),currentLineIndex:Q.value,historyLog:JSON.parse(JSON.stringify(q)),gameSettings:JSON.parse(JSON.stringify((0,r.toRaw)(x))),protagonist:c,eventPackData:C.value?JSON.parse(JSON.stringify(C.value)):void 0,lastFinalText:i,firstLine:(()=>{for(const e of K){if(!e||'object'!=typeof e)continue;if('performance'===e.kind)continue;const t='string'==typeof e.text?e.text.trim():'';if(t)return t.slice(0,120)}return''})(),thumbnail:x.bgImage,screenshotSelector:'.main-game-view'}},nt=async(e,t)=>{try{_e('Ê≠£Âú®‰øùÂ≠ò...',!0,0);const a=await at('manual',t||void 0,void 0);await async function(e){const t=await Ue(e);await re.idbService.saveSave(t);const a=await re.idbService.getAllSaves();return await ze(a),t}({...a,idOverride:e}),n.value=!1,_e('‚úì Â≠òÊ°£ÊàêÂäü',!0,2e3)}catch(e){console.error('[MainGame] Failed to save:',e),_e('Â≠òÊ°£Â§±Ë¥•: '+(e.message||e),!1,3e3)}},ot=async e=>{try{if(_e('Ê≠£Âú®ËØªÂèñÂ≠òÊ°£...',!0,0),await async function(e){const t=window.TavernHelper;t?.getWorldbookNames&&(t.getWorldbookNames().includes(Oe)||await t.createWorldbook(Oe),await t.rebindChatWorldbook('current',Oe));try{const t=window,a=(Array.isArray(e.worldbookEntries)?e.worldbookEntries:[]).filter(e=>{const t='string'==typeof e?.name?e.name:'';return'ÂâßÊÉÖ‰∫ã‰ª∂ - ÂºÄÂßã'!==t&&'ÂâßÊÉÖ‰∫ã‰ª∂ - ÁªìÊùü'!==t});if(a.length>0)if('function'==typeof t.getWorldbook&&'function'==typeof t.replaceWorldbook){const e=await t.getWorldbook(Oe),n=Array.isArray(e)?[...e]:[],o=new Set;for(const e of n)'number'==typeof e?.uid&&o.add(e.uid);const l=e=>n.findIndex(t=>t?.name===e);for(let e=0;e<a.length;e++){const t=a[e],r='string'==typeof t?.name?t.name:'';if(!r)continue;const i=l(r);if(-1!==i){const e=n[i]?.uid;n[i]={...n[i],...t,uid:'number'==typeof e?e:n[i]?.uid}}else{let a='number'==typeof t?.uid?t.uid:Date.now()+e;for(;o.has(a);)a++;o.add(a),n.push({...t,uid:a})}}await t.replaceWorldbook(Oe,n)}else'function'==typeof t.createWorldbookEntries&&await t.createWorldbookEntries(Oe,a)}catch{}sessionStorage.setItem('current_game_event_id',e.eventPackId),sessionStorage.setItem('current_game_char_ids',JSON.stringify(e.charIds||[]));try{const t=e.sessionData?.lastFinalText,a='string'==typeof t&&t.trim()?t:Pe(e.sessionData);if(a&&'string'==typeof a){const e=De(a),t=2e4;sessionStorage.setItem('last_final_text',e.length>t?e.slice(e.length-t):e)}else sessionStorage.removeItem('last_final_text')}catch{}if(sessionStorage.setItem('restore_save_id',e.id),sessionStorage.removeItem('restore_save_ref'),sessionStorage.removeItem('restore_save_data'),e.sessionData?.protagonist){const t=`save_${e.id}_protagonist`;await re.idbService.setRuntimeAsset(t,{imageUrl:e.sessionData.protagonist?.imageUrl||''}),sessionStorage.setItem('current_game_protagonist_ref',JSON.stringify({name:e.sessionData.protagonist?.name||'',runtimeId:t}))}e.sessionData?.gameSettings&&await he(e.sessionData.gameSettings)}(e),e.sessionData?.eventPackData)try{(0,ya.w7)(e.sessionData.eventPackData)}catch(e){console.warn('[MainGame] Failed to ensure game assets from saved eventPackData:',e)}if(e.sessionData?.eventPackData)C.value=e.sessionData.eventPackData;else if(e.eventPackId){const t=(await re.idbService.getAllWorks()).find(t=>'EVENT'===t.type&&t.id===e.eventPackId);t&&(C.value=t.data)}if(C.value)try{(0,ya.w7)(C.value)}catch(e){console.warn('[MainGame] Failed to ensure game assets from loaded event pack:',e)}if(e.sessionData){K.splice(0,K.length,...e.sessionData.dialogueQueue);const t='number'==typeof e.sessionData.currentLineIndex?e.sessionData.currentLineIndex:0,a=Math.max(0,K.length-1);if(Q.value=Math.min(Math.max(t,0),a),q.splice(0,q.length,...e.sessionData.historyLog),e.sessionData.gameSettings){const t=Array.isArray(x.enabledSidebarWidgets)?[...x.enabledSidebarWidgets]:null;Object.assign(x,e.sessionData.gameSettings);const a=x.enabledSidebarWidgets;!t||Array.isArray(a)&&0!==a.length||(x.enabledSidebarWidgets=t)}await b(),Ee()}n.value=!1,_e('‚úì ËØªÊ°£ÊàêÂäü',!0,2e3)}catch(e){console.error('[MainGame] Failed to load:',e),_e('ËØªÊ°£Â§±Ë¥•: '+(e.message||e),!1,3e3)}},lt=()=>{o.value=!0},rt=e=>e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),it=async e=>{try{const t='string'==typeof e?.boundEventId?e.boundEventId:'';if(t)try{sessionStorage.setItem('current_game_event_id',t)}catch{}const a=C.value?.name||'';C.value=e.eventPack,await async function(e){try{const t=JSON.parse(JSON.stringify(e));return await re.idbService.setRuntimeAsset(U,t),S.value=U,!0}catch(e){return console.warn('[MainGame] Failed to persist event pack override snapshot:',e),!1}}(e.eventPack).catch(()=>!1);try{await(async(e,t)=>{const a='Local',n=Yk;if('function'!=typeof window.deleteWorldbookEntries||'function'!=typeof window.createWorldbookEntries)return void console.warn('[MainGame] Worldbook APIs missing; cannot sync event pack worldbook entries');const o='string'==typeof e?.name?e.name:'',l=['string'==typeof t?t:'',o].map(e=>e.trim()).filter(Boolean),r=l.length>0?l.map(rt).join('|'):'.*?',i=new RegExp(`^„Äê${rt(a)}„Äë„Äê(?:${r})„Äë„Äê`),c=new RegExp(`„Äê(?:${['ÈöèÊú∫‰∫ã‰ª∂','Êù°‰ª∂‰∫ã‰ª∂','‰∏ñÁïåËßÇ','ÁâπÊÆäËßÑÂàô','ÂâßÊÉÖ‰∫ã‰ª∂','È¢ùÂ§ñ‰∏ñÁïå‰π¶'].map(rt).join('|')})„Äë`);await window.deleteWorldbookEntries(n,e=>{const t='string'==typeof e?.name?e.name:'';return!!t&&!!i.test(t)&&c.test(t)});try{await window.deleteWorldbookEntries(n,e=>'ÂèòÈáèÂ∫ìÁªìÊûÑÂÆö‰πâ - Ê≠£Êñá'===e?.name)}catch{}const s=[],d=(e,t,n,l=!1,r=null)=>{const i='string'==typeof e?e:String(e||'');i.trim()&&s.push({name:`„Äê${a}„Äë„Äê${o}„Äë„Äê${t}„Äë„Äê${String(n).padStart(3,'0')}„Äë`,content:i,position:{type:'after_character_definition',order:n},enabled:l,probability:r,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}})};try{(Array.isArray(e.randomEvents)?e.randomEvents:[]).forEach((e,t)=>{const a='number'==typeof e?.config?.probability?e.config.probability:0;d(e?.content||'','ÈöèÊú∫‰∫ã‰ª∂',202+t,!0,a)})}catch{}try{(Array.isArray(e.conditionalEvents)?e.conditionalEvents:[]).forEach((e,t)=>d(e?.content||'','Êù°‰ª∂‰∫ã‰ª∂',402+t,!0))}catch{}try{let t=502;const a=Array.isArray(e.worldviews)?e.worldviews:[],n=Array.isArray(e.powerSystems)?e.powerSystems:[];a.forEach(e=>d(e?.content||'','‰∏ñÁïåËßÇ',t++,!0)),n.forEach(e=>d(e?.content||'','‰∏ñÁïåËßÇ',t++,!0))}catch{}try{(Array.isArray(e.specialRules)?e.specialRules:[]).forEach((e,t)=>d(e?.content||'','ÁâπÊÆäËßÑÂàô',602+t,!0))}catch{}Array.isArray(e.extraWorldBooks)&&e.extraWorldBooks.length>0&&e.extraWorldBooks.forEach((e,t)=>{const n='string'==typeof e?.content?e.content:'';if(!n.trim())return;const l='number'==typeof e?.uid?String(e.uid).padStart(3,'0'):String(800+t).padStart(3,'0'),r='string'==typeof e?.name&&e.name.trim()?e.name.trim():'È¢ùÂ§ñ‰∏ñÁïå‰π¶';s.push({name:`„Äê${a}„Äë„Äê${o}„Äë„ÄêÈ¢ùÂ§ñ‰∏ñÁïå‰π¶„Äë„Äê${l}„Äë${r}`,content:n,position:e?.position||{type:'after_character_definition',order:800+t},enabled:!1!==e?.enabled,probability:'number'==typeof e?.probability?e.probability:null,strategy:e?.strategy||{type:'selective',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},recursion:e?.recursion,effect:e?.effect})}),'string'==typeof e.extraWorldBook&&e.extraWorldBook.trim()&&s.push({name:`„Äê${a}„Äë„Äê${o}„Äë„ÄêÈ¢ùÂ§ñ‰∏ñÁïå‰π¶„Äë„ÄêLEGACY„Äë`,content:e.extraWorldBook.trim(),position:{type:'after_character_definition',order:799},enabled:!0,probability:null,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}}),s.length>0&&await window.createWorldbookEntries(n,s);try{const{updateStoryWorldbook:t,getCurrentGameTime:a}=Mt(),n=await a().catch(()=>'');await t(e,n||'')}catch(e){console.warn('[MainGame] Failed to sync plot events via StoryManager:',e)}try{let t;t=Array.isArray(e.variableTree)&&e.variableTree.length>0?ma(e.variableTree):JSON.parse(JSON.stringify(Gt));const a={name:'ÂèòÈáèÂ∫ìÁªìÊûÑÂÆö‰πâ - Ê≠£Êñá',content:fa(t),position:{type:'before_character_definition',order:3},enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'}};await window.createWorldbookEntries(n,[a])}catch(e){console.warn('[MainGame] Failed to sync variable schema entry:',e)}})(e.eventPack,a)}catch(e){console.warn('[MainGame] Failed to sync event pack worldbook entries:',e)}try{const t=(0,ya.zP)(e.eventPack);(0,ya.RV)(t)}catch(e){console.warn('[MainGame] Failed to update game assets after applying event pack:',e)}try{await Le()}catch{}try{$e()}catch{}await Je(),_e('‚úì Â∑≤Â∫îÁî®Âà∞ÂΩìÂâçÂ≠òÊ°£Ôºà‰∏ç‰ºöË¶ÜÁõñ‚ÄúÂ∑≤‰∏ãËΩΩ‰ΩúÂìÅ‚Äù‰∏≠ÁöÑ‰∫ã‰ª∂ÂåÖÔºâ',!0,3e3)}catch(e){console.error('[MainGame] Failed to apply game asset:',e),_e('Â∫îÁî®Â§±Ë¥•: '+(e?.message||String(e)),!1,3e3)}},ct=async()=>{const e=e=>new Promise(t=>setTimeout(t,e)),i=async(t,a)=>{try{return await Promise.race([t,e(a).then(()=>null)])}catch{return null}};try{m.value=!0,(()=>{try{Ge&&(clearTimeout(Ge),Ge=null)}catch{}try{te&&(clearTimeout(te),te=null)}catch{}try{xe&&(clearTimeout(xe),xe=null)}catch{}try{be&&(clearTimeout(be),be=null)}catch{}})(),Z.value=!1,ee.value=!1,o.value=!1,t.value=!1,a.value=!1,n.value=!1,l.value=!1;try{await i(G(),1200)}catch(e){console.warn('[MainGame] Failed to reset persistence to Home:',e)}await(0,r.nextTick)();try{const e=await i(u.replace('/'),1200);e&&console.warn('[MainGame] Navigation failure:',e)}catch(e){console.warn('[MainGame] Failed to navigate to home via router:',e)}setTimeout(async()=>{try{const e=await window.getWorldbook(Yk);e&&e.length>0&&await window.deleteWorldbookEntries(Yk,e=>{const t='string'==typeof e?.name?e.name:'';return/^„Äê[^„Äë]*„Äë„Äê[^„Äë]*„Äë„Äê[^„Äë]*„Äë„Äê[^„Äë]*„Äë/.test(t)||'ÂèòÈáèÂ∫ìÁªìÊûÑÂÆö‰πâ - Ê≠£Êñá'===t||'ÂΩìÂâçÊ∏∏ÊàèÊï∞ÊçÆ'===t})}catch(e){console.warn('[MainGame] Failed to clear worldbook:',e)}try{await async function(){try{const e=window.updateWorldbookWith;if('function'!=typeof e)return void console.warn('[DeviationPrompt] updateWorldbookWith not available');await e('ÂêåÊ¢¶',e=>e.map(e=>e.name===Pt||e.name===Ot||e.name===Rt?{...e,strategy:{...e.strategy,type:'selective'}}:e)),console.log('[DeviationPrompt] Reset all deviation entries to selective')}catch(e){console.error('[DeviationPrompt] Failed to reset deviation entries:',e)}}(),console.log('[MainGame] Deviation entries reset to selective')}catch(e){console.warn('[MainGame] Failed to reset deviation entries:',e)}try{sessionStorage.removeItem('new_game_start_text'),sessionStorage.removeItem('current_game_event_id'),sessionStorage.removeItem('current_game_char_ids')}catch{}try{const e=sessionStorage.getItem(Gk);if(e){const t=JSON.parse(e);t?.runtimeId&&await re.idbService.deleteRuntimeAsset(t.runtimeId)}}catch(e){console.warn('[MainGame] Failed to cleanup protagonist runtime asset:',e)}try{sessionStorage.removeItem(Gk),sessionStorage.removeItem(Jk)}catch{}try{(0,ya.xg)()}catch{}console.log('[MainGame] Exit cleanup finished')},0),setTimeout(()=>{if('/'!==u.currentRoute.value?.path)try{window.location.reload()}catch{}},300)}catch(e){console.error('[MainGame] Failed to exit:',e);try{p||_e('ÈÄÄÂá∫Â§±Ë¥•: '+(e.message||e),!1,3e3)}catch{}}};return(e,i)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'main-game-view',style:(0,r.normalizeStyle)(h.value)},[(0,r.createCommentVNode)(' 0. Settings Overlay '),(0,r.createVNode)(r.Transition,{name:'fade-scale'},{default:(0,r.withCtx)(()=>[t.value?((0,r.openBlock)(),(0,r.createBlock)(ah,{key:0,settings:x,'onUpdate:settings':R,'onDebug:text':Re,onClose:i[0]||(i[0]=e=>t.value=!1)},null,8,['settings'])):(0,r.createCommentVNode)('v-if',!0)]),_:1}),(0,r.createCommentVNode)(' 1. Background Layer '),(0,r.createElementVNode)('div',Ik,[(0,r.createElementVNode)('div',Tk,[T.value?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:T.value,alt:'Background',class:'bg-image'},null,8,Ak)):(0,r.createCommentVNode)('v-if',!0),i[17]||(i[17]=(0,r.createElementVNode)('div',{class:'bg-gradient'},null,-1))])]),(0,r.createCommentVNode)(' 2. Character Layer '),(0,r.createElementVNode)('div',Dk,[(0,r.createCommentVNode)(' Dynamic Character from Settings/DB '),(0,r.createVNode)(r.Transition,{name:'fade',appear:''},{default:(0,r.withCtx)(()=>[P.value?((0,r.openBlock)(),(0,r.createElementBlock)('img',{key:0,src:P.value,class:'char-img dynamic-char',style:(0,r.normalizeStyle)(M.value)},null,12,Mk)):(0,r.createCommentVNode)('v-if',!0)]),_:1})]),(0,r.createCommentVNode)(' 3. HUD Layer (Top Left) '),(0,r.createVNode)(ip,{'override-time':ne.value,'override-location':oe.value,'typing-speed-ms':x.textSpeed},null,8,['override-time','override-location','typing-speed-ms']),(0,r.createCommentVNode)(' 3.5 Performance Overlay (GAL-style) '),pe.value?((0,r.openBlock)(),(0,r.createBlock)(kp,{key:0,text:ce.value.text,effect:ce.value.performance?.effect||'plain','text-speed-ms':x.textSpeed,'skip-mode':ee.value,onDone:He},null,8,['text','effect','text-speed-ms','skip-mode'])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 4. Dialogue Box Layer (Bottom) '),(0,r.createElementVNode)('div',{class:'dialogue-wrapper',onClick:Qe},[de.value?((0,r.openBlock)(),(0,r.createBlock)(Im,{key:0,name:de.value.name,text:de.value.text,'protagonist-name':E.value,effect:'plain','auto-mode':Z.value,'skip-mode':ee.value,settings:x,onNext:He,onBack:Xe,onLog:i[1]||(i[1]=e=>a.value=!0),onAuto:qe,onSkip:Ze,onOpenSettings:i[2]||(i[2]=e=>t.value=!0)},null,8,['name','text','protagonist-name','auto-mode','skip-mode','settings'])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createCommentVNode)(' 5. Left Sidebar (System Menu) '),(0,r.createVNode)(fp,{'error-count':s.length,onSaveload:i[3]||(i[3]=e=>n.value=!0),onAsset:i[4]||(i[4]=e=>c.value=!0),onVariables:i[5]||(i[5]=e=>ae.value=!0),onSettings:i[6]||(i[6]=e=>t.value=!0),onErrorlog:i[7]||(i[7]=e=>l.value=!0),onExit:lt},null,8,['error-count']),(0,r.createCommentVNode)(' 6. Right Sidebar (Widgets) '),(0,r.createVNode)($p,{settings:x},null,8,['settings']),(0,r.createCommentVNode)(' 7. Quick Input (Floating Orb) '),(0,r.createVNode)(Ap),(0,r.createCommentVNode)(' 8. Temporary Message Toast '),((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{to:'#ethereal-toast-root'},[(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[we.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:(0,r.normalizeClass)(['temp-message',{success:Se.value}])},(0,r.toDisplayString)(Ce.value),3)):(0,r.createCommentVNode)('v-if',!0)]),_:1})])),(0,r.createCommentVNode)(' 9. Log Overlay '),(0,r.createVNode)(r.Transition,{name:'fade'},{default:(0,r.withCtx)(()=>[a.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'log-overlay',onClick:i[9]||(i[9]=(0,r.withModifiers)(e=>a.value=!1,['self']))},[(0,r.createElementVNode)('div',Pk,[(0,r.createElementVNode)('div',Ok,[i[18]||(i[18]=(0,r.createElementVNode)('span',null,'History Log',-1)),(0,r.createElementVNode)('button',{class:'close-btn',onClick:i[8]||(i[8]=e=>a.value=!1)},'‚úï')]),(0,r.createElementVNode)('div',Rk,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(q,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:(0,r.normalizeClass)(['log-item',{clickable:Ke(e)}]),onClick:t=>Ke(e)&&(e=>{'number'==typeof e.queueIndex&&(Q.value=e.queueIndex,a.value=!1,Z.value=!1,ee.value=!1,te&&clearTimeout(te),Ee())})(e)},[(0,r.createElementVNode)('div',Lk,[(0,r.createElementVNode)('div',Uk,(0,r.toDisplayString)(e.name||''),1)]),(0,r.createElementVNode)('div',zk,(0,r.toDisplayString)(e.text),1)],10,$k))),128))])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1}),(0,r.createCommentVNode)(' 10. Save/Load Modal '),(0,r.createVNode)(Lv,{visible:n.value,'onUpdate:visible':i[10]||(i[10]=e=>n.value=e),mode:'both',onSave:nt,onLoad:ot},null,8,['visible']),(0,r.createCommentVNode)(' 11. Exit Confirmation Dialog '),(0,r.createVNode)(r.Transition,{name:'fade-scale'},{default:(0,r.withCtx)(()=>[o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'exit-confirm-overlay',onClick:i[12]||(i[12]=(0,r.withModifiers)(e=>o.value=!1,['self']))},[(0,r.createElementVNode)('div',Fk,[(0,r.createElementVNode)('div',Wk,[(0,r.createVNode)(v,{name:'alert',size:32})]),i[19]||(i[19]=(0,r.createElementVNode)('h3',null,'ËøîÂõû‰∏ªÈ°µ',-1)),i[20]||(i[20]=(0,r.createElementVNode)('p',null,[(0,r.createTextVNode)('Á°ÆÂÆöË¶ÅËøîÂõû‰∏ªÈ°µÂêóÔºü'),(0,r.createElementVNode)('br'),(0,r.createTextVNode)('ËØ∑Á°Æ‰øùÂ∑≤‰øùÂ≠òÊ∏∏ÊàèËøõÂ∫¶Ôºå'),(0,r.createElementVNode)('br'),(0,r.createTextVNode)('ËøîÂõûÂêéÂΩìÂâç‰∏ñÁïå‰π¶Êï∞ÊçÆÂ∞ÜË¢´Ê∏ÖÁ©∫„ÄÇ')],-1)),(0,r.createElementVNode)('div',jk,[(0,r.createElementVNode)('button',{class:'btn-cancel',onClick:i[11]||(i[11]=e=>o.value=!1)},'ÂèñÊ∂à'),(0,r.createElementVNode)('button',{class:'btn-confirm',onClick:ct},'Á°ÆËÆ§ËøîÂõû')])])])):(0,r.createCommentVNode)('v-if',!0)]),_:1}),(0,r.createCommentVNode)(' 12. Error Log Modal '),(0,r.createVNode)(tp,{visible:l.value,'onUpdate:visible':i[13]||(i[13]=e=>l.value=e),errors:s,onClear:Ie,onNotify:i[14]||(i[14]=e=>_e(e.text,e.success??!0,e.duration??2e3)),onReprocess:Ae},null,8,['visible','errors']),(0,r.createCommentVNode)(' 13. GameAsset / Event Pack Editor '),(0,r.createVNode)(Sh,{visible:c.value,'onUpdate:visible':i[15]||(i[15]=e=>c.value=e),'current-event-pack':C.value,onApply:it},null,8,['visible','current-event-pack']),(0,r.createCommentVNode)(' 14. Variable Editor '),(0,r.createVNode)(uk,{visible:ae.value,'onUpdate:visible':i[16]||(i[16]=e=>ae.value=e),'worldbook-name':Yk,onApplied:Fe},null,8,['visible'])],4))}}),Xk=(0,y.A)(Hk,[['__scopeId','data-v-0a73a0b2']]);function Kk(e){try{return'string'==typeof e?e:e instanceof Error?e.message:String(e)}catch{return'[unprintable]'}}function Qk(e){try{const t=window;Array.isArray(t.__MYCARD_RUNTIME_ERRORS__)||(t.__MYCARD_RUNTIME_ERRORS__=[]),t.__MYCARD_RUNTIME_ERRORS__.push(e),t.__MYCARD_RUNTIME_ERRORS__.length>50&&t.__MYCARD_RUNTIME_ERRORS__.splice(0,t.__MYCARD_RUNTIME_ERRORS__.length-50)}catch{}try{const t=window.top;t&&t!==window&&(Array.isArray(t.__MYCARD_RUNTIME_ERRORS__)||(t.__MYCARD_RUNTIME_ERRORS__=[]),t.__MYCARD_RUNTIME_ERRORS__.push(e),t.__MYCARD_RUNTIME_ERRORS__.length>50&&t.__MYCARD_RUNTIME_ERRORS__.splice(0,t.__MYCARD_RUNTIME_ERRORS__.length-50))}catch{}}const qk=(0,i.createRouter)({history:(0,i.createMemoryHistory)(),routes:[{path:'/',name:'home',component:te},{path:'/new-game',name:'newGame',component:ao},{path:'/load-game',name:'loadGame',component:wt},{path:'/workshop',name:'workshop',component:Vm},{path:'/MainGame',name:'mainGame',component:Xk}]});$(()=>{(async()=>{try{window.__MYCARD_PHASE__='bootstrap:diagnostics';try{const e=window.top;e&&e!==window&&(e.__MYCARD_PHASE__=window.__MYCARD_PHASE__)}catch{}window.addEventListener('error',e=>{const t=Kk(e?.message??e?.error??'unknown error'),a=e?.error?.stack?String(e.error.stack):void 0;Qk({ts:Date.now(),kind:'window-error',message:t,stack:a,route:qk.currentRoute.value.fullPath})}),window.addEventListener('unhandledrejection',e=>{const t=e?.reason,a=Kk(t),n=t instanceof Error?t.stack:void 0;Qk({ts:Date.now(),kind:'unhandledrejection',message:a,stack:n,route:qk.currentRoute.value.fullPath})})}catch{}const e=(0,r.createApp)(m);e.config.errorHandler=(e,t,a)=>{const n=t?.type?.name||t?.type?.__name||t?.type?.__file||'unknown-component',o=Kk(e),l=e instanceof Error?e.stack:void 0;Qk({ts:Date.now(),kind:'vue',message:o,stack:l,info:Kk(a),component:Kk(n),route:qk.currentRoute.value.fullPath}),console.error('[MyCard][VueError]',{message:o,info:a,component:n,route:qk.currentRoute.value.fullPath,err:e})},e.use(qk).mount('#app');try{window.__MYCARD_PHASE__='bootstrap:afterMount';try{const e=window.top;e&&e!==window&&(e.__MYCARD_PHASE__=window.__MYCARD_PHASE__)}catch{}}catch{}try{const e=await J();if(e){try{window.__MYCARD_PHASE__='bootstrap:restore:routerReplace';try{const e=window.top;e&&e!==window&&(e.__MYCARD_PHASE__=window.__MYCARD_PHASE__)}catch{}}catch{}await qk.replace(e)}}catch(e){console.warn('[MyCard] Startup restore failed:',e)}})()});</script><style>@import url(https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=Outfit:wght@300;400;600&display=swap);
/*! tailwindcss v4.1.12 | MIT License | https://tailwindcss.com */*{margin:0;padding:0;box-sizing:border-box}:root{--glass-100:rgba(255,255,255,0.05);--glass-200:rgba(255,255,255,0.1);--glass-300:rgba(255,255,255,0.15);--glass-border:rgba(255,255,255,0.1);--glass-highlight:rgba(255,255,255,0.08);--primary:#8b5cf6;--primary-glow:#a78bfa;--secondary:#06b6d4}body{font-family:"Outfit","Noto Sans SC",sans-serif;background-color:#050505;overflow:hidden;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:hsla(0,0%,100%,.05)}::-webkit-scrollbar-thumb{background:hsla(0,0%,100%,.2);border-radius:10px}::-webkit-scrollbar-thumb:hover{background:hsla(0,0%,100%,.4)}.ethereal-app-wrapper{width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;overflow:hidden}.ethereal-app-wrapper.is-fullscreen{position:fixed;inset:0;z-index:9998}.ethereal-app{position:relative;width:100%;height:100%;overflow:hidden;background:#000;color:#cbd5e1;font-family:"Outfit","Noto Sans SC",sans-serif;aspect-ratio:16/9}.background-layer{position:absolute;inset:0;z-index:0}.bg-orb{position:absolute;border-radius:50%;mix-blend-mode:screen}.bg-orb-violet{top:-20%;left:-10%;width:70vw;height:70vw;background:rgba(139,92,246,.2);filter:blur(120px);animation:pulse-slow 4s cubic-bezier(0.4,0,0.6,1) infinite}.bg-orb-blue{bottom:-20%;right:-10%;width:60vw;height:60vw;background:rgba(30,58,138,.1);filter:blur(100px)}.bg-orb-fuchsia{top:30%;left:40%;width:40vw;height:40vw;background:rgba(112,26,117,.1);filter:blur(80px)}html[data-th-mobile="1"]{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;text-size-adjust:100%}html[data-th-mobile="1"] *{backdrop-filter:none !important}html[data-th-mobile="1"] .bg-orb{filter:none !important;animation:none !important;opacity:.35}html[data-th-mobile="1"] .bg-orb-violet,html[data-th-mobile="1"] .bg-orb-blue,html[data-th-mobile="1"] .bg-orb-fuchsia{transform:none !important}html[data-th-mobile="1"] .bg-noise{opacity:.015}html[data-th-mobile="1"] .fullscreen-btn{backdrop-filter:none !important}html[data-th-mobile="1"] .fade-scale-enter-from,html[data-th-mobile="1"] .fade-scale-leave-to{filter:none !important}.main-content{position:relative;z-index:10;width:100%;height:100%}.ethereal-overlay-root{position:absolute;inset:0;z-index:11000;pointer-events:auto}.ethereal-overlay-root:empty{pointer-events:none}.ethereal-toast-root{position:absolute;inset:0;z-index:12000;pointer-events:none}.version-info{position:absolute;bottom:1em;right:1.5em;z-index:50;font-size:10px;color:hsla(0,0%,100%,.2);font-family:monospace;pointer-events:none}.bg-noise{position:absolute;inset:0;pointer-events:none;z-index:50;opacity:.03;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")}.fullscreen-btn{position:absolute;z-index:9999;width:40px;height:40px;border-radius:50%;background:rgba(0,0,0,.55);border:1px solid hsla(0,0%,100%,.15);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;color:hsla(0,0%,100%,.7);cursor:grab;transition:background .2s,border-color .2s,transform .15s;-webkit-user-select:none;user-select:none;touch-action:none}.fullscreen-btn:hover{background:rgba(139,92,246,.45);border-color:rgba(139,92,246,.6);color:#fff}.fullscreen-btn:active{cursor:grabbing;transform:scale(0.95)}.fullscreen-btn svg{pointer-events:none}.fade-scale-enter-active,.fade-scale-leave-active{transition:all .5s cubic-bezier(0.22,1,0.36,1)}.fade-scale-enter-from{opacity:0;transform:scale(0.95);filter:blur(10px)}.fade-scale-leave-to{opacity:0;transform:scale(1.05);filter:blur(10px)}@keyframes pulse-slow{0%,100%{opacity:1}50%{opacity:.5}}@keyframes blob{0%{transform:translate(0px,0px) scale(1)}33%{transform:translate(30px,-50px) scale(1.1)}66%{transform:translate(-20px,20px) scale(0.9)}100%{transform:translate(0px,0px) scale(1)}}@keyframes float{0%,100%{transform:translateY(0) translateX(0) scale(1)}25%{transform:translateY(-20px) translateX(10px) scale(1.02)}50%{transform:translateY(0) translateX(-10px) scale(1)}75%{transform:translateY(-10px) translateX(5px) scale(1.01)}}
.misty-sphere[data-v-7e21fa7d]{position:relative;cursor:pointer;animation:float-7e21fa7d 6s ease-in-out infinite}.misty-sphere:hover .sphere-glow[data-v-7e21fa7d]{opacity:.6}.misty-sphere:hover .sphere-content[data-v-7e21fa7d]{border-color:hsla(0,0%,100%,.3);box-shadow:0 0 80px rgba(139,92,246,.3)}.misty-sphere:hover .sphere-label[data-v-7e21fa7d]{transform:scale(1.1)}.sphere-glow[data-v-7e21fa7d]{position:absolute;inset:0;border-radius:50%;filter:blur(50px);opacity:.4;transition:opacity .7s}.sphere-glow.bg-violet[data-v-7e21fa7d]{background:#8b5cf6}.sphere-glow.bg-cyan[data-v-7e21fa7d]{background:#06b6d4}.sphere-glow.bg-fuchsia[data-v-7e21fa7d]{background:#d946ef}.sphere-mist[data-v-7e21fa7d]{position:absolute;inset:1em;border-radius:50%;filter:blur(30px);opacity:.3;mix-blend-mode:screen;background:#fff;animation:pulse-slow-7e21fa7d 4s cubic-bezier(0.4,0,0.6,1) infinite}.sphere-content[data-v-7e21fa7d]{position:relative;display:flex;align-items:center;justify-content:center;border-radius:50%;border:1px solid hsla(0,0%,100%,.1);background:hsla(0,0%,100%,.05);backdrop-filter:blur(4px);box-shadow:0 0 50px rgba(0,0,0,.2);overflow:hidden;transition:all .5s}.sphere-content.size-sm[data-v-7e21fa7d]{width:9em;height:9em;font-size:1.25em}.sphere-content.size-md[data-v-7e21fa7d]{width:13em;height:13em;font-size:1.5em}.sphere-content.size-lg[data-v-7e21fa7d]{width:16em;height:16em;font-size:2em;font-weight:bold}.sphere-swirl[data-v-7e21fa7d]{position:absolute;inset:-50%;background:linear-gradient(135deg,transparent,rgba(255,255,255,0.1),transparent);transform:rotate(45deg);animation:blob-7e21fa7d 7s infinite;opacity:.3}.sphere-label[data-v-7e21fa7d]{position:relative;z-index:10;color:#fff;letter-spacing:.2em;transition:transform .5s;text-shadow:0 0 10px hsla(0,0%,100%,.5)}@keyframes float-7e21fa7d{0%,100%{transform:translateY(0) translateX(0) scale(1)}25%{transform:translateY(-20px) translateX(10px) scale(1.02)}50%{transform:translateY(0) translateX(-10px) scale(1)}75%{transform:translateY(-10px) translateX(5px) scale(1.01)}}@keyframes pulse-slow-7e21fa7d{0%,100%{opacity:.3}50%{opacity:.15}}@keyframes blob-7e21fa7d{0%{transform:translate(0px,0px) scale(1) rotate(45deg)}33%{transform:translate(30px,-50px) scale(1.1) rotate(45deg)}66%{transform:translate(-20px,20px) scale(0.9) rotate(45deg)}100%{transform:translate(0px,0px) scale(1) rotate(45deg)}}
.glass-panel[data-v-f8670f2c]{position:relative;background:var(--glass-100);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid var(--glass-border);box-shadow:0 8px 32px 0 rgba(0,0,0,.37);border-radius:1.5em;overflow:hidden;color:#f1f5f9}@media (hover:none)and (pointer:coarse){.glass-panel[data-v-f8670f2c]{backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);background:rgba(20,20,25,.7)}}.glass-panel.full-height[data-v-f8670f2c]{height:100%}.shiny-edge-top[data-v-f8670f2c]{position:absolute;inset:0;height:1px;background:linear-gradient(to right,transparent,rgba(255,255,255,0.2),transparent);opacity:.5}.shiny-edge-left[data-v-f8670f2c]{position:absolute;top:0;left:0;width:1px;height:100%;background:linear-gradient(to bottom,transparent,rgba(255,255,255,0.1),transparent);opacity:.3}
.temp-message-overlay[data-v-525d84fb]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.4);backdrop-filter:blur(2px);z-index:12000;display:flex;align-items:center;justify-content:center;pointer-events:auto}.message-box[data-v-525d84fb]{min-width:300px;max-width:80vw;padding:2rem;display:flex;flex-direction:column;align-items:center;gap:1.5rem;text-align:center;border:1px solid hsla(0,0%,100%,.1)}.message-body[data-v-525d84fb]{display:flex;flex-direction:column;align-items:center;gap:1rem}.message-text[data-v-525d84fb]{font-size:1.1rem;color:#fff;white-space:pre-wrap;line-height:1.5}.message-actions[data-v-525d84fb]{display:flex;justify-content:center;width:100%}.btn-primary[data-v-525d84fb]{padding:.5rem 2rem;background:hsla(0,0%,100%,.1);border:1px solid hsla(0,0%,100%,.2);color:#fff;cursor:pointer;transition:all .2s;border-radius:4px;font-size:1rem}.btn-primary[data-v-525d84fb]:hover{background:hsla(0,0%,100%,.2);transform:translateY(-1px)}.btn-primary[data-v-525d84fb]:active{transform:translateY(0)}.loading-spinner[data-v-525d84fb]{width:40px;height:40px;border:4px solid hsla(0,0%,100%,.1);border-radius:50%;border-top-color:#fff;animation:spin-525d84fb 1s ease-in-out infinite}@keyframes spin-525d84fb{to{transform:rotate(360deg)}}.icon-wrapper[data-v-525d84fb]{color:#fff}.icon-wrapper.error[data-v-525d84fb]{color:#ff6b6b}.icon-wrapper.success[data-v-525d84fb]{color:#51cf66}.icon-wrapper.warning[data-v-525d84fb]{color:#fcc419}.msg-fade-enter-active[data-v-525d84fb],.msg-fade-leave-active[data-v-525d84fb]{transition:opacity .3s ease}.msg-fade-enter-from[data-v-525d84fb],.msg-fade-leave-to[data-v-525d84fb]{opacity:0}
.home-view[data-v-8e0e978a]{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;overflow:hidden;font-size:.85vw}.user-info[data-v-8e0e978a]{position:absolute;top:2.5em;right:2.5em;display:flex;align-items:center;gap:.75em;color:hsla(0,0%,100%,.5);background:rgba(0,0,0,.2);backdrop-filter:blur(12px);padding:.5em 1em;border-radius:9999px;border:.0625em solid hsla(0,0%,100%,.05)}.user-info span[data-v-8e0e978a]{font-size:1.5em;font-weight:300;letter-spacing:.2em}.user-avatar[data-v-8e0e978a]{width:3em;height:3em;border-radius:50%;object-fit:cover}.title-section[data-v-8e0e978a]{position:absolute;top:2em;left:2em;z-index:10}.main-title[data-v-8e0e978a]{font-size:3em;font-weight:900;background:linear-gradient(to bottom right,white,rgb(221,214,254),rgba(255,255,255,0.2));-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0);background-clip:text;letter-spacing:-0.05em;filter:drop-shadow(0 0.25em 0.375em rgba(0,0,0,0.3))}.sub-title[data-v-8e0e978a]{font-size:.5em;font-weight:300;letter-spacing:.2em;color:#c4b5fd;-webkit-text-fill-color:#c4b5fd}.description[data-v-8e0e978a]{margin-top:1em;color:hsla(0,0%,100%,.4);max-width:20em;font-size:1em;line-height:1.625;border-left:.125em solid rgba(139,92,246,.5);padding-left:1em}.sphere-position[data-v-8e0e978a]{position:absolute}.sphere-start[data-v-8e0e978a]{top:50%;left:22%;transform:translateY(-50%);z-index:20}.sphere-workshop[data-v-8e0e978a]{top:40%;right:12%;z-index:10}.sphere-load[data-v-8e0e978a]{bottom:15%;left:38%;z-index:30}
.confirm-overlay[data-v-7f68815a]{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);z-index:2000;display:flex;align-items:center;justify-content:center}.confirm-box[data-v-7f68815a]{width:90%;max-width:400px;padding:1.5em;display:flex;flex-direction:column;gap:1.25em;border:1px solid rgba(248,113,113,.3);box-shadow:0 10px 40px rgba(0,0,0,.5)}.confirm-header[data-v-7f68815a]{display:flex;align-items:center;gap:.75em}.confirm-header .warn-icon[data-v-7f68815a]{color:#fbbf24}.confirm-header h3[data-v-7f68815a]{font-size:1.25em;font-weight:bold;color:#fff;margin:0}.confirm-message[data-v-7f68815a]{color:hsla(0,0%,100%,.9);line-height:1.5;font-size:1em}.confirm-actions[data-v-7f68815a]{display:flex;justify-content:flex-end;gap:1em;margin-top:.5em}.confirm-actions button[data-v-7f68815a]{padding:.5em 1.5em;border-radius:9999px;font-size:.9em;font-weight:bold;cursor:pointer;transition:all .2s}.btn-cancel[data-v-7f68815a]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);color:hsla(0,0%,100%,.7)}.btn-cancel[data-v-7f68815a]:hover{background:hsla(0,0%,100%,.1);color:#fff}.btn-confirm[data-v-7f68815a]{background:#ef4444;border:none;color:#fff;box-shadow:0 0 15px rgba(239,68,68,.3)}.btn-confirm[data-v-7f68815a]:hover{background:#dc2626;box-shadow:0 0 20px rgba(239,68,68,.5)}.fade-enter-active[data-v-7f68815a],.fade-leave-active[data-v-7f68815a]{transition:opacity .2s}.fade-enter-from[data-v-7f68815a],.fade-leave-to[data-v-7f68815a]{opacity:0}
.load-game-view[data-v-ddadd5c2]{position:relative;width:100%;height:100%;padding:3em;display:flex;flex-direction:column;z-index:20;font-size:.85vw;box-sizing:border-box}.header[data-v-ddadd5c2]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2em}.header-left[data-v-ddadd5c2]{display:flex;align-items:center;gap:1.5em}.back-btn[data-v-ddadd5c2]{display:flex;align-items:center;gap:.5em;color:hsla(0,0%,100%,.6);background:none;border:none;cursor:pointer;transition:color .3s}.back-btn[data-v-ddadd5c2]:hover{color:#fff}.back-btn:hover .back-icon-wrapper[data-v-ddadd5c2]{background:hsla(0,0%,100%,.1)}.back-icon-wrapper[data-v-ddadd5c2]{padding:.5em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.05);transition:background .3s}.page-title[data-v-ddadd5c2]{font-size:2.25em;font-weight:300;letter-spacing:.2em;color:#fff}.import-btn[data-v-ddadd5c2]{display:flex;align-items:center;gap:.5em;padding:.5em 1.5em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);color:#f0abfc;font-size:.875em;cursor:pointer;transition:background .3s}.import-btn[data-v-ddadd5c2]:hover{background:hsla(0,0%,100%,.1)}.saves-panel[data-v-ddadd5c2]{flex:1;padding:2em}.saves-container[data-v-ddadd5c2]{display:flex;flex-direction:column;gap:1.5em;overflow-y:auto;height:100%;padding-right:1em}.section-title[data-v-ddadd5c2]{font-size:.9em;letter-spacing:.1em;color:hsla(0,0%,100%,.6);margin-top:.25em}.save-item[data-v-ddadd5c2]{position:relative;display:flex;gap:1.5em;align-items:center;padding:1em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;transition:all .3s}.save-item[data-v-ddadd5c2]:hover{background:rgba(0,0,0,.4);border-color:rgba(217,70,239,.5);transform:translateX(0.5em)}.save-item:hover .save-chapter[data-v-ddadd5c2]{color:#f0abfc}.save-item:hover .save-actions[data-v-ddadd5c2]{opacity:1}.save-thumbnail[data-v-ddadd5c2]{position:relative;width:12em;height:7em;border-radius:.5em;overflow:hidden;flex-shrink:0;border:1px solid hsla(0,0%,100%,.1)}.save-thumbnail img[data-v-ddadd5c2]{width:100%;height:100%;object-fit:cover;opacity:.7;transition:opacity .3s}.save-item:hover .save-thumbnail img[data-v-ddadd5c2]{opacity:1}.slot-badge[data-v-ddadd5c2]{position:absolute;top:.6em;left:.6em;font-size:.7em;padding:.25em .6em;border-radius:9999px;letter-spacing:.08em;background:rgba(0,0,0,.55);border:1px solid hsla(0,0%,100%,.15);color:hsla(0,0%,100%,.85)}.badge-auto[data-v-ddadd5c2]{border-color:rgba(59,130,246,.5);color:#93c5fd}.badge-cloud[data-v-ddadd5c2]{border-color:rgba(217,70,239,.5);color:#f0abfc}.badge-manual[data-v-ddadd5c2]{border-color:rgba(34,197,94,.45);color:#86efac}.thumbnail-overlay[data-v-ddadd5c2]{position:absolute;inset:0;background:linear-gradient(to right,rgba(0,0,0,0.5),transparent)}.save-info[data-v-ddadd5c2]{flex:1}.save-header[data-v-ddadd5c2]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.5em}.save-chapter[data-v-ddadd5c2]{font-size:1.25em;font-weight:bold;color:#fff;transition:color .3s}.save-date[data-v-ddadd5c2]{font-size:.75em;font-family:monospace;color:#6b7280;background:rgba(0,0,0,.3);padding:.25em .5em;border-radius:.25em}.save-summary[data-v-ddadd5c2]{font-size:.875em;color:#9ca3af}.save-firstline[data-v-ddadd5c2]{margin-top:.35em;font-size:.8em;color:hsla(0,0%,100%,.55);line-height:1.35;overflow:hidden;display:-webkit-box;line-clamp:2;-webkit-line-clamp:2;-webkit-box-orient:vertical}.save-actions[data-v-ddadd5c2]{display:flex;flex-direction:column;gap:.5em;opacity:.5;transition:opacity .3s}.action-btn[data-v-ddadd5c2]{padding:.5em;border-radius:9999px;background:none;border:none;color:#9ca3af;cursor:pointer;transition:all .3s}.action-btn.load-btn[data-v-ddadd5c2]:hover{background:#d946ef;color:#fff}.action-btn.export-btn[data-v-ddadd5c2]:hover{background:#3b82f6;color:#fff}.action-btn.delete-btn[data-v-ddadd5c2]:hover{background:#ef4444;color:#fff}.no-saves[data-v-ddadd5c2]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:4em;color:hsla(0,0%,100%,.3)}.no-saves p[data-v-ddadd5c2]{margin:0;font-size:1.25em}.no-saves span[data-v-ddadd5c2]{font-size:.875em;color:hsla(0,0%,100%,.2)}.no-saves.compact[data-v-ddadd5c2]{padding:1.5em 0}.loading-state[data-v-ddadd5c2]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:4em;color:hsla(0,0%,100%,.5)}.loading-state p[data-v-ddadd5c2]{margin:0}.loading-spinner[data-v-ddadd5c2]{width:3em;height:3em;border:.25em solid hsla(0,0%,100%,.1);border-radius:50%;border-top-color:#a78bfa;animation:spin-ddadd5c2 1s ease-in-out infinite}@keyframes spin-ddadd5c2{to{transform:rotate(360deg)}}.placeholder-thumb[data-v-ddadd5c2]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);color:hsla(0,0%,100%,.2)}
.step-container[data-v-429894f2]{height:100%;display:flex;flex-direction:column}.selection-grid[data-v-429894f2]{display:grid;grid-template-columns:1fr 1fr;gap:2em;height:100%;overflow:hidden}.selection-column[data-v-429894f2]{display:flex;flex-direction:column;height:100%;background:hsla(0,0%,100%,.02);border-radius:.75em;border:1px solid hsla(0,0%,100%,.05);overflow:hidden}.column-header[data-v-429894f2]{padding:1em 1.5em;background:rgba(0,0,0,.2);display:flex;align-items:center;gap:.75em;border-bottom:1px solid hsla(0,0%,100%,.05)}.column-header h2[data-v-429894f2]{margin:0;font-size:1.125em;font-weight:600;letter-spacing:1px;text-transform:uppercase}.column-header.event-header[data-v-429894f2]{color:#c4b5fd}.column-header.char-header[data-v-429894f2]{color:#67e8f9}.scrollable-list[data-v-429894f2],.scrollable-grid[data-v-429894f2]{flex:1;overflow-y:auto;padding:1.5em}.scrollable-list[data-v-429894f2]{display:flex;flex-direction:column;gap:1em}.scrollable-grid[data-v-429894f2]{display:grid;grid-template-columns:repeat(auto-fill,minmax(12.5em,1fr));gap:1em;align-content:start}.event-card[data-v-429894f2]{display:flex;gap:1em;padding:1em;background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;cursor:pointer;transition:all .2s;position:relative}.event-card[data-v-429894f2]:hover{background:hsla(0,0%,100%,.05);border-color:rgba(196,181,253,.3)}.event-card.selected[data-v-429894f2]{background:rgba(196,181,253,.1);border-color:#a78bfa;box-shadow:0 0 .9em rgba(167,139,250,.1)}.event-card .checked-icon[data-v-429894f2]{position:absolute;top:.625em;right:.625em;color:#a78bfa}.event-card .card-cover[data-v-429894f2]{width:10em;height:5.625em;border-radius:.375em;background-size:cover;background-position:center;background-color:#111;flex-shrink:0;display:flex;align-items:center;justify-content:center}.event-card .card-cover .placeholder[data-v-429894f2]{font-size:.7em;color:#555}.event-card .card-info[data-v-429894f2]{display:flex;flex-direction:column;gap:.375em}.event-card .card-info h3[data-v-429894f2]{margin:0;font-size:1.125em;color:#fff}.event-card .card-info p[data-v-429894f2]{margin:0;font-size:.875em;color:#94a3b8;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.event-card .card-info .pack-meta[data-v-429894f2]{margin-top:auto}.event-card .card-info .pack-meta .link-badge[data-v-429894f2]{font-size:.75em;background:rgba(139,92,246,.2);color:#c4b5fd;padding:.125em .375em;border-radius:.25em}.char-card[data-v-429894f2]{display:flex;flex-direction:column;background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;overflow:hidden;cursor:pointer;transition:all .2s}.char-card[data-v-429894f2]:hover{transform:translateY(-2px);border-color:rgba(103,232,249,.4)}.char-card.selected[data-v-429894f2]{border-color:#67e8f9;box-shadow:0 0 15px rgba(103,232,249,.2)}.char-card.selected .char-cover[data-v-429894f2]{border-bottom-color:#67e8f9}.char-card .char-cover[data-v-429894f2]{height:7em;background-size:cover;background-position:center;background-color:#111;position:relative;border-bottom:1px solid hsla(0,0%,100%,.05);aspect-ratio:16/9}.char-card .char-cover .overlay[data-v-429894f2]{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.8),transparent);opacity:.6}.char-card .char-cover .check-mark[data-v-429894f2]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#67e8f9;filter:drop-shadow(0 0 5px rgba(0,0,0,0.8))}.char-card .char-info[data-v-429894f2]{padding:.75em}.char-card .char-info h3[data-v-429894f2]{margin:0;font-size:.9375em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#e2e8f0}.char-card .char-info .preset-count[data-v-429894f2]{font-size:.75em;color:#64748b}.empty-list[data-v-429894f2]{color:#64748b;text-align:center;padding:2em;font-size:.875em;font-style:italic}
.step-container[data-v-0b0de7a9]{height:100%}.split-layout[data-v-0b0de7a9]{display:grid;grid-template-columns:1fr 1.5fr;gap:2em;height:100%}.info-column[data-v-0b0de7a9],.selection-column[data-v-0b0de7a9]{background:hsla(0,0%,100%,.02);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;display:flex;flex-direction:column;overflow:hidden}.header[data-v-0b0de7a9]{padding:1em 1.5em;background:rgba(0,0,0,.2);display:flex;align-items:center;gap:.75em;border-bottom:1px solid hsla(0,0%,100%,.05)}.header h2[data-v-0b0de7a9]{margin:0;font-size:1.125em;font-weight:600;color:#fcd34d;text-transform:uppercase}.scenario-details[data-v-0b0de7a9]{padding:2em;display:flex;flex-direction:column;gap:1.5em}.scenario-details .detail-row[data-v-0b0de7a9]{display:flex;flex-direction:column;gap:.5em}.scenario-details .detail-row label[data-v-0b0de7a9]{color:#94a3b8;font-size:.875em;text-transform:uppercase;letter-spacing:1px}.scenario-details .detail-row span[data-v-0b0de7a9],.scenario-details .detail-row p[data-v-0b0de7a9]{color:#fff;font-size:1.125em;line-height:1.6}.anchor-list[data-v-0b0de7a9]{flex:1;overflow-y:auto;padding:1.5em;display:flex;flex-direction:column;gap:1em}.anchor-card[data-v-0b0de7a9]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1.25em;cursor:pointer;transition:all .2s}.anchor-card[data-v-0b0de7a9]:hover{border-color:rgba(252,211,77,.4);background:hsla(0,0%,100%,.05)}.anchor-card.selected[data-v-0b0de7a9]{border-color:#fcd34d;background:rgba(252,211,77,.1);box-shadow:0 0 .9em rgba(252,211,77,.1)}.anchor-card .anchor-header[data-v-0b0de7a9]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5em}.anchor-card .anchor-header h3[data-v-0b0de7a9]{margin:0;font-size:1.125em;color:#fff}.anchor-card .anchor-header .badge[data-v-0b0de7a9]{font-size:.75em;background:hsla(0,0%,100%,.1);padding:.125em .375em;border-radius:.25em;color:#cbd5e1}.anchor-card .anchor-header .badge.custom[data-v-0b0de7a9]{background:rgba(252,211,77,.2);color:#fcd34d}.anchor-card .anchor-meta[data-v-0b0de7a9]{display:flex;gap:1em;color:#94a3b8;font-size:.875em;margin-bottom:.75em}.anchor-card .anchor-meta span[data-v-0b0de7a9]{display:flex;align-items:center;gap:.25em}.anchor-card .anchor-desc[data-v-0b0de7a9]{color:#cbd5e1;font-size:.9375em;line-height:1.5;margin:0;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.custom-form[data-v-0b0de7a9]{display:flex;flex-direction:column;gap:.75em;margin-top:1em}.custom-form input[data-v-0b0de7a9],.custom-form textarea[data-v-0b0de7a9]{width:100%;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);padding:.75em;border-radius:.375em;color:#fff;font-family:inherit;font-size:.875em}.custom-form input[data-v-0b0de7a9]:focus,.custom-form textarea[data-v-0b0de7a9]:focus{outline:none;border-color:#fcd34d}.empty-state[data-v-0b0de7a9]{padding:3em;text-align:center;color:#64748b;font-size:.875em}
.step-container[data-v-41af27aa]{height:100%;display:grid;grid-template-columns:25em 1fr;gap:2em}.presets-column[data-v-41af27aa],.editor-column[data-v-41af27aa]{background:hsla(0,0%,100%,.02);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;display:flex;flex-direction:column;overflow:hidden}.header[data-v-41af27aa]{padding:1em;background:rgba(0,0,0,.2);display:flex;align-items:center;gap:.75em;border-bottom:1px solid hsla(0,0%,100%,.05)}.header h2[data-v-41af27aa]{margin:0;font-size:1.125em;font-weight:600;color:#f9a8d4;text-transform:uppercase}.status-badge[data-v-41af27aa]{margin-left:auto;font-size:.8125em;padding:.25em .625em;border-radius:.25em;background:#ef4444;color:#fff}.status-badge.valid[data-v-41af27aa]{background:#10b981}.presets-list[data-v-41af27aa]{flex:1;overflow-y:auto;padding:1em;display:flex;flex-direction:column;gap:1em}.preset-card[data-v-41af27aa]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.08);border-radius:.5em;padding:.75em}.preset-card[data-v-41af27aa]:hover{border-color:hsla(0,0%,100%,.15)}.preset-card .preset-header[data-v-41af27aa]{display:flex;align-items:center;gap:.75em;margin-bottom:.625em}.preset-card .preset-cover[data-v-41af27aa]{width:2.5em;aspect-ratio:9/16;border-radius:.25em;background-size:cover;background-position:center;background-color:#222;flex-shrink:0}.preset-card .preset-info[data-v-41af27aa]{display:flex;flex-direction:column}.preset-card .preset-info .pn[data-v-41af27aa]{font-weight:bold;font-size:.875em;color:#fff}.preset-card .preset-info .origin[data-v-41af27aa]{font-size:.75em;color:#94a3b8}.preset-card .category-buttons[data-v-41af27aa]{display:flex;gap:.375em;flex-wrap:wrap;margin-bottom:.625em}.preset-card .cat-btn[data-v-41af27aa]{display:flex;align-items:center;gap:.25em;padding:.3125em .625em;background:hsla(0,0%,100%,.08);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;color:#aaa;font-size:.75em;cursor:pointer;transition:all .2s}.preset-card .cat-btn[data-v-41af27aa]:hover{background:rgba(167,139,250,.2);border-color:#a78bfa;color:#fff}.preset-card .cat-btn.selected[data-v-41af27aa]{background:rgba(167,139,250,.4);border-color:#a78bfa;color:#fff}.preset-card .preset-preview[data-v-41af27aa]{font-size:.75em;color:#666;display:flex;flex-direction:column;gap:.25em}.preset-card .preset-preview .preview-item[data-v-41af27aa]{display:flex;gap:.25em;line-height:1.4}.preset-card .preset-preview .preview-label[data-v-41af27aa]{color:#888;flex-shrink:0}.empty-list[data-v-41af27aa]{color:#666;text-align:center;padding:2em;font-size:.875em}.form-scroll[data-v-41af27aa]{flex:1;overflow-y:auto;padding:1.5em;display:flex;flex-direction:column;gap:1.5em}.form-section .section-header[data-v-41af27aa]{display:flex;align-items:center;justify-content:space-between;margin-bottom:.625em}.form-section h3[data-v-41af27aa]{font-size:1em;color:#f9a8d4;margin:0;display:flex;align-items:center;gap:.5em}.form-section .selection-count[data-v-41af27aa]{font-size:.75em;color:#a78bfa;background:rgba(167,139,250,.1);padding:.25em .5em;border-radius:.25em}.form-section textarea[data-v-41af27aa]{width:100%;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.375em;padding:.75em;color:#fff;resize:vertical;font-family:inherit;font-size:.875em;min-height:5em}.form-section textarea[data-v-41af27aa]:focus{outline:none;border-color:#f9a8d4}.input-grid[data-v-41af27aa]{display:flex;gap:1.5em}.avatar-uploader[data-v-41af27aa]{width:6.25em;aspect-ratio:9/16;border-radius:.5em;border:1px dashed hsla(0,0%,100%,.2);background-size:cover;background-position:center;position:relative;display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-uploader span[data-v-41af27aa]{font-size:.8125em;color:#666}.identity-fields[data-v-41af27aa]{flex:1;display:flex;flex-direction:column;gap:.75em}.identity-fields .field[data-v-41af27aa]{display:flex;flex-direction:column;gap:.3125em}.identity-fields .field label[data-v-41af27aa]{font-size:.8125em;color:#94a3b8}.identity-fields .field input[data-v-41af27aa]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;padding:.625em;color:#fff;font-size:.875em}.identity-fields .field input[data-v-41af27aa]:focus{border-color:#f9a8d4;outline:none}
.new-game-root[data-v-5b862732]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;font-size:.85vw}.visual-container[data-v-5b862732]{width:100%;height:100%;display:flex;flex-direction:column;padding:2em 2.5em;box-sizing:border-box}.new-game-header[data-v-5b862732]{height:5em;display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5em;flex-shrink:0}.nav-btn[data-v-5b862732]{display:flex;align-items:center;gap:.5em;padding:.9em 1.8em;background:#fff;color:#000;border:none;font-weight:bold;font-size:1em;border-radius:99em;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:1px}.nav-btn[data-v-5b862732]:hover{transform:scale(1.05);box-shadow:0 0 15px hsla(0,0%,100%,.3)}.nav-btn.disabled[data-v-5b862732]{opacity:.5;cursor:not-allowed;background:#555;color:#999}.nav-btn.next[data-v-5b862732]{background:linear-gradient(135deg,#a78bfa,#22d3ee);color:#fff}.steps-progress[data-v-5b862732]{display:flex;align-items:center;gap:.6em}.steps-progress .step-dot[data-v-5b862732]{width:2em;height:2em;border-radius:50%;background:hsla(0,0%,100%,.1);color:#666;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:1em;border:2px solid rgba(0,0,0,0)}.steps-progress .step-dot.active[data-v-5b862732]{background:#a78bfa;color:#fff}.steps-progress .step-dot.current[data-v-5b862732]{box-shadow:0 0 0 .25em rgba(167,139,250,.2)}.steps-progress .line[data-v-5b862732]{width:3em;height:2px;background:hsla(0,0%,100%,.1)}.steps-progress .line.active[data-v-5b862732]{background:#a78bfa}.step-content-wrapper[data-v-5b862732]{flex:1;background:rgba(20,20,25,.6);backdrop-filter:blur(10px);border:1px solid hsla(0,0%,100%,.05);border-radius:1.25em;padding:2em;overflow:hidden;box-shadow:0 1.25em 3em rgba(0,0,0,.5)}
.user-widget-container[data-v-79a103d6]{position:relative;min-height:50px;width:100%;display:flex;justify-content:flex-start;align-items:flex-start}.user-widget-content-outer[data-v-79a103d6]{width:100%;min-width:0;max-width:100%}.user-widget-content-inner[data-v-79a103d6]{display:inline-block;transform-origin:top left;transform:scale(var(--th-widget-scale,1))}.widget-loading[data-v-79a103d6]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2em;color:hsla(0,0%,100%,.5);gap:1em}.widget-loading .loading-spinner[data-v-79a103d6]{width:24px;height:24px;border:2px solid hsla(0,0%,100%,.1);border-top-color:rgba(139,92,246,.8);border-radius:50%;animation:spin-79a103d6 1s linear infinite}.widget-error[data-v-79a103d6]{display:flex;flex-direction:column;align-items:center;padding:2em;background:rgba(127,29,29,.2);border:1px solid rgba(239,68,68,.3);border-radius:.5em;text-align:center}.widget-error .error-icon[data-v-79a103d6]{font-size:2em;margin-bottom:.5em}.widget-error .error-title[data-v-79a103d6]{font-weight:bold;color:#f87171;margin-bottom:.5em}.widget-error .error-message[data-v-79a103d6]{color:hsla(0,0%,100%,.6);font-size:.85em;white-space:pre-wrap;max-width:100%;overflow-wrap:break-word;margin-bottom:1em}.widget-error .retry-btn[data-v-79a103d6]{padding:.5em 1.5em;background:rgba(239,68,68,.2);border:1px solid rgba(239,68,68,.4);border-radius:.25em;color:#f87171;cursor:pointer;transition:all .2s}.widget-error .retry-btn[data-v-79a103d6]:hover{background:rgba(239,68,68,.3)}.widget-warnings[data-v-79a103d6]{margin-bottom:1em}.widget-warnings .warning-item[data-v-79a103d6]{padding:.5em 1em;background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.2);border-radius:.25em;color:#fbbf24;font-size:.85em;margin-bottom:.5em}@keyframes spin-79a103d6{to{transform:rotate(360deg)}}
.gallery-card[data-v-3e807441]{cursor:pointer;transition:border-color .3s;overflow:hidden;position:relative}.gallery-card[data-v-3e807441]:hover{border-color:rgba(167,139,250,.5)}.gallery-card:hover .card-actions[data-v-3e807441]{opacity:1}.gallery-card:hover .card-image img[data-v-3e807441]{transform:scale(1.05)}.card-actions[data-v-3e807441]{position:absolute;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);display:flex;align-items:center;justify-content:center;gap:1em;opacity:0;transition:opacity .3s;z-index:10}.card-actions button[data-v-3e807441]{width:3em;height:3em;border-radius:50%;border:1px solid hsla(0,0%,100%,.2);background:hsla(0,0%,100%,.1);color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.card-actions button[data-v-3e807441]:hover{transform:scale(1.1);background:hsla(0,0%,100%,.2)}.card-actions button.btn-delete[data-v-3e807441]:hover{background:rgba(239,68,68,.5);border-color:rgba(239,68,68,.5)}.card-actions button.btn-delete-remote[data-v-3e807441]{border-color:rgba(239,68,68,.6);background:rgba(239,68,68,.18)}.card-actions button.btn-delete-remote[data-v-3e807441]:hover{background:rgba(239,68,68,.75);border-color:rgba(239,68,68,.95);transform:scale(1.15)}.card-actions button.btn-edit[data-v-3e807441]:hover{background:rgba(139,92,246,.5);border-color:rgba(139,92,246,.5)}.card-actions button.btn-info[data-v-3e807441]:hover{background:rgba(59,130,246,.45);border-color:rgba(59,130,246,.55)}.card-actions button.btn-file-download[data-v-3e807441]:hover{background:rgba(14,165,233,.45);border-color:rgba(14,165,233,.55)}.card-image[data-v-3e807441]{position:relative;aspect-ratio:16/10;background:rgba(0,0,0,.5);overflow:hidden}.card-image img[data-v-3e807441]{width:100%;height:100%;object-fit:cover;transition:transform .7s}.card-type-badge[data-v-3e807441]{position:absolute;top:.5em;left:.5em;padding:.25em .5em;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);border-radius:.25em;font-size:.825em;font-weight:bold;border:1px solid hsla(0,0%,100%,.1);color:#fff}.card-status-badge[data-v-3e807441]{position:absolute;top:.5em;right:.5em;padding:.25em .6em;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);border-radius:9999px;font-size:.825em;font-weight:bold;border:1px solid hsla(0,0%,100%,.1);color:#fff}.card-status-badge.local[data-v-3e807441]{border-color:rgba(14,165,233,.35)}.card-status-badge.cloud[data-v-3e807441]{border-color:rgba(167,139,250,.35)}.card-status-badge.both[data-v-3e807441]{border-color:rgba(34,197,94,.35)}.card-content[data-v-3e807441]{padding:1em}.card-header[data-v-3e807441]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.5em}.card-header h3[data-v-3e807441]{font-weight:bold;font-size:1.125em;color:#fff;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-right:.5em}.card-header .card-metrics[data-v-3e807441]{display:flex;align-items:center;gap:.75em;flex-shrink:0}.card-header .card-metrics .downloads[data-v-3e807441]{display:flex;align-items:center;gap:.25em;font-size:.75em;color:hsla(0,0%,100%,.75)}.card-author[data-v-3e807441]{display:flex;align-items:center;gap:.5em;margin-bottom:.75em}.card-author .author-avatar[data-v-3e807441]{width:1.25em;height:1.25em;border-radius:9999px;background:linear-gradient(135deg,#8b5cf6,#06b6d4)}.card-author .author-avatar-img[data-v-3e807441]{object-fit:cover;background:rgba(0,0,0,0)}.card-author span[data-v-3e807441]{font-size:.75em;color:#9ca3af}.card-author.btn-download[data-v-3e807441]:hover{background:rgba(8,145,178,.5);border-color:rgba(6,182,212,.5)}.card-author.btn-upload[data-v-3e807441]:hover{background:rgba(34,197,94,.45);border-color:rgba(34,197,94,.45)}.card-author .verified-icon[data-v-3e807441]{color:#3b82f6}.card-tags[data-v-3e807441]{display:flex;gap:.5em;flex-wrap:wrap}.card-tags span[data-v-3e807441]{font-size:.625em;padding:.25em .5em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.05);color:#9ca3af}
.image-cropper-overlay[data-v-085c99f0]{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:9999}.cropper-modal[data-v-085c99f0]{background:#1f2937;border:1px solid hsla(0,0%,100%,.1);border-radius:12px;padding:20px;width:90%;max-width:900px;display:flex;flex-direction:column;gap:16px;box-shadow:0 20px 25px -5px rgba(0,0,0,.5)}.cropper-header[data-v-085c99f0]{display:flex;justify-content:space-between;align-items:center;color:#e5e7eb}.cropper-viewport-container[data-v-085c99f0]{width:100%;padding:2em;background:#111;border-radius:8px;display:flex;justify-content:center;align-items:center;overflow:hidden}.cropper-viewport[data-v-085c99f0]{width:100%;max-height:60vh;position:relative;overflow:hidden;box-shadow:0 0 0 1px hsla(0,0%,100%,.5),0 0 0 9999px rgba(0,0,0,.7);display:block}.cropper-viewport img[data-v-085c99f0]{position:absolute;top:0;left:0;width:100%;height:auto;will-change:transform;-webkit-user-select:none;user-select:none}.cropper-footer[data-v-085c99f0]{display:flex;justify-content:flex-end;gap:12px}.btn[data-v-085c99f0]{padding:8px 16px;border-radius:6px;border:none;cursor:pointer;font-weight:500}.btn.cancel[data-v-085c99f0]{background:hsla(0,0%,100%,.1);color:#e5e7eb}.btn.confirm[data-v-085c99f0]{background:#8b5cf6;color:#fff}
.character-block[data-v-844c50f4]{min-width:300px;max-width:340px;border-radius:4px;color:#e2e8f0;position:relative;-webkit-user-select:none;user-select:none;box-shadow:0 4px 15px rgba(0,0,0,.5);border:1px solid hsla(0,0%,100%,.05);background:rgba(20,20,25,.85);backdrop-filter:blur(8px);transition:transform .1s,box-shadow .2s;margin-bottom:2px;border-radius:4px}.character-block.is-dragging[data-v-844c50f4]{opacity:.9;z-index:999;box-shadow:0 10px 30px rgba(0,0,0,.8);transform:scale(1.02);pointer-events:none;border-color:rgba(139,92,246,.5)}.character-block[data-v-844c50f4]{border-left:2px solid hsla(0,0%,100%,.1)}.character-block.type-identity[data-v-844c50f4]{border-left-color:#a78bfa}.character-block .block-header[data-v-844c50f4]{background:hsla(0,0%,100%,.02);padding:8px 12px;display:flex;align-items:center;gap:10px;font-weight:600;font-size:.85em;letter-spacing:.5px;cursor:grab;border-bottom:1px solid hsla(0,0%,100%,.05)}.character-block .block-header[data-v-844c50f4]:active{cursor:grabbing;background:hsla(0,0%,100%,.05)}.character-block .block-header .remove-btn[data-v-844c50f4]{margin-left:auto;background:none;border:none;color:hsla(0,0%,100%,.3);cursor:pointer;opacity:0;transition:opacity .2s,color .2s}.character-block .block-header .remove-btn[data-v-844c50f4]:hover{color:#ef4444}.character-block:hover .block-header .remove-btn[data-v-844c50f4]{opacity:1}.character-block .block-content[data-v-844c50f4]{padding:12px}.character-block .identity-form[data-v-844c50f4]{display:flex;gap:12px}.character-block .identity-form .avatar-upload[data-v-844c50f4]{width:90px;height:160px;flex-shrink:0;background:rgba(0,0,0,.4);border:1px dashed hsla(0,0%,100%,.2);border-radius:4px;background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;font-size:.7em;cursor:pointer;color:#666;transition:border-color .2s}.character-block .identity-form .avatar-upload[data-v-844c50f4]:hover{border-color:#a78bfa;color:#a78bfa}.character-block .identity-form .inputs[data-v-844c50f4]{flex:1;display:flex;flex-direction:column;gap:8px}.character-block .identity-form .inputs input[data-v-844c50f4]{width:100%;background:rgba(0,0,0,.4);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:6px 8px;border-radius:4px;font-size:.9em;transition:border-color .2s}.character-block .identity-form .inputs input[data-v-844c50f4]:focus{outline:none;border-color:rgba(139,92,246,.5)}.character-block .identity-form .inputs input.tiny[data-v-844c50f4]{font-size:.8em;color:#aaa}.character-block .text-content textarea[data-v-844c50f4]{width:100%;background:rgba(0,0,0,.4);border:1px solid hsla(0,0%,100%,.1);resize:vertical;color:#ddd;font-size:.9em;padding:8px;border-radius:4px;font-family:"Segoe UI",sans-serif;line-height:1.4;transition:border-color .2s}.character-block .text-content textarea[data-v-844c50f4]:focus{outline:none;border-color:rgba(139,92,246,.5)}.character-block .text-content textarea[data-v-844c50f4]::placeholder{color:hsla(0,0%,100%,.2)}.character-block .text-content textarea .block-socket-bottom[data-v-844c50f4]{position:relative}.character-block .text-content textarea .block-socket-bottom.is-snap-target[data-v-844c50f4]::after{content:"";display:block;width:100%;height:4px;background:#fbbf24;border-radius:2px;box-shadow:0 0 10px #fbbf24;animation:pulse 1s infinite;margin-top:4px}
.character-palette[data-v-5a44f092]{width:18em;background:rgba(0,0,0,.4);border-right:1px solid hsla(0,0%,100%,.1);padding:1.5em;display:flex;flex-direction:column;gap:1em;overflow-y:auto;flex-shrink:0;backdrop-filter:blur(10px);position:relative;z-index:10}.sidebar-spacer[data-v-5a44f092]{flex:1}.metadata-form[data-v-5a44f092]{display:flex;flex-direction:column;gap:12px;background:rgba(0,0,0,.2);padding:12px;border-radius:8px;border:1px solid hsla(0,0%,100%,.05)}.metadata-form .cover-upload[data-v-5a44f092]{width:100%;aspect-ratio:16/9;background:rgba(0,0,0,.4);border-radius:6px;border:1px dashed hsla(0,0%,100%,.15);background-size:cover;background-position:center;cursor:pointer;position:relative;overflow:hidden}.metadata-form .cover-upload .upload-placeholder[data-v-5a44f092]{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:hsla(0,0%,100%,.3);gap:5px;font-size:.8em}.metadata-form .cover-upload .upload-hover[data-v-5a44f092]{position:absolute;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s;color:#fff}.metadata-form .cover-upload:hover .upload-hover[data-v-5a44f092]{opacity:1}.metadata-form .inputs[data-v-5a44f092]{display:flex;flex-direction:column;gap:8px}.metadata-form .inputs input[data-v-5a44f092],.metadata-form .inputs textarea[data-v-5a44f092]{width:100%;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:8px;border-radius:4px;font-size:.9em;transition:border-color .2s}.metadata-form .inputs input[data-v-5a44f092]:focus,.metadata-form .inputs textarea[data-v-5a44f092]:focus{outline:none;border-color:rgba(139,92,246,.5)}.metadata-form .inputs .title-input[data-v-5a44f092]{font-weight:600;font-size:1em}.metadata-form .inputs .desc-input[data-v-5a44f092]{font-size:.85em;color:#ccc;resize:vertical}.metadata-form .inputs .input-hint[data-v-5a44f092]{display:flex;align-items:center;gap:.5em;padding:.5em;background:rgba(139,92,246,.1);border-radius:.375em;border:1px solid rgba(139,92,246,.2);color:rgba(196,181,253,.9);font-size:.7em;line-height:1.3;margin-top:-4px}.sidebar-group h3[data-v-5a44f092]{font-size:.8em;color:hsla(0,0%,100%,.4);text-transform:uppercase;letter-spacing:.1em;margin-bottom:1em;padding-left:.5em;font-weight:600}.palette-buttons[data-v-5a44f092]{display:flex;flex-direction:column;gap:.5em}.palette-btn[data-v-5a44f092]{width:100%;display:flex;align-items:center;gap:.75em;padding:.85em;background:rgba(0,0,0,0);border:1px solid rgba(0,0,0,0);color:hsla(0,0%,100%,.7);border-radius:.5em;cursor:grab;transition:all .2s;text-align:left;font-size:.95em}.palette-btn[data-v-5a44f092]:hover{background:hsla(0,0%,100%,.05);color:#fff;transform:translateX(2px)}.palette-btn[data-v-5a44f092]:active{cursor:grabbing;background:rgba(139,92,246,.15);border-color:rgba(139,92,246,.3)}.sidebar-info[data-v-5a44f092]{display:flex;flex-direction:column;gap:1.5em;border-top:1px solid hsla(0,0%,100%,.05);padding-top:1.5em}.sidebar-info .info-group h3[data-v-5a44f092]{font-size:.75em;color:hsla(0,0%,100%,.3);text-transform:uppercase;margin-bottom:.5em}.sidebar-info .info-group p[data-v-5a44f092]{font-size:.85em;color:hsla(0,0%,100%,.5);margin:.2em 0;line-height:1.4}
.character-pack-editor-root[data-v-e7b1ae30]{width:100%;height:100%;background:#0f0f12;background-image:radial-gradient(rgba(255,255,255,0.1) 1px,transparent 1px);background-size:20px 20px;overflow:hidden;position:relative;display:flex;align-items:center;justify-content:center}.visual-editor-container[data-v-e7b1ae30]{display:flex;background:rgba(0,0,0,0);color:#fff;overflow:hidden;box-shadow:0 0 100px rgba(0,0,0,.8);font-size:16px}.workspace[data-v-e7b1ae30]{flex:1;position:relative;overflow:hidden;cursor:default;touch-action:none}.workspace[data-v-e7b1ae30]:active{cursor:grabbing}.pan-zoom-wrapper[data-v-e7b1ae30]{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.pan-zoom-wrapper[data-v-e7b1ae30]>*{pointer-events:auto}.snap-hint[data-v-e7b1ae30]{display:none}@keyframes pulse-e7b1ae30{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}.drag-proxy[data-v-e7b1ae30]{position:absolute;pointer-events:none;z-index:1000;opacity:.9;filter:drop-shadow(0 15px 30px rgba(0,0,0,0.6));transform-origin:0 0}
.editor-section[data-v-94b03bdc]{animation:fadeIn .3s ease}.section-title[data-v-94b03bdc]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-94b03bdc]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-94b03bdc]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-94b03bdc]:hover{background:rgba(139,92,246,.4)}.items-list[data-v-94b03bdc]{display:flex;flex-direction:column;gap:1em}.event-item[data-v-94b03bdc]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em}.event-header[data-v-94b03bdc]{display:flex;gap:1em;margin-bottom:1em;align-items:center}.event-name[data-v-94b03bdc]{flex:1;font-weight:bold}.delete-btn[data-v-94b03bdc]{padding:.5em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer}.delete-btn[data-v-94b03bdc]:hover{background:rgba(239,68,68,.4)}.trigger-type-selector[data-v-94b03bdc]{display:flex;align-items:center;gap:1em;margin-bottom:1em}.trigger-type-selector label[data-v-94b03bdc]{color:#9ca3af;font-size:.9em}.type-toggle[data-v-94b03bdc]{display:flex;background:rgba(0,0,0,.3);border-radius:.5em;overflow:hidden;border:1px solid hsla(0,0%,100%,.1)}.type-toggle button[data-v-94b03bdc]{padding:.5em 1em;background:rgba(0,0,0,0);border:none;color:#9ca3af;cursor:pointer;transition:all .2s;font-size:.85em}.type-toggle button.active[data-v-94b03bdc]{background:rgba(139,92,246,.3);color:#c4b5fd}.type-toggle button[data-v-94b03bdc]:hover:not(.active){background:hsla(0,0%,100%,.05)}.conditions-panel[data-v-94b03bdc]{background:rgba(0,0,0,.2);border-radius:.5em;padding:1em;margin-bottom:1em}.conditions-header[data-v-94b03bdc]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75em}.conditions-label[data-v-94b03bdc]{color:#9ca3af;font-size:.9em;display:flex;align-items:center;gap:.5em}.add-condition-btn[data-v-94b03bdc]{padding:.4em .8em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.3);border-radius:.25em;cursor:pointer;font-size:.8em;display:flex;align-items:center;gap:.3em}.add-condition-btn[data-v-94b03bdc]:hover{background:rgba(139,92,246,.4)}.conditions-list[data-v-94b03bdc]{display:flex;flex-direction:column;gap:.5em}.condition-card[data-v-94b03bdc]{display:grid;grid-template-columns:1fr auto 1fr auto;gap:.5em;align-items:center;background:rgba(0,0,0,.2);padding:.5em;border-radius:.25em}.condition-card .var-select[data-v-94b03bdc],.condition-card .val-input[data-v-94b03bdc]{flex:1;min-width:0}.condition-card .op-select[data-v-94b03bdc]{width:3em;text-align:center}.condition-delete[data-v-94b03bdc]{width:1.5em;height:1.5em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer;font-size:1em}.condition-delete[data-v-94b03bdc]:hover{background:rgba(239,68,68,.4)}.no-conditions[data-v-94b03bdc]{text-align:center;color:hsla(0,0%,100%,.3);padding:1em;border:1px dashed hsla(0,0%,100%,.1);border-radius:.25em;font-size:.85em}.natural-condition-panel[data-v-94b03bdc]{background:rgba(0,0,0,.2);border-radius:.5em;padding:1em;margin-bottom:1em}.natural-condition-panel label[data-v-94b03bdc]{display:flex;align-items:center;gap:.5em;color:#9ca3af;font-size:.9em;margin-bottom:.5em}.natural-input[data-v-94b03bdc]{width:100%;min-height:4em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#e5e7eb;padding:.75em;border-radius:.25em;resize:vertical}.natural-input[data-v-94b03bdc]:focus{border-color:#8b5cf6;outline:none}.event-content-wrapper label[data-v-94b03bdc]{display:block;color:#9ca3af;font-size:.85em;margin-bottom:.5em}.event-content[data-v-94b03bdc]{width:100%;min-height:5em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);color:#e5e7eb;padding:.5em;border-radius:.25em}input[data-v-94b03bdc],select[data-v-94b03bdc]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:.5em;border-radius:.25em}input[data-v-94b03bdc]:focus,select[data-v-94b03bdc]:focus{border-color:#8b5cf6;outline:none}.empty-hint[data-v-94b03bdc]{padding:2em;text-align:center;color:hsla(0,0%,100%,.3);border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}
.editor-section[data-v-0916b7e8]{animation:fadeIn .3s ease;height:100%;display:flex;flex-direction:column}.wb-grid[data-v-0916b7e8]{display:grid;grid-template-columns:18em 1fr;gap:1.5em;flex:1;min-height:0}.wb-panel[data-v-0916b7e8]{background:rgba(0,0,0,.2);border-radius:.5em;overflow:hidden;display:flex;flex-direction:column;border:1px solid hsla(0,0%,100%,.05);min-height:0}.panel-header[data-v-0916b7e8]{display:flex;justify-content:space-between;align-items:center;padding:.75em 1em;border-bottom:1px solid hsla(0,0%,100%,.1);background:rgba(0,0,0,.2)}.panel-header h4[data-v-0916b7e8]{margin:0;font-size:.95em;display:flex;align-items:center;gap:.5em;color:#c4b5fd}.panel-content[data-v-0916b7e8]{flex:1;padding:1em;overflow-y:auto;min-height:0}.add-mini-btn[data-v-0916b7e8]{background:hsla(0,0%,100%,.1);color:#fff;border:none;width:1.8em;height:1.8em;border-radius:.25em;cursor:pointer}.add-mini-btn[data-v-0916b7e8]:hover{background:hsla(0,0%,100%,.2)}.editor-actions[data-v-0916b7e8]{display:flex;gap:.5em}.danger-btn[data-v-0916b7e8]{background:rgba(239,68,68,.18);border:1px solid rgba(239,68,68,.35);color:#fca5a5;border-radius:.4em;padding:.35em .75em;cursor:pointer;font-size:.8em}.danger-btn[data-v-0916b7e8]:hover{background:rgba(239,68,68,.3)}.danger-btn[data-v-0916b7e8]:disabled{opacity:.5;cursor:not-allowed}.entry-list[data-v-0916b7e8]{display:flex;flex-direction:column;gap:.5em}.entry-item[data-v-0916b7e8]{text-align:left;background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:.75em;cursor:pointer;color:hsla(0,0%,100%,.85);transition:.15s ease}.entry-item[data-v-0916b7e8]:hover{background:hsla(0,0%,100%,.06);border-color:hsla(0,0%,100%,.1)}.entry-item.active[data-v-0916b7e8]{background:rgba(139,92,246,.12);border-color:rgba(139,92,246,.3)}.entry-title-row[data-v-0916b7e8]{display:flex;align-items:center;justify-content:space-between;gap:.75em}.entry-title[data-v-0916b7e8]{font-weight:600;font-size:.9em;color:#fff}.entry-sub[data-v-0916b7e8]{margin-top:.25em;font-size:.75em}.dim[data-v-0916b7e8]{color:hsla(0,0%,100%,.45)}.badge[data-v-0916b7e8]{font-size:.7em;padding:.12em .45em;border-radius:99em;border:1px solid hsla(0,0%,100%,.12)}.badge.enabled[data-v-0916b7e8]{color:#c4b5fd;background:rgba(139,92,246,.14);border-color:rgba(139,92,246,.28)}.badge.disabled[data-v-0916b7e8]{color:hsla(0,0%,100%,.55);background:rgba(0,0,0,.2)}.empty-panel[data-v-0916b7e8]{text-align:center;color:hsla(0,0%,100%,.3);padding:2em;border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}.form-grid[data-v-0916b7e8]{display:grid;grid-template-columns:1fr 1fr;gap:1em}.field[data-v-0916b7e8]{display:flex;flex-direction:column;gap:.35em}.field label[data-v-0916b7e8]{font-size:.82em;color:#9ca3af}.field input[data-v-0916b7e8],.field select[data-v-0916b7e8],.field textarea[data-v-0916b7e8]{width:100%;padding:.55em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.35em;color:#fff;font-size:.9em}.field input[data-v-0916b7e8]:focus,.field select[data-v-0916b7e8]:focus,.field textarea[data-v-0916b7e8]:focus{outline:none;border-color:rgba(139,92,246,.7)}.field textarea[data-v-0916b7e8]{min-height:6em;resize:vertical}.field .content[data-v-0916b7e8]{min-height:14em}.span-2[data-v-0916b7e8]{grid-column:1/span 2}.mt[data-v-0916b7e8]{margin-top:.5em}.mono[data-v-0916b7e8]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}.hint[data-v-0916b7e8]{font-size:.75em;color:hsla(0,0%,100%,.45)}.hint.warning[data-v-0916b7e8]{color:#fca5a5}.sub-title[data-v-0916b7e8]{font-size:.85em;font-weight:600;color:hsla(0,0%,100%,.8);padding-top:.25em;border-top:1px solid hsla(0,0%,100%,.08)}.pretty-check[data-v-0916b7e8]{position:relative;display:inline-flex;align-items:center;gap:.6em;cursor:pointer;-webkit-user-select:none;user-select:none;color:hsla(0,0%,100%,.8)}.pretty-check input[data-v-0916b7e8]{position:absolute;opacity:0;pointer-events:none}.pretty-check .check-ui[data-v-0916b7e8]{width:1.15em;height:1.15em;border-radius:.3em;background:rgba(0,0,0,.25);border:1px solid hsla(0,0%,100%,.18);display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;transition:.15s ease;box-shadow:0 0 0 0 rgba(139,92,246,0)}.pretty-check .check-ui[data-v-0916b7e8]::after{content:"";width:.55em;height:.35em;border-left:2px solid rgba(0,0,0,0);border-bottom:2px solid rgba(0,0,0,0);transform:translateY(-0.05em) rotate(-45deg);opacity:0;transition:.15s ease}.pretty-check:hover .check-ui[data-v-0916b7e8]{border-color:rgba(139,92,246,.55);background:rgba(139,92,246,.08)}.pretty-check input:focus-visible+.check-ui[data-v-0916b7e8]{box-shadow:0 0 0 2px rgba(139,92,246,.35);border-color:rgba(139,92,246,.7)}.pretty-check input:checked+.check-ui[data-v-0916b7e8]{background:rgba(139,92,246,.25);border-color:rgba(139,92,246,.75)}.pretty-check input:checked+.check-ui[data-v-0916b7e8]::after{border-left-color:#c4b5fd;border-bottom-color:#c4b5fd;opacity:1}
.editor-section[data-v-6f86564c]{animation:fadeIn-6f86564c .3s ease}.section-title[data-v-6f86564c]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-6f86564c]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.metadata-grid[data-v-6f86564c]{display:grid;grid-template-columns:24em 1fr;gap:2em;background:rgba(0,0,0,.2);padding:1em;border-radius:.5em}.cover-uploader[data-v-6f86564c]{display:flex;flex-direction:column;gap:.5em}.cover-uploader label[data-v-6f86564c]{font-size:.8em;color:#9ca3af}.image-preview[data-v-6f86564c]{width:100%;aspect-ratio:16/9;background:#000;border-radius:.5em;border:2px dashed hsla(0,0%,100%,.1);background-size:contain;background-repeat:no-repeat;background-position:center;position:relative;overflow:hidden;cursor:pointer}.image-preview[data-v-6f86564c]:hover{border-color:#8b5cf6;background-color:hsla(0,0%,100%,.02)}.image-preview .placeholder[data-v-6f86564c]{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;color:hsla(0,0%,100%,.3);gap:.5em}.url-input[data-v-6f86564c]{width:100%;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);padding:.5em;border-radius:.25em;color:#eee;font-size:.8em}.url-input[data-v-6f86564c]:focus{border-color:#8b5cf6;outline:none}.info-fields[data-v-6f86564c]{display:flex;flex-direction:column;gap:1em}.form-group[data-v-6f86564c]{display:flex;flex-direction:column;gap:.5em}.form-group label[data-v-6f86564c]{font-size:.8em;color:#9ca3af}.form-group .linked-packs-selector[data-v-6f86564c]{display:flex;flex-wrap:wrap;gap:.8em;background:rgba(0,0,0,.2);padding:.8em;border-radius:.5em;border:1px solid hsla(0,0%,100%,.05);min-height:80px}.form-group .linked-packs-selector .pack-option[data-v-6f86564c]{display:flex;align-items:center;gap:.5em;padding:.4em .8em;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:4px;cursor:pointer;transition:all .2s;-webkit-user-select:none;user-select:none}.form-group .linked-packs-selector .pack-option[data-v-6f86564c]:hover{background:hsla(0,0%,100%,.1)}.form-group .linked-packs-selector .pack-option.selected[data-v-6f86564c]{background:rgba(139,92,246,.2);border-color:#8b5cf6;color:#c4b5fd}.form-group .linked-packs-selector .pack-option .pack-cover[data-v-6f86564c]{width:24px;height:24px;border-radius:2px;background-size:cover;background-position:center;background-color:#000}.form-group .linked-packs-selector .pack-option .pack-name[data-v-6f86564c]{font-size:.9em;font-weight:500}.form-group .linked-packs-selector .empty-packs[data-v-6f86564c]{color:#6b7280;font-size:.85em;padding:.5em;font-style:italic}.form-group input[data-v-6f86564c],.form-group textarea[data-v-6f86564c]{background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.1);padding:.75em;border-radius:.5em;color:#fff}.form-group input[data-v-6f86564c]:focus,.form-group textarea[data-v-6f86564c]:focus{border-color:#8b5cf6;outline:none}.form-group .disabled-input[data-v-6f86564c]{color:#6b7280;cursor:not-allowed}.full-height[data-v-6f86564c]{flex:1;display:flex;flex-direction:column}.full-height textarea[data-v-6f86564c]{flex:1;resize:none}@keyframes fadeIn-6f86564c{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.editor-section[data-v-5418ab68]{animation:fadeIn .3s ease}.section-title[data-v-5418ab68]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-5418ab68]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-5418ab68]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-5418ab68]:hover{background:rgba(139,92,246,.4)}.items-list[data-v-5418ab68]{display:flex;flex-direction:column;gap:1em}.event-item[data-v-5418ab68]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em}.event-header[data-v-5418ab68]{display:flex;gap:1em;margin-bottom:1em;align-items:center}.order-badge[data-v-5418ab68]{background:hsla(0,0%,100%,.1);padding:.2em .5em;border-radius:4px;font-size:.8em}.event-name[data-v-5418ab68]{flex:1;font-weight:bold;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:.5em;border-radius:.25em}.event-content[data-v-5418ab68]{width:100%;min-height:5em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);color:#e5e7eb;padding:.5em;border-radius:.25em;resize:vertical}.delete-btn[data-v-5418ab68]{padding:.5em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer}.delete-btn[data-v-5418ab68]:hover{background:rgba(239,68,68,.4)}.empty-hint[data-v-5418ab68]{padding:2em;text-align:center;color:hsla(0,0%,100%,.3);border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}
.editor-section[data-v-72d4ee51]{animation:fadeIn .3s ease}.section-title[data-v-72d4ee51]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-72d4ee51]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-72d4ee51]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-72d4ee51]:hover{background:rgba(139,92,246,.4)}.delete-btn[data-v-72d4ee51]{padding:.5em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer}.delete-btn[data-v-72d4ee51]:hover{background:rgba(239,68,68,.4)}.items-list[data-v-72d4ee51]{display:flex;flex-direction:column;gap:1em}.event-item[data-v-72d4ee51]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em}.event-header[data-v-72d4ee51]{display:flex;gap:1em;margin-bottom:1em;align-items:center}.event-name[data-v-72d4ee51]{flex:1;font-weight:bold;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:.5em;border-radius:.25em}.event-content[data-v-72d4ee51]{width:100%;min-height:5em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);color:#e5e7eb;padding:.5em;border-radius:.25em;resize:vertical}.event-config[data-v-72d4ee51]{margin-bottom:1em;padding:.75em;background:rgba(0,0,0,.2);border-radius:.25em;font-size:.85em}.config-hint[data-v-72d4ee51]{margin-top:.25em;color:hsla(0,0%,100%,.45);font-size:.85em}.config-row[data-v-72d4ee51]{display:flex;align-items:center;gap:.5em;margin-bottom:.5em}.conditions-box[data-v-72d4ee51]{background:rgba(0,0,0,.2);padding:.5em;border-radius:.25em;border:1px dashed hsla(0,0%,100%,.1)}.conditions-header[data-v-72d4ee51]{display:flex;justify-content:space-between;margin-bottom:.5em;color:#9ca3af}.condition-row[data-v-72d4ee51]{display:grid;grid-template-columns:2fr 1fr 2fr auto;gap:.5em;margin-bottom:.25em}input[data-v-72d4ee51],select[data-v-72d4ee51]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:.3em;border-radius:.25em}.add-mini-btn[data-v-72d4ee51],.remove-mini-btn[data-v-72d4ee51]{background:hsla(0,0%,100%,.1);color:#fff;border:none;border-radius:4px;cursor:pointer;width:1.5em;height:1.5em;display:inline-flex;justify-content:center;align-items:center}.remove-mini-btn[data-v-72d4ee51]{background:rgba(239,68,68,.2);color:#fca5a5}.empty-hint[data-v-72d4ee51]{padding:2em;text-align:center;color:hsla(0,0%,100%,.3);border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}
.editor-section[data-v-3368875e]{animation:fadeIn-3368875e .3s ease;height:100%;display:flex;flex-direction:column}.world-settings-grid[data-v-3368875e]{display:flex;flex-direction:column;gap:1.5em;flex:1;min-height:0}.world-panel[data-v-3368875e]{background:rgba(0,0,0,.2);border-radius:.5em;overflow:hidden;display:flex;flex-direction:column;border:1px solid hsla(0,0%,100%,.05);flex:1}.panel-header[data-v-3368875e]{display:flex;justify-content:space-between;align-items:center;padding:.75em 1em;border-bottom:1px solid hsla(0,0%,100%,.1);background:rgba(0,0,0,.2)}.panel-header h4[data-v-3368875e]{margin:0;font-size:.95em;display:flex;align-items:center;gap:.5em}.panel-header.special h4[data-v-3368875e]{color:#fbbf24}.panel-content[data-v-3368875e]{flex:1;padding:1em;overflow-y:auto}.world-items[data-v-3368875e]{display:flex;flex-direction:column;gap:.75em}.world-card[data-v-3368875e]{background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:.75em;display:flex;flex-direction:column;gap:.5em}.card-header[data-v-3368875e]{display:flex;align-items:center;gap:.5em}.card-title-input[data-v-3368875e]{flex:1;background:rgba(0,0,0,0);border:none;color:#fff;font-weight:bold;font-size:.95em;padding:.25em;border-bottom:1px solid rgba(0,0,0,0)}.card-title-input[data-v-3368875e]:focus{border-bottom-color:hsla(0,0%,100%,.3);outline:none}.card-content[data-v-3368875e]{width:100%;min-height:4em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:.25em;color:hsla(0,0%,100%,.8);font-size:.9em;padding:.5em;resize:vertical}.card-content[data-v-3368875e]:focus{border-color:hsla(0,0%,100%,.15);outline:none}.add-mini-btn[data-v-3368875e],.mini-delete[data-v-3368875e]{width:1.5em;height:1.5em;display:flex;align-items:center;justify-content:center;border:none;border-radius:.25em;cursor:pointer;transition:.2s}.add-mini-btn[data-v-3368875e]{background:hsla(0,0%,100%,.1);color:#fff}.add-mini-btn[data-v-3368875e]:hover{background:hsla(0,0%,100%,.2)}.mini-delete[data-v-3368875e]{background:rgba(0,0,0,0);color:hsla(0,0%,100%,.3)}.mini-delete[data-v-3368875e]:hover{color:#ef4444;background:rgba(239,68,68,.1)}.empty-panel[data-v-3368875e]{text-align:center;color:hsla(0,0%,100%,.3);padding:2em;font-style:italic}@keyframes fadeIn-3368875e{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.editor-section[data-v-e982b446]{animation:fadeIn .3s ease;height:100%;overflow-y:auto}.section-title[data-v-e982b446]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-e982b446]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.description-text[data-v-e982b446]{font-size:.85em;color:#94a3b8;margin-bottom:1rem}.add-btn[data-v-e982b446]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-e982b446]:hover{background:rgba(139,92,246,.4)}.items-list[data-v-e982b446]{display:flex;flex-direction:column;gap:1em;padding-bottom:2em}.event-item[data-v-e982b446]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em;display:flex;flex-direction:column;gap:1em}.event-header[data-v-e982b446]{display:flex;align-items:center;gap:.8em}.event-header .order-badge[data-v-e982b446]{background:hsla(0,0%,100%,.1);padding:.2em .5em;border-radius:4px;font-size:.8em;color:#94a3b8}.event-header .event-name[data-v-e982b446]{background:rgba(0,0,0,0);border:none;color:#fff;font-size:1em;font-weight:bold;flex:1;border-bottom:1px dashed hsla(0,0%,100%,.2);padding:.2em}.event-header .event-name[data-v-e982b446]:focus{outline:none;border-bottom-color:#a78bfa}.event-header .delete-btn[data-v-e982b446]{background:none;border:none;color:#64748b;cursor:pointer;opacity:.5;transition:all .2s}.event-header .delete-btn[data-v-e982b446]:hover{opacity:1;color:#ef4444}.event-config[data-v-e982b446]{display:grid;grid-template-columns:1fr 1fr;gap:1em;background:rgba(0,0,0,.2);padding:.8em;border-radius:4px}.config-row[data-v-e982b446]{display:flex;align-items:center;gap:.8em}.config-row label[data-v-e982b446]{min-width:5em;color:#94a3b8;font-size:.9em}.config-row .input-text[data-v-e982b446]{flex:1;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:4px;color:#fff;padding:.4em .6em;font-size:.9em}.config-row .input-text[data-v-e982b446]:focus{border-color:#a78bfa;outline:none}.event-content[data-v-e982b446]{width:100%;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:4px;padding:1em;color:#e2e8f0;font-family:inherit;font-size:.95em;line-height:1.6;resize:vertical;min-height:100px}.event-content[data-v-e982b446]:focus{border-color:#a78bfa;outline:none;background:rgba(0,0,0,.3)}.event-content[data-v-e982b446]::placeholder{color:hsla(0,0%,100%,.2)}.empty-hint[data-v-e982b446]{text-align:center;color:hsla(0,0%,100%,.3);padding:3em;border:2px dashed hsla(0,0%,100%,.1);border-radius:1em}
.user-widgets-editor[data-v-6f352719]{animation:fadeIn-6f352719 .3s ease}.section-title[data-v-6f352719]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-6f352719]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-6f352719]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-6f352719]:hover{background:rgba(139,92,246,.4)}.security-notice[data-v-6f352719]{display:flex;gap:.75em;padding:1em;background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.3);border-radius:.5em;margin-bottom:1em;color:#fbbf24}.security-notice .notice-content[data-v-6f352719]{flex:1}.security-notice .notice-content strong[data-v-6f352719]{display:block;margin-bottom:.25em}.security-notice .notice-content p[data-v-6f352719]{margin:0;font-size:.85em;opacity:.9;line-height:1.5}.security-notice .notice-content code[data-v-6f352719]{background:rgba(0,0,0,.3);padding:.1em .3em;border-radius:.25em;font-size:.9em}.preview-vars[data-v-6f352719]{margin-bottom:1em;padding:1em;background:rgba(0,0,0,.18);border:1px solid hsla(0,0%,100%,.06);border-radius:.75em}.preview-vars-header[data-v-6f352719]{display:flex;align-items:center;justify-content:space-between;gap:1em;margin-bottom:.5em}.preview-vars-title[data-v-6f352719]{color:hsla(0,0%,100%,.85);font-size:.95em}.preview-vars-actions[data-v-6f352719]{display:flex;gap:.5em}.preview-vars-btn[data-v-6f352719]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.16);color:hsla(0,0%,100%,.75);font-size:.8em;padding:.4em .75em;border-radius:.5em;cursor:pointer;transition:all .2s}.preview-vars-btn[data-v-6f352719]:hover{border-color:hsla(0,0%,100%,.3);color:hsla(0,0%,100%,.95)}.preview-vars-btn.primary[data-v-6f352719]{border-color:rgba(139,92,246,.45);color:rgba(196,181,253,.95)}.preview-vars-hint[data-v-6f352719]{color:hsla(0,0%,100%,.55);font-size:.8em;line-height:1.5;margin-bottom:.5em}.preview-vars-hint code[data-v-6f352719]{background:rgba(0,0,0,.3);padding:.1em .3em;border-radius:.25em}.preview-vars-error[data-v-6f352719]{color:#f87171;font-size:.85em;margin-bottom:.5em;white-space:pre-wrap}.preview-vars-editor[data-v-6f352719]{width:100%;min-height:140px;resize:vertical;background:rgba(0,0,0,.35);color:hsla(0,0%,100%,.9);border:1px solid hsla(0,0%,100%,.12);border-radius:.5em;padding:.75em;font-family:"Fira Code",monospace;font-size:.8em;line-height:1.35;box-sizing:border-box}.preview-vars-editor[data-v-6f352719]:focus{outline:none;border-color:rgba(139,92,246,.5)}.widgets-list[data-v-6f352719]{display:flex;flex-direction:column;gap:1em}.widget-card[data-v-6f352719]{background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;overflow:hidden}.widget-card.expanded[data-v-6f352719]{border-color:rgba(139,92,246,.3)}.widget-header[data-v-6f352719]{display:flex;align-items:center;justify-content:space-between;padding:.75em 1em;background:rgba(0,0,0,.2);cursor:pointer}.widget-header[data-v-6f352719]:hover{background:rgba(0,0,0,.3)}.widget-header .header-left[data-v-6f352719]{display:flex;align-items:center;gap:.75em}.widget-header .header-right[data-v-6f352719]{display:flex;align-items:center;gap:.5em}.widget-header .widget-name[data-v-6f352719]{background:rgba(0,0,0,0);border:none;color:#fff;font-size:1em;padding:.25em .5em;border-radius:.25em}.widget-header .widget-name[data-v-6f352719]:hover,.widget-header .widget-name[data-v-6f352719]:focus{background:hsla(0,0%,100%,.1)}.widget-header .position-badge[data-v-6f352719]{font-size:.75em;padding:.2em .5em;background:rgba(139,92,246,.2);border-radius:.25em;color:#c4b5fd}.widget-header button[data-v-6f352719]{padding:.4em;background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.5);cursor:pointer;border-radius:.25em}.widget-header button[data-v-6f352719]:hover{background:hsla(0,0%,100%,.1);color:#fff}.widget-header button.delete-btn[data-v-6f352719]:hover{color:#f87171}.widget-header button.preview-btn[data-v-6f352719]:hover{color:#34d399}.widget-body[data-v-6f352719]{padding:1em;display:flex;flex-direction:column;gap:1em}.form-row[data-v-6f352719]{display:flex;gap:1em;flex-wrap:wrap}.form-group[data-v-6f352719]{display:flex;flex-direction:column;gap:.25em}.form-group label[data-v-6f352719]{font-size:.85em;color:hsla(0,0%,100%,.6)}.form-group.checkbox-group[data-v-6f352719]{flex-direction:row;align-items:center;gap:.5em}.form-group.checkbox-group label[data-v-6f352719]{display:flex;align-items:center;gap:.5em;cursor:pointer}.form-group.checkbox-group .hint[data-v-6f352719]{font-size:.75em;color:#fbbf24}.form-input[data-v-6f352719],.form-select[data-v-6f352719]{padding:.5em .75em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;color:#fff;font-size:.9em}.form-input[data-v-6f352719]:focus,.form-select[data-v-6f352719]:focus{outline:none;border-color:rgba(139,92,246,.5)}.code-section .code-header[data-v-6f352719]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5em}.code-section .code-header label[data-v-6f352719]{font-size:.85em;color:hsla(0,0%,100%,.6)}.code-section .template-btn[data-v-6f352719]{padding:.3em .6em;background:rgba(96,165,250,.2);border:1px solid rgba(96,165,250,.3);border-radius:.25em;color:#93c5fd;font-size:.75em;cursor:pointer;display:flex;align-items:center;gap:.3em}.code-section .template-btn[data-v-6f352719]:hover{background:rgba(96,165,250,.3)}.code-editor[data-v-6f352719]{width:100%;min-height:200px;padding:.75em;background:rgba(0,0,0,.4);border:1px solid hsla(0,0%,100%,.05);border-radius:.25em;color:#a5f3fc;font-family:"Fira Code","Consolas",monospace;font-size:.85em;line-height:1.5;resize:vertical}.code-editor[data-v-6f352719]:focus{outline:none;border-color:rgba(139,92,246,.3)}.code-editor.css-editor[data-v-6f352719]{min-height:120px;color:#fbbf24}.code-hint[data-v-6f352719]{font-size:.75em;color:hsla(0,0%,100%,.4);margin-top:.25em}.code-hint code[data-v-6f352719]{background:rgba(0,0,0,.3);padding:.1em .3em;border-radius:.2em}.linked-vars-section label[data-v-6f352719]{display:block;font-size:.85em;color:hsla(0,0%,100%,.6);margin-bottom:.5em}.linked-vars-section .vars-container[data-v-6f352719]{display:flex;flex-wrap:wrap;gap:.5em;padding:.5em;background:rgba(0,0,0,.2);border-radius:.25em;min-height:40px}.linked-vars-section .var-tag[data-v-6f352719]{display:flex;align-items:center;gap:.25em;padding:.25em .5em;background:rgba(139,92,246,.2);border-radius:.25em;font-size:.85em;color:#c4b5fd}.linked-vars-section .var-tag button[data-v-6f352719]{background:none;border:none;color:inherit;cursor:pointer;opacity:.6;font-size:1em;padding:0;line-height:1}.linked-vars-section .var-tag button[data-v-6f352719]:hover{opacity:1}.linked-vars-section .var-input[data-v-6f352719]{flex:1;min-width:150px;background:rgba(0,0,0,0);border:none;color:#fff;font-size:.85em}.linked-vars-section .var-input[data-v-6f352719]:focus{outline:none}.linked-vars-section .var-input[data-v-6f352719]::placeholder{color:hsla(0,0%,100%,.3)}.validation-result[data-v-6f352719]{padding:.75em;border-radius:.25em}.validation-result .validation-success[data-v-6f352719]{display:flex;align-items:center;gap:.5em;color:#34d399}.validation-result .validation-success .warning-count[data-v-6f352719]{font-size:.85em;color:#fbbf24}.validation-result .validation-error[data-v-6f352719]{color:#f87171}.validation-result .validation-error ul[data-v-6f352719]{margin:.5em 0 0 1.5em;padding:0;font-size:.85em}.validation-result .validation-warnings[data-v-6f352719]{margin-top:.5em;color:#fbbf24}.validation-result .validation-warnings ul[data-v-6f352719]{margin:0;padding:0 0 0 1.5em;font-size:.85em}.widget-actions[data-v-6f352719]{display:flex;gap:.75em;padding-top:.5em;border-top:1px solid hsla(0,0%,100%,.05)}.widget-actions button[data-v-6f352719]{padding:.5em 1em;border-radius:.25em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.85em}.widget-actions .validate-btn[data-v-6f352719]{background:rgba(251,191,36,.2);border:1px solid rgba(251,191,36,.3);color:#fbbf24}.widget-actions .validate-btn[data-v-6f352719]:hover{background:rgba(251,191,36,.3)}.widget-actions .preview-btn[data-v-6f352719]{background:rgba(52,211,153,.2);border:1px solid rgba(52,211,153,.3);color:#34d399}.widget-actions .preview-btn[data-v-6f352719]:hover{background:rgba(52,211,153,.3)}.empty-hint[data-v-6f352719]{display:flex;flex-direction:column;align-items:center;gap:1em;padding:3em;color:hsla(0,0%,100%,.3);text-align:center;border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}.empty-hint p[data-v-6f352719]{margin:0}.empty-hint .add-first-btn[data-v-6f352719]{padding:.75em 1.5em;background:rgba(139,92,246,.2);border:1px solid rgba(139,92,246,.4);border-radius:.5em;color:#c4b5fd;cursor:pointer}.empty-hint .add-first-btn[data-v-6f352719]:hover{background:rgba(139,92,246,.3)}.preview-modal[data-v-6f352719]{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000;padding:2em}.preview-container[data-v-6f352719]{width:100%;max-width:600px;max-height:80vh;background:#1e1b2e;border-radius:.75em;border:1px solid rgba(139,92,246,.3);overflow:hidden;display:flex;flex-direction:column}.preview-header[data-v-6f352719]{display:flex;justify-content:space-between;align-items:center;padding:1em;background:rgba(0,0,0,.3);border-bottom:1px solid hsla(0,0%,100%,.05)}.preview-header h3[data-v-6f352719]{margin:0;font-size:1em;color:#c4b5fd}.preview-header .close-btn[data-v-6f352719]{background:none;border:none;color:hsla(0,0%,100%,.5);font-size:1.5em;cursor:pointer;line-height:1}.preview-header .close-btn[data-v-6f352719]:hover{color:#fff}.preview-body[data-v-6f352719]{flex:1;padding:1em;overflow-y:auto;min-height:200px}.preview-console[data-v-6f352719]{border-top:1px solid hsla(0,0%,100%,.05)}.preview-console .console-header[data-v-6f352719]{padding:.5em 1em;background:rgba(0,0,0,.3);font-size:.85em;color:hsla(0,0%,100%,.5)}.preview-console .console-logs[data-v-6f352719]{max-height:150px;overflow-y:auto;padding:.5em 1em;font-family:"Fira Code",monospace;font-size:.8em}.preview-console .log-entry[data-v-6f352719]{padding:.25em 0}.preview-console .log-entry.info[data-v-6f352719]{color:#93c5fd}.preview-console .log-entry.success[data-v-6f352719]{color:#34d399}.preview-console .log-entry.warning[data-v-6f352719]{color:#fbbf24}.preview-console .log-entry.error[data-v-6f352719]{color:#f87171}.preview-console .no-logs[data-v-6f352719]{color:hsla(0,0%,100%,.3);font-style:italic}@keyframes fadeIn-6f352719{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.variable-node[data-v-f020a9ba]{--indent:calc(var(--depth,0) * 1.5em)}.node-row[data-v-f020a9ba]{display:flex;align-items:center;gap:.5em;padding:.4em .5em;padding-left:calc(var(--indent) + .5em);border-radius:.25em;transition:background .15s}.node-row[data-v-f020a9ba]:hover{background:hsla(0,0%,100%,.05)}.node-row:hover .node-actions[data-v-f020a9ba]{opacity:1}.toggle-btn[data-v-f020a9ba]{padding:.2em;background:rgba(0,0,0,0);border:none;color:#9ca3af;cursor:pointer;display:flex;align-items:center;justify-content:center}.toggle-btn[data-v-f020a9ba]:hover{color:#fff}.toggle-placeholder[data-v-f020a9ba]{width:1.2em}.key-name[data-v-f020a9ba]{color:#e0e7ff;font-family:"Fira Code",monospace;font-size:.9em}.dynamic-badge[data-v-f020a9ba]{color:#fbbf24;font-family:"Fira Code",monospace;font-size:.9em;font-weight:bold}.type-badge[data-v-f020a9ba]{padding:.15em .4em;border-radius:.2em;font-size:.7em;font-weight:bold;margin-left:.25em}.type-badge.string[data-v-f020a9ba]{background:rgba(96,165,250,.2);color:#60a5fa}.type-badge.int[data-v-f020a9ba]{background:rgba(52,211,153,.2);color:#34d399}.type-badge.boolean[data-v-f020a9ba]{background:rgba(251,191,36,.2);color:#fbbf24}.type-badge.stringlist[data-v-f020a9ba]{background:rgba(244,114,182,.2);color:#f472b6}.comment[data-v-f020a9ba]{color:#6b7280;font-size:.8em;font-style:italic;margin-left:auto;padding-right:1em}.node-actions[data-v-f020a9ba]{display:flex;gap:.25em;opacity:0;transition:opacity .15s;margin-left:auto}.action-btn[data-v-f020a9ba]{padding:.25em;background:rgba(0,0,0,0);border:none;color:#6b7280;cursor:pointer;border-radius:.2em;display:flex;align-items:center;justify-content:center}.action-btn[data-v-f020a9ba]:hover{background:hsla(0,0%,100%,.1)}.action-btn.edit[data-v-f020a9ba]:hover{color:#60a5fa}.action-btn.add[data-v-f020a9ba]:hover{color:#34d399}.action-btn.delete[data-v-f020a9ba]:hover{color:#f87171}.node-children[data-v-f020a9ba]{border-left:1px dashed hsla(0,0%,100%,.1);margin-left:calc(var(--indent) + .75em)}.edit-overlay[data-v-f020a9ba]{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:1000}.edit-modal[data-v-f020a9ba]{background:#1f2937;border:1px solid hsla(0,0%,100%,.1);border-radius:.75em;padding:1.5em;width:90%;max-width:400px}.edit-modal h4[data-v-f020a9ba]{margin:0 0 1em;color:#c4b5fd;font-size:1.1em}.edit-field[data-v-f020a9ba]{margin-bottom:1em}.edit-field label[data-v-f020a9ba]{display:block;font-size:.85em;color:#9ca3af;margin-bottom:.25em}.edit-field input[type=text][data-v-f020a9ba],.edit-field select[data-v-f020a9ba]{width:100%;padding:.5em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;color:#fff;font-size:.9em}.edit-field input[type=text][data-v-f020a9ba]:focus,.edit-field select[data-v-f020a9ba]:focus{outline:none;border-color:#8b5cf6}.edit-field.checkbox-field label[data-v-f020a9ba]{display:flex;align-items:center;gap:.5em;cursor:pointer}.edit-field.checkbox-field label input[type=checkbox][data-v-f020a9ba]{width:auto}.edit-field.checkbox-field label input[type=checkbox][data-v-f020a9ba]:disabled{opacity:.5;cursor:not-allowed}.edit-field.checkbox-field .hint[data-v-f020a9ba]{display:block;font-size:.75em;color:#fbbf24;margin-top:.25em}.edit-field.checkbox-field .hint.warning[data-v-f020a9ba]{color:#f87171}.edit-actions[data-v-f020a9ba]{display:flex;justify-content:flex-end;gap:.5em;margin-top:1.5em}.edit-actions button[data-v-f020a9ba]{padding:.5em 1em;border-radius:.25em;font-size:.9em;cursor:pointer}.edit-actions .cancel-btn[data-v-f020a9ba]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);color:#9ca3af}.edit-actions .cancel-btn[data-v-f020a9ba]:hover{background:hsla(0,0%,100%,.05)}.edit-actions .save-btn[data-v-f020a9ba]{background:#8b5cf6;border:none;color:#fff}.edit-actions .save-btn[data-v-f020a9ba]:hover{background:#7c3aed}
.variables-editor[data-v-3c13ed4d]{animation:fadeIn-3c13ed4d .3s ease}.section-title[data-v-3c13ed4d]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-3c13ed4d]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-3c13ed4d]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-3c13ed4d]:hover{background:rgba(139,92,246,.4)}.info-hint[data-v-3c13ed4d]{display:flex;align-items:flex-start;gap:.5em;padding:.75em 1em;background:rgba(96,165,250,.1);border:1px solid rgba(96,165,250,.2);border-radius:.5em;margin-bottom:1em;font-size:.85em;color:#93c5fd}.info-hint strong[data-v-3c13ed4d]{color:#fbbf24}.variable-tree[data-v-3c13ed4d]{background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em;margin-bottom:1em}.empty-hint[data-v-3c13ed4d]{padding:2em;text-align:center;color:hsla(0,0%,100%,.3);border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em;margin-bottom:1em}.schema-preview[data-v-3c13ed4d]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;overflow:hidden}.schema-preview .preview-header[data-v-3c13ed4d]{display:flex;justify-content:space-between;align-items:center;padding:.5em 1em;background:rgba(0,0,0,.2)}.schema-preview .preview-header h5[data-v-3c13ed4d]{margin:0;font-size:.85em;color:#9ca3af}.schema-preview .copy-btn[data-v-3c13ed4d]{padding:.25em .5em;background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;color:#9ca3af;font-size:.75em;cursor:pointer;display:flex;align-items:center;gap:.25em}.schema-preview .copy-btn[data-v-3c13ed4d]:hover{background:hsla(0,0%,100%,.1);color:#fff}.schema-preview .error-message[data-v-3c13ed4d]{padding:1em;color:#f87171;background:rgba(127,29,29,.2);border-bottom:1px solid hsla(0,0%,100%,.05);white-space:pre-wrap;font-size:.85em}.schema-preview .schema-code[data-v-3c13ed4d]{margin:0;padding:1em;font-family:"Fira Code","Consolas",monospace;font-size:.8em;color:#a5f3fc;white-space:pre-wrap;word-break:break-all;max-height:300px;overflow-y:auto}@keyframes fadeIn-3c13ed4d{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.editor-section[data-v-68057b9f]{animation:fadeIn .3s ease}.section-title[data-v-68057b9f]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1em;padding-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.1)}.section-title h4[data-v-68057b9f]{color:#c4b5fd;font-size:1.1em;font-weight:bold;margin:0}.add-btn[data-v-68057b9f]{padding:.5em 1em;background:rgba(139,92,246,.2);color:#c4b5fd;border:1px solid rgba(139,92,246,.4);border-radius:99em;cursor:pointer;display:flex;align-items:center;gap:.5em;font-size:.75em}.add-btn[data-v-68057b9f]:hover{background:rgba(139,92,246,.4)}.visual-grid[data-v-68057b9f]{display:grid;grid-template-columns:repeat(auto-fill,minmax(16em,1fr));gap:1.5em}.char-image-item[data-v-68057b9f],.bg-image-item[data-v-68057b9f]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:1em;display:flex;flex-direction:column;gap:.75em;transition:all .3s}.char-image-item[data-v-68057b9f]:hover,.bg-image-item[data-v-68057b9f]:hover{background:hsla(0,0%,100%,.06);border-color:hsla(0,0%,100%,.1)}.image-preview[data-v-68057b9f]{aspect-ratio:16/9;background:#000;border-radius:.25em;overflow:hidden;cursor:pointer;position:relative;border:1px dashed hsla(0,0%,100%,.2)}.image-preview img[data-v-68057b9f]{width:100%;height:100%;object-fit:cover;transition:transform .3s}.image-preview:hover img[data-v-68057b9f]{transform:scale(1.05)}.image-preview .no-image[data-v-68057b9f]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:hsla(0,0%,100%,.2);gap:.5em;transition:color .3s}.image-preview .no-image span[data-v-68057b9f]{font-size:.8em}.image-preview:hover .no-image[data-v-68057b9f]{color:hsla(0,0%,100%,.5)}.image-preview.char-preview[data-v-68057b9f]{aspect-ratio:9/16}.image-preview.bg-preview[data-v-68057b9f]{aspect-ratio:16/9}.diff-row[data-v-68057b9f]{display:grid;grid-template-columns:1fr 1fr;gap:.5em}.fallback-row[data-v-68057b9f]{display:flex;align-items:center;justify-content:space-between;gap:.75em}.fallback-check[data-v-68057b9f]{display:flex;align-items:center;gap:.5em;font-size:.8em;color:hsla(0,0%,100%,.75)}.pretty-check[data-v-68057b9f]{position:relative;cursor:pointer;-webkit-user-select:none;user-select:none}.pretty-check input[data-v-68057b9f]{position:absolute;opacity:0;pointer-events:none}.pretty-check .check-ui[data-v-68057b9f]{width:1.15em;height:1.15em;border-radius:.3em;background:rgba(0,0,0,.25);border:1px solid hsla(0,0%,100%,.18);display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;transition:.15s ease;box-shadow:0 0 0 0 rgba(139,92,246,0)}.pretty-check .check-ui[data-v-68057b9f]::after{content:"";width:.55em;height:.35em;border-left:2px solid rgba(0,0,0,0);border-bottom:2px solid rgba(0,0,0,0);transform:translateY(-0.05em) rotate(-45deg);opacity:0;transition:.15s ease}.pretty-check:hover .check-ui[data-v-68057b9f]{border-color:rgba(139,92,246,.55);background:rgba(139,92,246,.08)}.pretty-check input:focus-visible+.check-ui[data-v-68057b9f]{box-shadow:0 0 0 2px rgba(139,92,246,.35);border-color:rgba(139,92,246,.7)}.pretty-check input:checked+.check-ui[data-v-68057b9f]{background:rgba(139,92,246,.25);border-color:rgba(139,92,246,.75)}.pretty-check input:checked+.check-ui[data-v-68057b9f]::after{border-left-color:#c4b5fd;border-bottom-color:#c4b5fd;opacity:1}.image-meta[data-v-68057b9f]{display:flex;flex-direction:column;gap:.5em}.image-meta input[data-v-68057b9f]{width:100%;padding:.5em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;color:#fff;font-size:.85em}.image-meta input[data-v-68057b9f]:focus{border-color:#8b5cf6;outline:none}.url-input-group[data-v-68057b9f]{display:flex;gap:.5em}.url-input-group input[data-v-68057b9f]{flex:1}.hint-badge[data-v-68057b9f]{font-size:.75em;color:hsla(0,0%,100%,.5);display:flex;align-items:center;gap:.5em;padding:0 .25em;margin-top:-0.25em}.icon-btn[data-v-68057b9f]{padding:.5em;background:hsla(0,0%,100%,.1);border:none;border-radius:.25em;color:#c4b5fd;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.icon-btn[data-v-68057b9f]:hover{background:rgba(139,92,246,.3)}.delete-btn[data-v-68057b9f]{padding:.5em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer;font-size:.75em;text-align:center}.delete-btn.full[data-v-68057b9f]{width:100%;margin-top:.2em}.delete-btn[data-v-68057b9f]:hover{background:rgba(239,68,68,.4)}.empty-hint[data-v-68057b9f]{padding:2em;text-align:center;color:hsla(0,0%,100%,.3);border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}
.editor-section[data-v-0660add8]{animation:fadeIn .3s ease;height:100%;display:flex;flex-direction:column}.world-settings-grid[data-v-0660add8]{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr;gap:1.5em;flex:1;min-height:0}.world-panel[data-v-0660add8]{background:rgba(0,0,0,.2);border-radius:.5em;overflow:hidden;display:flex;flex-direction:column;border:1px solid hsla(0,0%,100%,.05)}.panel-header[data-v-0660add8]{display:flex;justify-content:space-between;align-items:center;padding:.75em 1em;border-bottom:1px solid hsla(0,0%,100%,.1);background:rgba(0,0,0,.2)}.panel-header h4[data-v-0660add8]{margin:0;font-size:.95em;display:flex;align-items:center;gap:.5em}.panel-header.worldview h4[data-v-0660add8]{color:#60a5fa}.panel-header.power h4[data-v-0660add8]{color:#f472b6}.panel-header.special h4[data-v-0660add8]{color:#fbbf24}.panel-content[data-v-0660add8]{flex:1;padding:1em;overflow-y:auto}.world-items[data-v-0660add8]{display:flex;flex-direction:column;gap:.75em}.world-card[data-v-0660add8]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;padding:.75em}.card-header[data-v-0660add8]{display:flex;gap:.5em;margin-bottom:.5em}.card-title-input[data-v-0660add8]{flex:1;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#fff;padding:.4em;border-radius:.25em;font-weight:bold}.card-content[data-v-0660add8]{width:100%;min-height:6em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);color:#e5e7eb;padding:.5em;border-radius:.25em;resize:vertical}.empty-panel[data-v-0660add8]{text-align:center;color:hsla(0,0%,100%,.3);padding:2em;border:2px dashed hsla(0,0%,100%,.1);border-radius:.5em}.add-mini-btn[data-v-0660add8]{background:hsla(0,0%,100%,.1);color:#fff;border:none;width:1.8em;height:1.8em;border-radius:.25em;cursor:pointer}.add-mini-btn[data-v-0660add8]:hover{background:hsla(0,0%,100%,.2)}.mini-delete[data-v-0660add8]{width:1.8em;height:1.8em;background:rgba(239,68,68,.2);color:#fca5a5;border:none;border-radius:.25em;cursor:pointer}.mini-delete[data-v-0660add8]:hover{background:rgba(239,68,68,.4)}
.event-pack-editor[data-v-068bcd7f]{display:flex;height:100%;gap:1em;font-size:.9em;overflow:hidden}.editor-sidebar[data-v-068bcd7f]{width:16em;background:rgba(0,0,0,.3);border-right:1px solid hsla(0,0%,100%,.1);padding:1em;display:flex;flex-direction:column;gap:1.5em;overflow-y:auto;flex-shrink:0}.sidebar-group h3[data-v-068bcd7f]{font-size:.75em;color:hsla(0,0%,100%,.4);text-transform:uppercase;letter-spacing:.1em;margin-bottom:.5em;padding-left:.5em}.sidebar-group button[data-v-068bcd7f]{width:100%;display:flex;align-items:center;gap:.75em;padding:.75em;margin-bottom:.25em;background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.7);border-radius:.5em;cursor:pointer;transition:.2s;text-align:left}.sidebar-group button[data-v-068bcd7f]:hover{background:hsla(0,0%,100%,.05);color:#fff}.sidebar-group button.active[data-v-068bcd7f]{background:rgba(139,92,246,.25);color:#c4b5fd}.count-badge[data-v-068bcd7f]{margin-left:auto;background:rgba(0,0,0,.3);padding:.1em .4em;border-radius:99em;font-size:.8em}.editor-main[data-v-068bcd7f]{flex:1;overflow-y:auto;padding-right:.5em;display:flex;flex-direction:column}
.visual-preview[data-v-651a8ef6]{position:relative;width:100%;height:100%;overflow:hidden;background:#0a0a0f;border-radius:.5em}.background-layer[data-v-651a8ef6]{position:absolute;inset:0;z-index:0}.background-layer .bg-image[data-v-651a8ef6]{width:100%;height:100%;object-fit:cover}.background-layer .bg-gradient[data-v-651a8ef6]{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.8) 0%,rgba(0,0,0,0.3) 30%,transparent 60%)}.character-layer[data-v-651a8ef6]{position:absolute;inset:0;z-index:10;pointer-events:none}.character-layer .char-img[data-v-651a8ef6]{position:absolute;height:80%;width:auto;object-fit:contain;filter:drop-shadow(0 0 20px rgba(0,0,0,0.5))}.hud-layer[data-v-651a8ef6]{position:absolute;top:1em;left:1em;z-index:20}.location-pill[data-v-651a8ef6]{display:flex;align-items:center;gap:.5em;padding:.5em .75em;background:rgba(0,0,0,.6);backdrop-filter:blur(8px);border-radius:9999px;border:1px solid hsla(0,0%,100%,.1);color:#fff}.location-text[data-v-651a8ef6]{display:flex;flex-direction:column;line-height:1.2}.location-text .location-name[data-v-651a8ef6]{font-size:.75em;font-weight:bold;letter-spacing:.1em}.location-text .location-time[data-v-651a8ef6]{font-size:.5em;color:hsla(0,0%,100%,.6)}.dialogue-wrapper[data-v-651a8ef6]{position:absolute;bottom:0;left:0;right:0;z-index:30;padding:1em}.dialogue-box[data-v-651a8ef6]{background:linear-gradient(135deg,rgba(20,20,35,0.95) 0%,rgba(30,30,50,0.9) 100%);backdrop-filter:blur(12px);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;padding:1em;box-shadow:0 -5px 30px rgba(0,0,0,.3)}.speaker-name[data-v-651a8ef6]{font-size:.75em;font-weight:bold;color:#67e8f9;margin-bottom:.5em;padding-bottom:.25em;border-bottom:1px solid rgba(103,232,249,.3)}.dialogue-content p[data-v-651a8ef6]{font-size:.875em;color:hsla(0,0%,100%,.9);line-height:1.6;margin:0}.preview-info[data-v-651a8ef6]{position:absolute;top:1em;right:1em;z-index:40;display:flex;flex-direction:column;gap:.25em;align-items:flex-end}.info-badge[data-v-651a8ef6]{display:flex;align-items:center;gap:.25em;padding:.25em .5em;background:rgba(139,92,246,.8);backdrop-filter:blur(4px);border-radius:.25em;font-size:.625em;color:#fff}.info-badge .diff-name[data-v-651a8ef6]{opacity:.7}.fade-enter-active[data-v-651a8ef6],.fade-leave-active[data-v-651a8ef6]{transition:opacity .3s ease}.fade-enter-from[data-v-651a8ef6],.fade-leave-to[data-v-651a8ef6]{opacity:0}
.workshop-view[data-v-4dcced44]{position:relative;width:100%;height:100%;padding:1.5em;display:flex;flex-direction:column;z-index:20;overflow:hidden;font-size:.85vw}.hidden-file-input[data-v-4dcced44]{display:none}.editor-backdrop[data-v-4dcced44]{position:absolute;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:0}.workshop-header[data-v-4dcced44]{position:relative;z-index:10;display:flex;align-items:center;gap:1em;margin-bottom:1em}.back-btn[data-v-4dcced44]{padding:.5em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.05);color:hsla(0,0%,100%,.7);cursor:pointer;transition:all .3s}.back-btn[data-v-4dcced44]:hover{background:hsla(0,0%,100%,.1)}.title-group[data-v-4dcced44]{display:flex;align-items:center;gap:.5em}.title-group .title-icon[data-v-4dcced44]{color:#a78bfa}.title-group h1[data-v-4dcced44]{font-size:1.25em;font-weight:bold;letter-spacing:.2em;color:#fff}.editor-badge[data-v-4dcced44]{font-size:.75em;padding:.25em .5em;border-radius:.25em;background:rgba(139,92,246,.5);border:1px solid rgba(167,139,250,.3);color:#c4b5fd}.main-panel[data-v-4dcced44]{position:relative;z-index:10;flex:1;padding:1.5em;overflow:hidden}.intro-overlay[data-v-4dcced44]{position:fixed;inset:0;z-index:4000;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;padding:2em}.intro-panel[data-v-4dcced44]{width:min(720px,92vw);max-height:80vh;overflow:auto;background:rgba(20,25,35,.95);border:1px solid hsla(0,0%,100%,.12);border-radius:12px;box-shadow:0 25px 60px rgba(0,0,0,.7);padding:1.25em 1.25em 1em}.intro-header[data-v-4dcced44]{display:flex;justify-content:space-between;align-items:center;gap:1em;margin-bottom:.25em}.intro-title[data-v-4dcced44]{font-size:1.1em;font-weight:700;color:#fff}.intro-close[data-v-4dcced44]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.15);color:hsla(0,0%,100%,.7);border-radius:8px;padding:.25em .6em;cursor:pointer}.intro-close[data-v-4dcced44]:hover{color:#fff;border-color:hsla(0,0%,100%,.3)}.intro-sub[data-v-4dcced44]{color:hsla(0,0%,100%,.65);font-size:.9em;margin-bottom:1em}.intro-content[data-v-4dcced44]{white-space:pre-wrap;line-height:1.6;color:hsla(0,0%,100%,.85);font-size:.95em}.gallery-view[data-v-4dcced44]{display:flex;flex-direction:column;height:100%}.gallery-header[data-v-4dcced44]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5em;flex-wrap:wrap;gap:1em}.header-left[data-v-4dcced44]{display:flex;align-items:center;gap:1em;flex:1;min-width:0;flex-wrap:wrap}.search-box[data-v-4dcced44]{position:relative;flex:1;min-width:0;max-width:20em}.search-box .search-icon[data-v-4dcced44]{position:absolute;left:.75em;top:50%;transform:translateY(-50%);color:hsla(0,0%,100%,.4)}.search-box input[data-v-4dcced44]{background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:9999px;padding:.5em 1em .5em 2.5em;font-size:.875em;color:#fff;width:100%;outline:none;transition:border-color .3s}.search-box input[data-v-4dcced44]:focus{border-color:#8b5cf6}.search-box input[data-v-4dcced44]::placeholder{color:hsla(0,0%,100%,.3)}.filter-tabs[data-v-4dcced44]{display:flex;gap:.25em;background:rgba(0,0,0,.2);padding:.25em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.05)}.filter-tabs button[data-v-4dcced44]{padding:.375em 1em;border-radius:9999px;font-size:.75em;font-weight:bold;border:none;background:rgba(0,0,0,0);color:hsla(0,0%,100%,.5);cursor:pointer;transition:all .3s}.filter-tabs button[data-v-4dcced44]:hover{color:#fff}.filter-tabs button.active[data-v-4dcced44]{background:#fff;color:#000}.header-right[data-v-4dcced44]{display:flex;align-items:center;gap:.5em;flex-wrap:wrap}.my-works-toolbar[data-v-4dcced44]{display:flex;justify-content:flex-end;margin:-0.5em 0 1em}.my-works-btn[data-v-4dcced44],.downloaded-btn[data-v-4dcced44]{display:flex;align-items:center;gap:.5em;padding:.5em 1em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.1);background:rgba(0,0,0,0);font-size:.875em;color:hsla(0,0%,100%,.7);cursor:pointer;transition:all .3s}.my-works-btn[data-v-4dcced44]:hover,.downloaded-btn[data-v-4dcced44]:hover{background:hsla(0,0%,100%,.05)}.my-works-btn.active[data-v-4dcced44],.downloaded-btn.active[data-v-4dcced44]{background:#7c3aed;border-color:#8b5cf6;color:#fff}.downloaded-btn.active[data-v-4dcced44]{background:#0891b2;border-color:#06b6d4}.upload-dropdown[data-v-4dcced44]{position:relative}.upload-btn[data-v-4dcced44]{display:flex;align-items:center;gap:.5em;padding:.5em 1.5em;border-radius:9999px;border:none;background:#fff;color:#000;font-weight:bold;cursor:pointer;box-shadow:0 0 20px hsla(0,0%,100%,.2);transition:all .3s}.upload-btn[data-v-4dcced44]:hover{background:#e5e7eb}.import-btn[data-v-4dcced44]{display:flex;align-items:center;gap:.5em;padding:.5em 1.25em;border-radius:9999px;border:1px solid rgba(6,182,212,.6);background:rgba(8,145,178,.12);color:rgba(103,232,249,.95);font-weight:600;cursor:pointer;box-shadow:none;transition:all .25s}.import-btn[data-v-4dcced44]:hover{background:rgba(8,145,178,.22);border-color:rgba(6,182,212,.9);color:#fff}.dropdown-menu[data-v-4dcced44]{position:absolute;top:100%;right:0;margin-top:.5em;min-width:10em;background:rgba(30,30,50,.95);backdrop-filter:blur(12px);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;overflow:hidden;z-index:100}.dropdown-menu button[data-v-4dcced44]{display:flex;align-items:center;gap:.5em;width:100%;padding:.75em 1em;border:none;background:rgba(0,0,0,0);color:#fff;font-size:.875em;cursor:pointer;transition:background .2s}.dropdown-menu button[data-v-4dcced44]:hover{background:rgba(139,92,246,.3)}.dropdown-menu button[data-v-4dcced44]:not(:last-child){border-bottom:1px solid hsla(0,0%,100%,.05)}.gallery-grid[data-v-4dcced44]{flex:1;overflow-y:auto;display:grid;grid-template-columns:repeat(4,1fr);align-content:start;gap:1.5em;padding-bottom:2em;padding-right:.5em}.empty-state[data-v-4dcced44]{grid-column:1/-1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:4em;color:#6b7280}.empty-state p[data-v-4dcced44]{font-size:.875em}.editor-view[data-v-4dcced44]{display:flex;flex-direction:column;height:100%}.editor-container[data-v-4dcced44]{flex:1;border:2px solid hsla(0,0%,100%,.1);border-radius:.75em;background:rgba(0,0,0,.2);backdrop-filter:blur(12px);display:flex;flex-direction:column;overflow:hidden}.editor-content[data-v-4dcced44]{flex:1;overflow-y:auto;padding:1.5em}.editor-actions[data-v-4dcced44]{display:flex;justify-content:center;gap:1em;padding:1em;background:rgba(0,0,0,.4);backdrop-filter:blur(4px);border-top:1px solid hsla(0,0%,100%,.1);flex-wrap:wrap}.editor-actions button[data-v-4dcced44]{padding:.5em 1.5em;border-radius:9999px;font-size:.75em;cursor:pointer;transition:all .3s}.action-reset[data-v-4dcced44]{border:1px solid hsla(0,0%,100%,.1);background:rgba(0,0,0,0);color:hsla(0,0%,100%,.5)}.action-reset[data-v-4dcced44]:hover{background:hsla(0,0%,100%,.05)}.action-submit[data-v-4dcced44]{background:linear-gradient(135deg,#0891b2 0%,#8b5cf6 100%);border:none;color:#fff;font-weight:bold;box-shadow:0 0 20px rgba(139,92,246,.3)}.action-submit[data-v-4dcced44]:hover{box-shadow:0 0 30px rgba(139,92,246,.5)}.preview-overlay[data-v-4dcced44]{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:1000;display:flex;align-items:center;justify-content:center}.preview-modal[data-v-4dcced44]{position:relative;width:70%;height:70%;border-radius:.75em;overflow:hidden;box-shadow:0 0 50px rgba(0,0,0,.5)}.close-btn[data-v-4dcced44]{position:absolute;top:1em;right:1em;width:2.5em;height:2.5em;background:rgba(0,0,0,.6);border:1px solid hsla(0,0%,100%,.2);border-radius:50%;color:#fff;font-size:1.25em;cursor:pointer;z-index:10;transition:all .2s}.close-btn[data-v-4dcced44]:hover{background:rgba(248,113,113,.8)}.autosave-toast[data-v-4dcced44]{position:absolute;top:5em;left:50%;transform:translateX(-50%);background:rgba(16,185,129,.9);color:#fff;padding:.5em 1em;border-radius:9999px;font-size:.8em;display:flex;align-items:center;gap:.5em;z-index:100;box-shadow:0 4px 6px rgba(0,0,0,.1);pointer-events:none}.upload-overlay[data-v-4dcced44]{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(4px);z-index:3000;display:flex;align-items:center;justify-content:center;padding:1.5em}.upload-box[data-v-4dcced44]{width:92%;max-width:440px;padding:1.25em 1.25em 1em;display:flex;flex-direction:column;gap:.9em;border:1px solid rgba(139,92,246,.25)}.upload-header[data-v-4dcced44]{display:flex;align-items:center;gap:.75em}.upload-header h3[data-v-4dcced44]{margin:0;font-size:1.05em;color:hsla(0,0%,100%,.95)}.upload-icon[data-v-4dcced44]{color:rgba(196,181,253,.95)}.upload-stage[data-v-4dcced44]{color:hsla(0,0%,100%,.8);font-size:.9em;line-height:1.4}.upload-progress[data-v-4dcced44]{width:100%;height:10px;border-radius:9999px;background:hsla(0,0%,100%,.08);overflow:hidden;border:1px solid hsla(0,0%,100%,.08)}.upload-progress-bar[data-v-4dcced44]{height:100%;width:0%;background:linear-gradient(90deg,#0891b2 0%,#8b5cf6 60%,#22c55e 100%);transition:width .2s ease}.upload-progress-bar.indeterminate[data-v-4dcced44]{width:40%;animation:upload-indeterminate-4dcced44 1.1s ease-in-out infinite}@keyframes upload-indeterminate-4dcced44{0%{transform:translateX(-120%)}100%{transform:translateX(280%)}}.upload-meta[data-v-4dcced44]{color:hsla(0,0%,100%,.6);font-size:.8em}.upload-actions[data-v-4dcced44]{display:flex;justify-content:flex-end}.upload-actions .btn-cancel[data-v-4dcced44]{padding:.45em 1.1em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.2);background:rgba(0,0,0,0);color:hsla(0,0%,100%,.75);cursor:pointer;transition:all .2s}.upload-actions .btn-cancel[data-v-4dcced44]:hover:not(:disabled){background:hsla(0,0%,100%,.1);color:#fff}.upload-actions .btn-cancel[data-v-4dcced44]:disabled{opacity:.5;cursor:not-allowed}.fade-enter-active[data-v-4dcced44],.fade-leave-active[data-v-4dcced44]{transition:all .3s ease}.fade-enter-from[data-v-4dcced44]{opacity:0;transform:translateY(10px)}.fade-leave-to[data-v-4dcced44]{opacity:0;transform:translateY(-10px)}.dropdown-enter-active[data-v-4dcced44],.dropdown-leave-active[data-v-4dcced44]{transition:all .2s ease}.dropdown-enter-from[data-v-4dcced44],.dropdown-leave-to[data-v-4dcced44]{opacity:0;transform:translateY(-10px)}.widget-preview-overlay[data-v-4dcced44]{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:9999;padding:2em}.widget-preview-modal[data-v-4dcced44]{width:100%;max-width:600px;max-height:80vh;background:#1e1b2e;border-radius:.75em;border:1px solid rgba(139,92,246,.3);overflow:hidden;display:flex;flex-direction:column}.widget-preview-header[data-v-4dcced44]{display:flex;justify-content:space-between;align-items:center;padding:1em;background:rgba(0,0,0,.3);border-bottom:1px solid hsla(0,0%,100%,.05)}.widget-preview-header h3[data-v-4dcced44]{margin:0;font-size:1em;color:#c4b5fd}.widget-preview-header .close-btn[data-v-4dcced44]{background:none;border:none;color:hsla(0,0%,100%,.5);font-size:1.5em;cursor:pointer;line-height:1}.widget-preview-header .close-btn[data-v-4dcced44]:hover{color:#fff}.widget-preview-body[data-v-4dcced44]{flex:1;padding:2em;overflow-y:auto;min-height:300px;background:rgba(0,0,0,.3);display:flex;flex-direction:column;align-items:stretch;justify-content:flex-start;gap:1em}.widget-preview-vars[data-v-4dcced44]{border:1px solid hsla(0,0%,100%,.08);background:rgba(0,0,0,.25);border-radius:.75em;padding:1em}.vars-header[data-v-4dcced44]{display:flex;align-items:center;justify-content:space-between;gap:1em;margin-bottom:.75em}.vars-title[data-v-4dcced44]{color:hsla(0,0%,100%,.85);font-size:.9em}.vars-actions[data-v-4dcced44]{display:flex;gap:.5em}.vars-btn[data-v-4dcced44]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.18);color:hsla(0,0%,100%,.75);font-size:.8em;padding:.4em .75em;border-radius:.5em;cursor:pointer;transition:all .2s}.vars-btn[data-v-4dcced44]:hover{border-color:hsla(0,0%,100%,.3);color:hsla(0,0%,100%,.95)}.vars-btn.primary[data-v-4dcced44]{border-color:rgba(139,92,246,.45);color:rgba(196,181,253,.95)}.vars-error[data-v-4dcced44]{color:#f87171;font-size:.85em;margin-bottom:.5em;white-space:pre-wrap}.vars-textarea[data-v-4dcced44]{width:100%;min-height:180px;resize:vertical;background:rgba(0,0,0,.35);color:hsla(0,0%,100%,.9);border:1px solid hsla(0,0%,100%,.12);border-radius:.5em;padding:.75em;font-family:"Fira Code",monospace;font-size:.8em;line-height:1.35;box-sizing:border-box}.vars-textarea[data-v-4dcced44]:focus{outline:none;border-color:rgba(139,92,246,.5)}.widget-preview-render[data-v-4dcced44]{flex:1;min-height:0;display:flex;align-items:flex-start;justify-content:center}.widget-error[data-v-4dcced44]{display:flex;flex-direction:column;align-items:center;gap:1em;padding:2em;color:#f87171;text-align:center}.widget-error pre[data-v-4dcced44]{margin:0;white-space:pre-wrap;font-size:.85em;text-align:left;max-width:100%}.widget-preview-console[data-v-4dcced44]{border-top:1px solid hsla(0,0%,100%,.05)}.widget-preview-console .console-header[data-v-4dcced44]{padding:.5em 1em;background:rgba(0,0,0,.3);font-size:.85em;color:hsla(0,0%,100%,.5)}.widget-preview-console .console-logs[data-v-4dcced44]{max-height:150px;overflow-y:auto;padding:.5em 1em;font-family:"Fira Code",monospace;font-size:.8em}.widget-preview-console .log-entry[data-v-4dcced44]{padding:.25em 0}.widget-preview-console .log-entry.info[data-v-4dcced44]{color:#93c5fd}.widget-preview-console .log-entry.success[data-v-4dcced44]{color:#34d399}.widget-preview-console .log-entry.warning[data-v-4dcced44]{color:#fbbf24}.widget-preview-console .log-entry.error[data-v-4dcced44]{color:#f87171}.widget-preview-console .no-logs[data-v-4dcced44]{color:hsla(0,0%,100%,.3);font-style:italic}
.dialogue-layer[data-v-21001e54]{position:absolute;left:0;right:0;z-index:30;display:flex;justify-content:center;padding:0 2em;cursor:pointer;transform:translateZ(0);will-change:transform}.dialogue-panel[data-v-21001e54]{position:relative;display:flex;flex-direction:column;background-color:rgba(0,0,0,.6);backdrop-filter:blur(24px);border:1px solid hsla(0,0%,100%,.1);box-shadow:0 20px 50px rgba(0,0,0,.5);border-radius:2em;overflow:visible !important}.char-name-container[data-v-21001e54]{position:absolute;top:-1.5em;left:2.5em;display:flex;align-items:flex-end;gap:.75em}.char-name-box[data-v-21001e54]{background:rgba(0,0,0,.8);border:1px solid hsla(0,0%,100%,.2);padding:.25em 1em;border-radius:.5em;backdrop-filter:blur(10px)}.char-name[data-v-21001e54]{font-size:1.5em;font-weight:bold;color:#fff;letter-spacing:.05em;font-family:"Noto Sans SC",sans-serif}.name-deco-line[data-v-21001e54]{width:3em;height:.25em;background-color:#8b5cf6;margin-bottom:.5em;border-radius:9999px;box-shadow:0 0 10px rgba(139,92,246,.8)}.dialogue-text-wrapper[data-v-21001e54]{flex:1;overflow-y:auto;overflow-x:hidden;margin-bottom:2em}.dialogue-text-wrapper[data-v-21001e54]::-webkit-scrollbar{width:.5em}.dialogue-text-wrapper[data-v-21001e54]::-webkit-scrollbar-track{background:hsla(0,0%,100%,.05);border-radius:.25em}.dialogue-text-wrapper[data-v-21001e54]::-webkit-scrollbar-thumb{background:hsla(0,0%,100%,.2);border-radius:.25em}.dialogue-text-wrapper[data-v-21001e54]::-webkit-scrollbar-thumb:hover{background:hsla(0,0%,100%,.3)}.dialogue-text[data-v-21001e54]{font-size:1.5em;line-height:1.625;color:#f1f5f9;font-weight:500;text-shadow:0 4px 6px -1px rgba(0,0,0,.1);font-family:"Noto Sans SC",sans-serif;margin:0}.seg-psych[data-v-21001e54]{font-style:italic;opacity:.95}.dialogue-controls[data-v-21001e54]{position:absolute;bottom:1em;right:1.5em;display:flex;gap:1em;color:hsla(0,0%,100%,.4)}.control-btn[data-v-21001e54]{background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:.25em;font-size:.75em;text-transform:uppercase;font-weight:bold;letter-spacing:.05em;color:inherit;transition:color .2s}.control-btn.hover-violet[data-v-21001e54]:hover{color:#a78bfa}.control-btn.hover-cyan[data-v-21001e54]:hover{color:#22d3ee}.control-btn.hover-pink[data-v-21001e54]:hover{color:#f472b6}.control-btn.active[data-v-21001e54]{color:#fbbf24;text-shadow:0 0 8px rgba(251,191,36,.5)}.rotate-90[data-v-21001e54]{transform:rotate(90deg)}.rotate-180[data-v-21001e54]{transform:rotate(180deg)}.back-indicator[data-v-21001e54]{position:absolute;bottom:1em;left:1.5em;color:hsla(0,0%,100%,.6);cursor:pointer;transition:color .2s}.back-indicator[data-v-21001e54]:hover{color:#fff}
.error-log-overlay[data-v-1628de53]{position:absolute;inset:0;z-index:2500;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);display:flex;justify-content:center;align-items:center;padding:2em}.error-log-panel[data-v-1628de53]{width:100%;max-width:900px;height:85%;background:rgba(25,25,35,.98);border:1px solid rgba(255,100,100,.2);border-radius:16px;display:flex;flex-direction:column;box-shadow:0 25px 50px rgba(0,0,0,.8);overflow:hidden}.log-header[data-v-1628de53]{padding:1.5em 2em;border-bottom:1px solid rgba(255,100,100,.15);display:flex;justify-content:space-between;align-items:center;background:rgba(239,68,68,.05)}.header-left[data-v-1628de53]{display:flex;align-items:center;gap:1em}.icon-wrapper[data-v-1628de53]{display:flex;align-items:center;justify-content:center;color:#fbbf24}.title[data-v-1628de53]{font-size:1.25em;font-weight:600;color:#fff}.count-badge[data-v-1628de53]{padding:.25em .75em;background:rgba(239,68,68,.2);border:1px solid rgba(239,68,68,.3);border-radius:12px;font-size:.875em;font-weight:600;color:#fca5a5}.close-btn[data-v-1628de53]{background:none;border:none;color:hsla(0,0%,100%,.5);font-size:1.75em;cursor:pointer;transition:color .2s;width:2em;height:2em;display:flex;align-items:center;justify-content:center;border-radius:8px}.close-btn[data-v-1628de53]:hover{color:#fff;background:hsla(0,0%,100%,.05)}.empty-state[data-v-1628de53]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;color:hsla(0,0%,100%,.4)}.empty-state svg[data-v-1628de53]{color:#22c55e;opacity:.6}.empty-state p[data-v-1628de53]{font-size:1.25em;font-weight:500;margin:0}.empty-state .sub-text[data-v-1628de53]{font-size:.875em;opacity:.7}.log-content[data-v-1628de53]{flex:1;overflow-y:auto;padding:1.5em 2em;display:flex;flex-direction:column;gap:1.25em}.error-item[data-v-1628de53]{background:rgba(239,68,68,.03);border:1px solid rgba(239,68,68,.15);border-radius:12px;padding:1.25em;display:flex;flex-direction:column;gap:.75em;transition:all .2s}.error-item[data-v-1628de53]:hover{background:rgba(239,68,68,.06);border-color:rgba(239,68,68,.25)}.error-header[data-v-1628de53]{display:flex;justify-content:space-between;align-items:center;font-size:.875em}.error-index[data-v-1628de53]{padding:.25em .75em;background:rgba(239,68,68,.15);border-radius:6px;font-weight:600;color:#fca5a5;font-family:"Courier New",monospace}.error-time[data-v-1628de53]{color:hsla(0,0%,100%,.5)}.error-message[data-v-1628de53]{color:#fca5a5;font-size:1em;font-weight:500;line-height:1.5}.error-command[data-v-1628de53],.error-details[data-v-1628de53]{display:flex;flex-direction:column;gap:.5em;font-size:.875em}.command-actions[data-v-1628de53]{display:flex;gap:.5em}.mini-btn[data-v-1628de53]{display:inline-flex;align-items:center;gap:.4em;padding:.4em .65em;border-radius:8px;border:1px solid hsla(0,0%,100%,.12);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.85);cursor:pointer;font-size:.8em;transition:all .2s}.mini-btn[data-v-1628de53]:hover{background:hsla(0,0%,100%,.1)}.mini-btn[data-v-1628de53]:disabled{opacity:.45;cursor:not-allowed}.mini-btn.primary[data-v-1628de53]{border-color:rgba(139,92,246,.55);background:rgba(139,92,246,.18)}.mini-btn.primary[data-v-1628de53]:hover{background:rgba(139,92,246,.28)}.reprocess-panel[data-v-1628de53]{padding:1.25em 2em;border-top:1px solid rgba(255,100,100,.12);background:hsla(0,0%,100%,.02);display:flex;flex-direction:column;gap:.75em}.reprocess-title[data-v-1628de53]{display:flex;align-items:center;gap:.5em;color:hsla(0,0%,100%,.9);font-weight:600}.reprocess-desc[data-v-1628de53]{color:hsla(0,0%,100%,.55);font-size:.875em;line-height:1.35}.reprocess-input[data-v-1628de53]{width:100%;min-height:7.5em;resize:vertical;border-radius:12px;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.3);color:hsla(0,0%,100%,.86);padding:.75em;font-family:"Courier New",monospace;font-size:.9em;outline:none}.reprocess-input[data-v-1628de53]:focus{border-color:rgba(139,92,246,.65);box-shadow:0 0 0 3px rgba(139,92,246,.15)}.reprocess-actions[data-v-1628de53]{display:flex;justify-content:flex-end;gap:.6em}.command-label[data-v-1628de53],.details-label[data-v-1628de53]{color:hsla(0,0%,100%,.5);font-size:.875em;font-weight:500}code[data-v-1628de53]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;padding:.75em;color:#a78bfa;font-family:"Courier New",monospace;font-size:.95em;overflow-x:auto;white-space:pre-wrap;word-break:break-all}pre[data-v-1628de53]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;padding:.75em;color:hsla(0,0%,100%,.7);font-family:"Courier New",monospace;font-size:.9em;overflow-x:auto;white-space:pre-wrap;word-break:break-all;margin:0}.log-footer[data-v-1628de53]{padding:1.25em 2em;border-top:1px solid rgba(255,100,100,.15);display:flex;justify-content:space-between;align-items:center;background:rgba(239,68,68,.03)}.btn-clear[data-v-1628de53]{display:flex;align-items:center;gap:.5em;padding:.75em 1.25em;background:rgba(239,68,68,.15);border:1px solid rgba(239,68,68,.25);border-radius:8px;color:#fca5a5;font-size:.875em;font-weight:500;cursor:pointer;transition:all .2s}.btn-clear[data-v-1628de53]:hover{background:rgba(239,68,68,.25);border-color:rgba(239,68,68,.4)}.footer-info[data-v-1628de53]{color:hsla(0,0%,100%,.5);font-size:.875em}.fade-enter-active[data-v-1628de53],.fade-leave-active[data-v-1628de53]{transition:opacity .3s ease}.fade-enter-from[data-v-1628de53],.fade-leave-to[data-v-1628de53]{opacity:0}
.hud-layer[data-v-83a8506e]{position:absolute;top:2.5em;left:2.5em;z-index:20;display:flex;gap:1em;align-items:center}.location-icon-wrapper[data-v-83a8506e]{width:3em;height:3em;border-radius:50%;border:1px solid hsla(0,0%,100%,.2);display:flex;align-items:center;justify-content:center;background-color:rgba(0,0,0,.2);backdrop-filter:blur(4px);color:hsla(0,0%,100%,.5);transition:color .3s,border-color .3s}.group:hover .location-icon-wrapper[data-v-83a8506e]{color:#a78bfa;border-color:#8b5cf6}.location-text[data-v-83a8506e]{font-size:1.875em;font-weight:100;color:#fff;letter-spacing:.2em;text-shadow:0 10px 15px -3px rgba(0,0,0,.1);font-family:"Outfit",sans-serif}.time-text[data-v-83a8506e]{font-size:1em;font-family:monospace;color:#c4b5fd;letter-spacing:.1em;opacity:.8}
.left-sidebar[data-v-3a4a3550]{position:absolute;top:0;left:0;bottom:0;z-index:40;width:2.5em;transition:width .3s ease-out;display:flex;flex-direction:column;justify-content:center;pointer-events:none}.left-sidebar[data-v-3a4a3550]:hover{width:6em}.left-sidebar.open[data-v-3a4a3550]{width:6em}.trigger-area[data-v-3a4a3550]{position:absolute;inset:0;width:3.5em;background:rgba(0,0,0,0);z-index:10;pointer-events:auto}.sidebar-content[data-v-3a4a3550]{height:auto;padding:2em 0;width:5em;transform:translateX(-100%);transition:transform .3s;background-color:rgba(0,0,0,.8);backdrop-filter:blur(24px);border:1px solid hsla(0,0%,100%,.1);border-radius:1em;display:flex;flex-direction:column;gap:1.5em;align-items:center;box-shadow:0 25px 50px -12px rgba(0,0,0,.25);z-index:40;pointer-events:auto}.left-sidebar:hover .sidebar-content[data-v-3a4a3550]{transform:translateX(1em)}.left-sidebar.open .sidebar-content[data-v-3a4a3550]{transform:translateX(1em)}.sidebar-btn[data-v-3a4a3550]{display:flex;flex-direction:column;align-items:center;gap:.25em;width:100%;background:none;border:none;cursor:pointer;color:#9ca3af;transition:color .2s}.sidebar-btn[data-v-3a4a3550]:hover{color:#fff}.sidebar-btn.danger[data-v-3a4a3550]{color:#f87171}.sidebar-btn.danger[data-v-3a4a3550]:hover{color:#fca5a5}.btn-icon-wrapper[data-v-3a4a3550]{padding:.75em;border-radius:.75em;background-color:hsla(0,0%,100%,.05);transition:all .2s;position:relative}.sidebar-btn:hover .btn-icon-wrapper[data-v-3a4a3550]{background-color:#7c3aed;box-shadow:0 0 15px rgba(139,92,246,.5)}.btn-icon-wrapper.danger-bg[data-v-3a4a3550]{background-color:rgba(239,68,68,.1)}.sidebar-btn:hover .btn-icon-wrapper.danger-bg[data-v-3a4a3550]{background-color:rgba(239,68,68,.2);box-shadow:none}.btn-icon-wrapper.error-bg[data-v-3a4a3550]{background-color:rgba(251,191,36,.1)}.sidebar-btn:hover .btn-icon-wrapper.error-bg[data-v-3a4a3550]{background-color:rgba(251,191,36,.2);box-shadow:0 0 15px rgba(251,191,36,.3)}.error-badge[data-v-3a4a3550]{position:absolute;top:-0.25em;right:-0.25em;background:#ef4444;color:#fff;font-size:.625em;font-weight:bold;padding:.2em .4em;border-radius:.5em;min-width:1.5em;text-align:center;box-shadow:0 2px 4px rgba(0,0,0,.3)}.sidebar-btn.has-errors[data-v-3a4a3550]{color:#fbbf24}.sidebar-btn.has-errors[data-v-3a4a3550]:hover{color:#fcd34d}.btn-label[data-v-3a4a3550]{font-size:.625em;font-weight:bold;letter-spacing:.1em}.sidebar-divider[data-v-3a4a3550]{width:2em;height:1px;background-color:hsla(0,0%,100%,.1)}
.perf-overlay[data-v-0bf7f76c]{position:absolute;inset:0;z-index:60;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);backdrop-filter:none;pointer-events:none}.perf-panel[data-v-0bf7f76c]{min-width:22em;max-width:min(48em,92vw);border-radius:16px;padding:1.25em 1.5em;border:1px solid hsla(0,0%,100%,.18);background:rgba(20,20,30,.55);box-shadow:0 20px 60px rgba(0,0,0,.35);color:hsla(0,0%,100%,.92);pointer-events:auto}.perf-text[data-v-0bf7f76c]{font-size:1.1em;line-height:1.7;letter-spacing:.03em;white-space:pre-wrap}.perf-hint[data-v-0bf7f76c]{margin-top:.8em;font-size:.9em;opacity:.65}.effect-rise[data-v-0bf7f76c]{animation:riseIn-0bf7f76c 260ms ease-out}@keyframes riseIn-0bf7f76c{from{transform:translateY(8px);opacity:.6}to{transform:translateY(0);opacity:1}}
.quick-input-orb[data-v-6193fdd3]{position:fixed;right:2em;bottom:2em;z-index:5000;width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,rgba(139,92,246,0.85),rgba(59,130,246,0.75));backdrop-filter:blur(10px);box-shadow:0 4px 20px rgba(0,0,0,.4),0 0 30px rgba(139,92,246,.22);cursor:pointer;transition:width .3s ease,height .3s ease,border-radius .3s ease,background .3s ease,transform .2s ease,box-shadow .2s ease;-webkit-user-select:none;user-select:none;touch-action:none;will-change:transform}.quick-input-orb[data-v-6193fdd3]:hover:not(.expanded){transform:scale(1.1);box-shadow:0 6px 25px rgba(0,0,0,.5),0 0 40px rgba(100,150,255,.5)}.quick-input-orb.dragging[data-v-6193fdd3]{opacity:.8}.quick-input-orb.expanded[data-v-6193fdd3]{width:380px;height:auto;border-radius:12px;background:rgba(18,16,28,.92);border:1px solid hsla(0,0%,100%,.08);box-shadow:0 12px 50px rgba(0,0,0,.65),0 0 0 1px rgba(139,92,246,.12) inset;cursor:default}.orb-icon[data-v-6193fdd3]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.5em;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.3);pointer-events:none}.input-panel[data-v-6193fdd3]{display:flex;flex-direction:column;padding:0;transform-origin:right bottom}.quick-input-panel-enter-active[data-v-6193fdd3],.quick-input-panel-leave-active[data-v-6193fdd3]{transition:opacity .16s ease,transform .18s ease}.quick-input-panel-enter-from[data-v-6193fdd3],.quick-input-panel-leave-to[data-v-6193fdd3]{opacity:0;transform:translateY(10px) scale(0.98)}.quick-input-panel-enter-to[data-v-6193fdd3],.quick-input-panel-leave-from[data-v-6193fdd3]{opacity:1;transform:translateY(0) scale(1)}.panel-header[data-v-6193fdd3]{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;border-bottom:1px solid hsla(0,0%,100%,.1);touch-action:none}.panel-title[data-v-6193fdd3]{font-size:.9em;font-weight:bold;color:hsla(0,0%,100%,.9);letter-spacing:.05em}.panel-drag-handle[data-v-6193fdd3]{cursor:move;-webkit-user-select:none;user-select:none}.panel-close[data-v-6193fdd3]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;color:hsla(0,0%,100%,.5);cursor:pointer;border-radius:4px;background:rgba(0,0,0,0);border:none;padding:0;transition:background .2s,color .2s}.panel-close[data-v-6193fdd3]:hover{background:hsla(0,0%,100%,.1);color:hsla(0,0%,100%,.9)}.textarea-wrapper[data-v-6193fdd3]{padding:10px 15px}.textarea-wrapper textarea[data-v-6193fdd3]{width:100%;min-height:80px;max-height:280px;padding:10px;border:1px solid hsla(0,0%,100%,.15);border-radius:8px;background:rgba(0,0,0,.3);color:#fff;font-size:.9em;resize:none;outline:none;transition:border-color .2s}.textarea-wrapper textarea[data-v-6193fdd3]:focus{border-color:rgba(139,92,246,.55);box-shadow:0 0 0 3px rgba(139,92,246,.14)}.textarea-wrapper textarea[data-v-6193fdd3]::placeholder{color:hsla(0,0%,100%,.4)}.btn-group[data-v-6193fdd3]{display:flex;gap:10px;padding:0 15px 12px}.orb-btn[data-v-6193fdd3]{flex:1;padding:8px 0;text-align:center;font-size:.85em;color:hsla(0,0%,100%,.8);background:hsla(0,0%,100%,.1);border-radius:6px;cursor:pointer;transition:background .2s,color .2s}.orb-btn[data-v-6193fdd3]:hover{background:hsla(0,0%,100%,.2);color:#fff}.orb-btn.primary[data-v-6193fdd3]{background:linear-gradient(135deg,rgba(139,92,246,0.85),rgba(59,130,246,0.8));color:#fff}.orb-btn.primary[data-v-6193fdd3]:hover{background:linear-gradient(135deg,rgba(167,139,250,0.92),rgba(96,165,250,0.9))}.orb-btn.primary.disabled[data-v-6193fdd3]{opacity:.5;cursor:not-allowed;pointer-events:none}.history-list[data-v-6193fdd3]{max-height:200px;overflow-y:auto;border-top:1px solid hsla(0,0%,100%,.1);margin:0 15px 12px;border-radius:0 0 8px 8px}.history-empty[data-v-6193fdd3]{padding:15px;text-align:center;color:hsla(0,0%,100%,.4);font-size:.85em}.history-item[data-v-6193fdd3]{display:flex;align-items:flex-start;gap:10px;padding:10px;border-bottom:1px solid hsla(0,0%,100%,.05);cursor:pointer;transition:background .2s}.history-item[data-v-6193fdd3]:hover{background:hsla(0,0%,100%,.05)}.history-item[data-v-6193fdd3]:last-child{border-bottom:none}.history-time[data-v-6193fdd3]{font-size:.75em;color:hsla(0,0%,100%,.4);white-space:nowrap}.history-content[data-v-6193fdd3]{flex:1;font-size:.85em;color:hsla(0,0%,100%,.8);overflow:hidden;text-overflow:ellipsis;display:-webkit-box;line-clamp:2;-webkit-line-clamp:2;-webkit-box-orient:vertical}.history-delete[data-v-6193fdd3]{width:20px;height:20px;display:flex;align-items:center;justify-content:center;color:hsla(0,0%,100%,.3);cursor:pointer;border-radius:4px;transition:background .2s,color .2s}.history-delete[data-v-6193fdd3]:hover{background:rgba(255,100,100,.2);color:rgba(255,100,100,.9)}
.right-sidebar[data-v-c5ebd980]{position:absolute;top:0;right:0;bottom:0;z-index:40;width:.5em;transition:width .3s ease-out}.right-sidebar[data-v-c5ebd980]:hover{width:var(--open-width)}.right-sidebar.open[data-v-c5ebd980]{width:var(--open-width)}.right-sidebar.measuring[data-v-c5ebd980]{width:var(--open-width)}.trigger-area[data-v-c5ebd980]{position:absolute;top:0;bottom:0;right:0;width:100px;background:rgba(0,0,0,0);z-index:50;pointer-events:auto}.right-sidebar:hover .trigger-area[data-v-c5ebd980],.right-sidebar.open .trigger-area[data-v-c5ebd980],.right-sidebar.measuring .trigger-area[data-v-c5ebd980]{pointer-events:none}.widgets-panel[data-v-c5ebd980]{height:100%;width:max-content;max-width:90vw;transform:translateX(100%);transition:transform .3s;background-color:rgba(0,0,0,.9);backdrop-filter:blur(24px);border-left:1px solid hsla(0,0%,100%,.1);display:flex;flex-direction:column;padding:2em;box-shadow:0 25px 50px -12px rgba(0,0,0,.25);box-sizing:border-box;overflow:hidden}.right-sidebar:hover .widgets-panel[data-v-c5ebd980]{transform:translateX(0)}.right-sidebar.open .widgets-panel[data-v-c5ebd980]{transform:translateX(0)}.right-sidebar.measuring .widgets-panel[data-v-c5ebd980]{transform:translateX(0);opacity:0;pointer-events:none}.widgets-header-row[data-v-c5ebd980]{display:flex;justify-content:space-between;align-items:center;gap:1em;margin-bottom:2em;border-bottom:1px solid hsla(0,0%,100%,.1);padding-bottom:1em}.widgets-header-title[data-v-c5ebd980]{font-size:1.125em;font-weight:bold;color:#fff;letter-spacing:.1em;text-align:right;font-family:"Outfit",sans-serif}.refresh-btn[data-v-c5ebd980]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);color:hsla(0,0%,100%,.8);font-size:.75em;padding:.35em .75em;border-radius:.5em;cursor:pointer;transition:all .2s}.refresh-btn[data-v-c5ebd980]:hover{border-color:hsla(0,0%,100%,.35);color:#fff}.widgets-container[data-v-c5ebd980]{display:flex;flex-direction:column;gap:1.5em;flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;overscroll-behavior:contain}.widget-host[data-v-c5ebd980]{background-color:hsla(0,0%,100%,.05);border-radius:.75em;padding:1em;border:1px solid hsla(0,0%,100%,.1);max-width:100%;min-width:0;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch}.empty-state[data-v-c5ebd980],.missing-state[data-v-c5ebd980]{color:hsla(0,0%,100%,.6);font-size:.85em}
.saveload-overlay[data-v-2470003a]{position:absolute;inset:0;z-index:2000;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:flex;justify-content:center;align-items:center;font-size:.85vw}.saveload-container[data-v-2470003a]{width:90em;height:54em;padding:1.75em;display:flex;flex-direction:column;background:rgba(15,15,25,.95);border:1px solid hsla(0,0%,100%,.1);border-radius:1em;overflow:hidden;box-shadow:0 25px 50px rgba(0,0,0,.5)}.header[data-v-2470003a]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.25em}.header-left[data-v-2470003a]{display:flex;align-items:center;gap:1.25em}.page-title[data-v-2470003a]{margin:0;font-size:1.65em;font-weight:300;letter-spacing:.2em;color:#fff}.mode-switch[data-v-2470003a]{display:flex;gap:.5em;padding:.25em;border-radius:9999px;background:hsla(0,0%,100%,.04);border:1px solid hsla(0,0%,100%,.08)}.mode-btn[data-v-2470003a]{padding:.45em 1.15em;border-radius:9999px;background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.6);cursor:pointer;transition:all .25s}.mode-btn.active[data-v-2470003a]{background:rgba(217,70,239,.18);border:1px solid rgba(217,70,239,.35);color:#f0abfc}.header-actions[data-v-2470003a]{display:flex;align-items:center;gap:.75em}.import-btn[data-v-2470003a]{display:flex;align-items:center;gap:.5em;padding:.5em 1.25em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);color:#f0abfc;font-size:.875em;cursor:pointer;transition:background .3s}.import-btn[data-v-2470003a]:hover{background:hsla(0,0%,100%,.1)}.import-btn.primary[data-v-2470003a]{color:#fff;border-color:rgba(217,70,239,.35);background:rgba(217,70,239,.12)}.close-x[data-v-2470003a]{width:2.2em;height:2.2em;border-radius:9999px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.08);color:hsla(0,0%,100%,.7);cursor:pointer;transition:all .25s}.close-x[data-v-2470003a]:hover{background:hsla(0,0%,100%,.1);color:#fff}.saves-panel[data-v-2470003a]{flex:1;padding:1.75em}.saves-container[data-v-2470003a]{display:flex;flex-direction:column;gap:1.25em;overflow-y:auto;height:100%;padding-right:.75em}.section-title[data-v-2470003a]{margin:.25em 0 .25em;font-size:.95em;letter-spacing:.12em;color:hsla(0,0%,100%,.55)}.system-saves[data-v-2470003a]{display:flex;flex-direction:column;gap:1em;padding-bottom:.25em}.system-save[data-v-2470003a]{opacity:.85}.system-save[data-v-2470003a]:hover{transform:none;border-color:hsla(0,0%,100%,.08);background:rgba(0,0,0,.25)}.slots-col[data-v-2470003a]{display:flex;flex-direction:column;gap:1.1em}.save-slot.empty[data-v-2470003a]{border-style:dashed;border-color:hsla(0,0%,100%,.12)}.slot-index-badge[data-v-2470003a]{position:absolute;right:.6em;bottom:.6em;font-size:.75em;padding:.2em .55em;border-radius:9999px;background:rgba(0,0,0,.35);border:1px solid hsla(0,0%,100%,.12);color:hsla(0,0%,100%,.75);backdrop-filter:blur(6px)}.rename-overlay[data-v-2470003a]{position:absolute;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(3px);z-index:2100;display:flex;align-items:center;justify-content:center}.rename-box[data-v-2470003a]{width:90%;max-width:35em;padding:1.5em;display:flex;flex-direction:column;gap:1em;border:1px solid hsla(0,0%,100%,.12)}.rename-header[data-v-2470003a]{display:flex;align-items:center;gap:.75em}.rename-header h3[data-v-2470003a]{margin:0;color:#fff;font-size:1.2em}.rename-icon[data-v-2470003a]{color:#f0abfc}.rename-desc[data-v-2470003a]{margin:0;color:hsla(0,0%,100%,.75);line-height:1.4}.rename-input[data-v-2470003a]{width:100%;padding:.75em .9em;border-radius:.75em;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.25);color:#fff;outline:none}.rename-input[data-v-2470003a]:focus{border-color:rgba(217,70,239,.5);box-shadow:0 0 0 3px rgba(217,70,239,.15)}.rename-actions[data-v-2470003a]{display:flex;justify-content:flex-end;gap:.75em}.btn-cancel[data-v-2470003a]{padding:.55em 1.25em;border-radius:9999px;background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);color:hsla(0,0%,100%,.75);cursor:pointer}.btn-cancel[data-v-2470003a]:hover{background:hsla(0,0%,100%,.08);color:#fff}.btn-confirm[data-v-2470003a]{padding:.55em 1.25em;border-radius:9999px;background:rgba(217,70,239,.25);border:1px solid rgba(217,70,239,.4);color:#fff;cursor:pointer}.btn-confirm[data-v-2470003a]:hover{background:rgba(217,70,239,.35)}.save-item[data-v-2470003a]{position:relative;display:flex;gap:1.25em;align-items:center;padding:1em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;transition:all .3s}.save-item[data-v-2470003a]:hover{background:rgba(0,0,0,.4);border-color:rgba(217,70,239,.5);transform:translateX(0.5em)}.save-item:hover .save-chapter[data-v-2470003a]{color:#f0abfc}.save-item:hover .save-actions[data-v-2470003a]{opacity:1}.save-thumbnail[data-v-2470003a]{position:relative;width:12em;height:7em;border-radius:.5em;overflow:hidden;flex-shrink:0;border:1px solid hsla(0,0%,100%,.1)}.save-thumbnail img[data-v-2470003a]{width:100%;height:100%;object-fit:cover;opacity:.7;transition:opacity .3s}.save-item:hover .save-thumbnail img[data-v-2470003a]{opacity:1}.thumbnail-overlay[data-v-2470003a]{position:absolute;inset:0;background:linear-gradient(to right,rgba(0,0,0,0.5),transparent)}.slot-badge[data-v-2470003a]{position:absolute;left:.6em;top:.6em;font-size:.75em;padding:.2em .6em;border-radius:9999px;letter-spacing:.08em;backdrop-filter:blur(6px);border:1px solid hsla(0,0%,100%,.12);color:#fff;background:rgba(0,0,0,.35)}.slot-badge.badge-auto[data-v-2470003a]{border-color:rgba(59,130,246,.35);background:rgba(59,130,246,.18)}.slot-badge.badge-cloud[data-v-2470003a]{border-color:rgba(34,197,94,.35);background:rgba(34,197,94,.16)}.slot-badge.badge-manual[data-v-2470003a]{border-color:rgba(217,70,239,.35);background:rgba(217,70,239,.16)}.save-info[data-v-2470003a]{flex:1;min-width:0}.save-header[data-v-2470003a]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.5em;gap:1em}.save-chapter[data-v-2470003a]{font-size:1.15em;font-weight:bold;color:#fff;transition:color .3s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.save-date[data-v-2470003a]{flex-shrink:0;font-size:.75em;font-family:monospace;color:#6b7280;background:rgba(0,0,0,.3);padding:.25em .5em;border-radius:.25em}.save-summary[data-v-2470003a]{font-size:.875em;color:#9ca3af}.save-firstline[data-v-2470003a]{margin:.35em 0 0;font-size:.85em;color:hsla(0,0%,100%,.45);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.save-actions[data-v-2470003a]{display:flex;flex-direction:column;gap:.5em;opacity:.55;transition:opacity .3s}.action-btn[data-v-2470003a]{padding:.5em;border-radius:9999px;background:none;border:none;color:#9ca3af;cursor:pointer;transition:all .3s}.action-btn[data-v-2470003a]:disabled{opacity:.35;cursor:not-allowed}.action-btn.load-btn[data-v-2470003a]:hover{background:#d946ef;color:#fff}.action-btn.overwrite-btn[data-v-2470003a]:hover{background:#a78bfa;color:#fff}.action-btn.export-btn[data-v-2470003a]:hover{background:#3b82f6;color:#fff}.action-btn.delete-btn[data-v-2470003a]:hover{background:#ef4444;color:#fff}.no-saves[data-v-2470003a]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:4em;color:hsla(0,0%,100%,.3)}.no-saves p[data-v-2470003a]{margin:0;font-size:1.25em}.no-saves span[data-v-2470003a]{font-size:.875em;color:hsla(0,0%,100%,.2);text-align:center}.loading-state[data-v-2470003a]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:4em;color:hsla(0,0%,100%,.5)}.loading-state p[data-v-2470003a]{margin:0}.loading-spinner[data-v-2470003a]{width:3em;height:3em;border:.2em solid hsla(0,0%,100%,.1);border-radius:50%;border-top-color:#a78bfa;animation:spin-2470003a 1s ease-in-out infinite}@keyframes spin-2470003a{to{transform:rotate(360deg)}}.placeholder-thumb[data-v-2470003a]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);color:hsla(0,0%,100%,.2)}.footer[data-v-2470003a]{display:flex;justify-content:flex-end;margin-top:1em}.btn-secondary[data-v-2470003a]{padding:.55em 1.25em;border-radius:.75em;background:hsla(0,0%,100%,.06);border:1px solid hsla(0,0%,100%,.1);color:hsla(0,0%,100%,.75);cursor:pointer;transition:background .25s}.btn-secondary[data-v-2470003a]:hover{background:hsla(0,0%,100%,.1);color:#fff}.tabs[data-v-2470003a]{display:flex;gap:.5em;padding:1em 1.5em;border-bottom:1px solid hsla(0,0%,100%,.05)}.tab-btn[data-v-2470003a]{display:flex;align-items:center;gap:.5em;padding:.75em 1.5em;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;color:hsla(0,0%,100%,.6);font-size:.875em;cursor:pointer;transition:all .2s}.tab-btn[data-v-2470003a]:hover{background:hsla(0,0%,100%,.1);color:#fff}.tab-btn.active[data-v-2470003a]{background:rgba(167,139,250,.2);border-color:rgba(167,139,250,.5);color:#c4b5fd}.slots-container[data-v-2470003a]{flex:1;overflow-y:auto;padding:1em 1.5em;display:grid;grid-template-columns:repeat(auto-fill,minmax(20em,1fr));gap:1em;align-content:start}.save-slot[data-v-2470003a]{display:flex;gap:1em;align-items:center;padding:1em;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;cursor:pointer;transition:all .2s}.save-slot[data-v-2470003a]:hover{background:rgba(0,0,0,.5);border-color:rgba(167,139,250,.3);transform:translateY(-2px)}.save-slot:hover .slot-actions[data-v-2470003a]{opacity:1}.save-slot.is-selected[data-v-2470003a]{border-color:rgba(167,139,250,.5);background:rgba(167,139,250,.1)}.save-slot.quick-save[data-v-2470003a]{background:linear-gradient(135deg,rgba(34,211,238,0.1),rgba(167,139,250,0.1));border-color:rgba(34,211,238,.3)}.save-slot.quick-save[data-v-2470003a]:hover{border-color:rgba(34,211,238,.5)}.save-slot.empty-slot[data-v-2470003a]{border-style:dashed;border-color:hsla(0,0%,100%,.1)}.save-slot.empty-slot[data-v-2470003a]:hover{border-color:hsla(0,0%,100%,.3)}.slot-icon[data-v-2470003a]{width:3em;height:3em;display:flex;align-items:center;justify-content:center;background:rgba(167,139,250,.2);border-radius:.5em;color:#c4b5fd;flex-shrink:0}.slot-icon.empty[data-v-2470003a]{background:hsla(0,0%,100%,.05);color:hsla(0,0%,100%,.3)}.slot-thumbnail[data-v-2470003a]{position:relative;width:5em;height:3em;border-radius:.375em;overflow:hidden;flex-shrink:0;border:1px solid hsla(0,0%,100%,.1)}.slot-thumbnail img[data-v-2470003a]{width:100%;height:100%;object-fit:cover}.slot-thumbnail .placeholder-thumb[data-v-2470003a]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);color:hsla(0,0%,100%,.2)}.thumbnail-overlay[data-v-2470003a]{position:absolute;inset:0;background:linear-gradient(to right,rgba(0,0,0,0.3),transparent)}.slot-badge[data-v-2470003a]{position:absolute;top:4px;left:4px;padding:2px 6px;border-radius:6px;font-size:.65em;font-weight:600;letter-spacing:.05em;color:#fff;background:rgba(0,0,0,.55)}.badge-auto[data-v-2470003a]{background:linear-gradient(135deg,#22d3ee,#0ea5e9)}.badge-cloud[data-v-2470003a]{background:linear-gradient(135deg,#c084fc,#6366f1)}.badge-manual[data-v-2470003a]{background:linear-gradient(135deg,#f472b6,#f97316)}.slot-info[data-v-2470003a]{flex:1;min-width:0}.slot-info h3[data-v-2470003a]{margin:0 0 .25em 0;font-size:1em;font-weight:500;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.slot-info p[data-v-2470003a]{margin:0;font-size:.75em;color:hsla(0,0%,100%,.5);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.slot-header[data-v-2470003a]{display:flex;justify-content:space-between;align-items:center;gap:.5em}.slot-date[data-v-2470003a]{font-size:.625em;font-family:monospace;color:hsla(0,0%,100%,.4);background:rgba(0,0,0,.3);padding:.25em .5em;border-radius:.25em;flex-shrink:0}.slot-summary[data-v-2470003a]{margin-top:.25em !important}.slot-firstline[data-v-2470003a]{margin-top:.2em !important;color:hsla(0,0%,100%,.55);font-size:.7em;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.slot-actions[data-v-2470003a]{display:flex;gap:.5em;opacity:0;transition:opacity .2s}.action-btn[data-v-2470003a]{padding:.5em;border-radius:.375em;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);color:hsla(0,0%,100%,.6);cursor:pointer;transition:all .2s}.action-btn[data-v-2470003a]:hover{transform:scale(1.1)}.action-btn.load-btn[data-v-2470003a]:hover,.action-btn.overwrite-btn[data-v-2470003a]:hover{background:rgba(167,139,250,.3);border-color:rgba(167,139,250,.5);color:#c4b5fd}.action-btn.delete-btn[data-v-2470003a]:hover{background:rgba(239,68,68,.3);border-color:rgba(239,68,68,.5);color:#fca5a5}.no-saves[data-v-2470003a]{grid-column:1/-1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1em;padding:3em;color:hsla(0,0%,100%,.3)}.no-saves p[data-v-2470003a]{margin:0;font-size:1.125em}.modal-footer[data-v-2470003a]{display:flex;justify-content:flex-end;gap:1em;padding:1em 1.5em;border-top:1px solid hsla(0,0%,100%,.05);background:rgba(0,0,0,.2)}.btn-secondary[data-v-2470003a]{padding:.75em 1.5em;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;color:hsla(0,0%,100%,.7);font-size:.875em;cursor:pointer;transition:all .2s}.btn-secondary[data-v-2470003a]:hover{background:hsla(0,0%,100%,.1);color:#fff}.fade-scale-enter-active[data-v-2470003a],.fade-scale-leave-active[data-v-2470003a]{transition:all .3s ease}.fade-scale-enter-from[data-v-2470003a],.fade-scale-leave-to[data-v-2470003a]{opacity:0}.fade-scale-enter-from .saveload-container[data-v-2470003a],.fade-scale-leave-to .saveload-container[data-v-2470003a]{transform:scale(0.95)}
.debug-card[data-v-5c1378ba]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;padding:1em;display:flex;flex-direction:column;gap:1em;margin-bottom:2em;transition:opacity .2s}.debug-card.disabled[data-v-5c1378ba]{opacity:.5;pointer-events:none}.debug-card.disabled .card-body[data-v-5c1378ba]{filter:grayscale(0.5)}.disabled-hint[data-v-5c1378ba]{margin-left:auto;font-size:.75em;color:#ef4444;background:rgba(239,68,68,.1);padding:.2em .5em;border-radius:.25em}.card-header[data-v-5c1378ba]{display:flex;align-items:center;gap:.5em;color:#a78bfa;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.5em}.card-title[data-v-5c1378ba]{font-weight:600;font-size:.95em}.card-body[data-v-5c1378ba]{display:flex;flex-direction:column;gap:1em}.debug-textarea[data-v-5c1378ba]{width:100%;background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);color:#e5e7eb;padding:.75em;border-radius:.5em;font-family:inherit;resize:vertical}.debug-textarea[data-v-5c1378ba]:focus{outline:1px solid #8b5cf6}.upload-zone[data-v-5c1378ba]{display:flex;gap:.5em;align-items:center;background:rgba(0,0,0,.2);padding:.5em;border-radius:.5em}.input-text[data-v-5c1378ba]{flex:1;background:rgba(0,0,0,0);border:none;color:#fff;padding:.5em;border-bottom:1px solid hsla(0,0%,100%,.2)}.input-text[data-v-5c1378ba]:focus{outline:none;border-color:#8b5cf6}.file-label[data-v-5c1378ba]{cursor:pointer;background:hsla(0,0%,100%,.1);padding:.4em .8em;border-radius:.4em;font-size:.85em;transition:background .2s;white-space:nowrap}.file-label[data-v-5c1378ba]:hover{background:hsla(0,0%,100%,.2)}.action-btn[data-v-5c1378ba]{display:flex;align-items:center;gap:.5em;background:#8b5cf6;color:#fff;border:none;padding:.5em 1em;border-radius:.5em;cursor:pointer;font-weight:500;transition:background .2s}.action-btn[data-v-5c1378ba]:hover:not(:disabled){background:#7c3aed}.action-btn[data-v-5c1378ba]:disabled{opacity:.5;cursor:not-allowed;background:#4b5563}.action-btn.small[data-v-5c1378ba]{padding:.4em .8em;font-size:.85em}.temp-preview[data-v-5c1378ba]{position:relative;width:100px;height:60px;border:1px dashed #8b5cf6;border-radius:4px;overflow:hidden}.temp-preview img[data-v-5c1378ba]{width:100%;height:100%;object-fit:cover}.temp-preview.char-mode[data-v-5c1378ba]{width:60px;height:80px}.temp-preview.char-mode img[data-v-5c1378ba]{object-fit:contain}.preview-tag[data-v-5c1378ba]{position:absolute;bottom:0;right:0;background:#8b5cf6;font-size:8px;padding:1px 3px;color:#fff}.assets-grid[data-v-5c1378ba]{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:.75em;max-height:250px;overflow-y:auto;padding-right:.5em}.asset-item[data-v-5c1378ba]{background:rgba(0,0,0,.2);border-radius:.5em;overflow:hidden;cursor:pointer;transition:transform .2s,box-shadow .2s;border:1px solid rgba(0,0,0,0);position:relative}.asset-item[data-v-5c1378ba]:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.3);border-color:rgba(139,92,246,.3)}.asset-item.active[data-v-5c1378ba]{border-color:#8b5cf6;box-shadow:0 0 0 1px #8b5cf6}.asset-item.char-mode .asset-img-wrapper[data-v-5c1378ba]{aspect-ratio:3/4}.asset-item.char-mode .asset-img-wrapper img[data-v-5c1378ba]{object-fit:contain}.asset-img-wrapper[data-v-5c1378ba]{width:100%;aspect-ratio:16/9;background:#1a1a1a}.asset-img-wrapper img[data-v-5c1378ba]{width:100%;height:100%;object-fit:cover}.asset-info[data-v-5c1378ba]{padding:.4em;display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,.4)}.asset-name[data-v-5c1378ba]{font-size:.75em;color:#cbd5e1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:80%}.delete-btn[data-v-5c1378ba]{background:none;border:none;color:#ef4444;cursor:pointer;font-size:1.1em;line-height:1;padding:0 .2em}.delete-btn[data-v-5c1378ba]:hover{color:#f87171;background:hsla(0,0%,100%,.1);border-radius:2px}.status-bar[data-v-5c1378ba]{position:sticky;bottom:-1em;margin:0 -1em -1em -1em;background:#059669;color:#fff;padding:.5em;text-align:center;font-size:.85em;animation:slideUp-5c1378ba .3s ease}@keyframes slideUp-5c1378ba{from{transform:translateY(100%)}to{transform:translateY(0)}}.section-desc[data-v-5c1378ba]{color:#9ca3af;font-size:.85em;margin-bottom:1em}.highlight-glow[data-v-5c1378ba]{border-color:rgba(139,92,246,.4);background:rgba(139,92,246,.1);margin-bottom:2em}.card-row[data-v-5c1378ba]{display:flex;justify-content:space-between;align-items:center}.setting-info[data-v-5c1378ba]{display:flex;flex-direction:column;gap:.25em}.flex-row[data-v-5c1378ba]{display:flex;align-items:center;gap:.5em;color:#a78bfa;font-weight:600}.setting-hint[data-v-5c1378ba]{font-size:.8em;color:#9ca3af}.toggle-switch[data-v-5c1378ba]{width:44px;height:24px;background:hsla(0,0%,100%,.1);border-radius:12px;padding:2px;cursor:pointer;transition:background .2s;position:relative}.toggle-switch.active[data-v-5c1378ba]{background:#8b5cf6}.toggle-switch.active .toggle-knob[data-v-5c1378ba]{transform:translateX(20px);background:#fff}.toggle-switch .toggle-knob[data-v-5c1378ba]{width:20px;height:20px;background:hsla(0,0%,100%,.5);border-radius:50%;transition:transform .2s,background .2s}.toggle-switch:hover .toggle-knob[data-v-5c1378ba]{background:#fff}
.preview-stage-wrapper[data-v-adbfeaec]{display:flex;flex-direction:column;gap:.75em}.preview-header[data-v-adbfeaec]{display:flex;justify-content:space-between;align-items:center}.preview-label[data-v-adbfeaec]{font-size:.9em;color:#a78bfa;font-weight:500}.preview-stage[data-v-adbfeaec]{position:relative;width:100%;aspect-ratio:16/9;min-height:280px;border-radius:.5em;overflow:hidden;background:#000;border:1px solid hsla(0,0%,100%,.1);isolation:isolate;contain:layout paint}.background-layer[data-v-adbfeaec]{position:absolute;inset:0;z-index:0}.bg-image[data-v-adbfeaec],.bg-placeholder[data-v-adbfeaec]{width:100%;height:100%;object-fit:cover;opacity:.6}.bg-placeholder[data-v-adbfeaec]{background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);opacity:1}.bg-gradient[data-v-adbfeaec]{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.9),transparent,rgba(0,0,0,0.3))}.character-layer[data-v-adbfeaec]{position:absolute;inset:0;z-index:5;pointer-events:none;bottom:15%;transform:translateZ(0)}.char-img[data-v-adbfeaec]{position:absolute;object-fit:contain;object-position:bottom center;filter:drop-shadow(0 5px 20px rgba(0,0,0,0.6)) drop-shadow(0 15px 40px rgba(0,0,0,0.4));transition:left .4s cubic-bezier(0.4,0,0.2,1),bottom .4s cubic-bezier(0.4,0,0.2,1),height .4s cubic-bezier(0.4,0,0.2,1),transform .4s cubic-bezier(0.4,0,0.2,1),opacity .3s ease;will-change:left,bottom,height,transform,opacity}.dynamic-char[data-v-adbfeaec]{left:50%;bottom:0;transform:translateX(-50%);height:60%;animation:char-breathe-adbfeaec 4s ease-in-out infinite}@keyframes char-breathe-adbfeaec{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(-0.5%)}}.char-placeholder[data-v-adbfeaec]{position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;padding-bottom:10%;color:hsla(0,0%,100%,.3);font-size:.7em;gap:.3em}.char-fade-enter-active[data-v-adbfeaec],.char-fade-leave-active[data-v-adbfeaec]{transition:opacity .3s,transform .3s}.char-fade-enter-from[data-v-adbfeaec],.char-fade-leave-to[data-v-adbfeaec]{opacity:0;transform:translateX(-50%) translateY(10px)}.preview-hud[data-v-adbfeaec]{transform:scale(0.6);transform-origin:top left}@media (hover:none)and (pointer:coarse){.preview-stage[data-v-adbfeaec]{backface-visibility:hidden}.char-img[data-v-adbfeaec]{filter:none;transition:none;will-change:auto}.dynamic-char[data-v-adbfeaec]{animation:none}.char-fade-enter-active[data-v-adbfeaec],.char-fade-leave-active[data-v-adbfeaec]{transition:none}[data-v-adbfeaec] .dialogue-layer{transform:none !important;will-change:auto !important}[data-v-adbfeaec] .dialogue-panel,[data-v-adbfeaec] .char-name-box,[data-v-adbfeaec] .location-icon-wrapper{backdrop-filter:none !important}[data-v-adbfeaec] .dialogue-panel{box-shadow:none !important}}@media (hover:none)and (pointer:coarse)and (orientation:landscape){.preview-stage[data-v-adbfeaec]{transform:none}.character-layer[data-v-adbfeaec]{transform:none}}
.settings-section[data-v-69a21231]{display:flex;flex-direction:column;gap:1.5em}@media (hover:none)and (pointer:coarse)and (max-width:900px){.preview-card[data-v-69a21231]{display:none !important}}.section-header[data-v-69a21231]{margin-bottom:.5em}.section-title[data-v-69a21231]{font-size:1.1em;font-weight:600;color:#fff;margin:0 0 .25em 0}.section-desc[data-v-69a21231]{font-size:.85em;color:#9ca3af;margin:0}.sub-tabs[data-v-69a21231]{display:flex;gap:.5em;margin-bottom:.5em;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.5em}.sub-tab-btn[data-v-69a21231]{background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.5);padding:.5em 1em;border-radius:.5em .5em 0 0;cursor:pointer;font-size:.9em;transition:all .2s;border-bottom:2px solid rgba(0,0,0,0)}.sub-tab-btn[data-v-69a21231]:hover{color:hsla(0,0%,100%,.8);background:hsla(0,0%,100%,.03)}.sub-tab-btn.active[data-v-69a21231]{color:#a78bfa;background:rgba(167,139,250,.1);border-bottom-color:#a78bfa}.debug-card[data-v-69a21231]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;padding:1em;display:flex;flex-direction:column;gap:1em}.preview-card[data-v-69a21231]{padding:1.25em}.card-header[data-v-69a21231]{display:flex;align-items:center;gap:.5em;color:#a78bfa;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.5em}.card-icon[data-v-69a21231]{flex-shrink:0}.card-title[data-v-69a21231]{font-weight:600;font-size:.95em}.card-body[data-v-69a21231]{display:flex;flex-direction:column;gap:1em}.char-selector[data-v-69a21231]{display:flex;align-items:center;gap:1em;padding:.75em;background:rgba(0,0,0,.2);border-radius:.5em}.selector-label[data-v-69a21231]{font-size:.85em;color:#9ca3af}.selector-buttons[data-v-69a21231]{display:flex;gap:.5em}.selector-btn[data-v-69a21231]{background:hsla(0,0%,100%,.1);border:1px solid rgba(0,0,0,0);color:hsla(0,0%,100%,.6);padding:.4em .8em;border-radius:.4em;cursor:pointer;font-size:.8em;transition:all .2s}.selector-btn[data-v-69a21231]:hover{background:hsla(0,0%,100%,.15);color:#fff}.selector-btn.active[data-v-69a21231]{background:#8b5cf6;color:#fff;border-color:#a78bfa}.controls-panel[data-v-69a21231]{display:flex;flex-direction:column;gap:.75em}.control-group-title[data-v-69a21231]{font-size:.8em;color:#a78bfa;font-weight:500;margin-bottom:.25em}.control-row[data-v-69a21231]{display:flex;justify-content:space-between;align-items:center}.control-label[data-v-69a21231]{font-size:.85em;color:#9ca3af}.control-value[data-v-69a21231]{font-size:.85em;color:#a78bfa;font-family:monospace;background:rgba(167,139,250,.1);padding:.1em .4em;border-radius:.25em}.styled-range[data-v-69a21231]{-webkit-appearance:none;appearance:none;width:100%;height:4px;background:hsla(0,0%,100%,.1);border-radius:2px;outline:none;background-image:linear-gradient(#8b5cf6,#8b5cf6);background-size:var(--progress) 100%;background-repeat:no-repeat;cursor:pointer}.styled-range.full[data-v-69a21231]{margin-bottom:.5em}.styled-range[data-v-69a21231]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;height:14px;width:14px;border-radius:50%;background:#fff;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.3);-webkit-transition:transform .1s,box-shadow .1s;transition:transform .1s,box-shadow .1s}.styled-range[data-v-69a21231]:hover::-webkit-slider-thumb{box-shadow:0 0 0 4px rgba(139,92,246,.2)}.dialogue-settings[data-v-69a21231]{display:flex;flex-direction:column;gap:1.5em}.quick-actions[data-v-69a21231]{display:flex;justify-content:flex-end;gap:1em;padding-top:1em;border-top:1px solid hsla(0,0%,100%,.05)}.action-btn[data-v-69a21231]{background:#8b5cf6;color:#fff;border:none;padding:.5em 1em;border-radius:.5em;cursor:pointer;font-size:.9em;transition:background .2s}.action-btn[data-v-69a21231]:hover{background:#7c3aed}.action-btn.outline[data-v-69a21231]{background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);color:#9ca3af}.action-btn.outline[data-v-69a21231]:hover{background:hsla(0,0%,100%,.05);color:#fff}.highlight-card[data-v-69a21231]{background:linear-gradient(135deg,rgba(255,255,255,0.03) 0%,rgba(139,92,246,0.05) 100%);border:1px solid rgba(139,92,246,.2)}.highlight-card[data-v-69a21231]:hover{border-color:rgba(139,92,246,.4);box-shadow:0 4px 20px rgba(139,92,246,.1)}.hint-card[data-v-69a21231]{display:flex;gap:1em;background:rgba(0,0,0,.2);border:1px dashed hsla(0,0%,100%,.1);padding:1em}.hint-icon[data-v-69a21231]{color:#6b7280;padding-top:.2em}.hint-title[data-v-69a21231]{font-size:.9em;font-weight:600;color:#e5e7eb;margin-bottom:.25em}.hint-text[data-v-69a21231]{font-size:.85em;color:#9ca3af;line-height:1.6}.sub-hint[data-v-69a21231]{display:block;margin-top:.5em;font-style:italic;opacity:.8}.card-header-row[data-v-69a21231]{display:flex;align-items:center;margin-bottom:1em}.spacer[data-v-69a21231]{flex:1}.status-indicator[data-v-69a21231]{display:flex;align-items:center;gap:.5em;font-family:monospace;font-size:.9em;color:#6b7280;transition:color .2s}.status-indicator .status-dot[data-v-69a21231]{width:.5em;height:.5em;border-radius:50%;background-color:#4b5563;transition:background-color .2s,box-shadow .2s}.status-indicator.active[data-v-69a21231]{color:#a78bfa}.status-indicator.active .status-dot[data-v-69a21231]{background-color:#a78bfa;box-shadow:0 0 8px rgba(167,139,250,.6)}.switch[data-v-69a21231]{position:relative;display:inline-block;width:52px;height:28px}.switch input[data-v-69a21231]{opacity:0;width:0;height:0}.slider[data-v-69a21231]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.4);transition:.3s;border-radius:9999px;border:1px solid hsla(0,0%,100%,.1)}.slider[data-v-69a21231]:before{position:absolute;content:"";height:20px;width:20px;left:3px;top:3px;background-color:#9ca3af;transition:.3s cubic-bezier(0.4,0,0.2,1);border-radius:50%}input:checked+.slider[data-v-69a21231]{background-color:rgba(139,92,246,.2);border-color:rgba(139,92,246,.5)}input:checked+.slider[data-v-69a21231]:before{transform:translateX(24px);background-color:#a78bfa;box-shadow:0 0 10px rgba(167,139,250,.5)}
.settings-section[data-v-11e8c394]{padding:0 .5em}.section-header[data-v-11e8c394]{margin-bottom:2em}.section-title[data-v-11e8c394]{font-size:1.5em;font-weight:600;color:#fff;margin-bottom:.5em}.section-desc[data-v-11e8c394]{color:#9ca3af;font-size:.875em;line-height:1.5}.sidebar-layout[data-v-11e8c394]{display:flex;gap:2em;height:calc(100% - 6em);min-height:500px}.config-column[data-v-11e8c394]{flex:1;display:flex;flex-direction:column;gap:1.5em;overflow-y:auto;padding-right:1em}.preview-column[data-v-11e8c394]{flex:1;display:flex;flex-direction:column}.preview-card[data-v-11e8c394]{flex:1;display:flex;flex-direction:column}.card-body.no-padding[data-v-11e8c394]{padding:0;flex:1;position:relative;background:#000}.sidebar-preview__container[data-v-11e8c394]{width:100%;height:100%;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;background-image:radial-gradient(circle at 50% 50%,#2a2a2e 1px,transparent 1px);background-size:20px 20px}.sidebar-preview__viewport[data-v-11e8c394]{width:100%;height:100%;position:relative;overflow:hidden;background:rgba(0,0,0,.5)}.debug-card[data-v-11e8c394]{background:rgba(0,0,0,.3);border:1px solid hsla(0,0%,100%,.1);border-radius:.75em;overflow:hidden;flex-shrink:0}.card-header[data-v-11e8c394]{display:flex;align-items:center;gap:.75em;padding:1.25em;background:rgba(0,0,0,.3);border-bottom:1px solid hsla(0,0%,100%,.05)}.card-icon[data-v-11e8c394]{color:#a78bfa}.card-title[data-v-11e8c394]{font-size:.875em;font-weight:600;color:#fff}.card-body[data-v-11e8c394]{padding:1.25em}.empty-state[data-v-11e8c394]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2em;color:#9ca3af;text-align:center}.empty-icon[data-v-11e8c394]{margin-bottom:1em;opacity:.5}.empty-hint[data-v-11e8c394]{font-size:.875em;margin-top:.5em}.widget-list[data-v-11e8c394]{display:flex;flex-direction:column;gap:.75em}.widget-item[data-v-11e8c394]{display:flex;align-items:center;gap:1em;padding:1em;background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em;cursor:pointer;transition:all .2s}.widget-item[data-v-11e8c394]:hover{background:hsla(0,0%,100%,.06);border-color:hsla(0,0%,100%,.1)}.widget-item.active[data-v-11e8c394]{background:rgba(139,92,246,.1);border-color:rgba(139,92,246,.3)}.widget-checkbox input[type=checkbox][data-v-11e8c394]{width:1.25em;height:1.25em;cursor:pointer}.widget-info[data-v-11e8c394]{flex:1}.widget-name[data-v-11e8c394]{font-size:.9em;font-weight:500;color:#fff;margin-bottom:.25em}.widget-desc[data-v-11e8c394]{font-size:.75em;color:#9ca3af}.order-list[data-v-11e8c394]{display:flex;flex-direction:column;gap:.5em}.order-item[data-v-11e8c394]{display:flex;align-items:center;gap:1em;padding:.75em;background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.5em}.order-number[data-v-11e8c394]{width:2em;height:2em;display:flex;align-items:center;justify-content:center;background:rgba(139,92,246,.2);border-radius:50%;font-size:.875em;font-weight:bold;color:#a78bfa}.order-name[data-v-11e8c394]{flex:1;font-size:.875em;color:#fff}.order-actions[data-v-11e8c394]{display:flex;gap:.5em}.order-btn[data-v-11e8c394]{width:2em;height:2em;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:.25em;cursor:pointer;color:#fff;transition:all .2s}.order-btn[data-v-11e8c394]:hover:not(:disabled){background:hsla(0,0%,100%,.1)}.order-btn[data-v-11e8c394]:disabled{opacity:.3;cursor:not-allowed}.rotate-90[data-v-11e8c394]{transform:rotate(90deg)}.rotate-270[data-v-11e8c394]{transform:rotate(270deg)}.quick-actions[data-v-11e8c394]{display:flex;gap:1em;justify-content:flex-end}.action-btn[data-v-11e8c394]{padding:.75em 1.5em;background:rgba(0,0,0,0);border:1px solid hsla(0,0%,100%,.2);border-radius:.5em;color:#fff;font-size:.875em;font-weight:500;cursor:pointer;transition:all .2s}.action-btn[data-v-11e8c394]:hover{background:hsla(0,0%,100%,.05);border-color:hsla(0,0%,100%,.3)}.action-btn.outline[data-v-11e8c394]{color:#a78bfa;border-color:#a78bfa}.action-btn.outline[data-v-11e8c394]:hover{background:rgba(167,139,250,.1)}.switch[data-v-11e8c394]{position:relative;display:inline-block;width:52px;height:28px;pointer-events:none}.switch input[data-v-11e8c394]{opacity:0;width:0;height:0}.slider[data-v-11e8c394]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.4);transition:.3s;border-radius:9999px;border:1px solid hsla(0,0%,100%,.1)}.slider[data-v-11e8c394]:before{position:absolute;content:"";height:20px;width:20px;left:3px;top:3px;background-color:#9ca3af;transition:.3s cubic-bezier(0.4,0,0.2,1);border-radius:50%}input:checked+.slider[data-v-11e8c394]{background-color:rgba(139,92,246,.2);border-color:rgba(139,92,246,.5)}input:checked+.slider[data-v-11e8c394]:before{transform:translateX(24px);background-color:#a78bfa;box-shadow:0 0 10px rgba(167,139,250,.5)}.switch.small[data-v-11e8c394]{width:40px;height:22px}.switch.small .slider[data-v-11e8c394]:before{height:16px;width:16px;left:2px;top:2px}.switch.small input:checked+.slider[data-v-11e8c394]:before{transform:translateX(18px)}
.system-tab[data-v-77f1bfd9]{padding:.5em .25em}.tab-title[data-v-77f1bfd9]{margin:0 0 1em 0;font-size:1.1em;font-weight:600;color:#e5e7eb}.setting-group[data-v-77f1bfd9]{display:flex;flex-direction:column;gap:1em}.setting-row[data-v-77f1bfd9]{display:flex;align-items:center;justify-content:space-between;gap:1.25em;padding:1em 1em;border-radius:.75em;border:1px solid hsla(0,0%,100%,.06);background:rgba(0,0,0,.18)}.setting-row.disabled[data-v-77f1bfd9]{opacity:.6}.setting-info[data-v-77f1bfd9]{display:flex;flex-direction:column;gap:.25em}.setting-label[data-v-77f1bfd9]{font-size:.95em;font-weight:600;color:#f3f4f6}.setting-desc[data-v-77f1bfd9]{font-size:.85em;color:hsla(0,0%,100%,.62);line-height:1.35}.number-input[data-v-77f1bfd9]{width:7em;padding:.5em .75em;border-radius:.6em;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.35);color:#e5e7eb;outline:none}.setting-note[data-v-77f1bfd9]{padding:.75em 1em;border-radius:.75em;border:1px dashed hsla(0,0%,100%,.12);color:hsla(0,0%,100%,.6);font-size:.85em;background:rgba(0,0,0,.12)}.switch[data-v-77f1bfd9]{position:relative;display:inline-block;width:44px;height:24px}.switch input[data-v-77f1bfd9]{opacity:0;width:0;height:0}.slider[data-v-77f1bfd9]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,100%,.12);transition:.2s;border-radius:999px}.slider[data-v-77f1bfd9]:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:#c7d2fe;transition:.2s;border-radius:50%}.switch input:checked+.slider[data-v-77f1bfd9]{background-color:rgba(167,139,250,.35)}.switch input:checked+.slider[data-v-77f1bfd9]:before{transform:translateX(20px)}
.settings-section[data-v-3f3e5e2d]{display:flex;flex-direction:column;gap:1.5em}.section-header[data-v-3f3e5e2d]{margin-bottom:.5em}.section-title[data-v-3f3e5e2d]{font-size:1.1em;font-weight:600;color:#fff;margin:0 0 .25em 0}.section-desc[data-v-3f3e5e2d]{font-size:.85em;color:#9ca3af;margin:0}.settings-grid[data-v-3f3e5e2d]{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1.5em;align-items:start}.setting-card[data-v-3f3e5e2d]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;padding:1.25em;display:flex;flex-direction:column;gap:1em;transition:background .2s}.setting-card[data-v-3f3e5e2d]:hover{background:hsla(0,0%,100%,.05)}.full-width-card[data-v-3f3e5e2d]{grid-column:1/-1}.setting-info[data-v-3f3e5e2d]{display:flex;justify-content:space-between;align-items:center}.setting-name[data-v-3f3e5e2d]{color:#e5e7eb;font-size:.95em;font-weight:500;display:flex;align-items:center;gap:.5em}.setting-value[data-v-3f3e5e2d]{color:#a78bfa;font-family:monospace;font-size:.9em;background:rgba(167,139,250,.1);padding:.2em .5em;border-radius:.25em}.setting-control[data-v-3f3e5e2d]{display:flex;align-items:center;gap:1em}.setting-control.wide-control[data-v-3f3e5e2d]{flex:1;width:100%}.range-label[data-v-3f3e5e2d]{font-size:.75em;color:#6b7280;min-width:2em;text-align:center}.range-label.big[data-v-3f3e5e2d]{font-size:1.1em;font-weight:bold;color:#9ca3af}.card-group-title[data-v-3f3e5e2d]{display:flex;align-items:center;gap:.5em;font-weight:600;color:#fff;margin-bottom:.5em;font-size:1em;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.75em}.control-group[data-v-3f3e5e2d]{display:flex;flex-direction:column;gap:1.25em}.setting-row[data-v-3f3e5e2d]{display:flex;flex-direction:column;gap:.5em}.setting-info-compact[data-v-3f3e5e2d]{display:flex;justify-content:space-between;align-items:center}.setting-control.compact[data-v-3f3e5e2d]{gap:0;width:100%}.color-row[data-v-3f3e5e2d]{display:flex;align-items:center;justify-content:space-between}.color-actions[data-v-3f3e5e2d]{display:flex;align-items:center;gap:.5em}.setting-name-compact[data-v-3f3e5e2d]{color:#e5e7eb;font-size:.9em}.color-input.compact[data-v-3f3e5e2d]{width:6em;padding:.25em .5em;font-size:.85em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.12);border-radius:.5em;color:hsla(0,0%,100%,.9);font-family:monospace}.setting-icon[data-v-3f3e5e2d]{color:#a78bfa}.styled-range[data-v-3f3e5e2d]{-webkit-appearance:none;appearance:none;flex:1;height:4px;background:hsla(0,0%,100%,.1);border-radius:2px;outline:none;background-image:linear-gradient(#8b5cf6,#8b5cf6);background-size:var(--progress) 100%;background-repeat:no-repeat;cursor:pointer;margin:0;padding:0;vertical-align:middle}.styled-range[data-v-3f3e5e2d]::-webkit-slider-thumb{-webkit-appearance:none;height:16px;width:16px;border-radius:50%;background:#fff;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.3);-webkit-transition:transform .1s,box-shadow .1s;transition:transform .1s,box-shadow .1s}.styled-range[data-v-3f3e5e2d]:hover::-webkit-slider-thumb{box-shadow:0 0 0 4px rgba(139,92,246,.2)}.styled-range[data-v-3f3e5e2d]:active::-webkit-slider-thumb{transform:scale(1.1);box-shadow:0 0 0 6px rgba(139,92,246,.3)}
.settings-modal-overlay[data-v-40e66e51]{position:absolute;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;background-color:rgba(0,0,0,.8);backdrop-filter:blur(4px)}@media (hover:none)and (pointer:coarse){.settings-modal-overlay[data-v-40e66e51]{backdrop-filter:none}}.settings-modal[data-v-40e66e51]{width:110em;height:60em;background:rgba(30,30,35,.95);border:1px solid hsla(0,0%,100%,.1);border-radius:1em;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 25px 50px -12px rgba(0,0,0,.5)}.settings-header[data-v-40e66e51]{display:flex;justify-content:space-between;align-items:center;padding:1.5em 2em;border-bottom:1px solid hsla(0,0%,100%,.05);background:rgba(0,0,0,.2)}.settings-title[data-v-40e66e51]{display:flex;align-items:center;gap:.75em;font-size:1.1em;font-weight:600;letter-spacing:.1em;color:#fff}.icon-violet[data-v-40e66e51]{color:#a78bfa}.close-btn[data-v-40e66e51]{color:hsla(0,0%,100%,.5);background:none;border:none;cursor:pointer;transition:color .2s}.close-btn[data-v-40e66e51]:hover{color:#fff}.settings-body[data-v-40e66e51]{display:flex;flex:1;overflow:hidden}.settings-sidebar[data-v-40e66e51]{width:14em;border-right:1px solid hsla(0,0%,100%,.05);padding:1.5em 1em;display:flex;flex-direction:column;gap:.5em;background:rgba(0,0,0,.1)}.settings-tab-btn[data-v-40e66e51]{width:100%;text-align:left;padding:.875em 1.25em;border-radius:.5em;font-size:.9em;transition:all .2s;background:none;border:none;cursor:pointer;color:#9ca3af;font-weight:500}.settings-tab-btn[data-v-40e66e51]:hover{background-color:hsla(0,0%,100%,.05);color:#e5e7eb}.settings-tab-btn.active[data-v-40e66e51]{background-color:rgba(139,92,246,.15);color:#c4b5fd;border-left:3px solid #8b5cf6;border-radius:0 .5em .5em 0}.settings-content[data-v-40e66e51]{flex:1;padding:2em 3em;display:flex;flex-direction:column;gap:2em;overflow-y:auto}.settings-section[data-v-40e66e51]{display:flex;flex-direction:column;gap:1.5em}.section-header[data-v-40e66e51]{margin-bottom:.5em}.section-title[data-v-40e66e51]{font-size:1.1em;font-weight:600;color:#fff;margin:0 0 .25em 0}.section-desc[data-v-40e66e51]{font-size:.85em;color:#9ca3af;margin:0}.settings-grid[data-v-40e66e51]{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1.5em;align-items:start}.setting-card[data-v-40e66e51]{background:hsla(0,0%,100%,.03);border:1px solid hsla(0,0%,100%,.05);border-radius:.75em;padding:1.25em;display:flex;flex-direction:column;gap:1em;transition:background .2s}.setting-card[data-v-40e66e51]:hover{background:hsla(0,0%,100%,.05)}.full-width-card[data-v-40e66e51]{grid-column:1/-1}.setting-info[data-v-40e66e51]{display:flex;justify-content:space-between;align-items:center}.setting-name[data-v-40e66e51]{color:#e5e7eb;font-size:.95em;font-weight:500;display:flex;align-items:center;gap:.5em}.setting-value[data-v-40e66e51]{color:#a78bfa;font-family:monospace;font-size:.9em;background:rgba(167,139,250,.1);padding:.2em .5em;border-radius:.25em}.setting-control[data-v-40e66e51]{display:flex;align-items:center;gap:1em}.setting-control.wide-control[data-v-40e66e51]{flex:1;width:100%}.range-label[data-v-40e66e51]{font-size:.75em;color:#6b7280;min-width:2em;text-align:center}.range-label.big[data-v-40e66e51]{font-size:1.1em;font-weight:bold;color:#9ca3af}.card-group-title[data-v-40e66e51]{display:flex;align-items:center;gap:.5em;font-weight:600;color:#fff;margin-bottom:.5em;font-size:1em;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.75em}.control-group[data-v-40e66e51]{display:flex;flex-direction:column;gap:1.25em}.setting-row[data-v-40e66e51]{display:flex;flex-direction:column;gap:.5em}.setting-info-compact[data-v-40e66e51]{display:flex;justify-content:space-between;align-items:center}.setting-control.compact[data-v-40e66e51]{gap:0;width:100%}.color-row[data-v-40e66e51]{display:flex;align-items:center;justify-content:space-between}.color-actions[data-v-40e66e51]{display:flex;align-items:center;gap:.5em}.setting-name-compact[data-v-40e66e51]{color:#e5e7eb;font-size:.9em}.color-input.compact[data-v-40e66e51]{width:6em;padding:.25em .5em;font-size:.85em}.setting-icon[data-v-40e66e51]{color:#a78bfa}.styled-range[data-v-40e66e51]{-webkit-appearance:none;appearance:none;flex:1;height:4px;background:hsla(0,0%,100%,.1);border-radius:2px;outline:none;background-image:linear-gradient(#8b5cf6,#8b5cf6);background-size:var(--progress) 100%;background-repeat:no-repeat;cursor:pointer}.styled-range[data-v-40e66e51]::-webkit-slider-thumb{-webkit-appearance:none;height:16px;width:16px;border-radius:50%;background:#fff;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.3);margin-top:-6px;-webkit-transition:transform .1s,box-shadow .1s;transition:transform .1s,box-shadow .1s}.styled-range[data-v-40e66e51]:hover::-webkit-slider-thumb{box-shadow:0 0 0 4px rgba(139,92,246,.2)}.styled-range[data-v-40e66e51]:active::-webkit-slider-thumb{transform:scale(1.1);box-shadow:0 0 0 6px rgba(139,92,246,.3)}.color-input[data-v-40e66e51]{width:9em;padding:.35em .6em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.12);border-radius:.5em;color:hsla(0,0%,100%,.9);font-family:monospace;font-size:.9em}.toggle-switch[data-v-40e66e51]{width:3em;height:1.5em;background-color:#4b5563;border-radius:9999px;position:relative;cursor:pointer;transition:background .2s}.toggle-knob[data-v-40e66e51]{position:absolute;left:.25em;top:.25em;width:1em;height:1em;background-color:#fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2);transition:transform .2s}.debug-panel[data-v-40e66e51]{padding:1em;background-color:rgba(0,0,0,.3);border-radius:.5em;border:1px solid hsla(0,0%,100%,.05);font-family:monospace;font-size:.75em;color:#4ade80}.debug-row[data-v-40e66e51]{display:flex;justify-content:space-between;margin-bottom:.5em}.debug-row[data-v-40e66e51]:last-child{margin-bottom:0}.debug-label[data-v-40e66e51]{color:#6b7280}.debug-controls[data-v-40e66e51]{display:flex;gap:1em;width:100%;flex-wrap:wrap}.debug-textarea[data-v-40e66e51]{flex:1;width:100%;padding:.5em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;color:#fff;resize:vertical;min-height:4em;font-family:inherit}.action-btn[data-v-40e66e51]{background:#8b5cf6;color:#fff;border:none;padding:.5em 1em;border-radius:.5em;cursor:pointer;font-size:.9em;display:flex;align-items:center;justify-content:center}.action-btn[data-v-40e66e51]:hover{background:#7c3aed}.action-btn.outline[data-v-40e66e51]{background:rgba(0,0,0,0);border:1px solid #8b5cf6;color:#a78bfa}.action-btn.outline[data-v-40e66e51]:hover{background:rgba(139,92,246,.1)}.debug-input-text[data-v-40e66e51]{padding:.5em;background:rgba(0,0,0,.2);border:1px solid hsla(0,0%,100%,.1);border-radius:.5em;color:#fff;width:150px}.preview-label[data-v-40e66e51]{font-size:.8em;color:#9ca3af;margin-bottom:.5em}.file-input[data-v-40e66e51]{color:#a78bfa;font-size:.9em}.preview-box[data-v-40e66e51]{margin-top:1em;width:100%;padding:.5em;background:rgba(0,0,0,.2);border-radius:.5em;text-align:center}.preview-img[data-v-40e66e51]{max-width:100%;max-height:150px;border-radius:.25em}.char-preview[data-v-40e66e51]{max-height:200px;object-fit:contain}
.gaem-overlay[data-v-2b7a117a]{position:fixed;inset:0;z-index:120;background:rgba(0,0,0,.55);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;padding:1.5em}.gaem-dialog[data-v-2b7a117a]{width:min(94vw,167.132vh);aspect-ratio:16/9;font-size:calc(min(94vw,167.132vh)*.0133);height:auto;max-height:94vh;background:rgba(10,10,15,.92);border:1px solid hsla(0,0%,100%,.12);border-radius:1em;overflow:hidden;box-shadow:0 30px 80px rgba(0,0,0,.45);display:flex;flex-direction:column}.gaem-header[data-v-2b7a117a]{display:flex;align-items:center;justify-content:space-between;padding:.9em 1.1em;border-bottom:1px solid hsla(0,0%,100%,.08)}.gaem-title .title[data-v-2b7a117a]{font-size:1.05em;color:hsla(0,0%,100%,.92)}.gaem-title .subtitle[data-v-2b7a117a]{margin-top:.2em;font-size:.85em;color:hsla(0,0%,100%,.6)}.mono[data-v-2b7a117a]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}.gaem-close[data-v-2b7a117a]{background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.75);font-size:1.1em;cursor:pointer;padding:.2em .5em}.gaem-toolbar[data-v-2b7a117a]{display:flex;gap:1em;align-items:end;padding:.9em 1.1em;border-bottom:1px solid hsla(0,0%,100%,.08)}.field[data-v-2b7a117a]{display:flex;flex-direction:column;gap:.35em;flex:1}.label[data-v-2b7a117a]{font-size:.8em;color:hsla(0,0%,100%,.65)}.selectbox[data-v-2b7a117a]{position:relative}.select-trigger[data-v-2b7a117a]{width:100%;height:2.4em;border-radius:.6em;background:hsla(0,0%,100%,.06);border:1px solid hsla(0,0%,100%,.12);color:hsla(0,0%,100%,.9);padding:0 .6em;outline:none;display:flex;align-items:center;justify-content:space-between;gap:.6em;cursor:pointer}.selectbox.disabled .select-trigger[data-v-2b7a117a]{opacity:.55;cursor:not-allowed}.select-value[data-v-2b7a117a]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.select-chevron[data-v-2b7a117a]{opacity:.7;font-size:.95em}.select-menu[data-v-2b7a117a]{position:absolute;top:calc(100% + .45em);left:0;right:0;z-index:10;background:rgba(12,12,18,.98);border:1px solid hsla(0,0%,100%,.12);border-radius:.8em;box-shadow:0 20px 60px rgba(0,0,0,.55);padding:.6em}.select-search[data-v-2b7a117a]{width:100%;height:2.2em;border-radius:.6em;background:hsla(0,0%,100%,.06);border:1px solid hsla(0,0%,100%,.12);color:hsla(0,0%,100%,.9);padding:0 .6em;outline:none}.select-options[data-v-2b7a117a]{margin-top:.55em;max-height:18em;overflow:auto;display:flex;flex-direction:column;gap:.25em}.select-option[data-v-2b7a117a]{text-align:left;padding:.55em .6em;border-radius:.6em;border:1px solid rgba(0,0,0,0);background:rgba(0,0,0,0);color:hsla(0,0%,100%,.88);cursor:pointer;display:flex;align-items:baseline;justify-content:space-between;gap:.6em}.select-option[data-v-2b7a117a]:hover{background:hsla(0,0%,100%,.08)}.select-option.selected[data-v-2b7a117a]{border-color:rgba(139,92,246,.55);background:rgba(139,92,246,.18)}.opt-id[data-v-2b7a117a]{font-size:.75em;color:hsla(0,0%,100%,.5);white-space:nowrap}.dropdown-enter-active[data-v-2b7a117a],.dropdown-leave-active[data-v-2b7a117a]{transition:opacity .12s ease,transform .12s ease}.dropdown-enter-from[data-v-2b7a117a],.dropdown-leave-to[data-v-2b7a117a]{opacity:0;transform:translateY(-4px)}.actions[data-v-2b7a117a]{display:flex;gap:.6em}.btn[data-v-2b7a117a]{height:2.4em;padding:0 .9em;border-radius:.7em;border:1px solid hsla(0,0%,100%,.14);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.9);cursor:pointer}.btn[data-v-2b7a117a]:disabled{opacity:.45;cursor:not-allowed}.btn.primary[data-v-2b7a117a]{border-color:rgba(139,92,246,.55);background:rgba(139,92,246,.22)}.gaem-error[data-v-2b7a117a]{padding:.6em 1.1em;color:#fca5a5;font-size:.9em}.gaem-body[data-v-2b7a117a]{flex:1;overflow:hidden}.loading[data-v-2b7a117a],.empty[data-v-2b7a117a]{padding:1.1em;color:hsla(0,0%,100%,.75)}.hint[data-v-2b7a117a]{margin-top:.4em;color:hsla(0,0%,100%,.6);font-size:.9em}
.variable-node[data-v-ed213a2c]{--indent:calc(var(--depth,0) * 1.5em)}.node-row[data-v-ed213a2c]{display:flex;align-items:center;gap:.5em;padding:.4em .5em;padding-left:calc(var(--indent) + .5em);border-radius:.25em;transition:background .15s}.node-row[data-v-ed213a2c]:hover{background:hsla(0,0%,100%,.05)}.node-row:hover .node-actions[data-v-ed213a2c]{opacity:1}.toggle-btn[data-v-ed213a2c]{padding:.2em;background:rgba(0,0,0,0);border:none;color:#9ca3af;cursor:pointer;display:flex;align-items:center;justify-content:center}.toggle-btn[data-v-ed213a2c]:hover{color:#fff}.toggle-placeholder[data-v-ed213a2c]{width:1.2em}.key-name[data-v-ed213a2c]{color:#e0e7ff;font-family:"Fira Code",monospace;font-size:.9em}.type-badge[data-v-ed213a2c]{padding:.15em .5em;border-radius:9999px;font-size:.72em;font-weight:600;background:hsla(0,0%,100%,.08);color:hsla(0,0%,100%,.75)}.type-badge.string[data-v-ed213a2c]{background:rgba(59,130,246,.15);color:#93c5fd}.type-badge.number[data-v-ed213a2c]{background:rgba(16,185,129,.15);color:#6ee7b7}.type-badge.boolean[data-v-ed213a2c]{background:rgba(245,158,11,.15);color:#fcd34d}.type-badge.object[data-v-ed213a2c],.type-badge.array[data-v-ed213a2c]{background:rgba(139,92,246,.15);color:#c4b5fd}.type-badge.null[data-v-ed213a2c],.type-badge.undefined[data-v-ed213a2c]{background:rgba(239,68,68,.12);color:#fca5a5}.value-preview[data-v-ed213a2c]{margin-left:.25em;color:hsla(0,0%,100%,.55);font-size:.85em;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.value-preview.dim[data-v-ed213a2c]{color:hsla(0,0%,100%,.35)}.node-actions[data-v-ed213a2c]{margin-left:auto;display:flex;gap:.35em;opacity:0;transition:opacity .15s}.action-btn[data-v-ed213a2c]{width:1.8em;height:1.8em;border-radius:.5em;border:1px solid hsla(0,0%,100%,.1);background:hsla(0,0%,100%,.04);color:hsla(0,0%,100%,.8);cursor:pointer;display:flex;align-items:center;justify-content:center}.action-btn[data-v-ed213a2c]:hover{background:hsla(0,0%,100%,.08)}.action-btn.delete[data-v-ed213a2c]{border-color:rgba(239,68,68,.25);color:rgba(252,165,165,.95)}.action-btn.delete[data-v-ed213a2c]:hover{background:rgba(239,68,68,.12)}.node-children[data-v-ed213a2c]{margin-left:0}.edit-overlay[data-v-ed213a2c]{position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;padding:2em}.edit-modal[data-v-ed213a2c]{width:min(560px,92vw);background:rgba(15,15,25,.94);border:1px solid hsla(0,0%,100%,.12);border-radius:14px;padding:1em 1.25em;color:hsla(0,0%,100%,.9)}.edit-modal h4[data-v-ed213a2c]{margin:0 0 .75em;font-size:1.05em}.edit-field[data-v-ed213a2c]{display:flex;flex-direction:column;gap:.4em;margin-bottom:.85em}.edit-field label[data-v-ed213a2c]{font-size:.85em;color:hsla(0,0%,100%,.6)}.edit-field input[data-v-ed213a2c],.edit-field select[data-v-ed213a2c],.edit-field textarea[data-v-ed213a2c]{border-radius:10px;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.35);color:hsla(0,0%,100%,.9);padding:.65em .75em;font-family:"Fira Code",monospace;font-size:.9em}.edit-field input[data-v-ed213a2c]:focus,.edit-field select[data-v-ed213a2c]:focus,.edit-field textarea[data-v-ed213a2c]:focus{outline:none;border-color:rgba(139,92,246,.65);box-shadow:0 0 0 3px rgba(139,92,246,.15)}.edit-field textarea.json[data-v-ed213a2c]{min-height:160px;resize:vertical;font-family:"Fira Code",monospace}.edit-field .hint[data-v-ed213a2c]{font-size:.8em;color:hsla(0,0%,100%,.45)}.preset-row[data-v-ed213a2c]{display:flex;flex-wrap:wrap;gap:.45em;margin-bottom:.1em}.preset-btn[data-v-ed213a2c]{padding:.35em .75em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.12);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.85);cursor:pointer;font-size:.85em}.preset-btn[data-v-ed213a2c]:hover{background:hsla(0,0%,100%,.1)}.mono[data-v-ed213a2c]{font-family:"Fira Code",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}.edit-actions[data-v-ed213a2c]{display:flex;justify-content:flex-end;gap:.75em}.edit-actions button[data-v-ed213a2c]{padding:.55em 1em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.12);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.9);cursor:pointer}.edit-actions button[data-v-ed213a2c]:hover{background:hsla(0,0%,100%,.1)}.edit-actions .save-btn[data-v-ed213a2c]{border-color:rgba(139,92,246,.6);background:rgba(139,92,246,.2)}.edit-actions .save-btn[data-v-ed213a2c]:hover{background:rgba(139,92,246,.28)}.edit-actions .cancel-btn[data-v-ed213a2c]{color:hsla(0,0%,100%,.75)}
.vem-overlay[data-v-698cb22e]{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;padding:2em}.vem-dialog[data-v-698cb22e]{width:min(94vw,167.132vh);aspect-ratio:16/9;font-size:calc(min(94vw,167.132vh)*.0133);height:auto;max-height:94vh;background:rgba(15,15,25,.92);border:1px solid hsla(0,0%,100%,.12);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.55);display:flex;flex-direction:column;overflow:hidden}.vem-header[data-v-698cb22e]{display:flex;align-items:center;justify-content:space-between;padding:1em 1.25em;border-bottom:1px solid hsla(0,0%,100%,.08)}.vem-title .title[data-v-698cb22e]{font-size:1.1em;font-weight:700;color:hsla(0,0%,100%,.92)}.vem-title .subtitle[data-v-698cb22e]{margin-top:.25em;font-size:.9em;color:hsla(0,0%,100%,.55)}.vem-title .subtitle .sep[data-v-698cb22e]{margin:0 .5em}.mono[data-v-698cb22e]{font-family:"Fira Code",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}.vem-close[data-v-698cb22e]{width:2.25em;height:2.25em;border-radius:.6em;border:1px solid hsla(0,0%,100%,.12);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.85);cursor:pointer}.vem-close[data-v-698cb22e]:hover{background:hsla(0,0%,100%,.1)}.vem-toolbar[data-v-698cb22e]{display:flex;justify-content:space-between;align-items:center;padding:.75em 1.25em;gap:1em;border-bottom:1px solid hsla(0,0%,100%,.06)}.vem-toolbar .left[data-v-698cb22e],.vem-toolbar .right[data-v-698cb22e]{display:flex;gap:.5em;align-items:center}.btn[data-v-698cb22e]{padding:.55em .9em;border-radius:9999px;border:1px solid hsla(0,0%,100%,.12);background:hsla(0,0%,100%,.06);color:hsla(0,0%,100%,.9);cursor:pointer;transition:all .2s}.btn[data-v-698cb22e]:hover{background:hsla(0,0%,100%,.1)}.btn[data-v-698cb22e]:disabled{opacity:.5;cursor:not-allowed}.btn.primary[data-v-698cb22e]{border-color:rgba(139,92,246,.6);background:rgba(139,92,246,.2)}.btn.primary[data-v-698cb22e]:hover{background:rgba(139,92,246,.28)}.vem-error[data-v-698cb22e]{padding:.75em 1.25em;color:#fca5a5;border-bottom:1px solid hsla(0,0%,100%,.06);background:rgba(239,68,68,.08)}.vem-body[data-v-698cb22e]{flex:1;min-height:0;display:flex;padding:1em 1.25em 1.25em}.loading[data-v-698cb22e]{color:hsla(0,0%,100%,.7)}.tree-wrap[data-v-698cb22e]{flex:1;min-height:0;display:grid;grid-template-columns:1fr .9fr;gap:1em}.info-hint[data-v-698cb22e]{grid-column:1/-1;padding:.75em .9em;border:1px solid hsla(0,0%,100%,.08);border-radius:12px;background:hsla(0,0%,100%,.04);color:hsla(0,0%,100%,.7);font-size:.9em}.tree-view[data-v-698cb22e]{min-height:0;overflow:auto;border-radius:12px;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.25);padding:.5em .25em}.json-preview[data-v-698cb22e]{min-height:0;overflow:auto;border-radius:12px;border:1px solid hsla(0,0%,100%,.12);background:rgba(0,0,0,.25);padding:.75em}.preview-header[data-v-698cb22e]{display:flex;align-items:center;justify-content:space-between;gap:.75em;margin-bottom:.5em}.preview-title[data-v-698cb22e]{font-size:.95em;font-weight:700;color:hsla(0,0%,100%,.85)}.schema-code[data-v-698cb22e]{margin:0;white-space:pre-wrap;word-break:break-word;font-family:"Fira Code",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:.85em;line-height:1.35;color:hsla(0,0%,100%,.8)}.fade-enter-active[data-v-698cb22e],.fade-leave-active[data-v-698cb22e]{transition:opacity .18s ease}.fade-enter-from[data-v-698cb22e],.fade-leave-to[data-v-698cb22e]{opacity:0}
.main-game-view[data-v-0a73a0b2]{position:fixed;inset:0;width:var(--stable-vw,100%);height:var(--stable-vh,100%);overflow:hidden;background-color:#000;-webkit-user-select:none;user-select:none;font-family:sans-serif;font-size:.85vw;color:#fff;line-height:normal}[data-v-0a73a0b2] input,[data-v-0a73a0b2] textarea,[data-v-0a73a0b2] button{font-family:inherit;font-size:inherit}.background-layer[data-v-0a73a0b2]{position:absolute;inset:0;z-index:0;display:flex;align-items:center;justify-content:center;background-color:#000;overflow:hidden}.bg-frame[data-v-0a73a0b2]{position:relative;width:100%;height:100%;aspect-ratio:16/9;max-width:calc(var(--stable-vh,100vh)*16/9);max-height:56.25vw;overflow:hidden}.bg-image[data-v-0a73a0b2]{width:100%;height:100%;object-fit:cover;object-position:center;opacity:.6;transition:transform 20s linear;transform:scale(1.05)}.bg-image[data-v-0a73a0b2]:hover{transform:scale(1)}.bg-gradient[data-v-0a73a0b2]{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.9),transparent,rgba(0,0,0,0.3))}.character-layer[data-v-0a73a0b2]{position:absolute;inset:0;z-index:5;pointer-events:none;bottom:15%;transform:translateZ(0)}.char-img[data-v-0a73a0b2]{position:absolute;object-fit:contain;object-position:bottom center;filter:drop-shadow(0 5px 20px rgba(0,0,0,0.6)) drop-shadow(0 15px 40px rgba(0,0,0,0.4));transition:left .4s cubic-bezier(0.4,0,0.2,1),bottom .4s cubic-bezier(0.4,0,0.2,1),height .4s cubic-bezier(0.4,0,0.2,1),transform .4s cubic-bezier(0.4,0,0.2,1),opacity .3s ease}.dynamic-char[data-v-0a73a0b2]{left:50%;bottom:0;transform:translateX(-50%);height:75%;animation:char-breathe-0a73a0b2 4s ease-in-out infinite}@keyframes char-breathe-0a73a0b2{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(-0.5%)}}@media (hover:none)and (pointer:coarse)and (max-width:1024px){.bg-image[data-v-0a73a0b2]{transition:none !important;transform:none !important}.dynamic-char[data-v-0a73a0b2]{animation:none !important}.char-img[data-v-0a73a0b2]{filter:drop-shadow(0 4px 14px rgba(0,0,0,0.45)) !important}}.big-guy[data-v-0a73a0b2]{left:10%;height:calc(var(--stable-vh,100vh)*.8);filter:brightness(0.75) drop-shadow(0 10px 30px rgba(0,0,0,0.8))}.anime-girl[data-v-0a73a0b2]{right:15%;height:calc(var(--stable-vh,100vh)*.85)}.fade-scale-enter-active[data-v-0a73a0b2],.fade-scale-leave-active[data-v-0a73a0b2]{transition:opacity .3s,transform .3s}.fade-scale-enter-from[data-v-0a73a0b2],.fade-scale-leave-to[data-v-0a73a0b2]{opacity:0;transform:scale(0.95)}.slide-left-enter-active[data-v-0a73a0b2],.slide-left-leave-active[data-v-0a73a0b2]{transition:opacity 1s,transform 1s}.slide-left-enter-from[data-v-0a73a0b2]{opacity:0;transform:translateX(-50px)}.slide-right-enter-active[data-v-0a73a0b2],.slide-right-leave-active[data-v-0a73a0b2]{transition:opacity 1s,transform 1s;transition-delay:.2s}.slide-right-enter-from[data-v-0a73a0b2]{opacity:0;transform:translateX(50px)}.fade-enter-active[data-v-0a73a0b2],.fade-leave-active[data-v-0a73a0b2]{transition:opacity .3s ease}.fade-enter-from[data-v-0a73a0b2],.fade-leave-to[data-v-0a73a0b2]{opacity:0}.temp-message[data-v-0a73a0b2]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:12050;padding:1em 2em;border-radius:12px;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);color:hsla(0,0%,100%,.9);font-size:1em;font-weight:500;letter-spacing:.05em;box-shadow:0 8px 32px rgba(0,0,0,.4);border:1px solid hsla(0,0%,100%,.1);pointer-events:none}.temp-message.success[data-v-0a73a0b2]{border-color:rgba(100,200,150,.3);background:rgba(20,40,30,.9)}.log-overlay[data-v-0a73a0b2]{position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,.7);backdrop-filter:blur(5px);display:flex;justify-content:center;align-items:center}.log-panel[data-v-0a73a0b2]{width:80%;max-width:800px;height:80%;background:rgba(20,25,35,.95);border:1px solid hsla(0,0%,100%,.1);border-radius:12px;display:flex;flex-direction:column;box-shadow:0 20px 50px rgba(0,0,0,.8)}.log-header[data-v-0a73a0b2]{padding:15px 20px;border-bottom:1px solid hsla(0,0%,100%,.1);display:flex;justify-content:space-between;align-items:center;font-size:1.2em;font-weight:bold;color:#fff}.close-btn[data-v-0a73a0b2]{background:none;border:none;color:hsla(0,0%,100%,.5);font-size:1.5em;cursor:pointer;transition:color .2s}.close-btn[data-v-0a73a0b2]:hover{color:#fff}.log-content[data-v-0a73a0b2]{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:15px}.log-item[data-v-0a73a0b2]{display:flex;flex-direction:column;gap:5px;padding:10px;border-bottom:1px solid hsla(0,0%,100%,.05);border-radius:6px;transition:background .2s}.log-item.clickable[data-v-0a73a0b2]{cursor:pointer}.log-item.clickable[data-v-0a73a0b2]:hover{background:hsla(0,0%,100%,.05)}.log-item[data-v-0a73a0b2]:last-child{border-bottom:none}.log-item-header[data-v-0a73a0b2]{display:flex;justify-content:space-between;align-items:center}.log-jump-btn[data-v-0a73a0b2]{display:flex;align-items:center;gap:.4em;background:rgba(139,92,246,.1);border:1px solid rgba(139,92,246,.3);color:#a78bfa;font-size:.75em;padding:.25em .6em;border-radius:.3em;cursor:pointer;opacity:.7;transition:all .2s}.log-jump-btn[data-v-0a73a0b2]:hover{opacity:1;background:rgba(139,92,246,.2);transform:translateY(-1px)}.log-name[data-v-0a73a0b2]{font-size:.9em;color:#a78bfa;font-weight:bold}.log-text[data-v-0a73a0b2]{font-size:1em;color:hsla(0,0%,100%,.9);line-height:1.5;white-space:pre-wrap}.exit-confirm-overlay[data-v-0a73a0b2]{position:fixed;inset:0;z-index:3000;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:flex;justify-content:center;align-items:center}.exit-confirm-dialog[data-v-0a73a0b2]{background:rgba(20,25,35,.95);border:1px solid hsla(0,0%,100%,.1);border-radius:1em;padding:2em;text-align:center;max-width:400px;box-shadow:0 25px 50px rgba(0,0,0,.5)}.exit-confirm-dialog .dialog-icon[data-v-0a73a0b2]{color:#fbbf24;margin-bottom:1em}.exit-confirm-dialog h3[data-v-0a73a0b2]{margin:0 0 .75em 0;font-size:1.25em;font-weight:500;color:#fff}.exit-confirm-dialog p[data-v-0a73a0b2]{margin:0 0 1.5em 0;font-size:.9em;color:hsla(0,0%,100%,.7);line-height:1.6}.dialog-actions[data-v-0a73a0b2]{display:flex;gap:1em;justify-content:center}.dialog-actions button[data-v-0a73a0b2]{padding:.75em 1.5em;border-radius:.5em;font-size:.875em;cursor:pointer;transition:all .2s}.dialog-actions .btn-cancel[data-v-0a73a0b2]{background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);color:hsla(0,0%,100%,.7)}.dialog-actions .btn-cancel[data-v-0a73a0b2]:hover{background:hsla(0,0%,100%,.1);color:#fff}.dialog-actions .btn-confirm[data-v-0a73a0b2]{background:rgba(239,68,68,.2);border:1px solid rgba(239,68,68,.3);color:#fca5a5}.dialog-actions .btn-confirm[data-v-0a73a0b2]:hover{background:rgba(239,68,68,.3);border-color:rgba(239,68,68,.5)}
</style></head><body><div id="app"></div></body>